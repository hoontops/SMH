<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="smh.pcm.dao.PCMWipDao">
	<insert id="insertPcmLotequipment" parameterType="map">
	    INSERT 
	      INTO PCM_LOTEQUIPMENT(  LOTID  
	                            , TXNHISTKEY  
	                            , EQUIPMENTID  
	                            , PROCESSSTATE  
	                            , PROCESSSEGMENTID  
	                            , PROCESSSEGMENTVERSION  
	                            , WORKCOUNT  
	                            , RECEIVETIME  
	                            , TRACKINTIME  
	                            , TRACKOUTTIME  
	                            , LOTQTY  
	                            , DESCRIPTION  
	                            , CREATOR  
	                            , CREATEDTIME  
	                            , MODIFIER  
	                            , MODIFIEDTIME  
	                            , TXNGROUPHISTKEY  
	                            , TXNID  
	                            , TXNUSER  
	                            , TXNTIME  
	                            , TXNREASONCODECLASS  
	                            , TXNREASONCODE  
	                            , TXNCOMMENT  
	                            , RECIPEID  
	                            , RECIPEVERSION  
	                            , RECIPETYPE        
	                           ) VALUES (  #{LOTID}  
	                                     , #{TXNHISTKEY}  
	                                     , #{EQUIPMENTID}  
	                                     , #{PROCESSSTATE}  
	                                     , #{PROCESSSEGMENTID}  
	                                     , #{PROCESSSEGMENTVERSION}  
	                                     , #{WORKCOUNT}  
	                                     , #{RECEIVETIME}  
	                                     , #{TRACKINTIME}  
	                                     , #{TRACKOUTTIME}  
	                                     , #{LOTQTY}  
	                                     , #{DESCRIPTION}  
	                                     , #{CREATOR}  
	                                     , SYSDATE  
	                                     , #{MODIFIER}  
	                                     , SYSDATE  
	                                     , #{TXNGROUPHISTKEY}  
	                                     , #{TXNID}  
	                                     , #{TXNUSER}  
	                                     , SYSDATE
	                                     , #{TXNREASONCODECLASS}  
	                                     , #{TXNREASONCODE}  
	                                     , #{TXNCOMMENT}  
	                                     , #{RECIPEID}  
	                                     , #{RECIPEVERSION}  
	                                     , #{RECIPETYPE}    
	                                    )
	</insert> 

	<delete id="deletePcmLotworkresult" parameterType="map" > 
	    DELETE 
	      FROM PCM_LOTWORKRESULT 
	     WHERE LOTID      = #{LOTID}
	       AND TXNHISTKEY = #{TXNHISTKEY}
	</delete>
	<insert id="insertPcmLotcomment" parameterType="map">
	    INSERT 
	      INTO PCM_LOTCOMMENT(  LOTID  
	                          , TXNHISTKEY  
	                          , ENTERPRISEID  
	                          , PLANTID  
	                          , AREAID  
	                          , PRODUCTDEFID  
	                          , PRODUCTDEFVERSION  
	                          , PROCESSDEFID  
	                          , PROCESSDEFVERSION  
	                          , PROCESSPATHID  
	                          , USERSEQUENCE  
	                          , PROCESSSEGMENTID  
	                          , PROCESSSEGMENTVERSION  
	                          , WORKCOUNT  
	                          , PROCESSSTATE  
	                          , TRANSITIONID  
	                          , COMMENTS  
	                          , TXNGROUPHISTKEY  
	                          , CREATOR  
	                          , CREATEDTIME        
	                         )  VALUES (  #{LOTID}  
	                                    , #{TXNHISTKEY}  
	                                    , #{ENTERPRISEID}  
	                                    , #{PLANTID}  
	                                    , #{AREAID}  
	                                    , #{PRODUCTDEFID}  
	                                    , #{PRODUCTDEFVERSION}  
	                                    , #{PROCESSDEFID}  
	                                    , #{PROCESSDEFVERSION}  
	                                    , #{PROCESSPATHID}  
	                                    , #{USERSEQUENCE}  
	                                    , #{PROCESSSEGMENTID}  
	                                    , #{PROCESSSEGMENTVERSION}  
	                                    , #{WORKCOUNT}  
	                                    , #{PROCESSSTATE}  
	                                    , #{TRANSITIONID}  
	                                    , #{COMMENTS}  
	                                    , #{TXNGROUPHISTKEY}  
	                                    , #{CREATOR}  
	                                    , SYSDATE    
	                                   )
	</insert>
	<update id="updatePcmLot" parameterType="map" >
		UPDATE PCM_LOT 
		   SET PRODUCTIONORDERID       = #{PRODUCTIONORDERID}     
		       , LINENO                = #{LINENO}     
		       , LOTGROUPID            = #{LOTGROUPID}     
		       , LOTNAME               = #{LOTNAME}     
		       , ENTERPRISEID          = #{ENTERPRISEID}     
		       , PLANTID               = #{PLANTID}     
		       , FACTORYID             = #{FACTORYID}     
		       , ORIGINALPLANTID       = #{ORIGINALPLANTID}     
		       , AREAID                = #{AREAID}     
		       , EQUIPMENTID           = #{EQUIPMENTID}     
		       , LOCATIONID            = #{LOCATIONID}     
		       , RECIPEDEFID           = #{RECIPEDEFID}     
		       , RECIPEDEFVERSION      = #{RECIPEDEFVERSION}     
		       , RAWMATERIALID         = #{RAWMATERIALID}     
		       , ROOTLOTID             = #{ROOTLOTID}     
		       , PARENTLOTID           = #{PARENTLOTID}     
		       , CHILDLOTID            = #{CHILDLOTID}     
		       , CARRIERID             = #{CARRIERID}     
		       , LOTTYPE               = #{LOTTYPE}     
		       , LOTCREATEDTYPE        = #{LOTCREATEDTYPE}     
		       , LOTINPUTTYPE          = #{LOTINPUTTYPE}     
		       , ISREPRESENTROLLLOT    = #{ISREPRESENTROLLLOT}     
		       , HASSUBLOT             = #{HASSUBLOT}     
		       , PRODUCTDEFID          = #{PRODUCTDEFID}     
		       , PRODUCTDEFVERSION     = #{PRODUCTDEFVERSION}     
		       , PREVPRODUCTDEFVERSION = #{PREVPRODUCTDEFVERSION}     
		       , PROCESSDEFID          = #{PROCESSDEFID}     
		       , PROCESSDEFVERSION     = #{PROCESSDEFVERSION}     
		       , PROCESSPATHSTACK      = #{PROCESSPATHSTACK}     
		       , USERSEQUENCE          = #{USERSEQUENCE}     
		       , PROCESSSEGMENTID      = #{PROCESSSEGMENTID}     
		       , PROCESSSEGMENTVERSION = #{PROCESSSEGMENTVERSION}     
		       , PRIORITY              = #{PRIORITY}     
		       , DUEDATE               = #{DUEDATE}     
		       , EXPECTEDCOMPLETEDATE  = #{EXPECTEDCOMPLETEDATE}     
		       , ROOTLOTSTARTDATE      = #{ROOTLOTSTARTDATE}     
		       , LOTSTARTDATE          = #{LOTSTARTDATE}     
		       , WEEK                  = #{WEEK}     
		       , TRACKINUSER           = #{TRACKINUSER}     
		       , TRACKINTIME           = #{TRACKINTIME}     
		       , TRACKOUTUSER          = #{TRACKOUTUSER}     
		       , TRACKOUTTIME          = #{TRACKOUTTIME}     
		       , LOTSTATE              = #{LOTSTATE}     
		       , PROCESSSTATE          = #{PROCESSSTATE}     
		       , ISHOLD                = #{ISHOLD}     
		       , ISREWORK              = #{ISREWORK}     
		       , ISLOCKING             = #{ISLOCKING}     
		       , REWORKTYPE            = #{REWORKTYPE}     
		       , REWORKREASONCODE      = #{REWORKREASONCODE}     
		       , ISPRINTLOTCARD        = #{ISPRINTLOTCARD}     
		       , ISPRINTRCLOTCARD      = #{ISPRINTRCLOTCARD}     
		       , LAYER                 = #{LAYER}     
		       , CREATEDQTY            = #{CREATEDQTY}     
		       , LOTSTDPANELQTY        = #{LOTSTDPANELQTY}     
		       , UNIT                  = #{UNIT}     
		       , DEFECTUNIT            = #{DEFECTUNIT}     
		       , QTY                   = #{QTY}     
		       , DEFECTQTY             = #{DEFECTQTY}     
		       , PSEUDODEFECTQTY       = #{PSEUDODEFECTQTY}     
		       , PCSQTY                = #{PCSQTY}     
		       , ARRAYQTY              = #{ARRAYQTY}     
		       , PANELQTY              = #{PANELQTY}     
		       , PANELPERQTY           = #{PANELPERQTY}     
		       , REWORKCOUNT           = #{REWORKCOUNT}     
		       , TOTALREWORKCOUNT      = #{TOTALREWORKCOUNT}     
		       , PUREORDER             = #{PUREORDER}     
		       , PUREINPUT             = #{PUREINPUT}     
		       , SUBPROCESSDEFID       = #{SUBPROCESSDEFID}     
		       , SUBPROCESSDEFVERSION  = #{SUBPROCESSDEFVERSION}     
		       , RECEIVEUSER           = #{RECEIVEUSER}     
		       , RECEIVETIME           = #{RECEIVETIME}     
		       , STARTEDUSER           = #{STARTEDUSER}     
		       , STARTEDDATE           = #{STARTEDDATE}     
		       , SENDUSER              = #{SENDUSER}     
		       , SENDTIME              = #{SENDTIME}     
		       , HANDLETYPE            = #{HANDLETYPE}     
		       , DESCRIPTION           = #{DESCRIPTION}                     
		       , MODIFIER              = #{MODIFIER}     
		       , MODIFIEDTIME          = SYSDATE
		       , LASTTXNHISTKEY        = #{LASTTXNHISTKEY}     
		       , LASTTXNID             = #{LASTTXNID}     
		       , LASTTXNUSER           = #{LASTTXNUSER}     
		       , LASTTXNTIME           = SYSDATE     
		       , LASTTXNCOMMENT        = #{LASTTXNCOMMENT}     
		       , ISDEFECTED            = #{ISDEFECTED}    
		       , WORKCOUNT             = #{WORKCOUNT}     
		       , RESOURCEID            = #{RESOURCEID}     
		       , MKLOTID               = #{MKLOTID}     
		       , PREVPRODUCTDEFID      = #{PREVPRODUCTDEFID}     
		       , PNLROOTLOTID          = #{PNLROOTLOTID}     
		       , PNLCREATEDQTY         = #{PNLCREATEDQTY}     
		       , INPUTCONFIRMDATE      = #{INPUTCONFIRMDATE}     
		       , INPUTCONFIRMUSER      = #{INPUTCONFIRMUSER}     
		       , ISFINALINSPECTPROGESS = #{ISFINALINSPECTPROGESS}     
		       , LOTINPUTQTY           = #{LOTINPUTQTY}     
		       , ISFIRSTCREATELOT      = #{ISFIRSTCREATELOT}     
		       , ISOEM                 = #{ISOEM}     
		       , ISSHRINKTEST          = #{ISSHRINKTEST}
		   WHERE LOTID                 = #{LOTID}
	</update>
	<insert id="insertPcmLot" parameterType="map">
	    INSERT 
	      INTO PCM_LOT(  LOTID  
	                   , PRODUCTIONORDERID  
	                   , LINENO  
	                   , LOTGROUPID  
	                   , LOTNAME  
	                   , ENTERPRISEID  
	                   , PLANTID  
	                   , FACTORYID  
	                   , ORIGINALPLANTID  
	                   , AREAID  
	                   , EQUIPMENTID  
	                   , LOCATIONID  
	                   , RECIPEDEFID  
	                   , RECIPEDEFVERSION  
	                   , RAWMATERIALID  
	                   , ROOTLOTID  
	                   , PARENTLOTID  
	                   , CHILDLOTID  
	                   , CARRIERID  
	                   , LOTTYPE  
	                   , LOTCREATEDTYPE  
	                   , LOTINPUTTYPE  
	                   , ISREPRESENTROLLLOT  
	                   , HASSUBLOT  
	                   , PRODUCTDEFID  
	                   , PRODUCTDEFVERSION  
	                   , PREVPRODUCTDEFVERSION  
	                   , PROCESSDEFID  
	                   , PROCESSDEFVERSION  
	                   , PROCESSPATHSTACK  
	                   , USERSEQUENCE  
	                   , PROCESSSEGMENTID  
	                   , PROCESSSEGMENTVERSION  
	                   , PRIORITY  
	                   , DUEDATE  
	                   , EXPECTEDCOMPLETEDATE  
	                   , ROOTLOTSTARTDATE  
	                   , LOTSTARTDATE  
	                   , WEEK  
	                   , TRACKINUSER  
	                   , TRACKINTIME  
	                   , TRACKOUTUSER  
	                   , TRACKOUTTIME  
	                   , LOTSTATE  
	                   , PROCESSSTATE  
	                   , ISHOLD  
	                   , ISREWORK  
	                   , ISLOCKING  
	                   , REWORKTYPE  
	                   , REWORKREASONCODE  
	                   , ISPRINTLOTCARD  
	                   , ISPRINTRCLOTCARD  
	                   , LAYER  
	                   , CREATEDQTY  
	                   , LOTSTDPANELQTY  
	                   , UNIT  
	                   , DEFECTUNIT  
	                   , QTY  
	                   , DEFECTQTY  
	                   , PSEUDODEFECTQTY  
	                   , PCSQTY  
	                   , ARRAYQTY  
	                   , PANELQTY  
	                   , PANELPERQTY  
	                   , REWORKCOUNT  
	                   , TOTALREWORKCOUNT  
	                   , PUREORDER  
	                   , PUREINPUT  
	                   , SUBPROCESSDEFID  
	                   , SUBPROCESSDEFVERSION  
	                   , RECEIVEUSER  
	                   , RECEIVETIME  
	                   , STARTEDUSER  
	                   , STARTEDDATE  
	                   , SENDUSER  
	                   , SENDTIME  
	                   , HANDLETYPE  
	                   , DESCRIPTION  
	                   , CREATOR  
	                   , CREATEDTIME  
	                   , MODIFIER  
	                   , MODIFIEDTIME  
	                   , LASTTXNHISTKEY  
	                   , LASTTXNID  
	                   , LASTTXNUSER  
	                   , LASTTXNTIME  
	                   , LASTTXNCOMMENT  
	                   , ISDEFECTED  
	                   , LASTTXNGROUPHISTKEY  
	                   , WORKCOUNT  
	                   , RESOURCEID  
	                   , MKLOTID  
	                   , PREVPRODUCTDEFID  
	                   , PNLROOTLOTID  
	                   , PNLCREATEDQTY  
	                   , INPUTCONFIRMDATE  
	                   , INPUTCONFIRMUSER  
	                   , ISFINALINSPECTPROGESS  
	                   , LOTINPUTQTY  
	                   , ISFIRSTCREATELOT  
	                   , ISOEM  
	                   , ISSHRINKTEST        
	                  )  VALUES (  #{LOTID}  
	                             , #{PRODUCTIONORDERID}  
	                             , #{LINENO}  
	                             , #{LOTGROUPID}  
	                             , #{LOTNAME}  
	                             , #{ENTERPRISEID}  
	                             , #{PLANTID}  
	                             , #{FACTORYID}  
	                             , #{ORIGINALPLANTID}  
	                             , #{AREAID}  
	                             , #{EQUIPMENTID}  
	                             , #{LOCATIONID}  
	                             , #{RECIPEDEFID}  
	                             , #{RECIPEDEFVERSION}  
	                             , #{RAWMATERIALID}  
	                             , #{ROOTLOTID}  
	                             , #{PARENTLOTID}  
	                             , #{CHILDLOTID}  
	                             , #{CARRIERID}  
	                             , #{LOTTYPE}  
	                             , #{LOTCREATEDTYPE}  
	                             , #{LOTINPUTTYPE}  
	                             , #{ISREPRESENTROLLLOT}  
	                             , #{HASSUBLOT}  
	                             , #{PRODUCTDEFID}  
	                             , #{PRODUCTDEFVERSION}  
	                             , #{PREVPRODUCTDEFVERSION}  
	                             , #{PROCESSDEFID}  
	                             , #{PROCESSDEFVERSION}  
	                             , #{PROCESSPATHSTACK}  
	                             , #{USERSEQUENCE}  
	                             , #{PROCESSSEGMENTID}  
	                             , #{PROCESSSEGMENTVERSION}  
	                             , #{PRIORITY}  
	                             , #{DUEDATE}  
	                             , #{EXPECTEDCOMPLETEDATE}  
	                             , #{ROOTLOTSTARTDATE}  
	                             , #{LOTSTARTDATE}  
	                             , #{WEEK}  
	                             , #{TRACKINUSER}  
	                             , #{TRACKINTIME}  
	                             , #{TRACKOUTUSER}  
	                             , #{TRACKOUTTIME}  
	                             , #{LOTSTATE}  
	                             , #{PROCESSSTATE}  
	                             , #{ISHOLD}  
	                             , #{ISREWORK}  
	                             , #{ISLOCKING}  
	                             , #{REWORKTYPE}  
	                             , #{REWORKREASONCODE}  
	                             , #{ISPRINTLOTCARD}  
	                             , #{ISPRINTRCLOTCARD}  
	                             , #{LAYER}  
	                             , #{CREATEDQTY}  
	                             , #{LOTSTDPANELQTY}  
	                             , #{UNIT}  
	                             , #{DEFECTUNIT}  
	                             , #{QTY}  
	                             , #{DEFECTQTY}  
	                             , #{PSEUDODEFECTQTY}  
	                             , #{PCSQTY}  
	                             , #{ARRAYQTY}  
	                             , #{PANELQTY}  
	                             , #{PANELPERQTY}  
	                             , #{REWORKCOUNT}  
	                             , #{TOTALREWORKCOUNT}  
	                             , #{PUREORDER}  
	                             , #{PUREINPUT}  
	                             , #{SUBPROCESSDEFID}  
	                             , #{SUBPROCESSDEFVERSION}  
	                             , #{RECEIVEUSER}  
	                             , #{RECEIVETIME}  
	                             , #{STARTEDUSER}  
	                             , #{STARTEDDATE}  
	                             , #{SENDUSER}  
	                             , #{SENDTIME}  
	                             , #{HANDLETYPE}  
	                             , #{DESCRIPTION}  
	                             , #{CREATOR}  
	                             , SYSDATE  
	                             , #{MODIFIER}  
	                             , SYSDATE  
	                             , #{LASTTXNHISTKEY}  
	                             , #{LASTTXNID}  
	                             , #{LASTTXNUSER}  
	                             , SYSDATE 
	                             , #{LASTTXNCOMMENT}  
	                             , #{ISDEFECTED}  
	                             , #{LASTTXNGROUPHISTKEY}  
	                             , #{WORKCOUNT}  
	                             , #{RESOURCEID}  
	                             , #{MKLOTID}  
	                             , #{PREVPRODUCTDEFID}  
	                             , #{PNLROOTLOTID}  
	                             , #{PNLCREATEDQTY}  
	                             , #{INPUTCONFIRMDATE}  
	                             , #{INPUTCONFIRMUSER}  
	                             , #{ISFINALINSPECTPROGESS}  
	                             , #{LOTINPUTQTY}  
	                             , #{ISFIRSTCREATELOT}  
	                             , #{ISOEM}  
	                             , #{ISSHRINKTEST}    
	                            )
	</insert>		
	<select id="selectPcmLotgenealCnt" parameterType="map" resultType="int">
	    SELECT COUNT(*) AS CNT
	    FROM	PCM_LOTGENEAL A 
	    WHERE A.LOTID = #{LOTID}
	</select>
	<insert id="insertPcmLotgeneal" parameterType="map">
	    INSERT 
	      INTO PCM_LOTGENEAL(   LOTID  
	                          , TXNHISTKEY  
	                          , ENTERPRISEID  
	                          , PLANTID  
	                          , AREAID  
	                          , PRODUCTDEFID  
	                          , PRODUCTDEFVERSION  
	                          , PROCESSDEFID  
	                          , PROCESSDEFVERSION  
	                          , PROCESSPATHID  
	                          , USERSEQUENCE  
	                          , PROCESSSEGMENTID  
	                          , PROCESSSEGMENTVERSION  
	                          , ROOTLOTID  
	                          , DEPTH  
	                          , SOURCELOTID  
	                          , DESTINATIONLOTID  
	                          , CREATEDQTY  
	                          , QTY  
	                          , TXNUSER  
	                          , TXNTIME  
	                          , TXNREASONCODECLASS  
	                          , TXNREASONCODE  
	                          , TXNCOMMENT  
	                          , PROCESSSTATE  
	                          , LOTCREATETYPE       
	                          , PROCESSSTEP   
	                          , WORKCOUNT     
	                        ) VALUES (  #{LOTID}  
	                                  , #{TXNHISTKEY}  
	                                  , #{ENTERPRISEID}  
	                                  , #{PLANTID}  
	                                  , #{AREAID}  
	                                  , #{PRODUCTDEFID}  
	                                  , #{PRODUCTDEFVERSION}  
	                                  , #{PROCESSDEFID}  
	                                  , #{PROCESSDEFVERSION}  
	                                  , #{PROCESSPATHID}  
	                                  , #{USERSEQUENCE}  
	                                  , #{PROCESSSEGMENTID}  
	                                  , #{PROCESSSEGMENTVERSION}  
	                                  , #{ROOTLOTID}  
	                                  , #{DEPTH}  
	                                  , #{SOURCELOTID}  
	                                  , #{DESTINATIONLOTID}  
	                                  , #{CREATEDQTY}  
	                                  , #{QTY}  
	                                  , #{TXNUSER}  
	                                  , SYSDATE
	                                  , #{TXNREASONCODECLASS}  
	                                  , #{TXNREASONCODE}  
	                                  , #{TXNCOMMENT}  
	                                  , #{PROCESSSTATE}  
	                                  , #{LOTCREATETYPE}   
	                                  , #{PROCESSSTEP} 
	                                  , #{WORKCOUNT}
	                                 )
	</insert>
	<select id="selectPcmLotreservelocking" parameterType="map" resultType="hashmap">
	    SELECT 
	        A.TXNHISTKEY	 
	        ,A.LOTID	 
	        ,A.ENTERPRISEID	 
	        ,A.PLANTID	 
	        ,A.PROCESSDEFID	 
	        ,A.PROCESSDEFVERSION	 
	        ,A.PROCESSSEGMENTID	 
	        ,A.PROCESSSEGMENTVERSION	 
	        ,A.LOCKINGTYPE	 
	        ,A.LOCKINGCODE	 
	        ,A.COMMENTS	 
	        ,A.LOCKINGSTATUS	 
	        ,A.DESCRIPTION	 
	        ,A.CREATOR	 
	        ,A.CREATEDTIME	 
	        ,A.TXNGROUPHISTKEY	 
	        ,A.TXNUSER	 
	        ,A.TXNTIME	 
	        ,A.TXNREASONCODECLASS	 
	        ,A.TXNREASONCODE	 
	        ,A.TXNCOMMENT	 
	        ,A.LOCKING_PROCESSSTATE	 
	    FROM	PCM_LOTRESERVELOCKING A 
	    WHERE A.LOTID         = #{LOTID}
	      AND A.LOCKINGSTATUS = #{LOCKINGSTATUS}
	 </select>	
	<insert id="insertPcmLotreservelocking" parameterType="map">
	    INSERT 
	      INTO PCM_LOTRESERVELOCKING(   TXNHISTKEY  
	                                  , LOTID  
	                                  , ENTERPRISEID  
	                                  , PLANTID  
	                                  , PROCESSDEFID  
	                                  , PROCESSDEFVERSION  
	                                  , PROCESSSEGMENTID  
	                                  , PROCESSSEGMENTVERSION  
	                                  , LOCKINGTYPE  
	                                  , LOCKINGCODE  
	                                  , COMMENTS  
	                                  , LOCKINGSTATUS  
	                                  , DESCRIPTION  
	                                  , CREATOR  
	                                  , CREATEDTIME  
	                                  , TXNGROUPHISTKEY  
	                                  , TXNUSER  
	                                  , TXNTIME  
	                                  , TXNREASONCODECLASS  
	                                  , TXNREASONCODE  
	                                  , TXNCOMMENT  
	                                  , LOCKING_PROCESSSTATE        
	                                ) VALUES(  #{TXNHISTKEY}  
	                                         , #{LOTID}  
	                                         , #{ENTERPRISEID}  
	                                         , #{PLANTID}  
	                                         , #{PROCESSDEFID}  
	                                         , #{PROCESSDEFVERSION}  
	                                         , #{PROCESSSEGMENTID}  
	                                         , #{PROCESSSEGMENTVERSION}  
	                                         , #{LOCKINGTYPE}  
	                                         , #{LOCKINGCODE}  
	                                         , #{COMMENTS}  
	                                         , #{LOCKINGSTATUS}  
	                                         , #{DESCRIPTION}  
	                                         , #{CREATOR}  
	                                         , SYSDATE  
	                                         , #{TXNGROUPHISTKEY}  
	                                         , #{TXNUSER}  
	                                         , SYSDATE  
	                                         , #{TXNREASONCODECLASS}  
	                                         , #{TXNREASONCODE}  
	                                         , #{TXNCOMMENT}  
	                                         , #{LOCKING_PROCESSSTATE}    
	                                        )
	 </insert>	 
	 <select id="copyLotRouting" parameterType="map" resultType="hashmap">
	   SELECT USP_COPY_LOTROUTING(#{LOTID}, #{CHILDLOTID}) FROM DUAL;
	 </select>
	 <select id="getLotWorkResultByTrackIn" parameterType="map" resultType="map">
        SELECT *
		  FROM PCM_LOTWORKRESULT	WR
		 WHERE WR.LOTID            = #{LOTID}
		   AND WR.PROCESSSEGMENTID = #{PROCESSSEGMENTID}
		   AND WR.WORKCOUNT        = #{WORKCOUNT}	 
	 </select>
	 
	 <!-- LOT 보류 등록 -->
    <insert id="insertPcmLothold" parameterType="map">
    INSERT INTO PCM_LOTHOLD( 
        TXNHISTKEY  
        ,LOTID  
        ,AREAID  
        ,PROCESSDEFID  
        ,PROCESSDEFVERSION  
        ,PROCESSSEGMENTID  
        ,PROCESSSEGMENTVERSION  
        ,HOLDTOPCLASSID  
        ,HOLDMIDDLECLASSID  
        ,HOLDCODE  
        ,HOLDCOMMENT  
        ,HOLDUSER  
        ,HOLDTIME  
        ,HOLDSTATUS  
        ,RELEASECOMMENTS  
        ,RELEASEUSER  
        ,RELEASEDATE  
        ,TXNGROUPHISTKEY  
        ,CREATOR  
        ,CREATEDTIME        ) 
    VALUES( 
        #{TXNHISTKEY}  
        ,#{LOTID}  
        ,#{AREAID}  
        ,#{PROCESSDEFID}  
        ,#{PROCESSDEFVERSION}  
        ,#{PROCESSSEGMENTID}  
        ,#{PROCESSSEGMENTVERSION}  
        ,#{HOLDTOPCLASSID}  
        ,#{HOLDMIDDLECLASSID}  
        ,#{HOLDCODE}  
        ,#{HOLDCOMMENT}  
        ,#{HOLDUSER}  
        ,#{HOLDTIME}  
        ,#{HOLDSTATUS}  
        ,#{RELEASECOMMENTS}  
        ,#{RELEASEUSER}  
        ,#{RELEASEDATE}  
        ,#{TXNGROUPHISTKEY}  
        ,#{CREATOR}  
        ,SYSDATE    )
    </insert>

    <!-- LOT 보류 변경 -->
    <update id="updatePcmLothold" parameterType="map" >
    UPDATE PCM_LOTHOLD 
    SET 
        AREAID = #{AREAID}     
        ,PROCESSDEFID = #{PROCESSDEFID}     
        ,PROCESSDEFVERSION = #{PROCESSDEFVERSION}     
        ,PROCESSSEGMENTID = #{PROCESSSEGMENTID}     
        ,PROCESSSEGMENTVERSION = #{PROCESSSEGMENTVERSION}     
        ,HOLDTOPCLASSID = #{HOLDTOPCLASSID}     
        ,HOLDMIDDLECLASSID = #{HOLDMIDDLECLASSID}     
        ,HOLDCODE = #{HOLDCODE}     
        ,HOLDCOMMENT = #{HOLDCOMMENT}     
        ,HOLDUSER = #{HOLDUSER}     
        ,HOLDTIME = #{HOLDTIME}     
        ,HOLDSTATUS = #{HOLDSTATUS}     
        ,RELEASECOMMENTS = #{RELEASECOMMENTS}     
        ,RELEASEUSER = #{RELEASEUSER}     
        ,RELEASEDATE = #{RELEASEDATE}     
        ,TXNGROUPHISTKEY = #{TXNGROUPHISTKEY}                
    WHERE LOTID = #{LOTID}
	<if test="TXNHISTKEY != null and TXNHISTKEY !='' "> 
    AND TXNHISTKEY = #{TXNHISTKEY}
	</if>
    </update>

    <!-- LOT 보류 삭제 -->
    <update id="deletePcmLothold" parameterType="map" > 
    DELETE FROM PCM_LOTHOLD 
    WHERE LOTID = #{LOTID}
    AND TXNHISTKEY = #{TXNHISTKEY}
    </update>

    <!-- LOT 보류 조회-->
    <select id="selectPcmLotholdList" parameterType="map" resultType="hashmap">
    SELECT *
    FROM	PCM_LOTHOLD A 
    WHERE 1=1 
    <if test="TXNHISTKEY != null and TXNHISTKEY !='' "> 
        AND A.TXNHISTKEY = #{TXNHISTKEY}
    </if>
    <if test="LOTID != null and LOTID !='' "> 
        AND A.LOTID = #{LOTID}
    </if>
    <if test="AREAID != null and AREAID !='' "> 
        AND A.AREAID = #{AREAID}
    </if>
    <if test="PROCESSDEFID != null and PROCESSDEFID !='' "> 
        AND A.PROCESSDEFID = #{PROCESSDEFID}
    </if>
    <if test="PROCESSDEFVERSION != null and PROCESSDEFVERSION !='' "> 
        AND A.PROCESSDEFVERSION = #{PROCESSDEFVERSION}
    </if>
    <if test="PROCESSSEGMENTID != null and PROCESSSEGMENTID !='' "> 
        AND A.PROCESSSEGMENTID = #{PROCESSSEGMENTID}
    </if>
    <if test="PROCESSSEGMENTVERSION != null and PROCESSSEGMENTVERSION !='' "> 
        AND A.PROCESSSEGMENTVERSION = #{PROCESSSEGMENTVERSION}
    </if>
    <if test="HOLDTOPCLASSID != null and HOLDTOPCLASSID !='' "> 
        AND A.HOLDTOPCLASSID = #{HOLDTOPCLASSID}
    </if>
    <if test="HOLDMIDDLECLASSID != null and HOLDMIDDLECLASSID !='' "> 
        AND A.HOLDMIDDLECLASSID = #{HOLDMIDDLECLASSID}
    </if>
    <if test="HOLDCODE != null and HOLDCODE !='' "> 
        AND A.HOLDCODE = #{HOLDCODE}
    </if>
    <if test="HOLDCOMMENT != null and HOLDCOMMENT !='' "> 
        AND A.HOLDCOMMENT = #{HOLDCOMMENT}
    </if>
    <if test="HOLDUSER != null and HOLDUSER !='' "> 
        AND A.HOLDUSER = #{HOLDUSER}
    </if>
    <if test="HOLDTIME != null and HOLDTIME !='' "> 
        AND A.HOLDTIME = #{HOLDTIME}
    </if>
    <if test="HOLDSTATUS != null and HOLDSTATUS !='' "> 
        AND A.HOLDSTATUS = #{HOLDSTATUS}
    </if>
    <if test="RELEASECOMMENTS != null and RELEASECOMMENTS !='' "> 
        AND A.RELEASECOMMENTS = #{RELEASECOMMENTS}
    </if>
    <if test="RELEASEUSER != null and RELEASEUSER !='' "> 
        AND A.RELEASEUSER = #{RELEASEUSER}
    </if>
    <if test="RELEASEDATE != null and RELEASEDATE !='' "> 
        AND A.RELEASEDATE = #{RELEASEDATE}
    </if>
    <if test="P_TXNGROUPHISTKEY != null and P_TXNGROUPHISTKEY !='' "> 
        AND A.TXNGROUPHISTKEY = #{P_TXNGROUPHISTKEY}
    </if>
    </select>

    <!-- LOT 보류 상세조회-->
    <select id="selectPcmLothold" parameterType="map" resultType="hashmap">
    SELECT *
    FROM	PCM_LOTHOLD A 
    WHERE A.LOTID = #{LOTID}
	<if test="P_TXNHISTKEY != null and P_TXNHISTKEY !='' "> 
        AND A.TXNHISTKEY = #{P_TXNHISTKEY}
    </if>
    </select>
    
    <!-- LOT별 투입 자재사용 이력 등록 -->
    <insert id="insertPcmConsumemateriallotTemp" parameterType="map">
     INSERT INTO PCM_CONSUMEMATERIALLOT_TEMP(  LOTID  
                                             , MATERIALLOTID  
                                             , PROCESSSEGMENTID  
                                             , ENTERPRISEID  
                                             , PLANTID  
                                             , MATERIALTYPE  
                                             , AREAID  
                                             , EQUIPMENTID  
                                             , MATERIALDEFID  
                                             , MATERIALDEFVERSION  
                                             , CONSUMEDQTY  
                                             , SEQUENCE  
                                             , CREATOR  
                                             , CREATEDTIME  
                                             , TXNGROUPHISTKEY  
                                             , TXNUSER  
                                             , TXNTIME  
                                             , TXNREASONCODECLASS  
                                             , TXNREASONCODE  
                                             , TXNCOMMENT        
                                             , WAREHOUSEID
                                            ) VALUES(   #{LOTID}  
                                                      , #{MATERIALLOTID}  
                                                      , #{PROCESSSEGMENTID}  
                                                      , #{ENTERPRISEID}  
                                                      , #{PLANTID}  
                                                      , #{MATERIALTYPE}  
                                                      , #{AREAID}  
                                                      , #{EQUIPMENTID}  
                                                      , #{MATERIALDEFID}  
                                                      , #{MATERIALDEFVERSION}  
                                                      , #{CONSUMEDQTY}  
                                                      , #{SEQUENCE}  
                                                      , #{CREATOR}  
                                                      , SYSDATE  
                                                      , #{TXNGROUPHISTKEY}  
                                                      , #{TXNUSER}  
                                                      , SYSDATE  
                                                      , #{TXNREASONCODECLASS}  
                                                      , #{TXNREASONCODE}  
                                                      , #{TXNCOMMENT}
                                                      , #{WAREHOUSEID}
                                                    )
    </insert>

    <!-- LOT별 투입 자재사용 이력 변경 -->
    <update id="updatePcmConsumemateriallotTemp" parameterType="map" >
    UPDATE PCM_CONSUMEMATERIALLOT_TEMP 
    SET 
        ENTERPRISEID = #{ENTERPRISEID}     
        ,PLANTID = #{PLANTID}     
        ,MATERIALTYPE = #{MATERIALTYPE}     
        ,AREAID = #{AREAID}     
        ,EQUIPMENTID = #{EQUIPMENTID}     
        ,MATERIALDEFID = #{MATERIALDEFID}     
        ,MATERIALDEFVERSION = #{MATERIALDEFVERSION}     
        ,CONSUMEDQTY = #{CONSUMEDQTY}     
        ,SEQUENCE = #{SEQUENCE}                     
        ,TXNUSER = #{TXNUSER}     
        ,TXNTIME = SYSDATE 
        ,TXNREASONCODECLASS = #{TXNREASONCODECLASS}     
        ,TXNREASONCODE = #{TXNREASONCODE}     
        ,TXNCOMMENT = #{TXNCOMMENT}
    WHERE LOTID = #{LOTID}
    AND MATERIALLOTID = #{MATERIALLOTID}
    AND PROCESSSEGMENTID = #{PROCESSSEGMENTID}
    </update>

    <!-- LOT별 투입 자재사용 이력 삭제 -->
    <delete id="deletePcmConsumemateriallotTemp" parameterType="map" > 
			DELETE FROM PCM_CONSUMEMATERIALLOT_TEMP 
			WHERE LOTID = #{LOTID}
		<if test="MATERIALLOTID != null and MATERIALLOTID !='' "> 
			AND MATERIALLOTID = #{MATERIALLOTID}
		</if>
		<if test="PROCESSSEGMENTID != null and PROCESSSEGMENTID !='' "> 
			AND PROCESSSEGMENTID = #{PROCESSSEGMENTID}
		</if>
    
    </delete>


    <!-- LOT별 투입 자재사용 이력 상세조회-->
    <select id="selectPcmConsumemateriallotTempList" parameterType="map" resultType="hashmap">
    SELECT * 
    FROM	PCM_CONSUMEMATERIALLOT_TEMP A 
    WHERE A.LOTID = #{LOTID}
    <if test="MATERIALLOTID != null and MATERIALLOTID !='' "> 
        AND A.MATERIALLOTID = #{MATERIALLOTID}
    </if>
	<if test="PROCESSSEGMENTID != null and PROCESSSEGMENTID !='' "> 
        AND	A.PROCESSSEGMENTID = #{PROCESSSEGMENTID}
    </if>
    </select>
	<insert id="insertPcmLotworkresult" parameterType="map">
	    INSERT INTO PCM_LOTWORKRESULT(  TXNHISTKEY  
	                                   , LOTID  
	                                   , PROCESSSEGMENTID  
	                                   , PROCESSSEGMENTVERSION  
	                                   , ENTERPRISEID  
	                                   , PLANTID  
	                                   , FACTORYID  
	                                   , AREAID  
	                                   , PRODUCTIONORDERID  
	                                   , LINENO  
	                                   , PRODUCTDEFID  
	                                   , PRODUCTDEFVERSION  
	                                   , PROCESSDEFID  
	                                   , PROCESSDEFVERSION  
	                                   , PROCESSPATHID  
	                                   , PROCESSPATHSTACK  
	                                   , USERSEQUENCE  
	                                   , WORKCOUNT  
	                                   , RESOURCEID  
	                                   , RESULTTYPE  
	                                   , ISPRINTLOTCARD  
	                                   , WEEK  
	                                   , ISREWORK  
	                                   , REWORKTYPE  
	                                   , REWORKREASONCODE  
	                                   , REWORKCOUNT  
	                                   , RECEIVETIME  
	                                   , RECEIVEUSER  
	                                   , ROOTLOTSTARTDATE  
	                                   , WORKSTARTTIME  
	                                   , WORKSTARTUSER  
	                                   , WORKENDTIME  
	                                   , WORKENDUSER  
	                                   , SENDTIME  
	                                   , SENDUSER  
	                                   , RECEIVELEADTIME  
	                                   , WORKSTARTLEADTIME  
	                                   , WORKENDLEADTIME  
	                                   , SENDLEADTIME  
	                                   , DEFECTQTY  
	                                   , PSEUDODEFECTQTY  
	                                   , ROOTLOTINPUTPCSQTY  
	                                   , ROOTLOTINPUTARRAYQTY  
	                                   , ROOTLOTINPUTPANELQTY  
	                                   , RECEIVEPCSQTY  
	                                   , RECEIVEARRAYQTY  
	                                   , RECEIVEPANELQTY  
	                                   , WORKSTARTPCSQTY  
	                                   , WORKSTARTARRAYQTY  
	                                   , WORKSTARTPANELQTY  
	                                   , WORKENDPCSQTY  
	                                   , WORKENDARRAYQTY  
	                                   , WORKENDPANELQTY  
	                                   , SENDPCSQTY  
	                                   , SENDARRAYQTY  
	                                   , SENDPANELQTY  
	                                   , PREVSENDLOTHISTKEY  
	                                   , SELFTAKEINSPRESULT  
	                                   , SELFSHIPINSPRESULT  
	                                   , MEASUREINSPRESULT  
	                                   , DESCRIPTION  
	                                   , CREATOR  
	                                   , CREATEDTIME  
	                                   , MODIFIER  
	                                   , MODIFIEDTIME        
	                                 ) VALUES(  #{TXNHISTKEY}  
	                                           , #{LOTID}  
	                                           , #{PROCESSSEGMENTID}  
	                                           , #{PROCESSSEGMENTVERSION}  
	                                           , #{ENTERPRISEID}  
	                                           , #{PLANTID}  
	                                           , #{FACTORYID}  
	                                           , #{AREAID}  
	                                           , #{PRODUCTIONORDERID}  
	                                           , #{LINENO}  
	                                           , #{PRODUCTDEFID}  
	                                           , #{PRODUCTDEFVERSION}  
	                                           , #{PROCESSDEFID}  
	                                           , #{PROCESSDEFVERSION}  
	                                           , #{PROCESSPATHID}  
	                                           , #{PROCESSPATHSTACK}  
	                                           , #{USERSEQUENCE}  
	                                           , #{WORKCOUNT}  
	                                           , #{RESOURCEID}  
	                                           , #{RESULTTYPE}  
	                                           , #{ISPRINTLOTCARD}  
	                                           , #{WEEK}  
	                                           , #{ISREWORK}  
	                                           , NVL(#{REWORKTYPE}, 'NORMAL')  
	                                           , #{REWORKREASONCODE}  
	                                           , #{REWORKCOUNT}  
	                                           , #{RECEIVETIME}  
	                                           , #{RECEIVEUSER}  
	                                           , #{ROOTLOTSTARTDATE}  
	                                           , #{WORKSTARTTIME}  
	                                           , #{WORKSTARTUSER}  
	                                           , #{WORKENDTIME}  
	                                           , #{WORKENDUSER}  
	                                           , #{SENDTIME}  
	                                           , #{SENDUSER}  
	                                           , #{RECEIVELEADTIME}  
	                                           , #{WORKSTARTLEADTIME}  
	                                           , #{WORKENDLEADTIME}  
	                                           , #{SENDLEADTIME}  
	                                           , #{DEFECTQTY}  
	                                           , #{PSEUDODEFECTQTY}  
	                                           , #{ROOTLOTINPUTPCSQTY}  
	                                           , #{ROOTLOTINPUTARRAYQTY}  
	                                           , #{ROOTLOTINPUTPANELQTY}  
	                                           , #{RECEIVEPCSQTY}  
	                                           , #{RECEIVEARRAYQTY}  
	                                           , #{RECEIVEPANELQTY}  
	                                           , #{WORKSTARTPCSQTY}  
	                                           , #{WORKSTARTARRAYQTY}  
	                                           , #{WORKSTARTPANELQTY}  
	                                           , #{WORKENDPCSQTY}  
	                                           , #{WORKENDARRAYQTY}  
	                                           , #{WORKENDPANELQTY}  
	                                           , #{SENDPCSQTY}  
	                                           , #{SENDARRAYQTY}  
	                                           , #{SENDPANELQTY}  
	                                           , #{PREVSENDLOTHISTKEY}  
	                                           , #{SELFTAKEINSPRESULT}  
	                                           , #{SELFSHIPINSPRESULT}  
	                                           , #{MEASUREINSPRESULT}  
	                                           , #{DESCRIPTION}  
	                                           , #{CREATOR}  
	                                           , SYSDATE  
	                                           , #{MODIFIER}  
	                                           , SYSDATE    
	                                         )
	</insert>    

    <!-- LOT 불량 정보 변경 -->
    <update id="updatePcmLotdefect" parameterType="map" >
    UPDATE PCM_LOTDEFECT 
    SET 
        ENTERPRISEID = #{ENTERPRISEID}     
        ,PLANTID = #{PLANTID}     
        ,AREAID = #{AREAID}     
        ,PRODUCTDEFID = #{PRODUCTDEFID}     
        ,PRODUCTDEFVERSION = #{PRODUCTDEFVERSION}     
        ,PROCESSDEFID = #{PROCESSDEFID}     
        ,PROCESSDEFVERSION = #{PROCESSDEFVERSION}     
        ,PROCESSPATHID = #{PROCESSPATHID}     
        ,USERSEQUENCE = #{USERSEQUENCE}     
        ,PROCESSSEGMENTID = #{PROCESSSEGMENTID}     
        ,PROCESSSEGMENTVERSION = #{PROCESSSEGMENTVERSION}     
        ,WORKCOUNT = #{WORKCOUNT}     
        ,DETECTIONSEGMENTCLASSID = #{DETECTIONSEGMENTCLASSID}     
        ,REASONAREAID = #{REASONAREAID}     
        ,DEFECTCODE = #{DEFECTCODE}     
        ,DEFECTQTY = #{DEFECTQTY}     
        ,QCSEGMENTID = #{QCSEGMENTID}     
        ,REASONSEGMENTID = #{REASONSEGMENTID}     
        ,REASONCONSUMABLELOTID = #{REASONCONSUMABLELOTID}     
        ,REASONCONSUMABLEDEFID = #{REASONCONSUMABLEDEFID}     
        ,REASONCONSUMABLEDEFVERSION = #{REASONCONSUMABLEDEFVERSION}     
        ,RESOURCEID = #{RESOURCEID}     
        ,REWORKCOUNT = #{REWORKCOUNT}     
        ,OCCURREDSTEP = #{OCCURREDSTEP}                     
        ,TXNUSER = #{TXNUSER}     
        ,TXNTIME = SYSDATE    
        ,TXNREASONCODECLASS = #{TXNREASONCODECLASS}     
        ,TXNREASONCODE = #{TXNREASONCODE}     
        ,TXNCOMMENT = #{TXNCOMMENT}     
        ,VALIDSTATE = #{VALIDSTATE}     
        ,DESCRIPTION = #{DESCRIPTION}
    WHERE LOTID = #{LOTID}
    AND TXNHISTKEY = #{TXNHISTKEY}
    </update>

    <!-- LOT 불량 정보 삭제 -->
    <delete id="deletePcmLotdefect" parameterType="map" > 
    DELETE FROM PCM_LOTDEFECT 
    WHERE LOTID = #{LOTID}
	<if test="TXNHISTKEY != null and TXNHISTKEY !='' "> 
        AND TXNHISTKEY = #{TXNHISTKEY}
    </if>
    </delete>

    <!-- LOT 불량 정보 조회-->
    <select id="selectPcmLotdefectList" parameterType="map" resultType="hashmap">
    SELECT *
    FROM	PCM_LOTDEFECT A 
    WHERE 1=1 
    <if test="P_TXNHISTKEY != null and P_TXNHISTKEY !='' "> 
        AND A.TXNHISTKEY = #{P_TXNHISTKEY}
    </if>
    <if test="LOTID != null and LOTID !='' "> 
        AND A.LOTID = #{LOTID}
    </if>
    <if test="ENTERPRISEID != null and ENTERPRISEID !='' "> 
        AND A.ENTERPRISEID = #{ENTERPRISEID}
    </if>
    <if test="PLANTID != null and PLANTID !='' "> 
        AND A.PLANTID = #{PLANTID}
    </if>
    <if test="AREAID != null and AREAID !='' "> 
        AND A.AREAID = #{AREAID}
    </if>
    <if test="PRODUCTDEFID != null and PRODUCTDEFID !='' "> 
        AND A.PRODUCTDEFID = #{PRODUCTDEFID}
    </if>
    <if test="PRODUCTDEFVERSION != null and PRODUCTDEFVERSION !='' "> 
        AND A.PRODUCTDEFVERSION = #{PRODUCTDEFVERSION}
    </if>
    <if test="PROCESSDEFID != null and PROCESSDEFID !='' "> 
        AND A.PROCESSDEFID = #{PROCESSDEFID}
    </if>
    <if test="PROCESSDEFVERSION != null and PROCESSDEFVERSION !='' "> 
        AND A.PROCESSDEFVERSION = #{PROCESSDEFVERSION}
    </if>
    <if test="PROCESSPATHID != null and PROCESSPATHID !='' "> 
        AND A.PROCESSPATHID = #{PROCESSPATHID}
    </if>
    <if test="USERSEQUENCE != null and USERSEQUENCE !='' "> 
        AND A.USERSEQUENCE = #{USERSEQUENCE}
    </if>
    <if test="PROCESSSEGMENTID != null and PROCESSSEGMENTID !='' "> 
        AND A.PROCESSSEGMENTID = #{PROCESSSEGMENTID}
    </if>
    <if test="PROCESSSEGMENTVERSION != null and PROCESSSEGMENTVERSION !='' "> 
        AND A.PROCESSSEGMENTVERSION = #{PROCESSSEGMENTVERSION}
    </if>
    <if test="WORKCOUNT != null and WORKCOUNT !='' "> 
        AND A.WORKCOUNT = #{WORKCOUNT}
    </if>
    <if test="DETECTIONSEGMENTCLASSID != null and DETECTIONSEGMENTCLASSID !='' "> 
        AND A.DETECTIONSEGMENTCLASSID = #{DETECTIONSEGMENTCLASSID}
    </if>
    <if test="REASONAREAID != null and REASONAREAID !='' "> 
        AND A.REASONAREAID = #{REASONAREAID}
    </if>
    <if test="DEFECTCODE != null and DEFECTCODE !='' "> 
        AND A.DEFECTCODE = #{DEFECTCODE}
    </if>
    <if test="DEFECTQTY != null and DEFECTQTY !='' "> 
        AND A.DEFECTQTY = #{DEFECTQTY}
    </if>
    <if test="QCSEGMENTID != null and QCSEGMENTID !='' "> 
        AND A.QCSEGMENTID = #{QCSEGMENTID}
    </if>
    <if test="REASONSEGMENTID != null and REASONSEGMENTID !='' "> 
        AND A.REASONSEGMENTID = #{REASONSEGMENTID}
    </if>
    <if test="REASONCONSUMABLELOTID != null and REASONCONSUMABLELOTID !='' "> 
        AND A.REASONCONSUMABLELOTID = #{REASONCONSUMABLELOTID}
    </if>
    <if test="REASONCONSUMABLEDEFID != null and REASONCONSUMABLEDEFID !='' "> 
        AND A.REASONCONSUMABLEDEFID = #{REASONCONSUMABLEDEFID}
    </if>
    <if test="REASONCONSUMABLEDEFVERSION != null and REASONCONSUMABLEDEFVERSION !='' "> 
        AND A.REASONCONSUMABLEDEFVERSION = #{REASONCONSUMABLEDEFVERSION}
    </if>
    <if test="RESOURCEID != null and RESOURCEID !='' "> 
        AND A.RESOURCEID = #{RESOURCEID}
    </if>
    <if test="REWORKCOUNT != null and REWORKCOUNT !='' "> 
        AND A.REWORKCOUNT = #{REWORKCOUNT}
    </if>
    <if test="OCCURREDSTEP != null and OCCURREDSTEP !='' "> 
        AND A.OCCURREDSTEP = #{OCCURREDSTEP}
    </if>
    <if test="TXNREASONCODECLASS != null and TXNREASONCODECLASS !='' "> 
        AND A.TXNREASONCODECLASS = #{TXNREASONCODECLASS}
    </if>
    <if test="TXNREASONCODE != null and TXNREASONCODE !='' "> 
        AND A.TXNREASONCODE = #{TXNREASONCODE}
    </if>
    <if test="TXNCOMMENT != null and TXNCOMMENT !='' "> 
        AND A.TXNCOMMENT = #{TXNCOMMENT}
    </if>
    <if test="VALIDSTATE != null and VALIDSTATE !='' "> 
        AND A.VALIDSTATE = #{VALIDSTATE}
    </if>
    <if test="DESCRIPTION != null and DESCRIPTION !='' "> 
        AND A.DESCRIPTION = #{DESCRIPTION}
    </if>
    </select>

    <!-- LOT 불량 정보 상세조회-->
    <select id="selectPcmLotdefect" parameterType="map" resultType="hashmap">
			SELECT * 
			FROM	PCM_LOTDEFECT A 
			WHERE A.LOTID = #{LOTID}
		<if test="P_TXNHISTKEY != null and P_TXNHISTKEY !='' "> 
			AND A.TXNHISTKEY = #{P_TXNHISTKEY}
		</if>
    </select>
	<insert id="insertPcmLotdefect" parameterType="map">
	    INSERT INTO PCM_LOTDEFECT(   TXNHISTKEY  
	                               , LOTID  
	                               , ENTERPRISEID  
	                               , PLANTID  
	                               , AREAID  
	                               , PRODUCTDEFID  
	                               , PRODUCTDEFVERSION  
	                               , PROCESSDEFID  
	                               , PROCESSDEFVERSION  
	                               , PROCESSPATHID  
	                               , USERSEQUENCE  
	                               , PROCESSSEGMENTID  
	                               , PROCESSSEGMENTVERSION  
	                               , WORKCOUNT  
	                               , DETECTIONSEGMENTCLASSID  
	                               , REASONAREAID  
	                               , DEFECTCODE  
	                               , DEFECTQTY  
	                               , QCSEGMENTID  
	                               , REASONSEGMENTID  
	                               , REASONCONSUMABLELOTID  
	                               , REASONCONSUMABLEDEFID  
	                               , REASONCONSUMABLEDEFVERSION  
	                               , RESOURCEID  
	                               , REWORKCOUNT  
	                               , OCCURREDSTEP  
	                               , CREATOR  
	                               , CREATEDTIME  
	                               , TXNGROUPHISTKEY  
	                               , TXNUSER  
	                               , TXNTIME  
	                               , TXNREASONCODECLASS  
	                               , TXNREASONCODE  
	                               , TXNCOMMENT  
	                               , VALIDSTATE  
	                               , DESCRIPTION        
	                             ) VALUES (  #{TXNHISTKEY}  
	                                       , #{LOTID}  
	                                       , #{ENTERPRISEID}  
	                                       , #{PLANTID}  
	                                       , #{AREAID}  
	                                       , #{PRODUCTDEFID}  
	                                       , #{PRODUCTDEFVERSION}  
	                                       , #{PROCESSDEFID}  
	                                       , #{PROCESSDEFVERSION}  
	                                       , #{PROCESSPATHID}  
	                                       , #{USERSEQUENCE}  
	                                       , #{PROCESSSEGMENTID}  
	                                       , #{PROCESSSEGMENTVERSION}  
	                                       , NVL(#{WORKCOUNT}, 0) 
	                                       , #{DETECTIONSEGMENTCLASSID}  
	                                       , #{REASONAREAID}  
	                                       , #{DEFECTCODE}  
	                                       , #{DEFECTQTY}  
	                                       , #{QCSEGMENTID}  
	                                       , #{REASONSEGMENTID}  
	                                       , #{REASONCONSUMABLELOTID}  
	                                       , #{REASONCONSUMABLEDEFID}  
	                                       , #{REASONCONSUMABLEDEFVERSION}  
	                                       , #{RESOURCEID}  
	                                       , #{REWORKCOUNT}  
	                                       , #{OCCURREDSTEP}  
	                                       , #{CREATOR}  
	                           	<choose>
							          <when test="CREATEDTIME != null and CREATEDTIME !='' ">
							          		, #{CREATEDTIME}
							          </when>
							          <otherwise>
							          		, SYSDATE
							          </otherwise>
						          </choose>
	                                       , #{TXNGROUPHISTKEY}  
	                                       , #{TXNUSER}  
	                                       , SYSDATE    
	                                       , #{TXNREASONCODECLASS}  
	                                       , #{TXNREASONCODE}  
	                                       , #{TXNCOMMENT}  
	                                       , 'Valid' 
	                                       , #{DESCRIPTION}    
	                                      )
	</insert>
	<select id="selectLotLockingCount" parameterType="map" resultType="int">
		/* GetLotLockingCount 10001 */
			SELECT	COUNT(*)	AS COUNT
				FROM 	PCM_LOTLOCKING
				WHERE 	1 = 1
				AND		LOTID = #{LOTID}
				AND 	LOCKINGSTATUS = 'Y'
			<if test="PROCESSSEGMENTID != null and PROCESSSEGMENTID !='' "> 
				AND     PROCESSSEGMENTID = #{PROCESSSEGMENTID}
			</if>
			<if test="LOCKINGTYPE != null and LOCKINGTYPE !='' "> 
				AND     LOCKINGTYPE = #{LOCKINGTYPE}
			</if>
			<if test="LOCKINGCODE != null and LOCKINGCODE !='' "> 
				AND     LOCKINGCODE = #{LOCKINGCODE}
			</if>
	</select>

	<!-- LOT Locking 등록 -->
    <insert id="insertPcmLotlocking" parameterType="map">
    INSERT INTO PCM_LOTLOCKING( 
        TXNHISTKEY  
        ,LOTID  
        ,ENTERPRISEID  
        ,PLANTID  
        ,AREAID  
        ,PRODUCTDEFID  
        ,PRODUCTDEFVERSION  
        ,PROCESSDEFID  
        ,PROCESSDEFVERSION  
        ,USERSEQUENCE  
        ,PROCESSSEGMENTID  
        ,PROCESSSEGMENTVERSION  
        ,WORKCOUNT  
        ,LOCKINGSTATUS  
        ,LOCKINGTYPE  
        ,LOCKINGCODE  
        ,COMMENTS  
        ,UNLOCKINGCODE  
        ,RELEASECOMMENTS  
        ,DESCRIPTION  
        ,CREATOR  
        ,CREATEDTIME  
        ,TXNGROUPHISTKEY  
        ,TXNUSER  
        ,TXNTIME  
        ,TXNREASONCODECLASS  
        ,TXNREASONCODE  
        ,TXNCOMMENT        ) 
    VALUES( 
        #{TXNHISTKEY}  
        ,#{LOTID}  
        ,#{ENTERPRISEID}  
        ,#{PLANTID}  
        ,#{AREAID}  
        ,#{PRODUCTDEFID}  
        ,#{PRODUCTDEFVERSION}  
        ,#{PROCESSDEFID}  
        ,#{PROCESSDEFVERSION}  
        ,#{USERSEQUENCE}  
        ,#{PROCESSSEGMENTID}  
        ,#{PROCESSSEGMENTVERSION}  
        ,#{WORKCOUNT}  
        ,#{LOCKINGSTATUS}  
        ,#{LOCKINGTYPE}  
        ,#{LOCKINGCODE}  
        ,#{COMMENTS}  
        ,#{UNLOCKINGCODE}  
        ,#{RELEASECOMMENTS}  
        ,#{DESCRIPTION}  
        ,#{CREATOR}  
        ,SYSDATE  
        ,#{TXNGROUPHISTKEY}  
        ,#{TXNUSER}  
        ,SYSDATE  
        ,#{TXNREASONCODECLASS}  
        ,#{TXNREASONCODE}  
        ,#{TXNCOMMENT}    )
    </insert>

    <!-- LOT Locking 변경 -->
    <update id="updatePcmLotlocking" parameterType="map" >
	    UPDATE PCM_LOTLOCKING 
	    SET 
	        ENTERPRISEID = #{ENTERPRISEID}     
	        ,PLANTID = #{PLANTID}     
	        ,AREAID = #{AREAID}     
	        ,PRODUCTDEFID = #{PRODUCTDEFID}     
	        ,PRODUCTDEFVERSION = #{PRODUCTDEFVERSION}     
	        ,PROCESSDEFID = #{PROCESSDEFID}     
	        ,PROCESSDEFVERSION = #{PROCESSDEFVERSION}     
	        ,USERSEQUENCE = #{USERSEQUENCE}     
	        ,PROCESSSEGMENTID = #{PROCESSSEGMENTID}     
	        ,PROCESSSEGMENTVERSION = #{PROCESSSEGMENTVERSION}     
	        ,WORKCOUNT = #{WORKCOUNT}     
	        ,LOCKINGSTATUS = #{LOCKINGSTATUS}     
	        ,LOCKINGTYPE = #{LOCKINGTYPE}     
	        ,LOCKINGCODE = #{LOCKINGCODE}     
	        ,COMMENTS = #{COMMENTS}     
	        ,UNLOCKINGCODE = #{UNLOCKINGCODE}     
	        ,RELEASECOMMENTS = #{RELEASECOMMENTS}     
	        ,DESCRIPTION = #{DESCRIPTION}  
	        ,TXNUSER = #{TXNUSER}     
	        ,TXNTIME = SYSDATE  
	        ,TXNREASONCODECLASS = #{TXNREASONCODECLASS}     
	        ,TXNREASONCODE = #{TXNREASONCODE}     
	        ,TXNCOMMENT = #{TXNCOMMENT}
	    WHERE LOTID = #{LOTID}
	    AND TXNHISTKEY = #{TXNHISTKEY}
    </update>

    <!-- LOT Locking 삭제 -->
    <update id="deletePcmLotlocking" parameterType="map" > 
		    DELETE FROM PCM_LOTLOCKING 
		    WHERE LOTID = #{LOTID}
		<if test="TXNHISTKEY != null and TXNHISTKEY !='' "> 
		    AND TXNHISTKEY = #{TXNHISTKEY}
		</if>
    </update>

    <!-- LOT Locking 조회-->
    <select id="selectPcmLotlockingList" parameterType="map" resultType="hashmap">
    SELECT *
    FROM	PCM_LOTLOCKING A 
    WHERE 1=1 
    <if test="P_TXNHISTKEY != null and P_TXNHISTKEY !='' "> 
        AND A.TXNHISTKEY = #{P_TXNHISTKEY}
    </if>
    <if test="LOTID != null and LOTID !='' "> 
        AND A.LOTID = #{LOTID}
    </if>
    <if test="ENTERPRISEID != null and ENTERPRISEID !='' "> 
        AND A.ENTERPRISEID = #{ENTERPRISEID}
    </if>
    <if test="PLANTID != null and PLANTID !='' "> 
        AND A.PLANTID = #{PLANTID}
    </if>
    <if test="AREAID != null and AREAID !='' "> 
        AND A.AREAID = #{AREAID}
    </if>
    <if test="PRODUCTDEFID != null and PRODUCTDEFID !='' "> 
        AND A.PRODUCTDEFID = #{PRODUCTDEFID}
    </if>
    <if test="PRODUCTDEFVERSION != null and PRODUCTDEFVERSION !='' "> 
        AND A.PRODUCTDEFVERSION = #{PRODUCTDEFVERSION}
    </if>
    <if test="PROCESSDEFID != null and PROCESSDEFID !='' "> 
        AND A.PROCESSDEFID = #{PROCESSDEFID}
    </if>
    <if test="PROCESSDEFVERSION != null and PROCESSDEFVERSION !='' "> 
        AND A.PROCESSDEFVERSION = #{PROCESSDEFVERSION}
    </if>
    <if test="USERSEQUENCE != null and USERSEQUENCE !='' "> 
        AND A.USERSEQUENCE = #{USERSEQUENCE}
    </if>
    <if test="PROCESSSEGMENTID != null and PROCESSSEGMENTID !='' "> 
        AND A.PROCESSSEGMENTID = #{PROCESSSEGMENTID}
    </if>
    <if test="PROCESSSEGMENTVERSION != null and PROCESSSEGMENTVERSION !='' "> 
        AND A.PROCESSSEGMENTVERSION = #{PROCESSSEGMENTVERSION}
    </if>
    <if test="WORKCOUNT != null and WORKCOUNT !='' "> 
        AND A.WORKCOUNT = #{WORKCOUNT}
    </if>
    <if test="LOCKINGSTATUS != null and LOCKINGSTATUS !='' "> 
        AND A.LOCKINGSTATUS = #{LOCKINGSTATUS}
    </if>
    <if test="LOCKINGTYPE != null and LOCKINGTYPE !='' "> 
        AND A.LOCKINGTYPE = #{LOCKINGTYPE}
    </if>
    <if test="LOCKINGCODE != null and LOCKINGCODE !='' "> 
        AND A.LOCKINGCODE = #{LOCKINGCODE}
    </if>
    <if test="COMMENTS != null and COMMENTS !='' "> 
        AND A.COMMENTS = #{COMMENTS}
    </if>
    <if test="UNLOCKINGCODE != null and UNLOCKINGCODE !='' "> 
        AND A.UNLOCKINGCODE = #{UNLOCKINGCODE}
    </if>
    <if test="RELEASECOMMENTS != null and RELEASECOMMENTS !='' "> 
        AND A.RELEASECOMMENTS = #{RELEASECOMMENTS}
    </if>
    <if test="DESCRIPTION != null and DESCRIPTION !='' "> 
        AND A.DESCRIPTION = #{DESCRIPTION}
    </if>
    <if test="TXNREASONCODECLASS != null and TXNREASONCODECLASS !='' "> 
        AND A.TXNREASONCODECLASS = #{TXNREASONCODECLASS}
    </if>
    <if test="TXNREASONCODE != null and TXNREASONCODE !='' "> 
        AND A.TXNREASONCODE = #{TXNREASONCODE}
    </if>
    <if test="TXNCOMMENT != null and TXNCOMMENT !='' "> 
        AND A.TXNCOMMENT = #{TXNCOMMENT}
    </if>
    </select>
	<update id="updatePcmLotworkresult" parameterType="map" >
	    UPDATE PCM_LOTWORKRESULT 
	       SET PROCESSSEGMENTID = #{PROCESSSEGMENTID}     
	         , PROCESSSEGMENTVERSION = #{PROCESSSEGMENTVERSION}     
	         , ENTERPRISEID = #{ENTERPRISEID}     
	         , PLANTID = #{PLANTID}     
	         , FACTORYID = #{FACTORYID}     
	         , AREAID = #{AREAID}     
	         , PRODUCTIONORDERID = #{PRODUCTIONORDERID}     
	         , LINENO = #{LINENO}     
	         , PRODUCTDEFID = #{PRODUCTDEFID}     
	         , PRODUCTDEFVERSION = #{PRODUCTDEFVERSION}     
	         , PROCESSDEFID = #{PROCESSDEFID}     
	         , PROCESSDEFVERSION = #{PROCESSDEFVERSION}     
	         , PROCESSPATHID = #{PROCESSPATHID}     
	         , PROCESSPATHSTACK = #{PROCESSPATHSTACK}     
	         , USERSEQUENCE = #{USERSEQUENCE}     
	         , WORKCOUNT = #{WORKCOUNT}     
	         , RESOURCEID = #{RESOURCEID}     
	         , RESULTTYPE = #{RESULTTYPE}     
	         , ISPRINTLOTCARD = #{ISPRINTLOTCARD}     
	         , WEEK = #{WEEK}     
	         , ISREWORK = #{ISREWORK}     
	         , REWORKTYPE = #{REWORKTYPE}     
	         , REWORKREASONCODE = #{REWORKREASONCODE}     
	         , REWORKCOUNT = #{REWORKCOUNT}     
	         , RECEIVETIME = #{RECEIVETIME}     
	         , RECEIVEUSER = #{RECEIVEUSER}     
	         , ROOTLOTSTARTDATE = #{ROOTLOTSTARTDATE}     
	         , WORKSTARTTIME = #{WORKSTARTTIME}     
	         , WORKSTARTUSER = #{WORKSTARTUSER}     
	         , WORKENDTIME = #{WORKENDTIME}     
	         , WORKENDUSER = #{WORKENDUSER}     
	         , SENDTIME = #{SENDTIME}     
	         , SENDUSER = #{SENDUSER}     
	         , RECEIVELEADTIME = #{RECEIVELEADTIME}     
	         , WORKSTARTLEADTIME = #{WORKSTARTLEADTIME}     
	         , WORKENDLEADTIME = #{WORKENDLEADTIME}     
	         , SENDLEADTIME = #{SENDLEADTIME}     
	         , DEFECTQTY = #{DEFECTQTY}     
	         , PSEUDODEFECTQTY = #{PSEUDODEFECTQTY}     
	         , ROOTLOTINPUTPCSQTY = #{ROOTLOTINPUTPCSQTY}     
	         , ROOTLOTINPUTARRAYQTY = #{ROOTLOTINPUTARRAYQTY}     
	         , ROOTLOTINPUTPANELQTY = #{ROOTLOTINPUTPANELQTY}     
	         , RECEIVEPCSQTY = #{RECEIVEPCSQTY}     
	         , RECEIVEARRAYQTY = #{RECEIVEARRAYQTY}     
	         , RECEIVEPANELQTY = #{RECEIVEPANELQTY}     
	         , WORKSTARTPCSQTY = #{WORKSTARTPCSQTY}     
	         , WORKSTARTARRAYQTY = #{WORKSTARTARRAYQTY}     
	         , WORKSTARTPANELQTY = #{WORKSTARTPANELQTY}     
	         , WORKENDPCSQTY = #{WORKENDPCSQTY}     
	         , WORKENDARRAYQTY = #{WORKENDARRAYQTY}     
	         , WORKENDPANELQTY = #{WORKENDPANELQTY}     
	         , SENDPCSQTY = #{SENDPCSQTY}     
	         , SENDARRAYQTY = #{SENDARRAYQTY}     
	         , SENDPANELQTY = #{SENDPANELQTY}     
	         , PREVSENDLOTHISTKEY    = #{PREVSENDLOTHISTKEY}     
	         , SELFTAKEINSPRESULT    = #{SELFTAKEINSPRESULT}     
	         , SELFSHIPINSPRESULT    = #{SELFSHIPINSPRESULT}     
	         , MEASUREINSPRESULT     = #{MEASUREINSPRESULT}     
	         , DESCRIPTION           = #{DESCRIPTION}                     
	         , MODIFIER              = #{MODIFIER}     
	         , MODIFIEDTIME          = SYSDATE
	         , NEXT_AREAID           = #{NEXT_AREAID}
             , NEXT_RESOURCEID       = #{NEXT_RESOURCEID}
             , NEXT_PROCESSPATHSTACK = #{NEXT_PROCESSPATHSTACK}
             , NEXT_PROCESSSEGMENTID = #{NEXT_PROCESSPATHSTACK}
	     WHERE LOTID = #{LOTID}
	       AND TXNHISTKEY = #{TXNHISTKEY}
	</update> 
	<insert id="insertPcmLotworker" parameterType="map">
	    INSERT 
	      INTO PCM_LOTWORKER(  TXNHISTKEY  
	                         , LOTID  
	                         , ENTERPRISEID  
	                         , PLANTID  
	                         , AREAID  
	                         , PRODUCTDEFID  
	                         , PRODUCTDEFVERSION  
	                         , PROCESSDEFID  
	                         , PROCESSDEFVERSION  
	                         , PROCESSPATHID  
	                         , USERSEQUENCE  
	                         , PROCESSSEGMENTID  
	                         , PROCESSSEGMENTVERSION  
	                         , WORKCOUNT  
	                         , WORKERNAME  
	                         , USERID  
	                         , DESCRIPTION  
	                         , CREATOR  
	                         , CREATEDTIME  
	                         , TXNGROUPHISTKEY  
	                         , TXNUSER  
	                         , TXNTIME  
	                         , TXNREASONCODECLASS  
	                         , TXNREASONCODE  
	                         , TXNCOMMENT        
	                        ) VALUES(  #{TXNHISTKEY}  
	                                 , #{LOTID}  
	                                 , #{ENTERPRISEID}  
	                                 , #{PLANTID}  
	                                 , #{AREAID}  
	                                 , #{PRODUCTDEFID}  
	                                 , #{PRODUCTDEFVERSION}  
	                                 , #{PROCESSDEFID}  
	                                 , #{PROCESSDEFVERSION}  
	                                 , #{PROCESSPATHID}  
	                                 , #{USERSEQUENCE}  
	                                 , #{PROCESSSEGMENTID}  
	                                 , #{PROCESSSEGMENTVERSION}  
	                                 , #{WORKCOUNT}  
	                                 , #{WORKERNAME}  
	                                 , #{USERID}  
	                                 , #{DESCRIPTION}  
	                                 , #{CREATOR}  
	                                 , SYSDATE  
	                                 , #{TXNGROUPHISTKEY}  
	                                 , #{TXNUSER}  
	                                 , SYSDATE
	                                 , #{TXNREASONCODECLASS}  
	                                 , #{TXNREASONCODE}  
	                                 , #{TXNCOMMENT}    
	                                )
	</insert>
	<insert id="insertPcmLothistory" parameterType="map">
	    INSERT INTO PCM_LOTHISTORY( 
	        TXNHISTKEY  
	        ,LOTID  
	        ,PRODUCTIONORDERID  
	        ,LINENO  
	        ,LOTGROUPID  
	        ,LOTNAME  
	        ,ENTERPRISEID  
	        ,ORIGINALPLANTID  
	        ,PREVPLANTID  
	        ,PLANTID  
	        ,PREVFACTORYID  
	        ,FACTORYID  
	        ,PREVAREAID  
	        ,AREAID  
	        ,PREVEQUIPMENTID  
	        ,EQUIPMENTID  
	        ,LOCATIONID  
	        ,RECIPEDEFID  
	        ,RECIPEDEFVERSION  
	        ,PREVPRODUCTDEFID  
	        ,PREVPRODUCTDEFVERSION  
	        ,PRODUCTDEFID  
	        ,PRODUCTDEFVERSION  
	        ,PREVPROCESSDEFID  
	        ,PREVPROCESSDEFVERSION  
	        ,PROCESSDEFID  
	        ,PROCESSDEFVERSION  
	        ,PROCESSPATHSTACK  
	        ,PREVUSERSEQUENCE  
	        ,USERSEQUENCE  
	        ,PREVPROCESSSEGMENTID  
	        ,PREVPROCESSSEGMENTVERSION  
	        ,PROCESSSEGMENTID  
	        ,PROCESSSEGMENTVERSION  
	        ,RAWMATERIALID  
	        ,ROOTLOTID  
	        ,PARENTLOTID  
	        ,CHILDLOTID  
	        ,CARRIERID  
	        ,PREVLOTTYPE  
	        ,LOTTYPE  
	        ,LOTCREATEDTYPE  
	        ,LOTINPUTTYPE  
	        ,ISREPRESENTROLLLOT  
	        ,HASSUBLOT  
	        ,PRIORITY  
	        ,DUEDATE  
	        ,EXPECTEDCOMPLETEDATE  
	        ,ROOTLOTSTARTDATE  
	        ,LOTSTARTDATE  
	        ,WEEK  
	        ,TRACKINUSER  
	        ,TRACKINTIME  
	        ,TRACKOUTUSER  
	        ,TRACKOUTTIME  
	        ,PREVLOTSTATE  
	        ,LOTSTATE  
	        ,PREVPROCESSSTATE  
	        ,PROCESSSTATE  
	        ,ISHOLD  
	        ,ISREWORK  
	        ,ISLOCKING  
	        ,REWORKTYPE  
	        ,REWORKREASONCODE  
	        ,ISPRINTLOTCARD  
	        ,ISPRINTRCLOTCARD  
	        ,LAYER  
	        ,CREATEDQTY  
	        ,LOTSTDPANELQTY  
	        ,UNIT  
	        ,DEFECTUNIT  
	        ,PREVQTY  
	        ,QTY  
	        ,PREVDEFECTQTY  
	        ,DEFECTQTY  
	        ,PREVPSEUDODEFECTQTY  
	        ,PSEUDODEFECTQTY  
	        ,PREVPCSQTY  
	        ,PCSQTY  
	        ,PREVARRAYQTY  
	        ,ARRAYQTY  
	        ,PREVPANELQTY  
	        ,PANELQTY  
	        ,PANELPERQTY  
	        ,REWORKCOUNT  
	        ,TOTALREWORKCOUNT  
	        ,PUREORDER  
	        ,PUREINPUT  
	        ,SUBPROCESSDEFID  
	        ,SUBPROCESSDEFVERSION  
	        ,RECEIVEUSER  
	        ,RECEIVETIME  
	        ,STARTEDUSER  
	        ,STARTEDDATE  
	        ,SENDUSER  
	        ,SENDTIME  
	        ,HANDLETYPE  
	        ,ISCANCEL  
	        ,CANCELHISTKEY  
	        ,DESCRIPTION  
	        ,CREATOR  
	        ,CREATEDTIME  
	        ,MODIFIER  
	        ,MODIFIEDTIME  
	        ,TXNGROUPHISTKEY  
	        ,TXNID  
	        ,TXNUSER  
	        ,TXNTIME  
	        ,TXNREASONCODECLASS  
	        ,TXNREASONCODE  
	        ,TXNCOMMENT  
	        ,ISDEFECTED  
	        ,WORKCOUNT  
	        ,RESOURCEID  
	        ,MKLOTID  
	        ,PNLROOTLOTID  
	        ,PNLCREATEDQTY  
	        ,INPUTCONFIRMDATE  
	        ,INPUTCONFIRMUSER  
	        ,ISFINALINSPECTPROGESS  
	        ,LOTINPUTQTY  
	        ,ISFIRSTCREATELOT  
	        ,ISOEM  
	        ,ISSHRINKTEST        ) 
	    VALUES( 
	        #{TXNHISTKEY}  
	        ,#{LOTID}  
	        ,#{PRODUCTIONORDERID}  
	        ,#{LINENO}  
	        ,#{LOTGROUPID}  
	        ,#{LOTNAME}  
	        ,#{ENTERPRISEID}  
	        ,#{ORIGINALPLANTID}  
	        ,#{PREVPLANTID}  
	        ,#{PLANTID}  
	        ,#{PREVFACTORYID}  
	        ,#{FACTORYID}  
	        ,#{PREVAREAID}  
	        ,#{AREAID}  
	        ,#{PREVEQUIPMENTID}  
	        ,#{EQUIPMENTID}  
	        ,#{LOCATIONID}  
	        ,#{RECIPEDEFID}  
	        ,#{RECIPEDEFVERSION}  
	        ,#{PREVPRODUCTDEFID}  
	        ,#{PREVPRODUCTDEFVERSION}  
	        ,#{PRODUCTDEFID}  
	        ,#{PRODUCTDEFVERSION}  
	        ,#{PREVPROCESSDEFID}  
	        ,#{PREVPROCESSDEFVERSION}  
	        ,#{PROCESSDEFID}  
	        ,#{PROCESSDEFVERSION}  
	        ,#{PROCESSPATHSTACK}  
	        ,#{PREVUSERSEQUENCE}  
	        ,#{USERSEQUENCE}  
	        ,#{PREVPROCESSSEGMENTID}  
	        ,#{PREVPROCESSSEGMENTVERSION}  
	        ,#{PROCESSSEGMENTID}  
	        ,#{PROCESSSEGMENTVERSION}  
	        ,#{RAWMATERIALID}  
	        ,#{ROOTLOTID}  
	        ,#{PARENTLOTID}  
	        ,#{CHILDLOTID}  
	        ,#{CARRIERID}  
	        ,#{PREVLOTTYPE}  
	        ,#{LOTTYPE}  
	        ,#{LOTCREATEDTYPE}  
	        ,#{LOTINPUTTYPE}  
	        ,#{ISREPRESENTROLLLOT}  
	        ,#{HASSUBLOT}  
	        ,#{PRIORITY}  
	        ,#{DUEDATE}  
	        ,#{EXPECTEDCOMPLETEDATE}  
	        ,#{ROOTLOTSTARTDATE}  
	        ,#{LOTSTARTDATE}  
	        ,#{WEEK}  
	        ,#{TRACKINUSER}  
	        ,#{TRACKINTIME}  
	        ,#{TRACKOUTUSER}  
	        ,#{TRACKOUTTIME}  
	        ,#{PREVLOTSTATE}  
	        ,#{LOTSTATE}  
	        ,#{PREVPROCESSSTATE}  
	        ,#{PROCESSSTATE}  
	        ,#{ISHOLD}  
	        ,#{ISREWORK}  
	        ,#{ISLOCKING}  
	        ,#{REWORKTYPE}  
	        ,#{REWORKREASONCODE}  
	        ,#{ISPRINTLOTCARD}  
	        ,#{ISPRINTRCLOTCARD}  
	        ,#{LAYER}  
	        ,#{CREATEDQTY}  
	        ,#{LOTSTDPANELQTY}  
	        ,#{UNIT}  
	        ,#{DEFECTUNIT}  
	        ,#{PREVQTY}  
	        ,#{QTY}  
	        ,#{PREVDEFECTQTY}  
	        ,#{DEFECTQTY}  
	        ,#{PREVPSEUDODEFECTQTY}  
	        ,#{PSEUDODEFECTQTY}  
	        ,#{PREVPCSQTY}  
	        ,#{PCSQTY}  
	        ,#{PREVARRAYQTY}  
	        ,#{ARRAYQTY}  
	        ,#{PREVPANELQTY}  
	        ,#{PANELQTY}  
	        ,#{PANELPERQTY}  
	        ,#{REWORKCOUNT}  
	        ,#{TOTALREWORKCOUNT}  
	        ,#{PUREORDER}  
	        ,#{PUREINPUT}  
	        ,#{SUBPROCESSDEFID}  
	        ,#{SUBPROCESSDEFVERSION}  
	        ,#{RECEIVEUSER}  
	        ,#{RECEIVETIME}  
	        ,#{STARTEDUSER}  
	        ,#{STARTEDDATE}  
	        ,#{SENDUSER}  
	        ,#{SENDTIME}  
	        ,#{HANDLETYPE}  
	        ,#{ISCANCEL}  
	        ,#{CANCELHISTKEY}  
	        ,#{DESCRIPTION}  
	        ,#{CREATOR}  
	        ,SYSDATE
	        ,#{MODIFIER}  
	        ,SYSDATE
	        ,#{TXNGROUPHISTKEY}  
	        ,#{TXNID}  
	        ,#{TXNUSER}  
	        ,SYSDATE 
	        ,#{TXNREASONCODECLASS}  
	        ,#{TXNREASONCODE}  
	        ,#{TXNCOMMENT}  
	        ,#{ISDEFECTED}  
	        ,#{WORKCOUNT}  
	        ,#{RESOURCEID}  
	        ,#{MKLOTID}  
	        ,#{PNLROOTLOTID}  
	        ,#{PNLCREATEDQTY}  
	        ,#{INPUTCONFIRMDATE}  
	        ,#{INPUTCONFIRMUSER}  
	        ,#{ISFINALINSPECTPROGESS}  
	        ,#{LOTINPUTQTY}  
	        ,#{ISFIRSTCREATELOT}  
	        ,#{ISOEM}  
	        ,#{ISSHRINKTEST}    )
	 </insert>	
	<insert id="insertPcmLotwtime" parameterType="map">
	    INSERT INTO PCM_LOTWTIME(  TXNHISTKEY  
	                             , LOTID  
	                             , WTIMEDEFID  
	                             , WTIMEDEFNAME  
	                             , ENTERPRISEID  
	                             , PLANTID  
	                             , PRODUCTDEFID  
	                             , PRODUCTDEFVERSION  
	                             , PROCESSDEFID  
	                             , PROCESSDEFVERSION  
	                             , PROCESSPATHID  
	                             , USERSEQUENCE  
	                             , PROCESSSEGMENTID  
	                             , PROCESSSEGMENTVERSION  
	                             , PROCESSSTATE  
	                             , TOPROCESSDEFID  
	                             , TOPROCESSDEFVERSION  
	                             , TOPROCESSPATHID  
	                             , TOPROCESSSEGMENTID  
	                             , TOPROCESSSEGMENTVERSION  
	                             , TOPROCESSSTATE  
	                             , SETTIME  
	                             , OCCURETIME  
	                             , WTIME  
	                             , WTIMETYPE  
	                             , WTIMELIMIT  
	                             , DESCRIPTION  
	                             , CREATOR  
	                             , CREATEDTIME  
	                             , MODIFIER  
	                             , MODIFIEDTIME  
	                             , TXNGROUPHISTKEY  
	                             , TXNID  
	                             , TXNUSER  
	                             , TXNTIME  
	                             , TXNREASONCODECLASS  
	                             , TXNREASONCODE  
	                             , TXNCOMMENT        
	                            ) VALUES(  #{TXNHISTKEY}  
	                                     , #{LOTID}  
	                                     , #{WTIMEDEFID}  
	                                     , #{WTIMEDEFNAME}  
	                                     , #{ENTERPRISEID}  
	                                     , #{PLANTID}  
	                                     , #{PRODUCTDEFID}  
	                                     , #{PRODUCTDEFVERSION}  
	                                     , #{PROCESSDEFID}  
	                                     , #{PROCESSDEFVERSION}  
	                                     , #{PROCESSPATHID}  
	                                     , #{USERSEQUENCE}  
	                                     , #{PROCESSSEGMENTID}  
	                                     , #{PROCESSSEGMENTVERSION}  
	                                     , #{PROCESSSTATE}  
	                                     , #{TOPROCESSDEFID}  
	                                     , #{TOPROCESSDEFVERSION}  
	                                     , #{TOPROCESSPATHID}  
	                                     , #{TOPROCESSSEGMENTID}  
	                                     , #{TOPROCESSSEGMENTVERSION}  
	                                     , #{TOPROCESSSTATE}  
	                                     , #{SETTIME}  
	                                     , #{OCCURETIME}  
	                                     , #{WTIME}  
	                                     , #{WTIMETYPE}  
	                                     , #{WTIMELIMIT}  
	                                     , #{DESCRIPTION}  
	                                     , #{CREATOR}  
	                                     , SYSDATE  
	                                     , #{MODIFIER}  
	                                     , SYSDATE  
	                                     , #{TXNGROUPHISTKEY}  
	                                     , #{TXNID}  
	                                     , #{TXNUSER}  
	                                     , SYSDATE  
	                                     , #{TXNREASONCODECLASS}  
	                                     , #{TXNREASONCODE}  
	                                     , #{TXNCOMMENT}    
	                                    )
	</insert>		
	<update id="updatePcmLotwtime" parameterType="map" >
	    UPDATE PCM_LOTWTIME 
	       SET WTIMEDEFID              = #{WTIMEDEFID}     
	         , WTIMEDEFNAME            = #{WTIMEDEFNAME}     
	         , ENTERPRISEID            = #{ENTERPRISEID}     
	         , PLANTID                 = #{PLANTID}     
	         , PRODUCTDEFID            = #{PRODUCTDEFID}     
	         , PRODUCTDEFVERSION       = #{PRODUCTDEFVERSION}     
	         , PROCESSDEFID            = #{PROCESSDEFID}     
	         , PROCESSDEFVERSION       = #{PROCESSDEFVERSION}     
	         , PROCESSPATHID           = #{PROCESSPATHID}     
	         , USERSEQUENCE            = #{USERSEQUENCE}     
	         , PROCESSSEGMENTID        = #{PROCESSSEGMENTID}     
	         , PROCESSSEGMENTVERSION   = #{PROCESSSEGMENTVERSION}     
	         , PROCESSSTATE            = #{PROCESSSTATE}     
	         , TOPROCESSDEFID          = #{TOPROCESSDEFID}     
	         , TOPROCESSDEFVERSION     = #{TOPROCESSDEFVERSION}     
	         , TOPROCESSPATHID         = #{TOPROCESSPATHID}     
	         , TOPROCESSSEGMENTID      = #{TOPROCESSSEGMENTID}     
	         , TOPROCESSSEGMENTVERSION = #{TOPROCESSSEGMENTVERSION}     
	         , TOPROCESSSTATE          = #{TOPROCESSSTATE}     
	         , SETTIME                 = #{SETTIME}     
	         , OCCURETIME              = #{OCCURETIME}     
	         , WTIME                   = #{WTIME}     
	         , WTIMETYPE               = #{WTIMETYPE}     
	         , WTIMELIMIT              = #{WTIMELIMIT}     
	         , DESCRIPTION             = #{DESCRIPTION}                     
	         , MODIFIER                = #{MODIFIER}     
	         , MODIFIEDTIME            = SYSDATE     
	         , TXNGROUPHISTKEY         = #{TXNGROUPHISTKEY}     
	         , TXNID                   = #{TXNID}     
	         , TXNUSER                 = #{TXNUSER}     
	         , TXNTIME                 = SYSDATE     
	         , TXNREASONCODECLASS      = #{TXNREASONCODECLASS}     
	         , TXNREASONCODE           = #{TXNREASONCODE}     
	         , TXNCOMMENT              = #{TXNCOMMENT}
	    WHERE LOTID                    = #{LOTID}
	      AND TXNHISTKEY               = #{TXNHISTKEY}
	 </update>	
	<select id="selectBasWtimeactionList" parameterType="map" resultType="hashmap">
	    SELECT 
	        A.WTIMEDEFID	
	        ,A.WTIMEACTIONID	
	        ,A.ACTIONSEQUENCE	
	        ,A.ENTERPRISEID	
	        ,A.PLANTID	
	        ,A.DESCRIPTION	
	        ,A.CREATOR	
	        ,A.CREATEDTIME	
	        ,A.MODIFIER	
	        ,A.MODIFIEDTIME	
	        ,A.LASTTXNHISTKEY	
	        ,A.LASTTXNID	
	        ,A.LASTTXNUSER	
	        ,A.LASTTXNTIME	
	        ,A.LASTTXNCOMMENT	
	        ,A.VALIDSTATE	
	    FROM	BAS_WTIMEACTION A 
	    WHERE 1=1 
	    <if test="WTIMEDEFID != null and WTIMEDEFID !='' "> 
	        AND A.WTIMEDEFID = #{WTIMEDEFID}
	    </if>
	    <if test="WTIMEACTIONID != null and WTIMEACTIONID !='' "> 
	        AND A.WTIMEACTIONID = #{WTIMEACTIONID}
	    </if>
	    <if test="ACTIONSEQUENCE != null and ACTIONSEQUENCE !='' "> 
	        AND A.ACTIONSEQUENCE = #{ACTIONSEQUENCE}
	    </if>
	    <if test="ENTERPRISEID != null and ENTERPRISEID !='' "> 
	        AND A.ENTERPRISEID = #{ENTERPRISEID}
	    </if>
	    <if test="PLANTID != null and PLANTID !='' "> 
	        AND A.PLANTID = #{PLANTID}
	    </if>
	    <if test="DESCRIPTION != null and DESCRIPTION !='' "> 
	        AND A.DESCRIPTION = #{DESCRIPTION}
	    </if>
	    <if test="LASTTXNCOMMENT != null and LASTTXNCOMMENT !='' "> 
	        AND A.LASTTXNCOMMENT = #{LASTTXNCOMMENT}
	    </if>
	    <if test="VALIDSTATE != null and VALIDSTATE !='' "> 
	        AND A.VALIDSTATE = #{VALIDSTATE}
	    </if>
	</select>	
	 <select id="selectBasAction" parameterType="map" resultType="map">
		    SELECT 
		        A.ACTIONID	 
		        ,A.ACTIONNAME	 
		        ,A.ENTERPRISEID	 
		        ,A.PLANTID	 
		        ,A.ACTIONTYPE	 
		        ,A.HOLDUSER	 
		        ,A.HOLDCODE	 
		        ,A.HOLDCOMMENT	 
		        ,A.EMAILTITLE	 
		        ,A.EMAILBODY	 
		        ,A.SMSTITLE	 
		        ,A.SMSBODY	 
		        ,A.USERCLASSID	 
		        ,A.PROCEDURENAME	 
		        ,A.ACTIONTXNID	 
		        ,A.ACTIONTXNUSER	 
		        ,A.ACTIONTXNREASONCODECLASS	 
		        ,A.ACTIONTXNREASONCODE	 
		        ,A.ACTIONTXNCOMMENT	 
		        ,A.REFERENCEUSERCLASSID	 
		        ,A.DESCRIPTION	 
		        ,A.CREATOR	 
		        ,A.CREATEDTIME	 
		        ,A.MODIFIER	 
		        ,A.MODIFIEDTIME	 
		        ,A.LASTTXNHISTKEY	 
		        ,A.LASTTXNID	 
		        ,A.LASTTXNUSER	 
		        ,A.LASTTXNTIME	 
		        ,A.LASTTXNCOMMENT	 
		        ,A.VALIDSTATE	 
		    FROM	BAS_ACTION A 
		    WHERE A.ACTIONID = #{ACTIONID}
	</select>
	<select id="getAreaListByAuthority" parameterType="map" resultType="hashmap">
         SELECT AREAID
              , NVL(D.DICTIONARYNAME,  A.AREANAME) AS AREANAME
              , A.PLANTID
           FROM FN_AREA(#{CREATOR})  A
		   LEFT OUTER JOIN CMD_DICTIONARY  D ON A.AREANAME     = D.DICTIONARYID
                                      AND D.LANGUAGETYPE = #{SESSION_LANGUAGETYPE}
          WHERE  1 = 1   
        <if test="!(ISMODIFY eq 'N'.toString())"> 
          	AND A.ISMODIFY = 'Y'
        </if>
        <if test="PLANTID != null and PLANTID !='' and !(PLANTID eq '*'.toString())">   
	            AND A.PLANTID = #{PLANTID}
	    </if>
	    <if test="TXTAREA != null and TXTAREA !='' and !(TXTAREA eq '*'.toString())">   
	            AND (   UPPER(AREAID)   LIKE UPPER( <![CDATA['%' ||]]> #{TXTAREA} <![CDATA[|| '%']]>)
	                 OR UPPER(AREANAME) LIKE UPPER( <![CDATA['%' ||]]> #{TXTAREA} <![CDATA[|| '%']]>)
	                 OR UPPER(D.DICTIONARYNAME) like UPPER( <![CDATA['%' ||]]> #{TXTAREA} <![CDATA[|| '%']]>))
	    </if>
	    <if test="AREA != null and AREA !='' and !(AREA eq '*'.toString())">   
	            AND (   UPPER(AREAID)           LIKE UPPER(<![CDATA['%' ||]]> #{AREA} <![CDATA[|| '%']]>)
	                 OR UPPER(AREANAME)         LIKE UPPER(<![CDATA['%' ||]]> #{AREA} <![CDATA[|| '%']]>)
	                 OR UPPER(D.DICTIONARYNAME) LIKE UPPER(<![CDATA['%' ||]]> #{AREA} <![CDATA[|| '%']]>) )
	    </if>   
       ORDER BY AREAID ASC	
	</select>	
	<select id="getLotWorkResultCount" parameterType="map" resultType="int">
	    SELECT CASE WHEN COUNT(*) = 0 THEN 0
	                ELSE MAX(WORKCOUNT) + 1
	           END AS RESULTCNT
	      FROM PCM_LOTWORKRESULT  LWR
	    WHERE LWR.LOTID            = #{LOTID}
	      AND LWR.PROCESSSEGMENTID = #{PROCESSSEGMENTID}
   <if test="PROCESSPATHSTACK != null and PROCESSPATHSTACK !=''">  
          AND LWR.PROCESSPATHSTACK = #{PROCESSPATHSTACK}
   </if>
	      AND NVL(LWR.RESULTTYPE, 'NORMAL') != 'SKIP'	
	</select>
	<update id="updatePcmLothistory"  parameterType="map">
		UPDATE PCM_LOTHISTORY 
		   SET PREVPLANTID   = #{PREVPLANTID}
		     , PREVFACTORYID = #{PREVFACTORYID}
		     , PREVAREAID    = #{PREVAREAID}
		     , MODIFIER      = #{MODIFIER}     
             , MODIFIEDTIME  = SYSDATE  
		 WHERE LOTID         = #{LOTID}
		  AND  TXNHISTKEY    = #{TXNHISTKEY}
	</update>
	<select id="getProcessPathByProcessDefId" parameterType="map" resultType="hashmap">
		      SELECT PT.PROCESSPATHID
		           , PT.PROCESSDEFID
		           , PT.PROCESSDEFVERSION
		           , PT.ENTERPRISEID
		           , PT.PLANTID
		           , PT.PROCESSSEGMENTID
		           , PT.PROCESSSEGMENTVERSION
		           , PT.PATHTYPE
		           , NVL(DC1.DICTIONARYNAME, SG.PROCESSSEGMENTNAME) AS PROCESSSEGMENTNAME
		           , PT.PATHSEQUENCE
		           , PT.USERSEQUENCE
		      FROM BAS_PROCESSDEFINITION       PD
		      INNER JOIN BAS_PROCESSPATH       PT  ON PD.PROCESSDEFID        = PT.PROCESSDEFID
		                                          AND PD.PROCESSDEFVERSION   = PT.PROCESSDEFVERSION
		      INNER JOIN BAS_PROCESSSEGMENT    SG  ON PT.PROCESSSEGMENTID    = SG.PROCESSSEGMENTID
		 LEFT OUTER JOIN CMD_DICTIONARY       DC1  ON  SG.PROCESSSEGMENTNAME = DC1.DICTIONARYID
		                                          AND DC1.LANGUAGETYPE       = #{LANGUAGETYPE}
		           WHERE PD.PROCESSDEFID       = #{PROCESSDEFID}
		             AND PD.PROCESSDEFVERSION  = #{PROCESSDEFVERSION}
		             AND PT.VALIDSTATE         = 'Valid'
		        ORDER BY PT.PATHSEQUENCE		
	</select>
	<insert id="insertMtmConsumablelot" parameterType="map">
	    INSERT INTO MTM_CONSUMABLELOT(  CONSUMABLELOTID  
	                                  , CONSUMABLELOTGROUPID  
	                                  , CONSUMABLEDEFID  
	                                  , CONSUMABLEDEFVERSION  
	                                  , CONSUMABLELOTNAME  
	                                  , ENTERPRISEID  
	                                  , PLANTID  
	                                  , AREAID  
	                                  , EQUIPMENTID  
	                                  , LOCATIONID  
	                                  , CONSUMABLESTATE  
	                                  , CREATEDQTY  
	                                  , CONSUMABLELOTQTY  
	                                  , EXPIREDDATE  
	                                  , ISHOLD  
	                                  , VENDORLOTID  
	                                  , DESCRIPTION  
	                                  , CREATOR  
	                                  , CREATEDTIME  
	                                  , MODIFIER  
	                                  , MODIFIEDTIME  
	                                  , LASTTXNHISTKEY  
	                                  , LASTTXNID  
	                                  , LASTTXNUSER  
	                                  , LASTTXNTIME  
	                                  , LASTTXNCOMMENT  
	                                  , LASTTXNGROUPHISTKEY  
	                                  , WAREHOUSEID  
	                                  , WAITFORRECEIPTQTY  
	                                  , CONSUMEDQTY  
	                                  , PRODUCTDEFID  
	                                  , PRODUCTDEFVERSION  
	                                  , PROCESSDEFID  
	                                  , PROCESSDEFVERSION  
	                                  , PROCESSPATHID  
	                                  , USERSEQUENCE  
	                                  , PROCESSSEGMENTID  
	                                  , PROCESSSEGMENTVERSION  
	                                  , TXNGROUPHISTKEY  
	                                  , TXNUSER  
	                                  , TXNTIME  
	                                  , TXNREASONCODECLASS  
	                                  , TXNREASONCODE  
	                                  , TXNCOMMENT  
	                                  , WORKCOUNT  
	                                  ,TRANSACTIONREASONCODE        
	                                 ) VALUES(   #{CONSUMABLELOTID}  
	                                           , #{CONSUMABLELOTGROUPID}  
	                                           , #{CONSUMABLEDEFID}  
	                                           , #{CONSUMABLEDEFVERSION}  
	                                           , #{CONSUMABLELOTNAME}  
	                                           , #{ENTERPRISEID}  
	                                           , #{PLANTID}  
	                                           , #{AREAID}  
	                                           , #{EQUIPMENTID}  
	                                           , #{LOCATIONID}  
	                                           , #{CONSUMABLESTATE}  
	                                           , #{CREATEDQTY}  
	                                           , #{CONSUMABLELOTQTY}  
	                                           , #{EXPIREDDATE}  
	                                           , #{ISHOLD}  
	                                           , #{VENDORLOTID}  
	                                           , #{DESCRIPTION}  
	                                           , #{CREATOR}  
	                                           , SYSDATE  
	                                           , #{MODIFIER}  
	                                           , SYSDATE  
	                                           , #{LASTTXNHISTKEY}  
	                                           , #{LASTTXNID}  
	                                           , #{LASTTXNUSER}  
	                                           , #{LASTTXNTIME}  
	                                           , #{LASTTXNCOMMENT}  
	                                           , #{LASTTXNGROUPHISTKEY}  
	                                           , #{WAREHOUSEID}  
	                                           , #{WAITFORRECEIPTQTY}  
	                                           , #{CONSUMEDQTY}  
	                                           , #{PRODUCTDEFID}  
	                                           , #{PRODUCTDEFVERSION}  
	                                           , #{PROCESSDEFID}  
	                                           , #{PROCESSDEFVERSION}  
	                                           , #{PROCESSPATHID}  
	                                           , #{USERSEQUENCE}  
	                                           , #{PROCESSSEGMENTID}  
	                                           , #{PROCESSSEGMENTVERSION}  
	                                           , #{TXNGROUPHISTKEY}  
	                                           , #{TXNUSER}  
	                                           , SYSDATE  
	                                           , #{TXNREASONCODECLASS}  
	                                           , #{TXNREASONCODE}  
	                                           , #{TXNCOMMENT}  
	                                           , #{WORKCOUNT}  
	                                           , #{TRANSACTIONREASONCODE}    
	                                         )
	</insert>
	<select id="selectBBTPathSequenceByRouting" parameterType="map" resultType="hashmap">
		    WITH BBT_MAXSEQUENCE AS
		    (
				     SELECT X.LOTID 
				         ,  NVL(MAX(BBT_PATH),0) BBT_PATH
				      FROM (      SELECT L.LOTID
				                       , PP.PROCESSSEGMENTID
				                       , PP.PATHSEQUENCE
				                       , PS.PROCESSSEGMENTCLASSID
				                       , CASE WHEN PS.PROCESSSEGMENTCLASSID = '7022' THEN PP.PATHSEQUENCE ELSE 0 END BBT_PATH
				                    FROM PCM_LOT L
				              INNER JOIN BAS_PROCESSPATH PP    ON L.PROCESSDEFID           = PP.PROCESSDEFID
				                                              AND L.PROCESSDEFVERSION      = PP.PROCESSDEFVERSION
				              INNER JOIN BAS_PROCESSSEGMENT PS ON PP.PROCESSSEGMENTID      = PS.PROCESSSEGMENTID
				                                              AND PP.PROCESSSEGMENTVERSION = PS.PROCESSSEGMENTVERSION
				                   WHERE LOTID = #{LOTID}
				           ) X
				    GROUP BY X.LOTID
		    )
		        SELECT CASE WHEN BBT_PATH <![CDATA[<]]> PP.PATHSEQUENCE THEN 'Y' ELSE 'N'
		               END CHECKFIN
		          FROM PCM_LOT L
		    INNER JOIN BAS_PROCESSPATH PP ON  L.PROCESSDEFID         = PP.PROCESSDEFID
		                                 AND L.PROCESSDEFVERSION     = PP.PROCESSDEFVERSION
		                                 AND L.PROCESSSEGMENTID      = PP.PROCESSSEGMENTID
		                                 AND L.PROCESSSEGMENTVERSION = PP.PROCESSSEGMENTVERSION
		    INNER JOIN BBT_MAXSEQUENCE BM ON L.LOTID                 = BM.LOTID                             
		         WHERE L.LOTID = #{LOTID}
    	
	</select>		
	<update id="updateBasProcesssegment" parameterType="map" >
	    UPDATE BAS_PROCESSSEGMENT 
	       SET PROCESSSEGMENTCLASSID = #{PROCESSSEGMENTCLASSID}     
	         , PROCESSSEGMENTNAME    = #{PROCESSSEGMENTNAME}     
	         , ENTERPRISEID          = #{ENTERPRISEID}     
	         , PLANTID               = #{PLANTID}     
	         , AREAID                = #{AREAID}     
	         , PROCESSSEGMENTTYPE    = #{PROCESSSEGMENTTYPE}     
	         , EQUIPMENTCLASSID      = #{EQUIPMENTCLASSID}     
	         , ISTRACKINREQUIRED     = #{ISTRACKINREQUIRED}     
	         , LEADTIME              = #{LEADTIME}     
	         , VERSIONSTATE          = #{VERSIONSTATE}     
	         , STEPCLASS             = #{STEPCLASS}     
	         , STEPTYPE              = #{STEPTYPE}     
	         , ISIMPORTINSPECTION    = #{ISIMPORTINSPECTION}     
	         , ISMAINSEGMENT         = #{ISMAINSEGMENT}     
	         , WORKMETHOD            = #{WORKMETHOD}     
	         , QCTYPE                = #{QCTYPE}     
	         , ISDEFECTREASON        = #{ISDEFECTREASON}     
	         , MINWAITINGTIME        = #{MINWAITINGTIME}     
	         , MAXWAITINGTIME        = #{MAXWAITINGTIME}     
	         , WORKUNIT              = #{WORKUNIT}     
	         , DESCRIPTION           = #{DESCRIPTION}                     
	         , MODIFIER              = #{MODIFIER}     
	         , MODIFIEDTIME          = SYSDATE     
	         , LASTTXNHISTKEY        = #{LASTTXNHISTKEY}     
	         , LASTTXNID             = #{LASTTXNID}     
	         , LASTTXNUSER           = #{MODIFIER}      
	         , LASTTXNTIME           = SYSDATE    
	         , LASTTXNCOMMENT        = #{LASTTXNCOMMENT}     
	         , VALIDSTATE            = #{VALIDSTATE}
	    WHERE PROCESSSEGMENTID       = #{PROCESSSEGMENTID}
	      AND PROCESSSEGMENTVERSION  = #{PROCESSSEGMENTVERSION}
	</update>
	<select id="selectMaxDefectMaxSequence" parameterType="map" resultType="string">
        SELECT  MAX(SUBSTR(LOTID,-3)) AS MAXSEQUENCE
          FROM PCM_LOT
         WHERE ROOTLOTID = #{ROOTLOTID}
           AND LOTCREATEDTYPE = 'Defect'	
	</select>  
	<select id="selectMigMaxDefectMaxSequence" parameterType="map" resultType="string">
        SELECT  MAX(SUBSTR(LOTID,-1)) AS MAXSEQUENCE
          FROM PCM_LOT
         WHERE ROOTLOTID = #{ROOTLOTID}
           AND LOTCREATEDTYPE = 'Defect'	
	</select>  
	<select id="getMaxSplitLot" parameterType="map" resultType="string">
        SELECT MAX(SUBSTR(LOTID,-3)) AS MAXSEQUENCE
		  FROM PCM_LOT 
		 WHERE LOTID LIKE <![CDATA['%' ||]]> #{LOTID} <![CDATA[|| '%']]>
		   AND NVL(ISDEFECTED, 'N') = 'N'
	</select>  
	<select id="getMigMaxSplitLot" parameterType="map" resultType="string">
        SELECT MAX(SUBSTR(LOTID,-1)) AS MAXSEQUENCE
		  FROM PCM_LOT 
		 WHERE LOTID LIKE <![CDATA['%' ||]]> #{LOTID} <![CDATA[|| '%']]>
		   AND NVL(ISDEFECTED, 'N') = 'N'
		   AND LOTID <![CDATA[<>]]> #{LOTID}
	</select> 	
	<select id="selectPcmLotlocking" parameterType="map" resultType="hashmap">
	    SELECT A.TXNHISTKEY	 
	         , A.LOTID	 
	         , A.ENTERPRISEID	 
	         , A.PLANTID	 
	         , A.AREAID	 
	         , A.PRODUCTDEFID	 
	         , A.PRODUCTDEFVERSION	 
	         , A.PROCESSDEFID	 
	         , A.PROCESSDEFVERSION	 
	         , A.USERSEQUENCE	 
	         , A.PROCESSSEGMENTID	 
	         , A.PROCESSSEGMENTVERSION	 
	         , A.WORKCOUNT	 
	         , A.LOCKINGSTATUS	 
	         , A.LOCKINGTYPE	 
	         , A.LOCKINGCODE	 
	         , A.COMMENTS	 
	         , A.UNLOCKINGCODE	 
	         , A.RELEASECOMMENTS	 
	         , A.DESCRIPTION	 
	         , A.CREATOR	 
	         , A.CREATEDTIME	 
	         , A.TXNGROUPHISTKEY	 
	         , A.TXNUSER	 
	         , A.TXNTIME	 
	         , A.TXNREASONCODECLASS	 
	         , A.TXNREASONCODE	 
	         , A.TXNCOMMENT	 
	      FROM	PCM_LOTLOCKING A 
	     WHERE A.LOTID       = #{LOTID}
	   <if test="P_TXNHISTKEY != null and P_TXNHISTKEY !='' ">    
		   AND A.TXNHISTKEY = #{P_TXNHISTKEY}
	   </if>
	</select>	
    <update id="updatePcmReworkreturn" parameterType="map" >
	    UPDATE PCM_REWORKRETURN 
	    SET 
	        PRODUCTDEFID = #{PRODUCTDEFID}     
	        ,PRODUCTDEFVERSION = #{PRODUCTDEFVERSION}     
	        ,PROCESSDEFID = #{PROCESSDEFID}     
	        ,PROCESSDEFVERSION = #{PROCESSDEFVERSION}     
	        ,SUBPROCESSDEFID = #{SUBPROCESSDEFID}     
	        ,SUBPROCESSDEFVERSION = #{SUBPROCESSDEFVERSION}     
	        ,FROMPROCESSSEGMENTID = #{FROMPROCESSSEGMENTID}     
	        ,FROMPROCESSSEGMENTVERSION = #{FROMPROCESSSEGMENTVERSION}     
	        ,FROMPROCESSSTATE = #{FROMPROCESSSTATE}     
	        ,FROMAREAID = #{FROMAREAID}     
	        ,FROMRESOURCEID = #{FROMRESOURCEID}     
	        ,REWORKPROCESSSEGMENTID = #{REWORKPROCESSSEGMENTID}     
	        ,REWORKPROCESSSEGMENTVERSION = #{REWORKPROCESSSEGMENTVERSION}     
	        ,REWORKAREAID = #{REWORKAREAID}     
	        ,REWORKRESOURCE = #{REWORKRESOURCE}     
	        ,TOPROCESSSEGMENTID = #{TOPROCESSSEGMENTID}     
	        ,TOPROCESSSEGMENTVERSION = #{TOPROCESSSEGMENTVERSION}     
	        ,TOPROCESSSTATE = #{TOPROCESSSTATE}     
	        ,TORESOURCEID = #{TORESOURCEID}     
	        ,TOAREAID = #{TOAREAID}     
	        ,MOVESTATE = #{MOVESTATE}     
	        ,WORKCOUNT = #{WORKCOUNT}     
	        ,APPLOVEDUSER = #{APPLOVEDUSER}     
	        ,APPLOVEDDATE = #{APPLOVEDDATE}     
	        ,REWORKQTY = #{REWORKQTY}     
	        ,DESCRIPTION = #{DESCRIPTION}                     
	        ,MODIFIER = #{MODIFIER}     
	        ,MODIFIEDTIME = SYSDATE     
	        ,LASTTXNHISTKEY = #{LASTTXNHISTKEY}     
	        ,LASTTXNID = #{LASTTXNID}     
	        ,LASTTXNUSER = #{LASTTXNUSER}     
	        ,LASTTXNTIME = SYSDATE  
	        ,LASTTXNCOMMENT = #{LASTTXNCOMMENT}     
	        ,VALIDSTATE = #{VALIDSTATE}
	    WHERE LOTID = #{LOTID}
    </update>
    <insert id="insertBasProcessDefinitionCopy" parameterType="map" >
       <!-- PCMWipDaoMapper.insertBasProcessDefinitionCopy -->
 				INSERT INTO BAS_PROCESSDEFINITION
				(
				      PROCESSDEFID
				    , PROCESSDEFVERSION
				    , PROCESSCLASSID
				    , PROCESSDEFNAME
				    , ENTERPRISEID
				    , PLANTID
				    , PROCESSDEFTYPE
				    , LEADTIME
				    , VERSIONSTATE
				    , REWORKITEMCONTROL
				    , REWORKSEGMENTCONTROL
				    , DESCRIPTION
				    , CREATOR
				    , CREATEDTIME
				    , MODIFIER
				    , MODIFIEDTIME
				    , LASTTXNHISTKEY
				    , LASTTXNID
				    , LASTTXNUSER
				    , LASTTXNTIME
				    , LASTTXNCOMMENT
				    , VALIDSTATE
				    , TOPPROCESSSEGMENTID
				)
		        SELECT 	#{P_CHILDLOTID}	 AS PROCESSDEFID
		             ,	PP.PROCESSDEFVERSION
		             ,	PP.PROCESSCLASSID
		             ,	PP.PROCESSDEFNAME
		             ,	PP.ENTERPRISEID
		             ,	PP.PLANTID
		             ,	PP.PROCESSDEFTYPE
		             ,	PP.LEADTIME
		             ,	PP.VERSIONSTATE
		             ,	PP.REWORKITEMCONTROL
		             ,	PP.REWORKSEGMENTCONTROL
		             ,	PP.DESCRIPTION
		             ,	PP.CREATOR
		             ,	SYSDATE
		             ,	PP.MODIFIER
		             ,	SYSDATE
		             ,	PP.LASTTXNHISTKEY
		             ,	PP.LASTTXNID
		             ,	PP.LASTTXNUSER
		             ,	PP.LASTTXNTIME
		             ,	PP.LASTTXNCOMMENT
		             ,	PP.VALIDSTATE
		             ,	PP.TOPPROCESSSEGMENTID
		          FROM PCM_LOT					L
			INNER JOIN BAS_PROCESSDEFINITION	PP	ON L.PROCESSDEFID      = PP.PROCESSDEFID
								                   AND L.PROCESSDEFVERSION = PP.PROCESSDEFVERSION
				  WHERE L.LOTID = #{P_LOTID}   
    </insert>
    <insert id="insertBasProcessPathCopy" parameterType="map" >
     <!-- PCMWipDaoMapper.insertBasProcessPathCopy -->
		INSERT 
		  INTO BAS_PROCESSPATH (  PROCESSPATHID
								, ENTERPRISEID
								, PLANTID
								, PROCESSDEFID
								, PROCESSDEFVERSION
								, PROCESSSEGMENTID
								, PROCESSSEGMENTVERSION
								, PATHSEQUENCE
								, USERSEQUENCE
								, PATHTYPE
								, ALTERNATETYPE
								, ALTERNATEPROCESSCLASSID
								, REWORKPROCESSDEFID
								, REWORKPROCESSDEFVERSION
								, REWORKRETURNPATHID
								, DESCRIPTION
								, CREATOR
								, CREATEDTIME
								, MODIFIER
								, MODIFIEDTIME
								, LASTTXNHISTKEY
								, LASTTXNID
								, LASTTXNUSER
								, LASTTXNTIME
								, LASTTXNCOMMENT
								, VALIDSTATE
								, PROCESSUOM
				               )
        SELECT #{P_CHILDLOTID} || PT.PATHSEQUENCE	AS PROCESSPATHID
             , PT.ENTERPRISEID
             , PT.PLANTID
             , #{P_CHILDLOTID}						AS PROCESSDEFID
             , PT.PROCESSDEFVERSION
             , PT.PROCESSSEGMENTID
             , PT.PROCESSSEGMENTVERSION
             , PT.PATHSEQUENCE
             , PT.USERSEQUENCE
             , PT.PATHTYPE
             , PT.ALTERNATETYPE
             , PT.ALTERNATEPROCESSCLASSID
             , PT.REWORKPROCESSDEFID
             , PT.REWORKPROCESSDEFVERSION
             , PT.REWORKRETURNPATHID
             , PT.DESCRIPTION
             , PT.CREATOR
             , PT.CREATEDTIME
             , PT.MODIFIER
             , PT.MODIFIEDTIME
             , PT.LASTTXNHISTKEY
             , PT.LASTTXNID
             , PT.LASTTXNUSER
             , PT.LASTTXNTIME
             , PT.LASTTXNCOMMENT
             , PT.VALIDSTATE
             , PT.PROCESSUOM
          FROM PCM_LOT			L
	INNER JOIN BAS_PROCESSPATH	PT 	ON 	L.PROCESSDEFID     = PT.PROCESSDEFID
								   AND L.PROCESSDEFVERSION = PT.PROCESSDEFVERSION
		  WHERE L.LOTID = #{P_LOTID}    
    </insert>
    <insert id="insertBasBillOfMaterialCopy" parameterType="map" >
       <!-- PCMWipDaoMapper.insertBasBillOfMaterialCopy -->
	     INSERT 
	       INTO BAS_BILLOFMATERIAL(  PRODUCTDEFID
	                               , PRODUCTDEFVERSION
	                               , PROCESSDEFID
	                               , PROCESSDEFVERSION
	                               , PROCESSSEGMENTID
	                               , PROCESSSEGMENTVERSION
	                               , MATERIALTYPE
	                               , MATERIALDEFID
	                               , MATERIALDEFVERSION
	                               , "sequence"
	                               , ENTERPRISEID
	                               , PLANTID
	                               , UNIT
	                               , QTY
	                               , ISALTERABLE
	                               , ISREQUIRED
	                               , MAINMATERIALDEFID
	                               , MAINMATERIALDEFVERSION
	                               , DESCRIPTION
	                               , CREATOR
	                               , CREATEDTIME
	                               , MODIFIER
	                               , MODIFIEDTIME
	                               , LASTTXNHISTKEY
	                               , LASTTXNID
	                               , LASTTXNUSER
	                               , LASTTXNTIME
	                               , LASTTXNCOMMENT
	                               , VALIDSTATE
	                               , WIPSUPPLYTYPE
	                              )
	        SELECT BOM.PRODUCTDEFID
	             , BOM.PRODUCTDEFVERSION
	             , #{P_CHILDLOTID}     AS PROCESSDEFID
	             , BOM.PROCESSDEFVERSION
	             , BOM.PROCESSSEGMENTID
	             , BOM.PROCESSSEGMENTVERSION
	             , BOM.MATERIALTYPE
	             , BOM.MATERIALDEFID
	             , BOM.MATERIALDEFVERSION
	             , BOM."sequence"
	             , BOM.ENTERPRISEID
	             , BOM.PLANTID
	             , BOM.UNIT
	             , BOM.QTY
	             , BOM.ISALTERABLE
	             , BOM.ISREQUIRED
	             , BOM.MAINMATERIALDEFID
	             , BOM.MAINMATERIALDEFVERSION
	             , BOM.DESCRIPTION
	             , BOM.CREATOR
	             , BOM.CREATEDTIME
	             , BOM.MODIFIER
	             , BOM.MODIFIEDTIME
	             , BOM.LASTTXNHISTKEY
	             , BOM.LASTTXNID
	             , BOM.LASTTXNUSER
	             , BOM.LASTTXNTIME
	             , BOM.LASTTXNCOMMENT
	             , BOM.VALIDSTATE
	             , BOM.WIPSUPPLYTYPE
	          FROM PCM_LOT     L
	    INNER JOIN BAS_BILLOFMATERIAL  BOM ON BOM.PROCESSDEFID      = L.PROCESSDEFID
	                                      AND BOM.PROCESSDEFVERSION = L.PROCESSDEFVERSION
	         WHERE L.LOTID = #{P_LOTID}    
    </insert>	
    <insert id="insertBasBillOfResourceCopy" parameterType="map" >
        <!-- PCMWipDaoMapper.insertBasBillOfResourceCopy -->
		    INSERT 
		      INTO BAS_BILLOFRESOURCE ( PRODUCTDEFID
		                               , PRODUCTDEFVERSION
		                               , PROCESSDEFID
		                               , PROCESSDEFVERSION
		                               , PROCESSSEGMENTID
		                               , PROCESSSEGMENTVERSION
		                               , RESOURCETYPE
		                               , "sequence"
		                               , EQUIPMENTID
		                               , RESOURCECLASSID
		                               , RESOURCEID
		                               , ISPRIMARYRESOURCE
		                               , ENTERPRISEID
		                               , PLANTID
		                               , DESCRIPTION
		                               , CREATOR
		                               , CREATEDTIME
		                               , MODIFIER
		                               , MODIFIEDTIME
		                               , LASTTXNHISTKEY
		                               , LASTTXNID
		                               , LASTTXNUSER
		                               , LASTTXNTIME
		                               , LASTTXNCOMMENT
		                               , VALIDSTATE
		                               , RESOURCEVERSION
		                             )
		        SELECT BOR.PRODUCTDEFID
		             , BOR.PRODUCTDEFVERSION
		             , #{P_CHILDLOTID}     AS PROCESSDEFID
		             , BOR.PROCESSDEFVERSION
		             , BOR.PROCESSSEGMENTID
		             , BOR.PROCESSSEGMENTVERSION
		             , BOR.RESOURCETYPE
		             , BOR."sequence"
		             , BOR.EQUIPMENTID
		             , BOR.RESOURCECLASSID
		             , BOR.RESOURCEID
		             , BOR.ISPRIMARYRESOURCE
		             , BOR.ENTERPRISEID
		             , BOR.PLANTID
		             , BOR.DESCRIPTION
		             , BOR.CREATOR
		             , BOR.CREATEDTIME
		             , BOR.MODIFIER
		             , BOR.MODIFIEDTIME
		             , BOR.LASTTXNHISTKEY
		             , BOR.LASTTXNID
		             , BOR.LASTTXNUSER
		             , BOR.LASTTXNTIME
		             , BOR.LASTTXNCOMMENT
		             , BOR.VALIDSTATE
		             , BOR.RESOURCEVERSION
		          FROM PCM_LOT    L
		    INNER JOIN BAS_BILLOFRESOURCE BOR  ON L.PROCESSDEFID      = BOR.PROCESSDEFID
		                                      AND L.PROCESSDEFVERSION = BOR.PROCESSDEFVERSION
                 WHERE L.LOTID = #{P_LOTID}    
    </insert>
     <update id="updatePcmLotworkresultCopy" parameterType="map" >
         <!-- PCMWipDaoMapper.updatePcmLotworkresultCopy -->
		  MERGE INTO PCM_LOTWORKRESULT LWR          
		       USING (    SELECT L.LOTID
		                       , #{P_PROCESSDEFVERSION} AS PROCESSDEFVERSION
		                       , CASE WHEN COALESCE(L.SUBPROCESSDEFID, '')  <![CDATA[<>]]> '' THEN SPLIT_PART(L.PROCESSPATHSTACK, '.', 2)
		                               ELSE NEW.PROCESSPATHID 
		                         END AS PROCESSPATHID
		                       , CASE WHEN COALESCE(L.SUBPROCESSDEFID, '')  <![CDATA[<>]]> '' THEN NEW.PROCESSPATHID || '.' || SPLIT_PART(L.PROCESSPATHSTACK, '.', 2)
		                              ELSE NEW.PROCESSPATHID 
		                          END AS PROCESSPATHSTACK
		                       , CASE WHEN COALESCE(L.SUBPROCESSDEFID, '')  <![CDATA[<>]]> '' THEN L.USERSEQUENCE
		                              ELSE NEW.USERSEQUENCE 
		                         END AS USERSEQUENCE
		                       , L.PROCESSSEGMENTID
		                    FROM PCM_LOT L
		              INNER JOIN BAS_PROCESSPATH ORG ON ORG.PROCESSPATHID = CASE WHEN COALESCE(L.SUBPROCESSDEFID, '')  <![CDATA[<>]]> '' THEN SPLIT_PART(L.PROCESSPATHSTACK, '.', 2)
		                                                                         ELSE L.PROCESSPATHSTACK 
		                                                                    END
		              INNER JOIN BAS_PROCESSPATH NEW ON NEW.PROCESSDEFID       = L.LOTID
		                                            AND NEW.PROCESSDEFVERSION  = #{P_PROCESSDEFVERSION}
		                                            AND NEW.PROCESSSEGMENTID   = ORG.PROCESSSEGMENTID
		                    WHERE L.LOTID = #{P_CHILDLOTID} ) L  ON (     LWR.LOTID  = L.LOTID
		                                                               AND LWR.PROCESSSEGMENTID = L.PROCESSSEGMENTID )
		       WHEN MATCHED THEN 
		            UPDATE SET LWR.PROCESSDEFID      = #{P_CHILDLOTID}
		                     , LWR.PROCESSDEFVERSION = L.PROCESSDEFVERSION
		                     , LWR.PROCESSPATHID     = L.PROCESSPATHID
		                     , LWR.PROCESSPATHSTACK  = L.PROCESSPATHSTACK
		                     , LWR.USERSEQUENCE      = L.USERSEQUENCE  
     </update>
    <update id="updateLotworkresult" parameterType="map">
		 UPDATE PCM_LOTWORKRESULT
		        SET 
					  MODIFIER          = #{MODIFIER}
					, MODIFIEDTIME      = SYSDATE									
			    	, PROCESSDEFID      = #{PROCESSDEFID}						
			   		, PROCESSDEFVERSION = #{PROCESSDEFVERSION}					
				    , USERSEQUENCE      = #{USERSEQUENCE}	
			    	, PROCESSPATHID     = #{PROCESSPATHID}																					
			    	, PROCESSPATHSTACK  = #{PROCESSPATHSTACK}															
			WHERE 1 = 1
			  AND LOTID	      		    = #{LOTID}
			  AND PROCESSSEGMENTID   	= #{PROCESSSEGMENTID}
			  AND WORKCOUNT 		    = #{WORKCOUNT}
    </update>
    
       <select id="selectBasPlant" parameterType="map" resultType="map">
		    SELECT 
		        A.PLANTID	 
		        ,A.ENTERPRISEID	 
		        ,A.PLANTNAME	 
		        ,A.ADDRESS	 
		        ,A.PHONE	 
		        ,A.FAXNO	 
		        ,A.LANGUAGE	 
		        ,A.ISOSPBUDGETCONTROL	 
		        ,A.ISOSPETCBUDGETCONTROL	 
		        ,A.WORKTIME	 
		        ,A.TIMEZONE	 
		        ,A.SETHOLDDATE	 
		        ,A.ISOTIMEZONE	 
		        ,A.ISAUDIT	 
		        ,A.ISOSPWAREHOUSEOPERATE	 
		        ,A.ISWIPSURVEY	 
		        ,A.DESCRIPTION	 
		        ,A.CREATOR	 
		        ,A.CREATEDTIME	 
		        ,A.MODIFIER	 
		        ,A.MODIFIEDTIME	 
		        ,A.LASTTXNHISTKEY	 
		        ,A.LASTTXNID	 
		        ,A.LASTTXNUSER	 
		        ,A.LASTTXNTIME	 
		        ,A.LASTTXNCOMMENT	 
		        ,A.VALIDSTATE	 
		    FROM	BAS_PLANT A 
		    WHERE A.PLANTID = #{SESSION_SITETYPE}
    </select> 
    
     <select id="selectBasUsergroupuser" parameterType="map" resultType="hashmap">
                SELECT BU.USERGROUPID
				     , BU.USERID
				     , BU.VALIDSTATE
				     , U1.USERNAME AS USER_NM
				     , U1.DEPARTMENT AS DEPT_CD
				     , U1.POSITION AS JIKWI_CD
				     , U1.EMAILADDRESS 
				     , U1.MBPH_NO
				     , NULL AS CHK
				  FROM   BAS_USERGROUPUSER BU
				LEFT   OUTER JOIN CMD_USER_V U1
				ON     BU.USERID = U1.USERID
			WHERE  BU.USERGROUPID = #{USERGROUPID} 
    </select>
</mapper>
