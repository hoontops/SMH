<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="OSM00100M" width="1278" height="757" titletext="Claim 공정별 기준 금액" onload="fn_init" ontimer="OSM00100M_ontimer">
    <Layouts>
      <Layout height="757" mobileorientation="landscape" width="1278">
        <Tab id="tab_search" taborder="0" tabindex="0" left="2" top="64" cssclass="tab_search" bottom="0" width="295">
          <Tabpages>
            <Tabpage id="Tabpage1" text="Tabpage1">
              <Layouts>
                <Layout>
                  <Static id="label00" taborder="4" text="Site" left="0" top="10" width="103" height="20" cssclass="sta_WF_label" tooltiptext="SITE"/>
                  <Combo id="cbo_plantid" taborder="0" text="IFC" left="108" top="10" height="20" index="1" value="" width="165" codecolumn="C,SiteType,,Y,Y"/>
                  <Button id="btn_clear" taborder="3" top="105" width="107" height="36" cssclass="btn_SA_reset" left="171" text="초기화" tooltiptext="초기화" onclick="fn_searchClear"/>
                  <Button id="btn_search" taborder="2" top="105" width="146" height="36" cssclass="btn_SA_search" left="15" text="검색" tooltiptext="검색" onclick="fn_search"/>
                  <Static id="Static12_00_00_00" taborder="5" text="w&#13;&#10;15" width="15" top="30" visible="false" height="387" cssclass="guideTip" right="0"/>
                  <Static id="Static12_00_00_00_00" taborder="6" text="w&#13;&#10;15" width="15" top="40" visible="false" height="387" cssclass="guideTip" left="0"/>
                  <Static id="Static12_00_00_00_01" taborder="7" text="h10" width="45" top="0" visible="false" height="10" cssclass="guideTip" right="91"/>
                  <Static id="Static12_00_00_00_01_00" taborder="8" text="h5" width="45" top="30" visible="false" height="5" cssclass="guideTip" right="91"/>
                  <Edit id="edt_PRODUCTDEFID" taborder="1" left="108" top="35" height="20" right="37"/>
                  <Button id="btn_PRODUCTDEFID" taborder="9" width="22" height="20" cssclass="btn_WF_finder" top="35" right="15" onclick="tab_search_Tabpage1_btn_PRODUCTDEFID_onclick"/>
                  <Static id="label02_00" taborder="10" text="품목코드" left="0" top="35" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PRODUCTDEFID"/>
                  <Static id="label02_00_00" taborder="11" text="품목명" left="0" top="62" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PRODUCTDEFNAME"/>
                  <Edit id="edt_PRODUCTDEFID_nm" taborder="12" left="108" top="62" height="20" right="20" enable="false"/>
                  <Edit id="edt_PRODUCTDEFID_id" taborder="13" left="108" top="172" height="20" right="20" enable="false" visible="false"/>
                  <Edit id="edt_PROCESSDEFID" taborder="14" left="108" top="202" height="20" right="20" enable="false" visible="false"/>
                  <Edit id="edt_PROCESSDEFVERSION" taborder="15" left="108" top="232" height="20" right="20" enable="false" visible="false"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Static id="sta_searchTitle" taborder="1" text="검색조건" left="9" top="56" width="206" height="34" cssclass="sta_WF_subTitle" fittocontents="width" usedecorate="true"/>
        <Div id="div_header" taborder="2" text="div_00" left="0" top="0" height="47" right="0" formscrolltype="both">
          <Layouts>
            <Layout>
              <Static id="Static01" taborder="6" left="0" top="0" cssclass="sta_WF_titleBG" right="0" bottom="0"/>
              <Button id="btn_reset" taborder="0" top="16" width="31" height="24" cssclass="btn_com_reset" right="2" tooltiptext="Toolbar_Initialization" text="" initvalueid="x"/>
              <Button id="btn_help" taborder="1" top="16" width="26" height="24" cssclass="btn_com_help" right="34" tooltiptext="MANUAL" initvalueid="x"/>
              <Button id="btn_searchOpen" taborder="2" left="10" top="16" width="30" height="24" cssclass="btn_WF_searchOpen" onclick="nfn_searchOpen_onclick"/>
              <Static id="Static16" taborder="3" left="47" top="0" width="60" height="20" cssclass="guideTip" visible="false" text="h20"/>
              <Static id="sta_title" taborder="5" text="업무화면명(자동)" left="40" top="16" width="145" height="24" cssclass="sta_WF_title" fittocontents="width" expr="nexacro.getApplication().gds_menu.lookup(&quot;PGM_ID&quot;,comp.parent.parent.parent.name,&quot;MENU_NM&quot;)"/>
              <Button id="btn_favorite" taborder="4" left="sta_title:2" top="16" width="24" height="24" cssclass="btn_WF_favorite"/>
              <Button id="btn_searchExchange" taborder="7" text="환산금액조회" top="-5" width="91" height="24" cssclass="btn_com_basic" right="94" fittocontents="width" onclick="div_header_btn_searchExchange_onclick" visible="false"/>
              <Button id="btn_save" taborder="10" top="16" width="26" height="24" cssclass="btn_com_save" right="61" tooltiptext="Toolbar_Save" initvalueid="x" onclick="fn_save"/>
              <Button id="btn_reCalculate" taborder="8" text="재계산" top="15" width="65" height="24" cssclass="btn_com_basic" right="114" fittocontents="width" onclick="div_header_btn_reCalculate_onclick"/>
              <Button id="btn_saveCopy" taborder="9" text="복사" top="15" width="51" height="24" cssclass="btn_com_basic" right="180" fittocontents="width" onclick="fn_saveCopy"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_work" taborder="3" text="div_00" left="300" top="47" bottom="0" right="0">
          <Layouts>
            <Layout>
              <Grid id="grd_basProductquotationsegment" taborder="11" left="-1" top="183" right="1" binddataset="ds_basProductquotationsegment" autoenter="select" bottom="0" onselectchanged="div_work_grd_basApproval_onselectchanged">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="0"/>
                      <Column size="50"/>
                      <Column size="100"/>
                      <Column size="170"/>
                      <Column size="60"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="81"/>
                      <Column size="83"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="214"/>
                      <Column size="80"/>
                      <Column size="130"/>
                      <Column size="80"/>
                      <Column size="130"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="공정순서"/>
                      <Cell col="1" text="공정수순"/>
                      <Cell col="2" text="공정ID"/>
                      <Cell col="3" text="공정명"/>
                      <Cell col="4" text="유효상태" tooltiptext="VALIDSTATE"/>
                      <Cell col="5" text="공정변동비"/>
                      <Cell col="6" text="공정고정비"/>
                      <Cell col="7" text="자재비"/>
                      <Cell col="8" text="자재가공비"/>
                      <Cell col="9" text="Box비"/>
                      <Cell col="10" text="금형비"/>
                      <Cell col="11" text="샘플비"/>
                      <Cell col="12" text="제조간접비"/>
                      <Cell col="13" text="일반관리비"/>
                      <Cell col="14" text="기타"/>
                      <Cell col="15" text="불량반영금액"/>
                      <Cell col="16" text="견적가"/>
                      <Cell col="17" text="견적누적금액"/>
                      <Cell col="18" text="PCS금액"/>
                      <Cell col="19" text="PCS누적금액"/>
                      <Cell col="20" text="공정율(%)" background="yellow"/>
                      <Cell col="21" text="공정불량단가"/>
                      <Cell col="22" text="설명"/>
                      <Cell col="23" text="등록자" tooltiptext="WRITER"/>
                      <Cell col="24" text="등록일" tooltiptext="WRITEDATE"/>
                      <Cell col="25" text="수정자" tooltiptext="MODIFIER"/>
                      <Cell col="26" text="수정일" tooltiptext="MODIFIEDTIME"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:PATHSEQUENCE"/>
                      <Cell col="1" text="bind:USERSEQUENCE" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="2" text="bind:PROCESSSEGMENTID" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="3" text="bind:PROCESSSEGMENTNAME" textAlign="left" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="4" displaytype="combotext" combocodecol="C,UsageStatus,,Y,N" text="bind:USE_YN" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="5" text="bind:VARIABLECOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="6" text="bind:FIXEDCOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="7" text="bind:MATERIALCOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="8" text="bind:MATERIALPROCESSCOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="9" text="bind:BOXCOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="10" text="bind:MOLDCOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="11" text="bind:SAMPLECOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="12" text="bind:MANUFACTURINGOVERHEAD" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="13" text="bind:GENERALCOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="14" text="bind:ETCCOST" edittype="normal" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="15" text="bind:DEFECTAMOUNT" edittype="none" maskeditformat="#,##0" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="16" text="bind:AMOUNT" edittype="none" maskeditformat="#,##0" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="17" text="bind:CUMULATIVEAMOUNT" edittype="none" maskeditformat="#,##0" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="18" text="bind:PCSAMOUNT" edittype="none" maskeditformat="#,##0" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="19" text="bind:CUMULATIVEPCSAMOUNT" edittype="none" maskeditformat="#,##0" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="20" text="bind:CUMULATIVERATE" edittype="none" maskeditformat="#,##0" displaytype="number" background="yellow" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="21" text="bind:DEFECTUNITPRICE" edittype="none" maskeditformat="#,##0" displaytype="number" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="22" text="bind:DESCRIPTION" edittype="normal" textAlign="left" cssclass="expr:USE_YN == 'Invalid' ? 'cell_orange,cell_bold' : ''"/>
                      <Cell col="23" textAlign="left" text="bind:CREATOR"/>
                      <Cell col="24" text="bind:CREATEDTIME" calendardisplaynulltype="none"/>
                      <Cell col="25" textAlign="left" text="bind:MODIFIER"/>
                      <Cell col="26" text="bind:CREATEDTIME" calendardisplaynulltype="none"/>
                    </Band>
                    <Band id="summary">
                      <Cell colspan="5" text="합계" tooltiptext="TOTALAMOUNT"/>
                      <Cell col="5" expr="dataset.getSum(&quot;VARIABLECOST&quot;)" displaytype="number"/>
                      <Cell col="6" expr="dataset.getSum(&quot;FIXEDCOST&quot;)" displaytype="number"/>
                      <Cell col="7" expr="dataset.getSum(&quot;MATERIALCOST&quot;)" displaytype="number"/>
                      <Cell col="8" expr="dataset.getSum(&quot;MATERIALPROCESSCOST&quot;)" displaytype="number"/>
                      <Cell col="9" expr="dataset.getSum(&quot;BOXCOST&quot;)" displaytype="number"/>
                      <Cell col="10" expr="dataset.getSum(&quot;MOLDCOST&quot;)" displaytype="number"/>
                      <Cell col="11" expr="dataset.getSum(&quot;SAMPLECOST&quot;)" displaytype="number"/>
                      <Cell col="12" expr="dataset.getSum(&quot;MANUFACTURINGOVERHEAD&quot;)" displaytype="number"/>
                      <Cell col="13" expr="dataset.getSum(&quot;GENERALCOST&quot;)" displaytype="number"/>
                      <Cell col="14" expr="dataset.getSum(&quot;ETCCOST&quot;)" displaytype="number"/>
                      <Cell col="15" expr="dataset.getSum(&quot;DEFECTAMOUNT&quot;)" displaytype="number"/>
                      <Cell col="16" expr="dataset.getSum(&quot;AMOUNT&quot;)" displaytype="number"/>
                      <Cell col="17" displaytype="number"/>
                      <Cell col="18" expr="nexacro.round(dataset.getSum(&quot;PCSAMOUNT&quot;))" displaytype="number"/>
                      <Cell col="19" displaytype="number"/>
                      <Cell col="20" displaytype="number"/>
                      <Cell col="21" displaytype="number"/>
                      <Cell col="22"/>
                      <Cell col="23"/>
                      <Cell col="24"/>
                      <Cell col="25"/>
                      <Cell col="26"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="sta_subTitle" taborder="12" text="불량 단가 관리" left="5" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" fittocontents="width" width="175" tooltiptext="MENU_OUTSOURCEDCLAIMBASEAMOUNT"/>
              <Static id="sta_cnt_ds_basProductquotationsegment" taborder="13" left="sta_subTitle:20" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" right="761" padding="5px 0px 0px"/>
              <Button id="btn_xlDn_grd_basProductquotationsegment" taborder="14" top="156" width="29" height="24" cssclass="btn_WF_grdExcelDown" tooltiptext="GridExport" right="5" initvalueid="x"/>
              <Static id="label02_00" taborder="15" text="품목코드" left="0" top="35" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PRODUCTDEFID"/>
              <Edit id="edt_PRODUCTDEFID" taborder="16" left="108" top="35" height="20" enable="false" width="168"/>
              <Button id="btn_PRODUCTDEFID" taborder="17" width="22" height="20" cssclass="btn_WF_finder" top="35" left="783" onclick="div_work_btn_PRODUCTDEFID_onclick" visible="false"/>
              <Edit id="edt_PRODUCTDEFNAME" taborder="18" left="322" top="35" height="20" enable="false" width="329"/>
              <Edit id="edt_PRODUCTDEFVERSION" taborder="19" left="278" top="35" height="20" enable="false" width="42"/>
              <Static id="label02_00_00" taborder="20" text="화폐단위" left="0" top="60" width="103" height="20" cssclass="sta_WF_label" tooltiptext="CURRENCYUNIT"/>
              <Static id="Static12_00_00_00_01_00" taborder="21" text="h5" width="45" top="55" visible="false" height="5" cssclass="guideTip" right="776"/>
              <Static id="label02_00_00_00" taborder="22" text="불량반영금액" left="0" top="86" width="103" height="20" cssclass="sta_WF_label" tooltiptext="DEFECTAMOUNT"/>
              <Static id="label02_00_00_00_00" taborder="23" text="샘플비" left="0" top="113" width="103" height="20" cssclass="sta_WF_label" tooltiptext="SAMPLECOST"/>
              <Combo id="cbo_CURRENCYUNIT" taborder="0" text="IFC" left="108" top="60" height="20" index="1" value="" width="105" innerdataset="ds_basUomdefinition" codecolumn="UOMDEFID" datacolumn="UOMDEFNAME" enable="true"/>
              <Static id="label02_00_00_01" taborder="24" text="PCS/mm" left="220" top="60" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PCSMM"/>
              <MaskEdit id="msk_PCSMM" taborder="1" left="328" top="60" width="105" height="20" enable="false"/>
              <Static id="label02_00_00_01_00" taborder="25" text="기타비" left="439" top="60" width="103" height="20" cssclass="sta_WF_label" tooltiptext="ETCCOST"/>
              <MaskEdit id="msk_ETCCOST" taborder="2" left="547" top="60" width="105" height="20" format="#,###"/>
              <Static id="label02_00_00_01_01" taborder="26" text="BOX비" left="220" top="86" width="103" height="20" cssclass="sta_WF_label" tooltiptext="BOXCOST"/>
              <MaskEdit id="msk_BOXCOST" taborder="4" left="328" top="86" width="105" height="20" format="#,###"/>
              <Static id="label02_00_00_01_00_00" taborder="27" text="금형비" left="439" top="86" width="103" height="20" cssclass="sta_WF_label" tooltiptext="MOLDCOST"/>
              <MaskEdit id="msk_MOLDCOST" taborder="5" left="547" top="86" width="105" height="20" format="#,###"/>
              <MaskEdit id="msk_DEFECTAMOUNT" taborder="3" left="108" top="86" width="105" height="20" format="#,###"/>
              <MaskEdit id="msk_SAMPLECOST" taborder="6" left="108" top="112" width="105" height="20" format="#,###"/>
              <Static id="label02_00_00_01_01_00" taborder="28" text="제조간접비" left="220" top="112" width="103" height="20" cssclass="sta_WF_label" tooltiptext="MANUFACTURINGOVERHEAD"/>
              <MaskEdit id="msk_MANUFACTURINGOVERHEAD" taborder="7" left="328" top="112" width="105" height="20" format="#,###"/>
              <Static id="label02_00_00_01_00_00_00" taborder="29" text="일반관리비" left="439" top="112" width="103" height="20" cssclass="sta_WF_label" tooltiptext="GENERALCOST"/>
              <MaskEdit id="msk_GENERALCOST" taborder="8" left="547" top="112" width="105" height="20" format="#,###"/>
              <Static id="label02_00_01" taborder="30" text="FROM 품목코드" top="158" width="103" height="20" cssclass="sta_WF_label" tooltiptext="FROMPRODUCTDEFID" right="587"/>
              <Edit id="edt_PRODUCTDEFID2" taborder="9" top="158" height="20" right="414" enable="true" width="168" onkeydown="div_work_edt_PRODUCTDEFID2_onkeydown"/>
              <Edit id="edt_PRODUCTDEFID2_id" taborder="31" top="158" height="20" right="370" enable="false" width="42"/>
              <Button id="btn_PRODUCTDEFID2" taborder="10" width="22" height="20" cssclass="btn_WF_finder" top="158" right="345" onclick="div_work_btn_PRODUCTDEFID2_onclick"/>
              <Edit id="edt_PRODUCTDEFID2_nm" taborder="32" top="158" height="20" right="38" enable="false" width="305"/>
              <Edit id="edt_PROCESSDEFVERSION2" taborder="33" left="798" top="122" height="20" right="45" enable="false" visible="false"/>
              <Edit id="edt_PROCESSDEFID2" taborder="34" left="798" top="92" height="20" right="45" enable="false" visible="false"/>
              <Edit id="edt_PROCESSDEFID" taborder="35" left="698" top="22" height="20" right="115" enable="false" visible="false"/>
              <Edit id="edt_PROCESSDEFVERSION" taborder="36" left="698" top="52" height="20" right="115" enable="false" visible="false"/>
              <MaskEdit id="msk_SALEPRICE" taborder="37" left="727" top="60" width="105" height="20" format="#,###" enable="false"/>
              <Static id="label02_00_00_01_00_01" taborder="38" text="판가" left="659" top="60" width="63" height="20" cssclass="sta_WF_label" tooltiptext="SALEPRICE"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[/***************************************************************************************
 * 시스템명 	: IFC MES시스템
 * 업무명 		: Claim공정별 기준금액
 * 파일명 		: OSM00100M.xfdl
 * 작성자 		: 진성하
 * 작성일 		: 2021.04.11
 *
 * 설  명		: Claim공정별 기준금액
 *---------------------------------------------------------------------------------------
 * 변경일		변경자		변경내역
 *---------------------------------------------------------------------------------------
 * 2021.04.11	진성하   	최초작성
 * 2021.07.28	김진현		품목 라우팅에 미사용 여부 (21.07.28) USE_YN 컬럼 추가 및 쿼리 수정
 * 2027.08.08   김진현		등록자,등록일,수정자,수정일 추가
 *---------------------------------------------------------------------------------------
 ****************************************************************************************/

/**************************************************************************
 * 1. 필수 include
 ***************************************************************************/
// include "lib::comLib.xjs";
// include "cuslib::nbdfComLib.xjs";

/**************************************************************************
 * 2. FORM 변수 선언 영역
 ***************************************************************************/
this.fv_currDate;

/**************************************************************************
 * 3. FORM LOAD
 ***************************************************************************/
this.fn_init = function (obj:Form, e:nexacro.LoadEventInfo)
{
	this.nfn_formInit(obj);
	//this.div_page.set_visible(true);

	// paging
	//this.fn_paging_onload(obj);
	// paging end
	this.ds_search.clearData();
	this.ds_search.addRow();
	this.ds_search.setColumn(0, "UOMTYPE", "Currency");
	
	var sSvcID = "selectGetUomDefinitionListByOsp";
	var sController = "/osm00100/selectGetUomDefinitionListByOsp.do";
	var sInDatasets = "INPUT=ds_search";
	var sOutDatasets = "ds_basUomdefinition=output";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);	
	
	this.tab_search.Tabpage1.form.cbo_plantid.set_value(this.gf_getSiteType());
};

/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 기능 : 검색
 */

/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 기능 : 검색
 */
this.fn_search = function (obj:Button, e:nexacro.ClickEventInfo)
{
	var component = this.tab_search.Tabpage1;
	var strColIdList = "cbo_plantid,edt_PRODUCTDEFID";
	var strColNmList = "SITE,PRODUCTDEFID";
	var rtn = this.nfn_MandatoryCheck(component, strColIdList, strColNmList);
	if (rtn == false) return;
	
	this.ds_basProductquotationsegment.clearData();
	this.ds_search.clearData();
	this.ds_search.addRow();
	this.ds_search.setColumn(0, "PLANTID", this.tab_search.Tabpage1.form.cbo_plantid.value);
	this.ds_search.setColumn(0, "PRODUCTDEFID", this.tab_search.Tabpage1.form.edt_PRODUCTDEFID.value);
	this.ds_search.setColumn(0, "PRODUCTDEFVERSION", this.tab_search.Tabpage1.form.edt_PRODUCTDEFID_id.value);
	this.ds_search.setColumn(0, "PROCESSDEFID", this.tab_search.Tabpage1.form.edt_PROCESSDEFID.value);
	this.ds_search.setColumn(0, "PROCESSDEFVERSION", this.tab_search.Tabpage1.form.edt_PROCESSDEFVERSION.value);
	
	var sSvcID = "selectBasProductquotationsegmentList";
	var sController = "/osm00100/selectBasProductquotationsegmentList.do";
	var sInDatasets = "INPUT=ds_search";
	var sOutDatasets = "ds_basProductquotationsegment=output ds_productInformatByOsp=output2";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

/*
 * 기능 : 검색 초기화
 */
this.fn_searchClear = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 신규
 */
this.fn_new = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 저장(승인)
 */
this.fn_save = function (obj:Button, e:nexacro.ClickEventInfo)
{

	var component = this.div_work;
	var strColIdList = "edt_PRODUCTDEFID,cbo_CURRENCYUNIT";
	var strColNmList = "PRODUCTDEFID,CURRENCYUNIT";
	var rtn = this.nfn_MandatoryCheck(component, strColIdList, strColNmList);
	if (rtn == false) return;

	if (!this.gfn_dsIsUpdated(this.ds_basProductquotationsegment) ) 
	{
		this.gfn_Message("NoSaveData", null, "warning", "ok");//this.gfn_Message("IMCMM0033", null, "warning", "ok");
		return;
	}
	this.div_header_btn_reCalculate_onclick();
	// -------------------------
	// 저장
	// ':U' 는 갱신된 내용만을 입력 데이터세트로 보내며, ':A' 는 모든 정보를 보냅니다.
	// ':N' 은 현재 Delete를 제외한 데이터를 Normal 상태로 보냅니다. 지정하지 않는 데이터세트는 Normal로 동작합니다
	// -------------------------
	var sSvcID = "saveBasProductquotationsegment";
	var sController = "/osm00100/saveBasProductquotationsegment.do";
	var sInDatasets = "INPUT=ds_productInformatByOsp:A INPUT2=ds_basProductquotationsegment:A";
	//var sInDatasets = "INPUT=ds_basProductquotationsegment:A";
	var sOutDatasets = "";

	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

/*
 * 기능 : 저장(복사)
 */
this.fn_saveCopy = function (obj:Button, e:nexacro.ClickEventInfo)
{
	var component = this.div_work;
	var strColIdList = "edt_PRODUCTDEFID,edt_PRODUCTDEFID2_nm";
	// (21.07.02) - TO 품목코드 -> FROM 품목코드 변경
	//var strColNmList = "PRODUCTDEFID,TOPRODUCTDEFID";
	var strColNmList = "PRODUCTDEFID,FROMPRODUCTDEFID";
	var rtn = this.nfn_MandatoryCheck(component, strColIdList, strColNmList);
	if (rtn == false) return;

	if(this.div_work.form.edt_PRODUCTDEFID.value == this.div_work.form.edt_PRODUCTDEFID2.value 
		&& this.div_work.form.edt_PRODUCTDEFVERSION.value == this.div_work.form.edt_PRODUCTDEFID2_id.value ){
		this.gfn_Message("SameCopyTarget", "", "error", "ok");
		return;
	}	

	if (!this.gfn_dsIsUpdated(this.ds_productInformatByOsp) ) 
	{
		this.gfn_Message("NoSaveData", null, "warning", "ok");//this.gfn_Message("IMCMM0033", null, "warning", "ok");
		return;
	}

	var bOK = this.gfn_Message("OspDoProcessWant", "COPY", "conf", "yesno");//복사 처리를 하시겠습니까? 
	if (bOK == false) return;
	
/*
	this.ds_productInformatByOsp.setColumn(0,"TOPRODUCTDEFID",this.div_work.form.edt_PRODUCTDEFID2.value);
	this.ds_productInformatByOsp.setColumn(0,"TOPRODUCTDEFVERSION",this.div_work.form.edt_PRODUCTDEFID2_id.value);
	this.ds_productInformatByOsp.setColumn(0,"TOPROCESSDEFID",this.div_work.form.edt_PROCESSDEFID2.value);
	this.ds_productInformatByOsp.setColumn(0,"TOPROCESSDEFVERSION",this.div_work.form.edt_PROCESSDEFVERSION2.value);
*/
	// (21.07.01)
	
	
	trace("--------- : "+this.ds_productInformatByOsp.saveXML());
	
	//return;
	// -------------------------
	// 저장
	// ':U' 는 갱신된 내용만을 입력 데이터세트로 보내며, ':A' 는 모든 정보를 보냅니다.
	// ':N' 은 현재 Delete를 제외한 데이터를 Normal 상태로 보냅니다. 지정하지 않는 데이터세트는 Normal로 동작합니다
	// -------------------------
	var sSvcID = "copyBasProductquotationsegment";
	var sController = "/osm00100/copyBasProductquotationsegment.do";
	var sInDatasets = "INPUT=ds_productInformatByOsp";
	var sOutDatasets = "";

	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};
/*
 * 기능 : 삭제
 */
this.fn_delelete = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};
/*
 * 기능 : 도움말  => 공통 처리
 */
this.fn_help = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 출력
 */
this.fn_print = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : work영역 초기화  => 공통처리
 */
this.fn_reset = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/**************************************************************************
 * 5. TRANSACTION, CALLBACK 영역
 ***************************************************************************/
this.fn_callBack = function (trId, errCD, errMsg)
{
	if (errCD < 0) 
	{
		this.gfn_Message("ProcessingError", trId + errMsg, "error", "ok");
	}
	else 
	{
		if (trId == "saveBasProductquotationsegment") 
		{
			this.gfn_Message("ProcessingSuccess", null, "info", "ok");
			this.fn_search();
		}
		else if (trId == "selectBasProductquotationsegmentList") 
		{
			this.div_header.form.btn_saveCopy.set_enable(true);
		}
		else if (trId == "copyBasProductquotationsegment") 
		{
			this.gfn_Message("SuccessOspProcess", null, "info", "ok");
			this.div_header.form.btn_saveCopy.set_enable(false);
			// (to -> from 변경 조회된 내용이 from 이다. 재조회 탄다.) (21.07.02)
			this.fn_search();		
		}
	}

}


/**************************************************************************
 * 6. 팝업 호출/콜백
 **************************************************************************/
this.fn_popupAfter = function(sPopupId, Variant)
{
	var rtn = this.fv_rtnValue;	
	if(this.nfn_isNull(rtn)) return;
	
	if(sPopupId == "PRODUCTDEFID")
	{
		this.tab_search.Tabpage1.form.edt_PRODUCTDEFID.set_value(rtn[0]);
		this.tab_search.Tabpage1.form.edt_PRODUCTDEFID_nm.set_value(rtn[1]);
		this.tab_search.Tabpage1.form.edt_PRODUCTDEFID_id.set_value(rtn[2]);
		this.tab_search.Tabpage1.form.edt_PROCESSDEFID.set_value(rtn[3]);
		this.tab_search.Tabpage1.form.edt_PROCESSDEFVERSION.set_value(rtn[4]);
	}

	if(sPopupId == "PRODUCTDEFID2")
	{
		this.div_work.form.edt_PRODUCTDEFID2.set_value(rtn[0]);
		this.div_work.form.edt_PRODUCTDEFID2_nm.set_value(rtn[1]);
		this.div_work.form.edt_PRODUCTDEFID2_id.set_value(rtn[2]);
		this.div_work.form.edt_PROCESSDEFID2.set_value(rtn[3]);
		this.div_work.form.edt_PROCESSDEFVERSION2.set_value(rtn[4]);
	}
	
}
/**************************************************************************
 * 7. 기타 함수(화면 로컬 정의) 
 **************************************************************************/

/**************************************************************************
 * 8. 이벤트
 ***************************************************************************/
this.tab_search_Tabpage1_btn_PRODUCTDEFID_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var popupId = "PRODUCTDEFID";
	var oArg = {};
	oArg.arg_type = "BA";
	oArg.arg_popupCd = "P00215";
	oArg.arg_popupNm = "품목코드";
	oArg.arg_rtnCols = "PRODUCTDEFID|PRODUCTDEFNAME|PRODUCTDEFVERSION|PROCESSDEFID|PROCESSDEFVERSION";
	oArg.arg_paramCols = "ENTERPRISEID|PLANTID";
	oArg.arg_paramValues = this.gf_getEnterpriseId()+"|"+this.tab_search.Tabpage1.form.cbo_plantid.value;
	oArg.arg_searchStr = "PRODUCTDEFID="+this.tab_search.Tabpage1.form.edt_PRODUCTDEFID.value;
	this.gfn_openPopup(popupId,"cmd::CMSA00100P.xfdl",oArg,"");		
};

this.div_work_btn_PRODUCTDEFID2_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var popupId = "PRODUCTDEFID2";
	var oArg = {};
	oArg.arg_type = "BA";
	oArg.arg_popupCd = "P00215";
	oArg.arg_popupNm = "품목코드";
	oArg.arg_rtnCols =  "PRODUCTDEFID|PRODUCTDEFNAME|PRODUCTDEFVERSION|PROCESSDEFID|PROCESSDEFVERSION";
	oArg.arg_paramCols = "ENTERPRISEID|PLANTID";
	oArg.arg_paramValues = this.gf_getEnterpriseId()+"|"+this.tab_search.Tabpage1.form.cbo_plantid.value;
//	oArg.arg_paramCols = "ENTERPRISEID|PLANTID|"+(this.gfn_isNull(this.div_work.form.edt_PRODUCTDEFVERSION.value)?"1":"PRODUCTDEFVERSION");
//	oArg.arg_paramValues = this.gf_getEnterpriseId()+"|"+this.tab_search.Tabpage1.form.cbo_plantid.value+"|"+(this.gfn_isNull(this.div_work.form.edt_PRODUCTDEFVERSION.value)?"1":this.div_work.form.edt_PRODUCTDEFVERSION.value);
	oArg.arg_searchStr = "PRODUCTDEFID="+this.div_work.form.edt_PRODUCTDEFID2.value;
	this.gfn_openPopup(popupId,"cmd::CMSA00100P.xfdl",oArg,"");			
};


this.div_header_btn_searchExchange_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var popupId = "EXCHANGE";
	var oArg = {};
	oArg.arg_productdefid = this.div_work.form.edt_PRODUCTDEFID.value;
	oArg.arg_productdefversion = this.div_work.form.edt_PRODUCTDEFVERSION.value;
	oArg.arg_productdefname = this.div_work.form.edt_PRODUCTDEFNAME.value;
	oArg.arg_processdefid = this.div_work.form.edt_PROCESSDEFID.value;
	oArg.arg_processdefversion = this.div_work.form.edt_PROCESSDEFVERSION.value;
	this.gfn_openPopup(popupId,"osm::OSM00101P.xfdl",oArg,"");				
};

this.div_header_btn_reCalculate_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var component = this.div_work;
	var strColIdList = "edt_PRODUCTDEFID,cbo_CURRENCYUNIT";
	var strColNmList = "PRODUCTDEFID,CURRENCYUNIT";
	var rtn = this.nfn_MandatoryCheck(component, strColIdList, strColNmList);
	if (rtn == false) return;
	
	//nexacro.getEnvironment().set_usewaitcursor(true);
	this.setWaitCursor(true, true); //커서 활성화.
	this.setTimer(1,10);
	
	var decSalePrice = nexacro.toNumber(this.nfn_nvl(this.ds_productInformatByOsp.getColumn(0,"SALEPRICE"),0));
	
	var decAmount = 0; // 견적계산 
	var decPcsamount = 0; //pcs 견적금액
	var strTotecdefectAmount = this.div_work.form.msk_DEFECTAMOUNT.value;// txtDefectamount.Text.ToString();
	var strTotalBoxAMT = this.div_work.form.msk_BOXCOST.value;//txtBoxAMT.Text.ToString();
	var strTotalMoldAMT = this.div_work.form.msk_MOLDCOST.value;//txtMoldAMT.Text.ToString();
	var strTotalSampleAMT = this.div_work.form.msk_SAMPLECOST.value;//txtSampleAMT.Text.ToString();
	var strTotalIndirectAMT = this.div_work.form.msk_MANUFACTURINGOVERHEAD.value;//txtIndirectAMT.Text.ToString();
	var strTotalNormalAMT = this.div_work.form.msk_GENERALCOST.value;//txtNormalAMT.Text.ToString();
	var strTotalEtcAMT = this.div_work.form.msk_ETCCOST.value;//txtEtcAMT.Text.ToString();

	var dectotecdefectAmount = this.nfn_nvl(strTotecdefectAmount,0);
	var decTotalBoxAMT = this.nfn_nvl(strTotalBoxAMT,0);
	var decTotalMoldAMT = this.nfn_nvl(strTotalMoldAMT,0);
	var decTotalSampleAMT = this.nfn_nvl(strTotalSampleAMT,0);
	var decTotalIndirectAMT = this.nfn_nvl(strTotalIndirectAMT,0);
	var decTotalNormalAMT = this.nfn_nvl(strTotalNormalAMT,0);
	var decTotalEtcAMT = this.nfn_nvl(strTotalEtcAMT,0);
	
	var strPcsmm = nexacro.toNumber(this.div_work.form.msk_PCSMM.value);//txtPcsmm.Text.ToString();
	var decPcsmm = this.nfn_nvl(strPcsmm,0);
	
	//불량금액 n분하기 
	var intRowCount = this.ds_basProductquotationsegment.rowcount;//grdOutsourcedClaimBaseAmount.View.DataRowCount;
	//
	if (intRowCount == 0) return;
	var dectotecdefectAmountDiv = 0;
	var dectotecdefectAmountDivsub = 0;
	var decTotalBoxAMTDiv = 0;
	var decTotalBoxAMTDivSub = 0;
	var decTotalMoldAMTDiv = 0;
	var decTotalMoldAMTDivSub = 0;
	var decTotalSampleAMTDiv = 0;
	var decTotalSampleAMTDivSub = 0;
	var decTotalIndirectAMTDiv = 0;
	var decTotalIndirectAMTDivSub = 0;
	var decTotalNormalAMTDiv = 0;
	var decTotalNormalAMTDivSub = 0;
	var decTotalEtcAMTDiv = 0;
	var decTotalEtcAMTDivSub = 0;

	if (dectotecdefectAmount > 0)
	{
		dectotecdefectAmountDiv = Math.trunc(dectotecdefectAmount / intRowCount);
		dectotecdefectAmountDivsub = dectotecdefectAmount - (dectotecdefectAmountDiv * intRowCount);
	}
	if(decTotalBoxAMT > 0)
	{
		decTotalBoxAMTDiv = Math.trunc(decTotalBoxAMT / intRowCount);
		decTotalBoxAMTDivSub = decTotalBoxAMT - (decTotalBoxAMTDiv * intRowCount);
	}

	if (decTotalMoldAMT > 0)
	{
		decTotalMoldAMTDiv = Math.trunc(decTotalMoldAMT / intRowCount);
		decTotalMoldAMTDivSub = decTotalMoldAMT - (decTotalMoldAMTDiv * intRowCount);
	}

	if (decTotalSampleAMT > 0)
	{
		decTotalSampleAMTDiv = Math.trunc(decTotalSampleAMT / intRowCount);
		decTotalSampleAMTDivSub = decTotalSampleAMT - (decTotalSampleAMTDiv * intRowCount);
	}

	if (decTotalIndirectAMT > 0)
	{
		decTotalIndirectAMTDiv = Math.trunc(decTotalIndirectAMT / intRowCount);
		decTotalIndirectAMTDivSub = decTotalIndirectAMT - (decTotalIndirectAMTDiv * intRowCount);
	}

	if (decTotalNormalAMT > 0)
	{
		decTotalNormalAMTDiv = Math.trunc(decTotalNormalAMT / intRowCount);
		decTotalNormalAMTDivSub = decTotalNormalAMT - (decTotalNormalAMTDiv * intRowCount);
	}
	if (decTotalEtcAMT > 0)
	{
		decTotalEtcAMTDiv = Math.trunc(decTotalEtcAMT / intRowCount);
		decTotalEtcAMTDivSub = decTotalEtcAMT - (decTotalEtcAMTDiv * intRowCount);
	}
	var decAmountSum = 0;// 견적가 누계 
	var decCumulativepcsamount = 0;//pcs금액 누계 
   // 1.제조비용 합계 구하기
	for(var i=0; i<this.ds_basProductquotationsegment.rowcount; i++){
		this.ds_basProductquotationsegment.setColumn(i,"CURRENCYUNIT",this.div_work.form.cbo_CURRENCYUNIT.value);
		var decDefectamounttot = this.nfn_nvl(this.div_work.form.msk_DEFECTAMOUNT.value,0);
		this.ds_basProductquotationsegment.setColumn(i,"DEFECTAMOUNTTOT",decDefectamounttot);
		var decVariablecost = this.nfn_nvl(this.ds_basProductquotationsegment.getColumn(i,"VARIABLECOST"),0);
		this.ds_basProductquotationsegment.setColumn(i,"VARIABLECOST",decVariablecost);
		var decFixedcost = this.nfn_nvl(this.ds_basProductquotationsegment.getColumn(i,"FIXEDCOST"),0);
		this.ds_basProductquotationsegment.setColumn(i,"FIXEDCOST",decFixedcost);
		var decMaterialcost = this.nfn_nvl(this.ds_basProductquotationsegment.getColumn(i,"MATERIALCOST"),0);
		this.ds_basProductquotationsegment.setColumn(i,"MATERIALCOST",decMaterialcost);
		var decMaterialprocesscost = this.nfn_nvl(this.ds_basProductquotationsegment.getColumn(i,"MATERIALPROCESSCOST"),0);
		this.ds_basProductquotationsegment.setColumn(i,"MATERIALPROCESSCOST",decMaterialprocesscost);
		var decBoxcost = this.nfn_nvl(this.div_work.form.msk_BOXCOST.value,0);
		this.ds_basProductquotationsegment.setColumn(i,"BOXCOSTTOT",decBoxcost);
		var decMoldcost = this.nfn_nvl(this.div_work.form.msk_MOLDCOST.value,0);
		this.ds_basProductquotationsegment.setColumn(i,"MOLDCOSTTOT",decMoldcost);
        var decSamplecost = this.nfn_nvl(this.div_work.form.msk_SAMPLECOST.value,0);
		this.ds_basProductquotationsegment.setColumn(i,"SAMPLECOSTTOT",decSamplecost);
		var decManufacturingoverhead = this.nfn_nvl(this.div_work.form.msk_MANUFACTURINGOVERHEAD.value,0);
		this.ds_basProductquotationsegment.setColumn(i,"MANUFACTURINGOVERHEADTOT",this.div_work.form.cbo_CURRENCYUNIT.value);
		var strGeneralcost = this.div_work.form.msk_GENERALCOST.value;
		var decGeneralcost = this.nfn_nvl(strGeneralcost,0); //
		this.ds_basProductquotationsegment.setColumn(i,"GENERALCOSTTOT",decGeneralcost);
		
		var strEtccost = this.div_work.form.msk_ETCCOST.value;
		var decEtccost = this.nfn_nvl(strEtccost,0); //
		this.ds_basProductquotationsegment.setColumn(i,"ETCCOSTTOT",decEtccost);
		
		var decsumcost = decVariablecost + decFixedcost + decMaterialcost + decMaterialprocesscost;
		
		this.ds_basProductquotationsegment.setColumn(i,"DEFECTAMOUNT",dectotecdefectAmountDiv);
		this.ds_basProductquotationsegment.setColumn(i,"BOXCOST",decTotalBoxAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"MOLDCOST",decTotalMoldAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"SAMPLECOST",decTotalSampleAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"MANUFACTURINGOVERHEAD",decTotalIndirectAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"GENERALCOST",decTotalNormalAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"ETCCOST",decTotalEtcAMTDiv);
		
		decAmount = this.nfn_nvl(decsumcost) + this.nfn_nvl(dectotecdefectAmountDiv) + this.nfn_nvl(decTotalBoxAMTDiv) + this.nfn_nvl(decTotalMoldAMTDiv) 
					+ this.nfn_nvl(decTotalSampleAMTDiv) + this.nfn_nvl(decTotalIndirectAMTDiv) + this.nfn_nvl(decTotalNormalAMTDiv) + this.nfn_nvl(decTotalEtcAMTDiv) ;//견적가

		dectotecdefectAmountDiv = Math.trunc(dectotecdefectAmount / (intRowCount - i));
		decTotalBoxAMTDiv = Math.trunc(decTotalBoxAMT / (intRowCount - i));
		decTotalMoldAMTDiv = Math.trunc(decTotalMoldAMT / (intRowCount - i));
		decTotalSampleAMTDiv = Math.trunc(decTotalSampleAMT / (intRowCount - i));
		decTotalIndirectAMTDiv = Math.trunc(decTotalIndirectAMT / (intRowCount - i));
		decTotalNormalAMTDiv = Math.trunc(decTotalNormalAMT / (intRowCount - i));
		decTotalEtcAMTDiv = Math.trunc(decTotalEtcAMT / (intRowCount - i));
		
		this.ds_basProductquotationsegment.setColumn(i,"DEFECTAMOUNT",dectotecdefectAmountDiv);
		this.ds_basProductquotationsegment.setColumn(i,"BOXCOST",decTotalBoxAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"MOLDCOST",decTotalMoldAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"SAMPLECOST",decTotalSampleAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"MANUFACTURINGOVERHEAD",decTotalIndirectAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"GENERALCOST",decTotalNormalAMTDiv);
		this.ds_basProductquotationsegment.setColumn(i,"ETCCOST",decTotalEtcAMTDiv);
		
		dectotecdefectAmount = this.nfn_nvl(dectotecdefectAmount) - this.nfn_nvl(dectotecdefectAmountDiv) ;
		decTotalBoxAMT = this.nfn_nvl(decTotalBoxAMT) - this.nfn_nvl(decTotalBoxAMTDiv,0);
		decTotalMoldAMT = this.nfn_nvl(decTotalMoldAMT) - this.nfn_nvl(decTotalMoldAMTDiv,0);
		decTotalSampleAMT = this.nfn_nvl(decTotalSampleAMT) - this.nfn_nvl(decTotalSampleAMTDiv,0);
		decTotalIndirectAMT = this.nfn_nvl(decTotalIndirectAMT) - this.nfn_nvl(decTotalIndirectAMTDiv,0);
		decTotalNormalAMT = this.nfn_nvl(decTotalNormalAMT) - this.nfn_nvl(decTotalNormalAMTDiv,0);
		decTotalEtcAMT = this.nfn_nvl(decTotalEtcAMT) - this.nfn_nvl(decTotalEtcAMTDiv,0);
//		decAmount = this.nfn_nvl(decsumcost,0) + this.nfn_nvl(dectotecdefectAmountDiv,0)+ this.nfn_nvl(decTotalBoxAMT,0)+ this.nfn_nvl(decTotalMoldAMT,0)
//				+ this.nfn_nvl(decTotalSampleAMT,0)+ this.nfn_nvl(decTotalIndirectAMT,0)+ this.nfn_nvl(decTotalNormalAMT,0)+ this.nfn_nvl(decTotalEtcAMT,0);//견적가
		decAmount = decVariablecost + decFixedcost + decMaterialcost + decMaterialprocesscost + decTotalBoxAMTDiv + decTotalMoldAMTDiv + decTotalSampleAMTDiv + decTotalIndirectAMTDiv + decTotalNormalAMTDiv + decTotalEtcAMTDiv + dectotecdefectAmountDiv;
		this.ds_basProductquotationsegment.setColumn(i,"AMOUNT",decAmount);
		
		decAmountSum = this.nfn_nvl(decAmountSum,0) + this.nfn_nvl(decAmount,0);// 견적누계
		this.ds_basProductquotationsegment.setColumn(i,"CUMULATIVEAMOUNT",decAmountSum);
		
		if (decPcsmm == 0)
		{
			decPcsamount = 0;
			decCumulativepcsamount = nexacro.round(this.nfn_nvl(decCumulativepcsamount,0) + this.nfn_nvl(decPcsamount,0),1);
		}
		else
		{
			decPcsamount = nexacro.round(this.nfn_nvl(decAmount,0) / this.nfn_nvl(decPcsmm,0), 1);
			decCumulativepcsamount = nexacro.round(this.nfn_nvl(decCumulativepcsamount,0) + this.nfn_nvl(decPcsamount,0),1);
		}		
		this.ds_basProductquotationsegment.setColumn(i,"CUMULATIVEAMOUNT",decAmountSum);
		this.ds_basProductquotationsegment.setColumn(i,"PCSAMOUNT",decPcsamount);
		this.ds_basProductquotationsegment.setColumn(i,"CUMULATIVEPCSAMOUNT",decCumulativepcsamount);
	}

	// 2.1 불량 반영금액 계산하기 (비용누계/비용합계*불량반영금액 )
	// 2.2 불량 반영금액 보정하기
	// 2.3 견적가계산 
	// 2.4 견격누계
	// 2.5 불량반영금액 누계 
	// 2.6 pcs 견적금액, pcs견적누계
	//누적비율  decAmountSum 
	var decCumulativeRateSum = 0;
	for(var i=0; i<this.ds_basProductquotationsegment.rowcount; i++){
		decCumulativepcsamount = this.nfn_nvl(this.ds_basProductquotationsegment.getColumn(i,"CUMULATIVEAMOUNT"),0);
		var decCumulativeRate = 0; // 불량 반영 금액
		 // 견적누계 0
		if (decAmountSum == 0)  
		{
			this.ds_basProductquotationsegment.setColumn(i,"CUMULATIVERATE", 0); //누계비율
		}
		else
		{
			if (decCumulativepcsamount > 0)
			{
				decCumulativeRate = nexacro.round(decCumulativepcsamount / decAmountSum * 100, 1);//견적가누계/견적합계
				decCumulativeRateSum = decCumulativeRateSum + decCumulativeRate;
				this.ds_basProductquotationsegment.setColumn(i,"CUMULATIVERATE",decCumulativeRate);
			}
			else
			{
				this.ds_basProductquotationsegment.setColumn(i,"CUMULATIVERATE",0);//견적비율
			}
		}
		var decDefectUnitPrice = decSalePrice * nexacro.toNumber(this.ds_basProductquotationsegment.getColumn(i,"CUMULATIVERATE")) / 100;
		this.ds_basProductquotationsegment.setColumn(i,"DEFECTUNITPRICE",nexacro.round(decDefectUnitPrice,1));//공정불량단가
	}
	//nexacro.getEnvironment().set_usewaitcursor(false);
	//this.setWaitCursor(false, true); //커서 비활성화.	this.setWaitCursor(false,true); //커서 비활성화.
};

this.OSM00100M_ontimer = function(obj:nexacro.Form,e:nexacro.TimerEventInfo)
{
	if(e.timerid == 1){
		var cnt=0;
		for(var i=0; i < 1000; i++){
			cnt++;
			trace(cnt);
		}
		this.setWaitCursor(false,true);
		this.killTimer(1);
	}	
};

this.div_work_edt_PRODUCTDEFID2_onkeydown = function(obj:nexacro.Edit,e:nexacro.KeyEventInfo)
{
	if(e.keycode==13) this.div_work_btn_PRODUCTDEFID2_onclick();
};
]]></Script>
    <Objects>
      <Dataset id="ds_search">
        <ColumnInfo>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PROCESSDEFID" type="STRING" size="256"/>
          <Column id="PROCESSDEFVERSION" type="STRING" size="256"/>
          <Column id="UOMTYPE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_basProductquotationsegment" useclientlayout="true">
        <ColumnInfo>
          <Column id="USERSEQUENCE" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="PROCESSDEFID" type="STRING" size="256"/>
          <Column id="PROCESSDEFVERSION" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="VARIABLECOST" type="BIGDECIMAL" size="256"/>
          <Column id="FIXEDCOST" type="BIGDECIMAL" size="256"/>
          <Column id="MATERIALCOST" type="BIGDECIMAL" size="256"/>
          <Column id="MATERIALPROCESSCOST" type="BIGDECIMAL" size="256"/>
          <Column id="BOXCOST" type="BIGDECIMAL" size="256"/>
          <Column id="MOLDCOST" type="BIGDECIMAL" size="256"/>
          <Column id="SAMPLECOST" type="BIGDECIMAL" size="256"/>
          <Column id="MANUFACTURINGOVERHEAD" type="BIGDECIMAL" size="256"/>
          <Column id="GENERALCOST" type="BIGDECIMAL" size="256"/>
          <Column id="ETCCOST" type="BIGDECIMAL" size="256"/>
          <Column id="DEFECTAMOUNT" type="BIGDECIMAL" size="256"/>
          <Column id="AMOUNT" type="BIGDECIMAL" size="256"/>
          <Column id="PCSAMOUNT" type="BIGDECIMAL" size="256"/>
          <Column id="CUMULATIVEAMOUNT" type="BIGDECIMAL" size="256"/>
          <Column id="CUMULATIVERATE" type="BIGDECIMAL" size="256"/>
          <Column id="CUMULATIVEPCSAMOUNT" type="BIGDECIMAL" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="CREATOR" type="STRING" size="256"/>
          <Column id="CREATEDTIME" type="DATE" size="256"/>
          <Column id="MODIFIER" type="STRING" size="256"/>
          <Column id="MODIFIEDTIME" type="DATE" size="256"/>
          <Column id="LASTTXNHISTKEY" type="STRING" size="256"/>
          <Column id="LASTTXNID" type="STRING" size="256"/>
          <Column id="LASTTXNUSER" type="STRING" size="256"/>
          <Column id="LASTTXNTIME" type="DATE" size="256"/>
          <Column id="LASTTXNCOMMENT" type="STRING" size="256"/>
          <Column id="VALIDSTATE" type="STRING" size="256"/>
          <Column id="CURRENCYUNIT" type="STRING" size="256"/>
          <Column id="PCSMM" type="STRING" size="256"/>
          <Column id="PATHSEQUENCE" type="STRING" size="256"/>
          <Column id="DEFECTAMOUNTTOT" type="BIGDECIMAL" size="256"/>
          <Column id="BOXCOSTTOT" type="BIGDECIMAL" size="256"/>
          <Column id="MOLDCOSTTOT" type="BIGDECIMAL" size="256"/>
          <Column id="SAMPLECOSTTOT" type="BIGDECIMAL" size="256"/>
          <Column id="MANUFACTURINGOVERHEADTOT" type="BIGDECIMAL" size="256"/>
          <Column id="GENERALCOSTTOT" type="BIGDECIMAL" size="256"/>
          <Column id="ETCCOSTTOT" type="BIGDECIMAL" size="256"/>
          <Column id="DEFECTUNITPRICE" type="STRING" size="256"/>
          <Column id="USE_YN" type="STRING" size="256" description="품목 라우팅에 미사용 여부 (21.07.28)"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_productInformatByOsp" useclientlayout="true">
        <ColumnInfo>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PROCESSDEFID" type="STRING" size="256"/>
          <Column id="PROCESSDEFVERSION" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="CURRENCYUNIT" type="STRING" size="256"/>
          <Column id="DEFECTAMOUNT" type="BIGDECIMAL" size="256"/>
          <Column id="BOXCOST" type="BIGDECIMAL" size="256"/>
          <Column id="MOLDCOST" type="BIGDECIMAL" size="256"/>
          <Column id="SAMPLECOST" type="BIGDECIMAL" size="256"/>
          <Column id="MANUFACTURINGOVERHEAD" type="BIGDECIMAL" size="256"/>
          <Column id="GENERALCOST" type="BIGDECIMAL" size="256"/>
          <Column id="ETCCOST" type="BIGDECIMAL" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="CREATOR" type="STRING" size="256"/>
          <Column id="CREATEDTIME" type="DATE" size="256"/>
          <Column id="MODIFIER" type="STRING" size="256"/>
          <Column id="MODIFIEDTIME" type="DATE" size="256"/>
          <Column id="LASTTXNHISTKEY" type="STRING" size="256"/>
          <Column id="LASTTXNID" type="STRING" size="256"/>
          <Column id="LASTTXNUSER" type="STRING" size="256"/>
          <Column id="LASTTXNTIME" type="DATE" size="256"/>
          <Column id="LASTTXNCOMMENT" type="STRING" size="256"/>
          <Column id="VALIDSTATE" type="STRING" size="256"/>
          <Column id="TOPRODUCTDEFID" type="STRING" size="256"/>
          <Column id="TOPRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="TOPROCESSDEFID" type="STRING" size="256"/>
          <Column id="TOPROCESSDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="TOPRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="PCSMM" type="BIGDECIMAL" size="256"/>
          <Column id="SALEPRICE" type="BIGDECIMAL" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_basUomdefinition">
        <ColumnInfo>
          <Column id="UOMDEFID" type="STRING" size="256"/>
          <Column id="UOMDEFNAME" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="UOMTYPE" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="CREATOR" type="STRING" size="256"/>
          <Column id="CREATEDTIME" type="DATE" size="256"/>
          <Column id="MODIFIER" type="STRING" size="256"/>
          <Column id="MODIFIEDTIME" type="DATE" size="256"/>
          <Column id="VALIDSTATE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_copy">
        <ColumnInfo>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PROCESSDEFID" type="STRING" size="256"/>
          <Column id="PROCESSDEFVERSION" type="STRING" size="256"/>
          <Column id="TOPRODUCTDEFID" type="STRING" size="256"/>
          <Column id="TOPRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="TOPROCESSDEFID" type="STRING" size="256"/>
          <Column id="TOPROCESSDEFVERSION" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="div_work.form.edt_PRODUCTDEFID" propid="value" datasetid="ds_productInformatByOsp" columnid="PRODUCTDEFID"/>
      <BindItem id="item1" compid="div_work.form.edt_PRODUCTDEFVERSION" propid="value" datasetid="ds_productInformatByOsp" columnid="PRODUCTDEFVERSION"/>
      <BindItem id="item2" compid="div_work.form.edt_PRODUCTDEFNAME" propid="value" datasetid="ds_productInformatByOsp" columnid="PRODUCTDEFNAME"/>
      <BindItem id="item3" compid="div_work.form.cbo_CURRENCYUNIT" propid="value" datasetid="ds_productInformatByOsp" columnid="CURRENCYUNIT"/>
      <BindItem id="item4" compid="div_work.form.msk_PCSMM" propid="value" datasetid="ds_productInformatByOsp" columnid="PCSMM"/>
      <BindItem id="item5" compid="div_work.form.msk_ETCCOST" propid="value" datasetid="ds_productInformatByOsp" columnid="ETCCOST"/>
      <BindItem id="item6" compid="div_work.form.msk_MOLDCOST" propid="value" datasetid="ds_productInformatByOsp" columnid="MOLDCOST"/>
      <BindItem id="item7" compid="div_work.form.msk_GENERALCOST" propid="value" datasetid="ds_productInformatByOsp" columnid="GENERALCOST"/>
      <BindItem id="item8" compid="div_work.form.msk_MANUFACTURINGOVERHEAD" propid="value" datasetid="ds_productInformatByOsp" columnid="MANUFACTURINGOVERHEAD"/>
      <BindItem id="item9" compid="div_work.form.msk_BOXCOST" propid="value" datasetid="ds_productInformatByOsp" columnid="BOXCOST"/>
      <BindItem id="item10" compid="div_work.form.msk_DEFECTAMOUNT" propid="value" datasetid="ds_productInformatByOsp" columnid="DEFECTAMOUNT"/>
      <BindItem id="item11" compid="div_work.form.msk_SAMPLECOST" propid="value" datasetid="ds_productInformatByOsp" columnid="SAMPLECOST"/>
      <BindItem id="item12" compid="div_work.form.edt_PROCESSDEFID" propid="value" datasetid="ds_productInformatByOsp" columnid="PROCESSDEFID"/>
      <BindItem id="item13" compid="div_work.form.edt_PROCESSDEFVERSION" propid="value" datasetid="ds_productInformatByOsp" columnid="PROCESSDEFVERSION"/>
      <BindItem id="item14" compid="div_work.form.edt_PRODUCTDEFID2" propid="value" datasetid="ds_productInformatByOsp" columnid="TOPRODUCTDEFID"/>
      <BindItem id="item15" compid="div_work.form.edt_PRODUCTDEFID2_id" propid="value" datasetid="ds_productInformatByOsp" columnid="TOPRODUCTDEFVERSION"/>
      <BindItem id="item17" compid="div_work.form.edt_PROCESSDEFVERSION2" propid="value" datasetid="ds_productInformatByOsp" columnid="TOPROCESSDEFVERSION"/>
      <BindItem id="item18" compid="div_work.form.edt_PROCESSDEFID2" propid="value" datasetid="ds_productInformatByOsp" columnid="TOPROCESSDEFID"/>
      <BindItem id="item16" compid="div_work.form.edt_PRODUCTDEFID2_nm" propid="value" datasetid="ds_productInformatByOsp" columnid="TOPRODUCTDEFNAME"/>
      <BindItem id="item19" compid="div_work.form.msk_SALEPRICE" propid="value" datasetid="ds_productInformatByOsp" columnid="SALEPRICE"/>
    </Bind>
  </Form>
</FDL>
