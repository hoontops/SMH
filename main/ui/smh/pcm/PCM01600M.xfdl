<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="PCM01500M" width="1258" height="747" titletext="자주검사" oninit="fn_init">
    <Layouts>
      <Layout height="747" width="1258">
        <Tab id="tab_search" taborder="0" tabindex="0" left="0" top="47" width="290" cssclass="tab_search" bottom="0">
          <Tabpages>
            <Tabpage id="Tabpage1" text="Tabpage1">
              <Layouts>
                <Layout>
                  <Static id="staAREAID" taborder="8" text="작업장" left="0" top="10" width="103" height="20" cssclass="sta_WF_label_point" tooltiptext="AREA"/>
                  <Edit id="edt_AREAID" taborder="0" left="108" top="10" height="20" right="37"/>
                  <Button id="btn_clear" taborder="7" top="200" width="102" height="36" cssclass="btn_SA_reset" left="171" text="초기화" tooltiptext="초기화"/>
                  <Button id="btn_search" taborder="6" top="200" width="146" height="36" cssclass="btn_SA_search" left="15" text="검색" tooltiptext="검색" onclick="fn_search" hotkey="F2"/>
                  <Static id="guidetip02" taborder="9" text="h10" width="45" top="0" visible="false" height="10" cssclass="guideTip" right="91"/>
                  <Static id="guidetip03" taborder="10" text="h5" width="45" top="30" visible="false" height="5" cssclass="guideTip" right="91"/>
                  <Static id="guidetip04" taborder="11" text="h20" width="45" top="180" visible="false" height="20" cssclass="guideTip" right="91"/>
                  <Static id="guidetip05" taborder="12" text="w&#13;&#10;10" width="10" top="206" visible="false" height="27" cssclass="guideTip" left="161"/>
                  <Static id="staLOTID" taborder="13" text="Lot No." left="0" top="110" width="103" height="20" cssclass="sta_WF_label"/>
                  <Button id="btn_AREAID" taborder="14" width="22" height="20" cssclass="btn_WF_finder" top="10" right="15" onclick="btn_AREAID_onclick"/>
                  <Static id="staPROCSEGMENT" taborder="15" text="공정" left="0" top="135" width="103" height="20" cssclass="sta_WF_label"/>
                  <Edit id="edt_PROCSEGMENT" taborder="5" left="108" top="135" height="20" right="37"/>
                  <Button id="btn_PROCSEGMENT" taborder="16" width="22" height="20" cssclass="btn_WF_finder" top="135" right="15" onclick="btn_PROCSEGMENT_onclick"/>
                  <Edit id="edt_LOTID" taborder="4" left="108" top="110" height="20" right="37"/>
                  <Button id="btn_LOTID" taborder="17" width="22" height="20" cssclass="btn_WF_finder" top="110" right="15" onclick="btn_LOTID_onclick"/>
                  <Static id="guidetip00" taborder="18" text="w&#13;&#10;15" width="15" top="0" visible="false" height="290" cssclass="guideTip" right="0"/>
                  <Static id="guidetip01" taborder="19" text="w&#13;&#10;15" width="15" top="0" visible="false" height="290" cssclass="guideTip" left="0"/>
                  <Static id="staPRODUCTDEFID" taborder="20" text="품목코드" left="0" top="35" width="103" height="20" cssclass="sta_WF_label" tooltiptext="ITEMID"/>
                  <Edit id="edt_PRODUCTDEFID" taborder="1" left="108" top="35" height="20" right="37"/>
                  <Combo id="cbo_PRODUCTDEFVERSION" taborder="2" text="CCT" left="108" top="60" height="20" index="1" value="" width="165" codecolumn="PRODUCTDEFVERSIONCODE" datacolumn="PRODUCTDEFVERSIONNAME" innerdataset="ds_cbo_ProdVersion"/>
                  <Static id="staPRODUCTDEFVERSION" taborder="21" text="Rev." left="0" top="60" width="103" height="20" cssclass="sta_WF_label" tooltiptext="INNERREVISION"/>
                  <Static id="staPRODUCTDEFNAME" taborder="22" text="품목명" left="0" top="85" width="103" height="20" cssclass="sta_WF_label" tooltiptext="ITEMNAME"/>
                  <Edit id="edt_PRODUCTDEFNAME" taborder="3" left="108" top="85" height="20" width="165" enable="true"/>
                  <Button id="btn_PRODUCTDEFID" taborder="23" width="22" height="20" cssclass="btn_WF_finder" top="35" right="15" onclick="btn_PRODUCTDEFID_onclick"/>
                  <Static id="staPRODUCTDIVISION" taborder="24" text="제품구분" left="0" top="160" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PRODUCTDIVISION"/>
                  <Combo id="cbo_PRODUCTDIVISION" taborder="25" text="CCT" left="108" top="160" height="20" codecolumn="C,ProductDivision2,ALL,Y,Y" index="1" value="" width="165" innerdataset=""/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Div id="div_work" taborder="1" text="div_00" left="300" top="47" right="0" bottom="0">
          <Layouts>
            <Layout>
              <Tab id="tab_Main" taborder="1" tabindex="0" left="0" bottom="0" right="0" top="37.71%">
                <Tabpages>
                  <Tabpage id="Tabpage1" text="검사 결과 등록">
                    <Layouts>
                      <Layout>
                        <Grid id="grdNcrList" taborder="2" left="49.06%" top="34" height="146" autoenter="select" right="0" binddataset="ds_NcrList" autofittype="col">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="40"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="120"/>
                                <Column size="85"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell text="No"/>
                                <Cell col="1" text="판정등급" tooltiptext="DECISIONDEGREE"/>
                                <Cell col="2" text="조치등급" tooltiptext="QCGRADE"/>
                                <Cell col="3" text="NG조건" tooltiptext="NGCONDITION"/>
                                <Cell col="4" text="수량/불량율 구분" tooltiptext="QTYORRATE"/>
                                <Cell col="5" text="범위" cssclass="cell_end" tooltiptext="RANGE"/>
                              </Band>
                              <Band id="body">
                                <Cell text="expr:currow+1"/>
                                <Cell col="1" text="bind:DECISIONDEGREENAME"/>
                                <Cell col="2" text="bind:QCGRADE"/>
                                <Cell col="3" text="bind:NGCONDITIONNAME"/>
                                <Cell col="4" text="bind:QTYORRATENAME"/>
                                <Cell col="5" text="bind:NCRSPEC"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Div id="div_RegInspection" taborder="0" text="상세영역" left="0" top="34" height="63" cssclass="div_WF_detail_line" right="grdNcrList:10">
                          <Layouts>
                            <Layout>
                              <Static id="staArea" taborder="0" text="작업장" left="0" top="0" width="15.28%" height="31" cssclass="sta_WF_detailLabel" wordWrap="english"/>
                              <Static id="staInspectionUser" taborder="1" text="검사자" left="0" top="31" width="15.07%" height="31" cssclass="sta_WF_detailLabel" wordWrap="english"/>
                              <Static id="staLOTID" taborder="2" text="Lot No." left="47.82%" top="0" width="17.47%" height="31" cssclass="sta_WF_detailLabel" wordWrap="english"/>
                              <Static id="strReinspectReason" taborder="3" text="재검 사유" left="47.82%" top="31" width="17.47%" height="31" cssclass="sta_WF_detailLabel" wordWrap="english"/>
                              <Edit id="edt_AREA" taborder="4" left="staArea:5" top="5" height="20" right="staLOTID:5" enable="false"/>
                              <Edit id="edt_LOTID" taborder="5" left="staLOTID:5" top="5" height="20" right="5" enable="false"/>
                              <Button id="btn_InspectionUser" taborder="7" width="22" height="20" cssclass="btn_WF_finder" top="36" right="strReinspectReason:5" onclick="div_RegInspection_btn_InspectionUser_onclick"/>
                              <Edit id="edt_InspectionUser" taborder="6" left="staInspectionUser:5" top="36" height="20" right="btn_InspectionUser:0"/>
                              <Edit id="edt_ReinspectReason" taborder="8" left="strReinspectReason:5" top="36" height="20" right="5" enable="false"/>
                            </Layout>
                          </Layouts>
                        </Div>
                        <Grid id="grdLotQty" taborder="1" left="0" top="107" height="73" binddataset="ds_LotQty" cssclass="grd_detail" autoenter="select" autofittype="col" scrollbartype="none" scrolltype="none" border="1px solid #e8e8e8" right="grdNcrList:10">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell text=" "/>
                                <Cell col="1" text="작업수량" tooltiptext="WORKQTY"/>
                                <Cell col="2" text="검사수량" tooltiptext="INSPECTIONQTY"/>
                                <Cell col="3" text="불량수량" cssclass="cell_end" tooltiptext="DEFECTQTY"/>
                              </Band>
                              <Band id="body">
                                <Cell text="bind:DIVISION" cssclass="cell_bgWhite"/>
                                <Cell col="1" text="bind:WORKQTY" cssclass="cell_bgWhite" textAlign="right" maskeditformat="#,##0" displaytype="mask"/>
                                <Cell col="2" text="bind:INSPECTIONQTY" cssclass="cell_bgWhite" textAlign="right" maskeditformat="#,##0" edittype="mask" displaytype="mask" maskeditautoselect="true"/>
                                <Cell col="3" text="bind:DEFECTQTY" cssclass="cell_end" textAlign="right" maskeditformat="#,##0" displaytype="mask"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Static id="title1" taborder="3" text="NCR 발행기준" left="49.06%" height="34" cssclass="sta_WF_subTitle" usedecorate="true" right="388" top="0" fittocontents="width" width="100"/>
                        <Static id="title1_01" taborder="4" text="기본정보" left="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" top="0" width="66" fittocontents="width"/>
                        <Grid id="grdInspectionList" taborder="5" left="0" top="214" autoenter="select" binddataset="ds_InspectionList" bottom="0" right="260" oncellclick="grdInspectionList_oncellclick" onexpandup="grdInspectionList_onexpandup">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="80"/>
                                <Column size="150"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="150"/>
                                <Column size="150"/>
                                <Column size="150"/>
                                <Column size="80"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                                <Row size="26" band="summ"/>
                              </Rows>
                              <Band id="head">
                                <Cell text="불량 코드" cssclass="cell_point"/>
                                <Cell col="1" text="불량코드 명"/>
                                <Cell col="2" text="판정등급" tooltiptext="DECISIONDEGREE"/>
                                <Cell col="3" text="품질공정" tooltiptext="QCSEGMENT"/>
                                <Cell col="4" text="수량(PNL)" cssclass="cell_point"/>
                                <Cell col="5" text="수량" cssclass="cell_point"/>
                                <Cell col="6" text="불량율"/>
                                <Cell col="7" text="사진등록" tooltiptext="ADDIMAGE"/>
                                <Cell col="8" text="원인품목" tooltiptext="REASONCONSUMABLEDEFID"/>
                                <Cell col="9" text="원인 LOTID" tooltiptext="REASONCONSUMABLELOTID"/>
                                <Cell col="10" text="원인 공정" tooltiptext="REASONPROCESSSEGMENTID"/>
                                <Cell col="11" text="원인 작업장" tooltiptext="REASONAREAID"/>
                              </Band>
                              <Band id="body">
                                <Cell text="bind:SEGMENT_DEFECTCODE" textAlign="left" expandshow="show"/>
                                <Cell col="1" text="bind:SEGMENT_DEFECTNAME" textAlign="left"/>
                                <Cell col="2" text="bind:DECISIONDEGREE" displaytype="combotext" combocodecol="C,DecisionDegree,SEL,Y,N"/>
                                <Cell col="3" text="bind:QCSEGMENTNAME"/>
                                <Cell col="4" text="bind:PNLQTY" textAlign="right" displaytype="mask" edittype="mask" maskeditformat="#,##0.00" maskeditautoselect="true"/>
                                <Cell col="5" text="bind:QTY" textAlign="right" displaytype="mask" edittype="mask" maskeditformat="#,##0" maskeditautoselect="true"/>
                                <Cell col="6" text="bind:DEFECTRATE" textAlign="right" displaytype="mask" edittype="none" maskeditformat="#,##0.00"/>
                                <Cell col="7" text="expr:dataset.parent.nfn_getDictionaryname('ADDIMAGE',true)" displaytype="buttoncontrol" edittype="button"/>
                                <Cell col="8" text="bind:CONSUMABLEDEFNAME" expandshow="show"/>
                                <Cell col="9" text="bind:REASONCONSUMABLELOTID" combodataset="ds_ReasonConsumableLot" combocodecol="CONSUMABLELOTID" combodatacol="CONSUMABLELOTID" displaytype="combotext" edittype="combo"/>
                                <Cell col="10" text="bind:REASONPROCESSSEGMENTNAME" expandshow="show"/>
                                <Cell col="11" text="bind:REASONAREANAME"/>
                              </Band>
                              <Band id="summary">
                                <Cell/>
                                <Cell col="1"/>
                                <Cell col="2"/>
                                <Cell col="3"/>
                                <Cell col="4" maskeditformat="#,##0.00"/>
                                <Cell col="5" maskeditformat="#,##0" displaytype="mask" expr="expr:dataset.getSum(&quot;QTY&quot;) "/>
                                <Cell col="6" expandchar="%" expandsize="24" maskeditformat="#,##0.00" displaytype="mask" expr="dataset.getSum(&quot;DEFECTRATE&quot;)" maskedittype="number" maskeditpostfixtext=" %"/>
                                <Cell col="7"/>
                                <Cell col="8"/>
                                <Cell col="9"/>
                                <Cell col="10"/>
                                <Cell col="11"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Button id="btnAddRow_ds_InspectionList" taborder="6" top="186" width="26" height="24" cssclass="btn_WF_grdAdd" tooltiptext="추가" right="286" onclick="btnAddRow_ds_InspectionList_onclick"/>
                        <Button id="btn_delRow_ds_InspectionList" taborder="7" top="186" width="26" height="24" cssclass="btn_WF_grdDel" tooltiptext="삭제" right="260"/>
                        <ImageViewer id="imageViewer" taborder="8" top="214" width="250" cssclass="img_photo" right="0" bottom="0" stretch="fixaspectratio"/>
                        <Static id="title1_00" taborder="9" text="불량" left="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" top="180" width="38" fittocontents="width"/>
                        <Combo id="cbo_Image" taborder="10" text="CCT" height="24" index="1" value="" width="137" innerdataset="ds_fileCombo" codecolumn="ATCH_FILE_GUID" datacolumn="OC_FILE_NM" right="113" onitemchanged="div_work_tab_Main_Tabpage1_cbo_Image_onitemchanged" top="186"/>
                      </Layout>
                    </Layouts>
                  </Tabpage>
                  <Tabpage id="Tabpage2" text="자주검사 이력" LotID="" DetailLoad="" InspectionClassID="SelfInspectionShip"/>
                </Tabpages>
              </Tab>
              <Grid id="grdLotList" taborder="0" left="0" autoenter="select" top="34" right="0" autofittype="none" bottom="tab_Main:10" onrbuttondown="div_work_grdLotList_onrbuttondown" binddataset="ds_LotList">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="50"/>
                      <Column size="80"/>
                      <Column size="240"/>
                      <Column size="180"/>
                      <Column size="80"/>
                      <Column size="150"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="120"/>
                      <Column size="150"/>
                      <Column size="80"/>
                      <Column size="130"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="No"/>
                      <Cell col="1" text="품목코드"/>
                      <Cell col="2" text="품목명"/>
                      <Cell col="3" text="Lot No."/>
                      <Cell col="4" text="공정수순"/>
                      <Cell col="5" text="공정명"/>
                      <Cell col="6" text="PNL" tooltiptext="PNL"/>
                      <Cell col="7" text="PCS" tooltiptext="PCS"/>
                      <Cell col="8" text="차수" tooltiptext="DEGREE"/>
                      <Cell col="9" tooltiptext="CURRENTAREA" text="현 작업장"/>
                      <Cell col="10" text="설비명"/>
                      <Cell col="11" text="작업자" tooltiptext="ACTUALUSER"/>
                      <Cell col="12" text="작업완료시간" calendardateformat="yyyy-MM-dd HH:mm:ss"/>
                    </Band>
                    <Band id="body">
                      <Cell text="expr:currow+1" textAlign="center"/>
                      <Cell col="1" text="bind:PRODUCTDEFID"/>
                      <Cell col="2" text="bind:PRODUCTDEFNAME" textAlign="left"/>
                      <Cell col="3" text="bind:LOTID" textAlign="left"/>
                      <Cell col="4" text="bind:USERSEQUENCE"/>
                      <Cell col="5" text="bind:PROCESSSEGMENTNAME" textAlign="left"/>
                      <Cell col="6" text="bind:PANELQTY" textAlign="right"/>
                      <Cell col="7" text="bind:QTY" textAlign="right"/>
                      <Cell col="8" text="bind:DEGREE1"/>
                      <Cell col="9" text="bind:AREANAME" textAlign="left"/>
                      <Cell col="10" text="bind:EQUIPMENTNAME" textAlign="left"/>
                      <Cell col="11" text="bind:USERNAME"/>
                      <Cell col="12" text="bind:TRACKOUTTIME"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="staTitle" taborder="2" left="0" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" width="89" text="자주 검사"/>
              <Static id="sta_cnt_ds_LotList" taborder="3" text="Count : &lt;fc v=&quot;#f31d24&quot;&gt;0&lt;/fc&gt;" left="89" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" width="140"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_header" taborder="2" left="0" top="0" height="47" right="0" formscrolltype="both">
          <Layouts>
            <Layout>
              <Static id="Static01" taborder="4" left="0" top="0" cssclass="sta_WF_titleBG" right="0" bottom="0"/>
              <Button id="btn_reset" taborder="0" top="16" width="26" height="24" cssclass="btn_com_reset" right="0" tooltiptext="Toolbar_Initialization" text="" initvalueid="x"/>
              <Button id="btn_help" taborder="1" top="16" width="26" height="24" cssclass="btn_com_help" right="btn_reset:0" tooltiptext="MANUAL" initvalueid="x"/>
              <Button id="btn_save" taborder="2" top="16" width="26" height="24" cssclass="btn_com_save" right="btn_help:0" tooltiptext="Toolbar_Save" initvalueid="x"/>
              <Static id="Static16" taborder="3" left="47" top="0" width="60" height="20" cssclass="guideTip" visible="false" text="h20"/>
              <Button id="btn_searchOpen" taborder="5" left="0" top="16" width="30" height="24" cssclass="btn_WF_searchOpen" onclick="nfn_searchOpen_onclick"/>
              <Static id="sta_title" taborder="6" left="30" top="16" width="80" height="24" cssclass="sta_WF_title" fittocontents="width" text="자주 검사"/>
              <Button id="btn_favorite" taborder="7" left="sta_title:0" top="16" width="24" height="24" cssclass="btn_WF_favorite"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="sta_searchTitle" taborder="3" text="검색조건" left="0" top="47" width="281" height="34" cssclass="sta_WF_subTitle" fittocontents="width" usedecorate="true" tooltiptext="SEARCH_CONDITION_GROUP"/>
        <PopupDiv id="pdv_ReasonConsumableList" text="pdv_00" visible="false" left="553" top="779" width="450" height="221" cssclass="pdiv_POP">
          <Layouts>
            <Layout>
              <Grid id="grd_ReasonConsumableList" taborder="0" left="0" top="0" right="0" bottom="0" binddataset="ds_ReasonConsumableList" oncelldblclick="pdv_ReasonConsumableList_grd_ReasonConsumableList_oncelldblclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="106"/>
                      <Column size="72"/>
                      <Column size="163"/>
                      <Column size="101"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="자재ID"/>
                      <Cell col="1" text="자재버전"/>
                      <Cell col="2" text="자재명"/>
                      <Cell col="3" text="자재유형"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CONSUMABLEDEFID"/>
                      <Cell col="1" text="bind:CONSUMABLEDEFVERSION"/>
                      <Cell col="2" text="bind:CONSUMABLEDEFNAME"/>
                      <Cell col="3" text="bind:MATERIALTYPE"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
            </Layout>
          </Layouts>
        </PopupDiv>
        <PopupDiv id="pdv_ReasonProcessSegment" text="pdv_00" visible="false" left="863" top="789" width="450" height="221" cssclass="pdiv_POP">
          <Layouts>
            <Layout>
              <Grid id="grd_ReasonProcessSegment" taborder="0" left="0" top="0" right="0" bottom="0" binddataset="ds_ReasonProcessSegment" oncelldblclick="pdv_ReasonProcessSegment_grd_ReasonProcessSegment_oncelldblclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="88"/>
                      <Column size="177"/>
                      <Column size="77"/>
                      <Column size="101"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="공정ID"/>
                      <Cell col="1" text="공정명"/>
                      <Cell col="2" text="공정수순"/>
                      <Cell col="3" text="작업장"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:PROCESSSEGMENTID"/>
                      <Cell col="1" text="bind:PROCESSSEGMENTNAME"/>
                      <Cell col="2" text="bind:USERSEQUENCE"/>
                      <Cell col="3" text="bind:AREANAME"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
            </Layout>
          </Layouts>
        </PopupDiv>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_search" oncolumnchanged="ds_search_oncolumnchanged">
        <ColumnInfo>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="AREANAME" type="STRING" size="256"/>
          <Column id="LANGUAGETYPE" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="SQL_ID" type="STRING" size="256"/>
          <Column id="INSPECTIONCLASSID" type="STRING" size="256"/>
          <Column id="INS_USERID" type="STRING" size="256"/>
          <Column id="INS_USERNAME" type="STRING" size="256"/>
          <Column id="REINS_REASON" type="STRING" size="256"/>
          <Column id="PRODUCTDIVISION" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_LotList" onrowposchanged="ds_LotList_onrowposchanged" canrowposchange="ds_LotList_canrowposchange">
        <ColumnInfo>
          <Column id="DEGREE1" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="PANELQTY" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="USERSEQUENCE" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="QTY" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="AREANAME" type="STRING" size="256"/>
          <Column id="EQUIPMENTNAME" type="STRING" size="256"/>
          <Column id="USERNAME" type="STRING" size="256"/>
          <Column id="TRACKOUTTIME" type="STRING" size="256"/>
          <Column id="LOTSTATE" type="STRING" size="256"/>
          <Column id="PROCESSSTATE" type="STRING" size="256"/>
          <Column id="ISHOLD" type="STRING" size="256"/>
          <Column id="ISLOCKING" type="STRING" size="256"/>
          <Column id="PCSPNL" type="STRING" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="NCRINSPECTIONQTY" type="STRING" size="256"/>
          <Column id="INSPECTIONUNIT" type="STRING" size="256"/>
          <Column id="CURAREAID" type="STRING" size="256"/>
          <Column id="CURAREANAME" type="STRING" size="256"/>
          <Column id="PREVSENDTIME" type="STRING" size="256"/>
          <Column id="MENUTP" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cbo_ProdVersion" firefirstcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PRODUCTDEFVERSIONCODE" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSIONNAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Process" firefirstcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTCLASSNAME_MIDDLE" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTCLASSNAME_TOP" type="STRING" size="256"/>
          <Column id="P_PROCESSSEGMENTID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_grdMenu">
        <ColumnInfo>
          <Column id="GRD_NM" type="STRING" size="256"/>
          <Column id="MENU_NM" type="STRING" size="256"/>
          <Column id="FUNC" type="STRING" size="256"/>
          <Column id="DICTIONARYID" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="GRD_NM">grdLotList</Col>
            <Col id="MENU_NM">Lot 이력조회</Col>
            <Col id="FUNC">mfn_gotoLot</Col>
            <Col id="DICTIONARYID">MENU_PG-SG-0340</Col>
          </Row>
          <Row>
            <Col id="MENU_NM">재공조회</Col>
            <Col id="FUNC">mfn_gotoWIP</Col>
            <Col id="GRD_NM">grdLotList</Col>
            <Col id="DICTIONARYID">MENU_PG-SG-0460</Col>
          </Row>
          <Row>
            <Col id="GRD_NM">grdLotList</Col>
            <Col id="MENU_NM">모델별 제공조회</Col>
            <Col id="FUNC">mfn_gotoModelWIP</Col>
            <Col id="DICTIONARYID">MENU_PG-SG-0490</Col>
          </Row>
          <Row>
            <Col id="GRD_NM">grdLotList</Col>
            <Col id="MENU_NM">자주검사(입고,출하) 결과조회</Col>
            <Col id="FUNC">mfn_gotoWIR</Col>
            <Col id="DICTIONARYID">MENU_PG-QC-0560</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_LotQty" oncolumnchanged="ds_LotQty_oncolumnchanged" cancolumnchange="ds_LotQty_cancolumnchange">
        <ColumnInfo>
          <Column id="DIVISION" type="STRING" size="256"/>
          <Column id="WORKQTY" type="STRING" size="256"/>
          <Column id="INSPECTIONQTY" type="STRING" size="256"/>
          <Column id="DEFECTQTY" type="STRING" size="256"/>
          <Column id="PCSPNL" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="WORKQTY">0</Col>
            <Col id="INSPECTIONQTY">0</Col>
            <Col id="DEFECTQTY">0</Col>
            <Col id="PCSPNL">216</Col>
            <Col id="DIVISION">PNL</Col>
          </Row>
          <Row>
            <Col id="INSPECTIONQTY">0</Col>
            <Col id="WORKQTY">0</Col>
            <Col id="DEFECTQTY">0</Col>
            <Col id="PCSPNL">216</Col>
            <Col id="DIVISION">PCS</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_temp"/>
      <Dataset id="ds_InspectionList" useclientlayout="true" oncolumnchanged="ds_InspectionList_oncolumnchanged" cancolumnchange="ds_InspectionList_cancolumnchange" onrowsetchanged="ds_InspectionList_onrowsetchanged" onrowposchanged="ds_InspectionList_onrowposchanged">
        <ColumnInfo>
          <Column id="TXNHISTKEY" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="SEGMENT_DEFECTCODE" type="STRING" size="256"/>
          <Column id="SEGMENT_DEFECTNAME" type="STRING" size="256"/>
          <Column id="DEFECTCODE" type="STRING" size="256"/>
          <Column id="DEFECTCODENAME" type="STRING" size="256"/>
          <Column id="QCSEGMENTID" type="STRING" size="256"/>
          <Column id="QCSEGMENTNAME" type="STRING" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="PNLQTY" type="FLOAT" size="256"/>
          <Column id="QTY" type="FLOAT" size="256"/>
          <Column id="DEFECTRATE" type="FLOAT" size="256"/>
          <Column id="DECISIONDEGREE" type="STRING" size="256"/>
          <Column id="IMAGE" type="STRING" size="256"/>
          <Column id="FILENAME" type="STRING" size="256"/>
          <Column id="FILESIZE" type="STRING" size="256"/>
          <Column id="FILEEXT" type="STRING" size="256"/>
          <Column id="FILEPATH" type="STRING" size="256"/>
          <Column id="IMAGERESOURCEID" type="STRING" size="256"/>
          <Column id="ISUPLOAD" type="STRING" size="256"/>
          <Column id="SPLITCONSUMABLEDEFIDVERSION" type="STRING" size="256"/>
          <Column id="CONSUMABLEDEFNAME" type="STRING" size="256"/>
          <Column id="REASONCONSUMABLEDEFID" type="STRING" size="256"/>
          <Column id="REASONCONSUMABLEDEFVERSION" type="STRING" size="256"/>
          <Column id="REASONCONSUMABLELOTID" type="STRING" size="256"/>
          <Column id="REASONPROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="REASONPROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="REASONAREAID" type="STRING" size="256"/>
          <Column id="REASONAREANAME" type="STRING" size="256"/>
          <Column id="IMGBUTTONNAME" type="STRING" size="256"/>
          <Column id="DEGREE" type="STRING" size="256"/>
          <Column id="REASONCODEID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_NcrList">
        <ColumnInfo>
          <Column id="DECISIONDEGREE" type="STRING" size="256"/>
          <Column id="DECISIONDEGREENAME" type="STRING" size="256"/>
          <Column id="QCGRADE" type="STRING" size="256"/>
          <Column id="NGCONDITION" type="STRING" size="256"/>
          <Column id="NGCONDITIONNAME" type="STRING" size="256"/>
          <Column id="QTYORRATE" type="STRING" size="256"/>
          <Column id="QTYORRATENAME" type="STRING" size="256"/>
          <Column id="NCRSPEC" type="STRING" size="256"/>
          <Column id="FROMRATE" type="STRING" size="256"/>
          <Column id="TORATE" type="STRING" size="256"/>
          <Column id="NGQUANTITY" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ReasonConsumableList" useclientlayout="true">
        <ColumnInfo>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PARENTLOTID" type="STRING" size="256"/>
          <Column id="CONSUMABLEDEFID" type="STRING" size="256"/>
          <Column id="CONSUMABLEDEFVERSION" type="STRING" size="256"/>
          <Column id="CONSUMABLEDEFNAME" type="STRING" size="256"/>
          <Column id="MATERIALTYPE" type="STRING" size="256"/>
          <Column id="CONSUMABLEDEFIDVERSION" type="STRING" size="256"/>
          <Column id="SPLITCONSUMABLEDEFIDVERSION" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ReasonConsumableLot" useclientlayout="true">
        <ColumnInfo>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="CONSUMABLELOTID" type="STRING" size="256"/>
          <Column id="REASONCONSUMABLEDEFIDVERSION" type="STRING" size="256"/>
          <Column id="SPLITCONSUMABLEDEFIDVERSION" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ReasonProcessSegment" useclientlayout="true">
        <ColumnInfo>
          <Column id="SPLITCONSUMABLEDEFIDVERSION" type="STRING" size="256"/>
          <Column id="REASONCONSUMABLEDEFIDVERSION" type="STRING" size="256"/>
          <Column id="REASONCONSUMABLELOTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="USERSEQUENCE" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="AREANAME" type="STRING" size="256"/>
          <Column id="SEQ" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_NcrListTemp">
        <ColumnInfo>
          <Column id="DECISIONDEGREE" type="STRING" size="256"/>
          <Column id="DECISIONDEGREENAME" type="STRING" size="256"/>
          <Column id="QCGRADE" type="STRING" size="256"/>
          <Column id="NGCONDITION" type="STRING" size="256"/>
          <Column id="NGCONDITIONNAME" type="STRING" size="256"/>
          <Column id="QTYORRATE" type="STRING" size="256"/>
          <Column id="QTYORRATENAME" type="STRING" size="256"/>
          <Column id="NCRSPEC" type="STRING" size="256"/>
          <Column id="FROMRATE" type="STRING" size="256"/>
          <Column id="TORATE" type="STRING" size="256"/>
          <Column id="NGQUANTITY" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_LotListTemp">
        <ColumnInfo>
          <Column id="DEGREE1" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="PANELQTY" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="USERSEQUENCE" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="QTY" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="AREANAME" type="STRING" size="256"/>
          <Column id="EQUIPMENTNAME" type="STRING" size="256"/>
          <Column id="USERNAME" type="STRING" size="256"/>
          <Column id="TRACKOUTTIME" type="STRING" size="256"/>
          <Column id="LOTSTATE" type="STRING" size="256"/>
          <Column id="PROCESSSTATE" type="STRING" size="256"/>
          <Column id="ISHOLD" type="STRING" size="256"/>
          <Column id="ISLOCKING" type="STRING" size="256"/>
          <Column id="PCSPNL" type="STRING" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="NCRINSPECTIONQTY" type="STRING" size="256"/>
          <Column id="INSPECTIONUNIT" type="STRING" size="256"/>
          <Column id="CURAREAID" type="STRING" size="256"/>
          <Column id="CURAREANAME" type="STRING" size="256"/>
          <Column id="PREVSENDTIME" type="STRING" size="256"/>
          <Column id="MENUTP" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_result"/>
      <Dataset id="ds_checkLotInsp">
        <ColumnInfo>
          <Column id="INSPECTIONDEFID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSTATE" type="STRING" size="256"/>
          <Column id="ISHOLD" type="STRING" size="256"/>
          <Column id="CHECKINSPECTION" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_file" firefirstcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="SEQ" type="STRING" size="256"/>
          <Column id="FILE_NAME" type="STRING" size="256"/>
          <Column id="FILE_SIZE" type="STRING" size="256"/>
          <Column id="ORG_FILE_NAME" type="STRING" size="256"/>
          <Column id="INPUT_TIME" type="STRING" size="256"/>
          <Column id="FILE_TYPE" type="STRING" size="256"/>
          <Column id="JOB_SYS_CD" type="STRING" size="256"/>
          <Column id="FILE_EXT" type="STRING" size="256"/>
          <Column id="OC_FILE_NM" type="STRING" size="256"/>
          <Column id="ATCH_FILE_GUID" type="STRING" size="256"/>
          <Column id="SVR_SAVE_COURS" type="STRING" size="256"/>
          <Column id="DRM_APY_YN" type="STRING" size="256"/>
          <Column id="RM" type="STRING" size="256"/>
          <Column id="ATCH_FILE_ID" type="BIGDECIMAL" size="256"/>
          <Column id="DNLD_CNT" type="BIGDECIMAL" size="256"/>
          <Column id="KEEP_START_DATEC" type="STRING" size="256"/>
          <Column id="KEEP_END_DATEC" type="STRING" size="256"/>
          <Column id="USE_YN" type="STRING" size="256"/>
          <Column id="CREATION_DATE" type="STRING" size="256"/>
          <Column id="LAST_UPDATED_BY" type="BIGDECIMAL" size="256"/>
          <Column id="LAST_UPDATE_DATE" type="STRING" size="256"/>
          <Column id="LAST_UPDATE_LOGIN" type="BIGDECIMAL" size="256"/>
          <Column id="TABLE_NAME" type="STRING" size="256"/>
          <Column id="DESC" type="STRING" size="256"/>
          <Column id="ATCH_SRC_KEY" type="STRING" size="256"/>
          <Column id="FULL_SAVE_COURS" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_fileCombo" firefirstcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" onrowposchanged="ds_fileCombo_onrowposchanged">
        <ColumnInfo>
          <Column id="OC_FILE_NM" type="STRING" size="256"/>
          <Column id="ATCH_FILE_GUID" type="STRING" size="256"/>
          <Column id="ATCH_FILE_ID" type="BIGDECIMAL" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchCopy">
        <ColumnInfo>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="AREANAME" type="STRING" size="256"/>
          <Column id="LANGUAGETYPE" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="SQL_ID" type="STRING" size="256"/>
          <Column id="INSPECTIONCLASSID" type="STRING" size="256"/>
          <Column id="INS_USERID" type="STRING" size="256"/>
          <Column id="INS_USERNAME" type="STRING" size="256"/>
          <Column id="REINS_REASON" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript5.1"><![CDATA[/***************************************************************************************
 * 시스템명 	: IFC MES시스템
 * 업무명 		: 자주검사 
 * 파일명 		: PCM01500M.xfdl
 * 작성자 		: 김애리
 * 작성일 		: 2021.3.26
 * AS-IS		: LotIncommingInspection
 * 설  명		: 작업 완료 후 해당 검사가 필요한 품목은 검사 하게 됨
 *---------------------------------------------------------------------------------------
 * 변경일		변경자		변경내역
 *---------------------------------------------------------------------------------------
 * 2021.3.26	김애리   	최초작성
 *---------------------------------------------------------------------------------------
 ****************************************************************************************/
 
/**************************************************************************
 * 1. 필수 include
 ***************************************************************************/
 include "lib::lib_bas.xjs";	//기준관리 공통 라이브러리 include
 include "pcm::pcmCommon.xjs"; //pcm 에서 사용하는 공통
 
/**************************************************************************
 * 2. FORM 변수 선언 영역
 ***************************************************************************/
 this.DefectSegments = "";
 this.SelectLotJsonString = "";
 
 this.IsSaved = true;
 
 //첫번째 탭 불량 그리드
 this.Defect = {
		inspectQty :	0   	//검사 수량(pcs 기준)
	  , pcsPnl :    0   		//기준 (PCS / PNL) 수량
	  , InspectionDefId : "" 	//검사정의 ID
	  , SelectedLotId : "" 		//Selected Lot ID
	  , panelPerQty : 0			//usDefectGrid 의 member
	  , qty : 0					//usDefectGrid 의 member
 };

/**************************************************************************
 * 3. FORM LOAD
 ***************************************************************************/
 this.fn_init = function (obj:Form, e:nexacro.LoadEventInfo)
{
	this.nfn_formInit(obj); 
	
	//this.tab_search.Tabpage1.form.edt_AREAID.removeEventHandler("onkeydown", this.gfn_setEnterKeyEvent , this); 
	this.ds_search.set_rowposition(0);
	
	this.ds_search.setColumn(0, "ENTERPRISEID", this.gf_getEnterpriseId());
	this.ds_search.setColumn(0, "PLANTID",this.gf_getSiteType());
	this.ds_search.setColumn(0, "LANGUAGETYPE",this.gf_getLanguageType());
	this.ds_search.setColumn(0, "INSPECTIONCLASSID", "SelfInspectionShip");//자주검사(입고)
	this.ds_search.setColumn(0, "INS_USERID", this.gf_getUserId());
	this.ds_search.setColumn(0, "INS_USERNAME", this.gf_getUserNm());
	
	this.fn_initParam();
	this.fn_initCombo();
	this.GetNCRList();
	
	//그리드 기능 제외 
	//sort 제거	  
	this.div_work.form.tab_Main.Tabpage1.form.grdLotQty.removeEventHandler("onheadclick", this.nfn_grd_onheadclick , this); 
	//filter 제거
	this.div_work.form.tab_Main.Tabpage1.form.grdLotQty.removeEventHandler("onexpandup", this.nfn_grd_onexpandup , this); 
	this.div_work.form.tab_Main.Tabpage1.form.grdLotQty.removeEventHandler("onmousemove", this.nfn_grd_onmousemove, this); //filter 아이콘 안나오게 처리
	
	this.div_work.form.tab_Main.Tabpage2.set_url("pcm::PCM01500D.xfdl");

}; 

/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 기능 : 검색
 */
this.fn_search = function (obj:Button, e:nexacro.ClickEventInfo)
{
	this.GetLotList();
};

this.GetLotList = function ()
{
	this.ds_LotQty.setColumn(0,"INSPECTIONQTY",0);
	this.ds_LotQty.setColumn(0,"DEFECTQTY",0);
	this.ds_LotQty.setColumn(1,"DEFECTQTY",0);
	
	if(this.ds_search.getColumn(0,"PROCESSSEGMENTID") == "") 
		this.ds_search.setColumn(0,"PROCESSSEGMENTID", this.ds_search.getColumn(0,"PROCESSSEGMENTNAME")) ;
	
	if(this.nfn_isNull(this.ds_search.getColumn(0,"PRODUCTDEFID"))) this.ds_search.setColumn(0,"PRODUCTDEFVERSION","");
	this.ds_LotList.clearData();
	if(this.fn_searchValidate() == false) return;
	
	var sSvcID 			= "SelectLotInspectionList";
	var sController 	= "/pcm01500/SelectLotInspectionList.do";
	var sInDatasets 	= "INPUT=ds_search";
	var sOutDatasets 	= "ds_LotList=output";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

this.GetTXNHISTKEY = function ()
{
	this.ds_temp.clear();
	
	var sSvcID 			= "selectTxnHistKey";
	var sController 	= "/pcmCommon/selectTxnHistKey.do";
	var sInDatasets 	= ""; 
	var sOutDatasets 	= "ds_temp=output";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs,"","",false);
	
	//trace(this.ds_temp.saveXML());
	return this.ds_temp.getColumn(0,0);
	
};

this.fn_searchValidate = function ()
{
	if(this.tab_search.Tabpage1.form.edt_AREAID.value != this.ds_search.getColumn(0,"AREANAME"))
		this.ds_search.setColumn(0,"AREANAME", this.tab_search.Tabpage1.form.edt_AREAID.value);
		
	var component = this.tab_search.Tabpage1;
	var strColIdList = "edt_AREAID";
	var strColNmList = "AREA";
	return this.nfn_MandatoryCheck(component, strColIdList, strColNmList);
};

/*
* 기능 : 검색 초기화
*/
this.fn_searchClear = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	
	this.ds_search.copyData(this.ds_searchCopy);
};

this.GetNCRList = function ()
{
	this.ds_NcrList.clearData();
	
	var sSvcID 			= "SelectNcrStandardOfSelfInspection";
	var sController 	= "/pcm01500/SelectNcrStandardOfSelfInspection.do";
	var sInDatasets 	= "INPUT=ds_search";
	var sOutDatasets 	= "ds_NcrList=output";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

this.fn_save = function (obj:Button, e:nexacro.ClickEventInfo)
{
	if(this.fn_saveValidate() == false) return;
	
	var mRow = this.ds_LotList.rowcount == 1 ? 0 : this.ds_LotList.rowposition;
	
	for(var r=0;r<this.ds_InspectionList.rowcount;r++)
	{
		var pcsQty = nexacro.toNumber(this.ds_InspectionList.getColumn(r, "QTY"));
		var pnlQty = nexacro.toNumber(this.ds_InspectionList.getColumn(r, "PNLQTY"));
		var defectRate = nexacro.toNumber(this.ds_InspectionList.getColumn(r, "DEFECTRATE"));
		var defectGrade = this.ds_InspectionList.getColumn(r, "DECISIONDEGREE");
		var defectCode = this.ds_InspectionList.getColumn(r, "DEFECTCODE");
		var imgResourceID = this.ds_InspectionList.getColumn(r, "IMAGERESOURCEID");

		if(this.mfn_checkNCR(defectGrade, defectRate, pcsQty,defectCode, imgResourceID ) == false) return;
	}
	this.ds_LotListTemp.clearData();
	var addRow =  this.ds_LotListTemp.addRow();
	var bSucc = this.ds_LotListTemp.copyRow(addRow,this.ds_LotList,mRow);

	//this.ds_LotList 에서 보냄.  
	
	var sSvcID 			= "saveLotIncommingInspection";
	var sController 	= "/pcm01500/saveLotIncommingInspection.do";
	var sInDatasets 	= "ds_search=ds_search ds_LotList=ds_LotListTemp ds_LotQty=ds_LotQty ds_InspectionList=ds_InspectionList:A";
	var sOutDatasets 	= "ds_result=output";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
		
};

this.fn_saveValidate = function ()
{
	var insPnlQty = nexacro.toNumber(this.ds_LotQty.getColumn(0,"INSPECTIONQTY")); 
    var insPcsQty = nexacro.toNumber(this.ds_LotQty.getColumn(1,"INSPECTIONQTY")); 
	
	var defectPnlQty = nexacro.toNumber(this.ds_LotQty.getColumn(0,"DEFECTQTY")); 
    var defectPcsQty = nexacro.toNumber(this.ds_LotQty.getColumn(1,"DEFECTQTY")); 
	
	if (insPcsQty == 0)
	{
		//검사수량이 0입니다. 검사 작업 후 진행하여 주십시오.
		this.gfn_Message("MustDoInspect", null, "warning", "ok");
		return false;
	}
	
	if (insPnlQty == 0 && insPcsQty == 0)
	{
		this.ds_LotQty.set_enableevent(false);
		this.ds_LotQty.setColumn(0,"DEFECTQTY",0);
		this.ds_LotQty.setColumn(1,"DEFECTQTY",0);
		this.ds_LotQty.set_enableevent(true);
		
		var arg = [this.nfn_getDictionaryname('INSPECTIONQTY',true)];
		this.gfn_Message("MustDoInspect", arg, "warning", "ok");//검사 수량을(를) 먼저 입력하세요.
		return false;
	}
	
	if (defectPcsQty > insPcsQty)
	{
		this.ds_LotQty.set_enableevent(false);
		this.ds_LotQty.setColumn(0,"DEFECTQTY",0);
		this.ds_LotQty.setColumn(1,"DEFECTQTY",0);
		this.ds_LotQty.set_enableevent(true);
		
		var arg = [this.nfn_getDictionaryname('DEFECTQTY',true), this.nfn_getDictionaryname('INSPECTIONQTY',true)];
		this.gfn_Message("CanNotToMuch", arg, "warning", "ok");//불량 수량은(는) 검사 수량보다 많을 수 없습니다.
		return false;
	}
	if(defectPcsQty == 0) {
		this.ds_InspectionList.clearData();
	} else {
		for(var i=0;i<this.ds_InspectionList.rowcount;i++)
		{
			if(this.ds_InspectionList.getColumn(i,"QTY") == 0 ){
				var arg = this.ds_InspectionList.getColumn(i,"SEGMENT_DEFECTCODE");
				this.gfn_Message("InputDefectQty", arg, "warning", "ok");//불량 수량을 입력하시기 바랍니다. Defect Code : {0}
				return false;
			}
		}
	}
	return true;
}

this.mfn_checkNCR = function (defectGrade, defectRate, defectQty,strDefectCode, imgResourceID )
{
	this.ds_NcrListTemp.copyData(this.ds_NcrList);
	this.ds_NcrListTemp.filter("DECISIONDEGREE == '" + defectGrade + "'");
	var bcheck = true;
	var message = "";
	
	for(var i=0;i<this.ds_NcrListTemp.rowcount;i++)
	{
		var judgeType = this.ds_NcrListTemp.getColumn(i,"NGCONDITION");
		var fromRate = nexacro.toNumber(this.ds_NcrListTemp.getColumn(i,"FROMRATE"));
		var toRate = nexacro.toNumber(this.ds_NcrListTemp.getColumn(i,"TORATE"));
		var ngQty = nexacro.toNumber(this.ds_NcrListTemp.getColumn(i,"NGQUANTITY"));
		var chkDefectQty = defectQty;
		var checkType = this.ds_NcrListTemp.getColumn(i,"QTYORRATE");
		
		var spec = this.ds_NcrListTemp.getColumn(i,"NCRSPEC");
		var gcGrad = this.ds_NcrListTemp.getColumn(i,"QCGRADE");
		
		switch(judgeType) {
		case "GE"://이상
		{
			if(checkType == "RATE" && defectRate >= toRate){
				message = this.SetNCRMessage(checkType, strDefectCode, gcGrad, defectQty.toString(), spec, defectRate.toString());
				bcheck = false;
			}else if(checkType == "QTY" && chkDefectQty >= ngQty){
				message = this.SetNCRMessage(checkType, strDefectCode, gcGrad, defectQty.toString(), spec, defectRate.toString());
				bcheck = false;
			}
			break;
		}
		case "BT":
		{
			if(checkType == "RATE" &&  defectRate >= fromRate && defectRate <= toRate){
				message = this.SetNCRMessage(checkType, strDefectCode, gcGrad, defectQty.toString(), spec, defectRate.toString());
				bcheck = false;
			}else if(checkType == "QTY" && ngQty >= fromRate && ngQty <= toRate){
				message = this.SetNCRMessage(checkType, strDefectCode, gcGrad, defectQty.toString(), spec, defectRate.toString());
				bcheck = false;
			}
			break;
		}
		case "GT":
		{
			if(checkType == "RATE" &&  defectRate > toRate){
				message = this.SetNCRMessage(checkType, strDefectCode, gcGrad, defectQty.toString(), spec, defectRate.toString());
				bcheck = false;
			}else if(checkType == "QTY" && chkDefectQty > ngQty){
				message = this.SetNCRMessage(checkType, strDefectCode, gcGrad, defectQty.toString(), spec, defectRate.toString());
				bcheck = false;
			}
			break;
		}
		case "LE":
		{
			if(checkType == "RATE" &&  defectRate <= toRate){
				message = this.SetNCRMessage(checkType, strDefectCode, gcGrad, defectQty.toString(), spec, defectRate.toString());
				bcheck = false;
			}else if(checkType == "QTY" && chkDefectQty <= ngQty){
				message = this.SetNCRMessage(checkType, strDefectCode, gcGrad, defectQty.toString(), spec, defectRate.toString());
				bcheck = false;
			}
			break;
		}
		default:
		}
	}
	
	if (!bcheck && this.nfn_isNull(imgResourceID)) {
		this.gfn_Message("CHECKIMEAGEBYNCR", message, "warning", "ok");//NCR 발행 불량은 이미지 등록이 필수 입니다. {0}
	} else {
		bcheck = true;
	}
	
	return bcheck;
};

this.SetNCRMessage = function (checkType, strDefectCode, gcGrad, defectQty, spec, defectRate)
{
	var message = "";

	message = "\r\n" + this.nfn_getDictionaryname('DEFECTCODE',true) + " : " + strDefectCode + "\r\n" + this.nfn_getDictionaryname('QCGRADE',true) + " : " + gcGrad + "\r\n";
	if (checkType == "QTY")
	{
		message = message + this.nfn_getDictionaryname('PCSDEFECTQTY',true) + " : " + defectQty + "\r\n" + this.nfn_getDictionaryname('RANGE',true)  + " : " + spec;
	}
	else
	{
		message = message + this.nfn_getDictionaryname('NCRDEFECTRATE',true) + " : " + defectRate + "\r\n" + this.nfn_getDictionaryname('RANGE',true) + " : " + spec;
	}

	return message;
};



 /**************************************************************************
 * 5. TRANSACTION, CALLBACK 영역
 ***************************************************************************/
this.fn_callBack = function (trId, errCD, errMsg)
{
trace('fn_callBack trId ?' + trId);
	if (errCD < 0) 
	{
		this.gfn_Message("ProcessingError", trId + errMsg, "error", "ok");	
		return;
	} 
	 
	{
		switch(trId) {
		case "SelectLotInspectionList" :
		{
			if(this.ds_LotList.rowcount > 0) 
			{
				this.div_work.form.tab_Main.Tabpage2.LotID = this.ds_LotList.getColumn(0,"LOTID");
				if(this.div_work.form.tab_Main.Tabpage2.DetailLoad == "Y" )
				{
					this.div_work.form.tab_Main.Tabpage2.form.mfn_GetInspection(this.ds_LotList.getColumn(0,"LOTID"));
				}
			}
			break;
		}
		case "saveLotIncommingInspection" : 
		{
			this.gfn_Message("SuccessSave", "", "info", "ok");
			//trace(this.ds_result.saveXML());
			this.ds_InspectionList.applyChange();
			this.SelectLotJsonString = this.SelectRow2JsonString(this.ds_LotList);
			this.fn_sendEmail();
			break;
		}
		case "selectCheckLotInspection" :
		{
			if(this.ds_checkLotInsp.getColumn(0,"CHECKINSPECTION") == "N")
			{
				var bRtn = this.gfn_confirm("MoveQualitySpecification", "information", ""); //품질규격 측정값 등록 화면으로 이동하시겠습니까?
				if(bRtn)
				{
					var sUrl = "qam::QAM01100M.xfdl"; 
					// arryList 타입전달 예)
					var objArgs = {
						menuName : "MeasReg",
						objList : [this.SelectLotJsonString]
					};

					var bReload = true;
					this.gfn_goPage(sUrl, objArgs, bReload);
				}
			}
			
			//this.fn_sendEmail();
			break;
		}
		case "selectEcmLookupValuesVList2ds_CSiteTypeALL" :
		{
			this.ds_search.setColumn(0,"PLANTID",this.gf_getSiteType());
			break;
		}
		case "selectInputResultByInputDay" : 
		{
			//trace(this.ds_InputResultByDay.saveXML());
			break;
		}
		case "selectReasonConsumableList" : 
		{
			//trace(this.ds_ReasonConsumableList.saveXML());
			break;
		}
		case "selectDefectReasonConsumableLot" :
		{
			//trace(this.ds_ReasonConsumableLot.saveXML());
			break;
		}
		case "selectDefectReasonProcesssegment" : 
		{
			var arrSeg = [];
			for(var i=0;i<this.ds_ReasonProcessSegment.rowcount;i++)
			{
				arrSeg.push(this.ds_ReasonProcessSegment.getColumn(i,"PROCESSSEGMENTID"));
			}
			this.DefectSegments = arrSeg.join(',');
			break;
		}
		case "selectEcmLookupValuesVList2ds_CDecisionDegreeSEL" :
		{
			this.ds_searchCopy.copyData(this.ds_search);
			break;
		}
		default:
		}
	}
};

/**************************************************************************
 * 6. 팝업 호출/콜백
 **************************************************************************/
/*
 *	기능 : 팝업 관련
 */ 
this.fn_popupAfter = function(sPopupId, Variant)
{
	var rtn = this.fv_rtnValue;	
	
	if(sPopupId == "EMAIL" ) this.mfn_GetCheckLotInspection();
	
	if(this.nfn_isNull(rtn)) return;

	if(sPopupId == "SEARCH_PRODUCT")
	{//PRODUCTDEFID|PRODUCTDEFVERSION|PRODUCTDEFNAME
		this.setProduct_P00105(rtn, this.ds_cbo_ProdVersion, this.ds_search);
		
	} else if (sPopupId == "SEARCH_AREA")
	{//AREAID|AREANAME
		this.ds_search.setColumn(0,"AREAID",rtn[0]);
		this.ds_search.setColumn(0,"AREANAME",rtn[1]);
	}else if (sPopupId == "SEARCH_LOTID")
	{//LOTID
		this.ds_search.setColumn(0,"LOTID",rtn.join(","));
	}else if (sPopupId == "SEARCH_SEGMENT")
	{
		var resultInfo = JSON.parse(rtn);
		if(resultInfo.resultCd == "OK")
		{
			var arrCode = [];
			var arrName = [];
			for(var i=0;i<this.ds_Process.rowcount;i++)
			{
				arrCode.push(this.ds_Process.getColumn(i,"PROCESSSEGMENTID"));
				arrName.push(this.ds_Process.getColumn(i,"PROCESSSEGMENTNAME"));
			}
			this.ds_search.setColumn(0,"PROCESSSEGMENTID",arrCode.join(","));
			this.ds_search.setColumn(0,"PROCESSSEGMENTNAME",arrName.join(","));
			
		}
	}else if (sPopupId == "SEARCH_USER")
	{//USERID|USERNAME
		this.ds_search.setColumn(0,"INS_USERID",rtn[0]);
		this.ds_search.setColumn(0,"INS_USERNAME",rtn[1]);
	}else if (sPopupId == "SEARCH_DEFECT")
	{//DEFECTCODE|DEFECTCODENAME|QCSEGMENTID|QCSEGMENTNAME|DECISIONDEGREE|SEGMENT_DEFECTCODE|SEGMENT_DEFECTNAME";
	
		if(this.ds_InspectionList.findRow("SEGMENT_DEFECTCODE",rtn[5]) >= 0 ) return;
	
		var nRow = this.ds_InspectionList.rowcount == 1 ? 0 : this.ds_InspectionList.rowposition;
		this.ds_InspectionList.setColumn(nRow,"DEFECTCODE",rtn[0]);
		this.ds_InspectionList.setColumn(nRow,"DEFECTCODENAME",rtn[1]);
		this.ds_InspectionList.setColumn(nRow,"QCSEGMENTID",rtn[2]);
		this.ds_InspectionList.setColumn(nRow,"QCSEGMENTNAME",rtn[3]);
		this.ds_InspectionList.setColumn(nRow,"DECISIONDEGREE",rtn[4]);
		this.ds_InspectionList.setColumn(nRow,"SEGMENT_DEFECTCODE",rtn[5]);
		this.ds_InspectionList.setColumn(nRow,"SEGMENT_DEFECTNAME",rtn[6]);
		
	}else if( sPopupId == "file_upload")
	{
		if(rtn == "SUCC")
		{
			var nRow = this.ds_InspectionList.rowcount == 1 ? 0 : this.ds_InspectionList.rowposition;
			trace(this.ds_file.saveXML());
			
			this.ds_fileCombo.filter();
			for(var j=this.ds_fileCombo-1;j >= 0;j--)
			{
				if(this.ds_fileCombo.findRow("ATCH_FILE_ID",this.ds_InspectionList.getColumn(nRow,"IMAGERESOURCEID")) > 0);
					this.ds_fileCombo.deleteRow(j);
			}
			
			for(var i=0;i<this.ds_file.rowcount;i++)
			{
				var eRow = this.ds_fileCombo.addRow();
				this.ds_fileCombo.setColumn(eRow, "OC_FILE_NM", this.ds_file.getColumn(i,"OC_FILE_NM"));
				this.ds_fileCombo.setColumn(eRow, "ATCH_FILE_GUID", this.ds_file.getColumn(i,"ATCH_FILE_GUID"));
				this.ds_fileCombo.setColumn(eRow, "ATCH_FILE_ID", this.ds_file.getColumn(i,"ATCH_FILE_ID"));
			}
			
			var filterString = "ATCH_FILE_ID == '" + this.ds_file.getColumn(0,"ATCH_FILE_ID") + "'"
			this.ds_fileCombo.filter();
			this.ds_fileCombo.filter(filterString);
			
			this.ds_InspectionList.setColumn(nRow,"IMAGERESOURCEID",this.ds_file.getColumn(0,"ATCH_FILE_ID"));
			this.ds_fileCombo.set_rowposition(0);
			this.div_work.form.tab_Main.Tabpage1.form.cbo_Image.set_value(this.ds_file.getColumn(0,"ATCH_FILE_GUID"));
			
			var upUrl = nexacro.getEnvironment().services["svcurl"].url +"/comm/downImage/" + this.ds_file.getColumn(0,"ATCH_FILE_GUID") + ".do";
			this.div_work.form.tab_Main.Tabpage1.form.imageViewer.set_image(upUrl);
	
		}
		
	}
	
};

/**************************************************************************
 * 7. 기타 함수(화면 로컬 정의) 
 **************************************************************************/

this.mfn_ClearGetLotList = function ()
{
	this.ds_InspectionList.set_enableevent(false);
	this.ds_LotQty.set_enableevent(false);
	
	this.ds_InspectionList.clearData();
	this.ds_LotQty.setColumn(0,"INSPECTIONQTY","0");
	this.ds_LotQty.setColumn(1,"INSPECTIONQTY","0");
	this.ds_LotQty.setColumn(0,"DEFECTQTY","0");
	this.ds_LotQty.setColumn(1,"DEFECTQTY","0");
	this.ds_search.setColumn(0,"REINS_REASON","");
	
	this.GetLotList();
	
	this.ds_InspectionList.set_enableevent(true);
	this.ds_LotQty.set_enableevent(true);
};
/*
 *	화면 호출시 셋팅된 argument 가 존재하면 가져온다.
 */
this.fn_initParam = function()
{
	var sArgName = this.gfn_getFrameAguments("menuName");
	if(sArgName == "LotOutcommingInspection") {
		trace("argument :" + sArgName); 

		//var sArgArr = this.gfn_getFrameAguments("objList");
		var data = JSON.parse(this.gfn_getFrameAguments("objList"));
		this.ds_search.setColumn(0,"AREAID",data.AREAID);
		this.ds_search.setColumn(0,"AREANAME",data.AREANAME);
		this.ds_search.setColumn(0,"LOTID",data.LOTID);
		this.tab_search.Tabpage1.form.edt_AREAID.set_value(data.AREANAME );
		this.GetLotList();
	}
}

this.fn_initCombo = function ()
{
	this.AddAll(this.ds_cbo_ProdVersion,"PRODUCTDEFVERSIONCODE","PRODUCTDEFVERSIONNAME");
	this.ds_search.setColumn(0, "PRODUCTDEFVERSION", "");
};


/*
 *	입고 검사 Context Menu : Lot 이력조회
 */
this.mfn_gotoLot = function ()
{
	var sUrl = "pcm::PCM03100M.xfdl"; 
	// arryList 타입전달 예)
	var objArgs = {
		menuName : "LotHistory",
		objList : [this.SelectRow2JsonString(this.ds_LotList)]
	};

	var bReload = true;
	this.gfn_goPage(sUrl, objArgs, bReload);
};

/*
 *	입고 검사 Context Menu : 재공조회
 */
this.mfn_gotoWIP = function ()
{
// 	var nRow = this.ds_LotList.rowposition;
// 	var lotID = this.ds_LotList.getColumn(nRow,"LOTID");
// 	var prodID = this.ds_LotList.getColumn(nRow,"PRODUCTDEFID");
// 	var prodVer = this.ds_LotList.getColumn(nRow,"PRODUCTDEFVERSION");
// 	var prodName = this.ds_LotList.getColumn(nRow,"PRODUCTDEFNAME");
// 	var areaID = this.ds_LotList.getColumn(nRow,"AREAID");
// 	var areaName = this.ds_LotList.getColumn(nRow,"AREANAME");
	
	var sUrl = "pcm::PCM04900M.xfdl";
	// arryList 타입전달 예)
	var objArgs = {
		menuName : "LotWorkInProcess",
		objList : [this.SelectRow2JsonString(this.ds_LotList)]
	};

	var bReload = true;
	this.gfn_goPage(sUrl, objArgs, bReload);
};

/*
 *	입고 검사 Context Menu : 모델별 제공조회
 */
this.mfn_gotoModelWIP = function ()
{
	var sUrl = "pcm::PCM05000M.xfdl"; 
	// arryList 타입전달 예)
	var objArgs = {
		menuName : "ModelWorkInProcess",
		objList : [this.SelectRow2JsonString(this.ds_LotList)]
	};

	var bReload = true;
	this.gfn_goPage(sUrl, objArgs, bReload);
};

/*
 *	입고 검사 Context Menu : 자주검사(입고,출하) 결과조회
 */
this.mfn_gotoWIR = function ()
{
	var sUrl = "qam::QAM00800M.xfdl"; 
	// arryList 타입전달 예)
	var objArgs = {
		menuName : "InspectionResult",
		objList : [this.SelectRow2JsonString(this.ds_LotList)]
	};

	var bReload = true;
	this.gfn_goPage(sUrl, objArgs, bReload);
};

/*
 *	상단 그리드 선택 시 Detail 데이타 뿌려줌. asis : FocusedRowDataBind
 */
this.SetInspectionReg = function (nRow)
{
	var lotId = this.ds_LotList.getColumn(nRow, "LOTID");
    var areaName = this.ds_LotList.getColumn(nRow, "CURAREANAME");
    var processsegmentName = this.ds_LotList.getColumn(nRow, "PROCESSSEGMENTNAME");
    var InspectionCnt = this.pfn_allTrim(this.ds_LotList.getColumn(nRow, "DEGREE1"));
	
	var pnlQty = nexacro.toNumber( this.ds_LotList.getColumn(nRow, "PANELQTY"));
    var pcsQty = nexacro.toNumber( this.ds_LotList.getColumn(nRow, "QTY"));
    var pcsPnl = nexacro.toNumber( this.ds_LotList.getColumn(nRow, "PCSPNL"));
	
	this.ds_search.setColumn(0,"REINS_REASON","");
	
	if(InspectionCnt == "0" )
		this.div_work.form.tab_Main.Tabpage1.form.div_RegInspection.form.edt_ReinspectReason.set_enable(false);
	else
		this.div_work.form.tab_Main.Tabpage1.form.div_RegInspection.form.edt_ReinspectReason.set_enable(true);
		
	var InspUnit = this.pfn_allTrim(this.ds_LotList.getColumn(nRow, "INSPECTIONUNIT"));
	var Inspqty = nexacro.toNumber( this.ds_LotList.getColumn(nRow, "NCRINSPECTIONQTY"));
		
	//ClearLotQtyGrid(pnlQty, pcsQty, pcsPnl); 대신...
	this.ds_LotQty.set_enableevent(false);
	this.ds_LotQty.setColumn(0,"WORKQTY",pnlQty);
	this.ds_LotQty.setColumn(1,"WORKQTY",pcsQty);
	this.ds_LotQty.setColumn(0,"PCSPNL",pcsPnl);
	this.ds_LotQty.setColumn(1,"PCSPNL",pcsPnl);
	this.ds_LotQty.set_enableevent(true);
	
	this.defectProcessListControl_SetResultData(lotId,pcsQty, pcsPnl);
	
	this.ds_InspectionList.addRow();
	this.ds_InspectionList.applyChange();
	this.ds_ReasonProcessSegment.filter("");
};

this.SetInspectionHist = function (nRow)
{
	if(this.div_work.form.tab_Main.Tabpage2.DetailLoad == "Y" )
	{//this.mfn_GetInspection(this.parent.LotID);
		this.div_work.form.tab_Main.Tabpage2.form.mfn_GetInspection(this.ds_LotList.getColumn(nRow,"LOTID"));
	}
};

/*
 *	기본정보 그리드에서 검사 수량(PNL) 변경 시 
 */
this.mfn_ChangePnlQty = function (pnlQty, pcsPnl)
{
	this.IsSaved = true;
	var pcsQty = pnlQty * pcsPnl;
	var workQty = nexacro.toNumber(this.ds_LotQty.getColumn(1, "WORKQTY"));
	if(workQty < pcsQty) pcsQty = workQty;

	return pcsQty;
	
};

/*
 *	기본정보 그리드에서 검사 수량(PCS) 변경 시 
 */
this.mfn_ChangePcsQty = function (pcsQty, pcsPnl)
{
	this.IsSaved = true;
	var pnlQty = nexacro.ceil(pcsQty / pcsPnl);
	return pnlQty;
};


/*
 *	불량 검사 그리드에서 수량(PNL) 변경 시 
 */
this.mfn_defectChangePnlQty = function (pnlQty)
{
	this.ds_InspectionList.set_enableevent(false);
	this.ds_LotQty.set_enableevent(false);
	try{
		var nRow = this.ds_InspectionList.rowcount == 1 ? 0 : this.ds_InspectionList.rowposition;
	
		var pcsQty = (pnlQty * this.Defect.pcsPnl);
		this.ds_InspectionList.setColumn(nRow, "QTY", pcsQty);
		var sumPnlQty = this.ds_InspectionList.getSum("PNLQTY");
		var sumPcsQty = this.ds_InspectionList.getSum("QTY");
		
		this.ds_LotQty.setColumn(0,"DEFECTQTY",nexacro.ceil(sumPnlQty));
		this.ds_LotQty.setColumn(1,"DEFECTQTY",nexacro.ceil(sumPcsQty));
		defectiveRate = (pcsQty/this.Defect.inspectQty)*100;
		this.ds_InspectionList.setColumn(nRow,"DEFECTRATE",defectiveRate);
	}
	catch(ec){
		trace("mfn_defectChangePnlQty ? " + ec.toString());
	}
	
	this.ds_InspectionList.set_enableevent(true);
	this.ds_LotQty.set_enableevent(true);
};

/*
 *	불량 검사 그리드에서 수량(PCS) 변경 시 
 */
this.mfn_defectChangePcsQty = function (pcsQty)
{
	this.ds_InspectionList.set_enableevent(false);
	this.ds_LotQty.set_enableevent(false);
	try{
		var nRow = this.ds_InspectionList.rowcount == 1 ? 0 : this.ds_InspectionList.rowposition;
	
		var pnlQty = (pcsQty / this.Defect.pcsPnl);
		this.ds_InspectionList.setColumn(nRow, "PNLQTY", nexacro.ceil(pnlQty));
		var sumPnlQty = this.ds_InspectionList.getSum("PNLQTY");
		var sumPcsQty = this.ds_InspectionList.getSum("QTY");
		
		this.ds_LotQty.setColumn(0,"DEFECTQTY",nexacro.ceil(sumPnlQty));
		this.ds_LotQty.setColumn(1,"DEFECTQTY",nexacro.ceil(sumPcsQty));
		defectiveRate = (pcsQty/this.Defect.inspectQty)*100;
		this.ds_InspectionList.setColumn(nRow,"DEFECTRATE",defectiveRate);
		
		
		this.GetDecisionDegree();
	}
	catch(ec){
		trace("mfn_defectChangePcsQty ? " + ec.toString());
	}
	
	this.ds_InspectionList.set_enableevent(true);
	this.ds_LotQty.set_enableevent(true);
	
};

this.GetDecisionDegree = function ()
{
	var nRow = this.ds_InspectionList.rowcount == 1 ? 0 : this.ds_InspectionList.rowposition;
	
	
};


/*
 *	최하단 불량 검사 그리드에 원인품목 리스트를 다시 읽어옴. 
 */
this.GetReasonConsumableList = function ()
{
	this.ds_temp.clear();
	this.pfn_DatasetAddColumn(this.ds_temp, "LOTID,LANGUAGETYPE");
	
	this.ds_temp.setColumn(0, "LOTID", this.ds_LotList.getColumn(this.ds_LotList.rowposition, "LOTID"));
	this.ds_temp.setColumn(0, "LANGUAGETYPE", nexacro.getApplication().gds_userInfo.getColumn(0,"gv_languageType"));

	this.pfn_CostomQuery(this.ds_temp, this.ds_ReasonConsumableList, "selectReasonConsumableList");
	
};

/*
 *	최하단 불량 검사 그리드에 원인자재LOT 리스트를 다시 읽어옴. 
 */
this.GetDefectReasonConsumableLot = function ()
{
	this.ds_ReasonConsumableLot.filter("");
	
	this.ds_temp.clear();
	this.pfn_DatasetAddColumn(this.ds_temp, "LOTID,LANGUAGETYPE");
	
	this.ds_temp.setColumn(0, "LOTID", this.ds_LotList.getColumn(this.ds_LotList.rowposition, "LOTID"));
	this.ds_temp.setColumn(0, "LANGUAGETYPE", nexacro.getApplication().gds_userInfo.getColumn(0,"gv_languageType"));

	this.pfn_CostomQuery(this.ds_temp, this.ds_ReasonConsumableLot, "selectDefectReasonConsumableLot");
};

/*
 *	최하단 불량 검사 그리드에 원인공정 리스트를 다시 읽어옴. 
 */
this.GetDefectReasonProcesssegment = function ()
{
	this.ds_ReasonProcessSegment.filter("");
	
	this.ds_temp.clear();
	this.pfn_DatasetAddColumn(this.ds_temp, "LOTID,LANGUAGETYPE");
	
	this.ds_temp.setColumn(0, "LOTID", this.ds_LotList.getColumn(this.ds_LotList.rowposition, "LOTID"));
	this.ds_temp.setColumn(0, "LANGUAGETYPE", nexacro.getApplication().gds_userInfo.getColumn(0,"gv_languageType"));

	this.pfn_CostomQuery(this.ds_temp, this.ds_ReasonProcessSegment, "selectDefectReasonProcesssegment");
};

this.fn_sendEmail = function ()
{
	if(this.ds_result.rowcount <= 1) 
	{
		//QcmService.DoActionAndGetIsSendEmail 의 결과가 false 로 들어왔음. 
		//this.mfn_ClearGetLotList();
		this.mfn_GetCheckLotInspection();
		return;
	}
	
	var mRow = this.ds_LotList.rowcount == 1 ? 0 : this.ds_LotList.rowposition;
	
	var defectCodeName = [];
	for(var i=0;i<this.ds_result.rowcount-1;i++)
	{
		defectCodeName.push(this.ds_result.getColumn(i,"DEFECTCODENAME"));
	}
	 
	var arr = [];
	arr.push( this.nfn_getDictionaryname('PROCESSSEGMENT',true) );
	arr.push( this.ds_LotList.getColumn(mRow,"PROCESSSEGMENTNAME") );
	arr.push( this.ds_LotList.getColumn(mRow,"PROCESSSEGMENTID") );
	arr.push( this.nfn_getDictionaryname('AREA',true) );
	arr.push( this.ds_LotList.getColumn(mRow,"AREANAME") );
	arr.push( this.ds_LotList.getColumn(mRow,"AREAID") );
	arr.push( this.nfn_getDictionaryname('PRODUCTDEFNAME',true) );
	arr.push( this.nfn_getDictionaryname('PRODUCTDEFID',true) );
	arr.push( this.nfn_getDictionaryname('PRODUCTDEFVERSION',true) );
	arr.push( this.ds_LotList.getColumn(mRow,"PRODUCTDEFNAME") );
	arr.push( this.ds_LotList.getColumn(mRow,"PRODUCTDEFID") );
	arr.push( this.ds_LotList.getColumn(mRow,"PRODUCTDEFVERSION") );
	arr.push( this.nfn_getDictionaryname('LOTID',true) );
	arr.push( this.ds_LotList.getColumn(mRow,"LOTID") );
	arr.push( this.nfn_getDictionaryname('DEFECTNAME',true) );	
	arr.push( defectCodeName.join(",") );
	
	var title = this.ds_search.getColumn(0,"INSPECTIONCLASSID")=="SelfInspectionTake" 
			? this.nfn_getDictionaryname('SELFTAKEABNORMALTITLE',true) : this.nfn_getDictionaryname('SELFABNORMALTITLE',true) ;
			
	var emailContent = "○" + arr[0] + ":" + arr[1] + "(" + arr[2] + ")" + "<BR>"
					 + "○" + arr[3] + ":" + arr[4] + "(" + arr[5] + ")" + "<BR>"
					 + "○" + arr[6] + "(" + arr[7] + "/" + arr[8] + "):" +  arr[9] + "(" + arr[10] + "/" + arr[11] + ")" + "<BR>"
					 + "○" + arr[12] + ":" + arr[13] + "<BR>"
					 + "○" + arr[14] + ":" + arr[15] + "<BR>"
	
	var popupId = "EMAIL";
	 var oArg = {
	  subject : title,  //제목
	  contents : emailContent, //메일내용
	  objAddrList : [],  //수신자 배열
	  objUserList : [],   //수신자명 배열
	  atchSrc : "", //"BAS_ITEMMASTER", //업무에서 올려진 파일 첨부시 (테이블)
	  atchSrcKey : "" //"INTERFLEX|10400010A1|FA1"   //업무에서 올려진 파일 첨부시 (키값)
	  };
	 this.gfn_openPopup(popupId,"cmd::CMAM00100P.xfdl",oArg,"width=790,height=790");
};

this.mfn_GetCheckLotInspection = function ()
{
	this.ds_temp.clear();
	this.pfn_DatasetAddColumn(this.ds_temp, "LOTID,INSPECTIONDEFID");
	
	this.ds_temp.setColumn(0, "LOTID", this.ds_LotList.getColumn(this.ds_LotList.rowposition, "LOTID"));
	this.ds_temp.setColumn(0, "INSPECTIONDEFID", "OperationInspection");

	this.pfn_CostomQuerySync(this.ds_temp, this.ds_checkLotInsp, "selectCheckLotInspection");
	
	this.mfn_ClearGetLotList();
	
};

/**************************************************************************
 * 8. 이벤트
 ***************************************************************************/

// 조회 조건 이벤트 [S]
this.btn_AREAID_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.ds_search.setColumn(0,"AREAID",this.tab_search.Tabpage1.form.edt_AREAID.value);
	this.openAREA_P00124("BA", this.ds_search);
};

this.btn_PRODUCTDEFID_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.ds_search.setColumn(0,"PRODUCTDEFID",this.tab_search.Tabpage1.form.edt_PRODUCTDEFID.value);
	this.openProduct_P00105("CA", this.ds_search,"Product");
};


this.btn_LOTID_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.ds_search.setColumn(0,"LOTID",this.tab_search.Tabpage1.form.edt_LOTID.value);
	this.pfn_openPopup_LOTID("SEARCH_LOTID", this.ds_search.getColumn(0,"LOTID"),"CA");
};

this.btn_PROCSEGMENT_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.mfn_OpenProcSegment();
};
// 조회 조건 이벤트 [E]
this.mfn_OpenProcSegment = function ()
{
	var popupId = "SEARCH_SEGMENT";
	var oArg = {};
	
	oArg.plantID = this.pfn_allTrim(this.ds_search.getColumn(0,"PLANTID"));
	oArg.process = this.pfn_allTrim(this.ds_search.getColumn(0,"PROCESSSEGMENTNAME"));
	oArg.ds_result = this.ds_Process;	 
	
	this.gfn_openPopup(popupId,"pcm::PCM00800P.xfdl",oArg,"width=800,height=600");
};

this.ds_LotList_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	if(e.newrow < 0 ) return;
	
	if(this.gfn_dsIsUpdated(this.ds_InspectionList) )
	{
		var bRtn = this.gfn_confirm("WRITTENBEDELETE", "information", ""); //"입력한 내용이 있으면 현재 작성중인 내용이 모두 삭제됩니다."
		if(bRtn == false)  return;
	}
	
	var nRow = e.newrow;
	
	this.ds_InspectionList.clearData();
	
	//최하단 불량 검사 그리드에 원인품목 리스트를 다시 읽어옴. 
	this.GetReasonConsumableList();
	this.GetDefectReasonConsumableLot();
	this.GetDefectReasonProcesssegment();
	
	this.SetInspectionReg(nRow);
	this.SetInspectionHist(nRow);
	
	this.ds_LotQty.setColumn(0,"INSPECTIONQTY",0);
	this.ds_LotQty.setColumn(0,"DEFECTQTY",0);
	this.ds_LotQty.setColumn(1,"DEFECTQTY",0);
};


this.div_RegInspection_btn_InspectionUser_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.openUSER_P00155(this.ds_search,"B");
};

/*
 *	작업장, 공정 값 clear 에 대해 ID 도 함께 clear
 */
this.ds_search_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid == "AREANAME" && this.pfn_allTrim(this.ds_search.getColumn(0,"AREANAME")) == "") this.ds_search.setColumn(0,"AREAID","");
	if(e.columnid == "PROCESSSEGMENTNAME"&& this.pfn_allTrim(this.ds_search.getColumn(0,"PROCESSSEGMENTNAME")) == "") this.ds_search.setColumn(0,"PROCESSSEGMENTID","");
};

this.btnAddRow_ds_InspectionList_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if(this.ds_LotList.rowcount == 0)
	{
		this.gfn_Message("NotSeletedLot", "", "warning", "ok");
		return;
	}
	
	var nRow = this.ds_InspectionList.addRow();

};




this.defectProcessListControl_SetGridQtyClear = function ()
{
	for(var i=0;i<this.ds_InspectionList.rowcount;i++)
	{
		this.ds_InspectionList.setColumn(i,"PNLQTY",0);
		this.ds_InspectionList.setColumn(i,"QTY",0);
		this.ds_InspectionList.setColumn(i,"DEFECTRATE",0);
	}
};

this.defectProcessListControl_SetResultData = function (lotId,pcsQty, pcsPnl)
{
	this.Defect.SelectedLotId = lotId;
	this.Defect.pcsPnl = pcsPnl;
	this.Defect.InspectionDefId = this.ds_search.getColumn(0,"INSPECTIONCLASSID");
	this.Defect.panelPerQty = pcsPnl;
	this.Defect.qty = pcsQty;
	this.defectProcessListControl_SetConsumableDefComboBox();
};

this.defectProcessListControl_SetConsumableDefComboBox = function ()
{
	
};

/*
 *	검사 결과 등록 탭에 검사 수량 입력 시 validation. 
 */
this.ds_LotQty_cancolumnchange = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.newrow < 0) return;
	if(this.ds_LotList.rowcount == 0) {
		this.gfn_Message("NeedSearch", "", "warning", "ok");
		return false;
	}
	
	var insQty = e.newvalue;//nexacro.toNumber(this.ds_LotQty.getColumn(e.newrow, "INSPECTIONQTY"));
	var workQty = nexacro.toNumber(this.ds_LotQty.getColumn(e.newrow, "WORKQTY"));
	if(workQty < insQty)
	{
		var arg = [this.nfn_getDictionaryname('INSPECTIONQTY',true), this.nfn_getDictionaryname('WORKQTY',true)]
		this.gfn_Message("CanNotToMuch", arg, "warning", "ok");
		return false;
	}
};


/*
 *	검사 결과 등록 탭에 검사 수량 입력 시 이벤트. 
 */
this.ds_LotQty_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.row < 0) return;
	try{
	
		this.ds_LotQty.set_enableevent(false);
		this.ds_InspectionList.set_enableevent(false);
		
		var mRow = this.ds_LotList.rowcount == 1 ? 0 : this.ds_LotList.rowposition;
		
		this.defectProcessListControl_SetGridQtyClear(); 
		
		var pcsPnl = nexacro.round(this.ds_LotList.getColumn(mRow, "PCSPNL"));
		if(e.columnid == "INSPECTIONQTY")
		{
			if(e.row == 0) this.Defect.inspectQty = e.newvalue * pcsPnl;
			else  this.Defect.inspectQty = e.newvalue ;
		}
		
		switch(e.row) {
		case 0://PNL Row
			var pnlQty = nexacro.toNumber(this.ds_LotQty.getColumn(0, "INSPECTIONQTY"));
			var result = this.mfn_ChangePnlQty(pnlQty, pcsPnl); // pnlQty * pcsPnl;
			this.ds_LotQty.setColumn(1,"INSPECTIONQTY",result);
			break;
		case 1://PCS Row
			var pcsQty = nexacro.toNumber(this.ds_LotQty.getColumn(1, "INSPECTIONQTY"));
			var result = this.mfn_ChangePcsQty(pcsQty, pcsPnl); // pcsQty / pcsPnl
			this.ds_LotQty.setColumn(0,"INSPECTIONQTY",result);
			break;
		default:
		}
	}
	catch(ec)
	{
		trace("ds_LotList_canrowposchange ? " + ec.toString());
		this.ds_LotQty.setColumn(e.row,e.col,e.oldvalue);
	}
	this.ds_LotQty.getAvg()
	this.ds_LotQty.set_enableevent(true);
	this.ds_InspectionList.set_enableevent(true);
};



this.grdInspectionList_oncellclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	if (e.fromreferenceobject.name == "cellbutton" || e.col == 7) 
	{
		if(this.nfn_isNull(this.ds_InspectionList.getColumn(e.row, "DEFECTCODE")) )
		{
			this.gfn_Message("NoDefectCode", "", "warning", "ok");
			return;
		}
		else if (this.ds_InspectionList.getColumn(e.row, "QTY") == 0 )
		{
			this.gfn_Message("CheckRegDefectQty", "", "warning", "ok");
			return;
		}
// 		else if(this.nfn_isNull(this.ds_InspectionList.getColumn(e.row, "REASONPROCESSSEGMENTID")) )
// 		{
// 			this.gfn_Message("MustInputCauseProcesssegmentId", "", "warning", "ok");
// 			return;
// 		}
		
		this.fn_attach();
	}
	
}; 

this.grdInspectionList_onexpandup = function(obj:nexacro.Grid,e:nexacro.GridMouseEventInfo)
{
	if(e.row <0) return;
	
	/* Form 에서 Grid Cell 기준으로 위치얻기 */
	var objRect = obj.getCellRect(e.row, e.cell);

	/* cell 기준 position으로 클라이언트 기준 X, Y 좌표를 스크린 기준 기준으로 바꾸어 위치얻기 */
	var nLeft = system.clientToScreenX(obj, objRect.left);
	var nTop = system.clientToScreenY(obj, objRect.bottom);

	/* 스크린 기준 X, Y 좌표를 클라이언트 기준으로 바꾸어 위치얻기 */
	nLeft = system.screenToClientX(nexacro.getApplication().mainframe, nLeft);
	nTop = system.screenToClientY(nexacro.getApplication().mainframe, nTop);	
	
	if (this.nfn_isEqualCol(obj, e.cell, "SEGMENT_DEFECTCODE")) 
	{
		this.mfn_OpenDefectPopup();
	}
	else if (this.nfn_isEqualCol(obj, e.cell, "CONSUMABLEDEFNAME")) 
	{
		this.pdv_ReasonConsumableList.show();
		this.pdv_ReasonConsumableList.trackPopup(nLeft, nTop,  this.pdv_ReasonConsumableList.width, this.pdv_ReasonConsumableList.height, "fn_Callback_pdv_ReasonConsumableList");
	} else if (this.nfn_isEqualCol(obj, e.cell, "REASONPROCESSSEGMENTNAME")) 
	{
		this.ds_ReasonProcessSegment.filter("");
		if(this.nfn_isNull(this.ds_InspectionList.getColumn(e.row,"REASONCONSUMABLELOTID"))==false && this.ds_InspectionList.getColumn(e.row,"REASONCONSUMABLELOTID") != ""){
			this.ds_ReasonProcessSegment.filter("LOTID == '" + this.ds_InspectionList.getColumn(e.row,"REASONCONSUMABLELOTID") + "'")
		}
		this.pdv_ReasonProcessSegment.show();
		this.pdv_ReasonProcessSegment.trackPopup(nLeft, nTop,  this.pdv_ReasonProcessSegment.width, this.pdv_ReasonProcessSegment.height, "fn_Callback_pdv_ReasonProcessSegment");
	}
	
};


this.mfn_OpenDefectPopup = function ()
{
	var mRow = this.ds_LotList.rowcount == 1 ? 0 : this.ds_LotList.rowposition;
	var nRow = this.ds_InspectionList.rowcount == 1 ? 0 : this.ds_InspectionList.rowposition;

	var popupId = "SEARCH_DEFECT"; 
	var lotID = this.ds_LotList.getColumn(mRow, "LOTID");
	var defectID = this.ds_InspectionList.getColumn(nRow,"DEFECTCODE");
	var qcSegmentID = this.ds_InspectionList.getColumn(nRow,"QCSEGMENTID");
	var language = this.gf_getLanguageType();

	var oArg = {};
	oArg.arg_type = "BA"; 
	oArg.arg_popupCd = "P00241";
	oArg.arg_popupNm = "";
	oArg.arg_rtnCols = "DEFECTCODE|DEFECTCODENAME|QCSEGMENTID|QCSEGMENTNAME|DECISIONDEGREE|SEGMENT_DEFECTCODE|SEGMENT_DEFECTNAME";
	oArg.arg_paramCols = "LOTID|SEGMENTID|LANGUAGETYPE|VERSION";
	oArg.arg_paramValues = lotID + "|" + this.DefectSegments+"|"+this.gf_getLanguageType()+"|10003";
	oArg.arg_searchStr = "1=1";//defectID == "" ? "" : "DEFECTCODENAME=" + defectID + "|QCSEGMENTIDNAME="+qcSegmentID;
	
	this.gfn_openPopup(popupId,"cmd::CMSA00100P.xfdl",oArg,"width=800,height=800");
};

/*
 *	하단 불량 그리드에 데이타 validate
 */
this.ds_InspectionList_cancolumnchange = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	switch(e.columnid) {
	case "PNLQTY" :
		{
			var pnlQty = nexacro.toNumber(this.ds_LotQty.getColumn(0,"INSPECTIONQTY"));
			if(e.newvalue !="0" && pnlQty == 0) {
				this.gfn_Message("NoInspectionQtyAndPnl", null, "warning", "ok");//검사 수량을(를) 먼저 입력하세요.
				return false;
			}
			var pnlQtySum = this.ds_InspectionList.getSum("PNLQTY") + e.newvalue - e.oldvalue;
			if(pnlQty < pnlQtySum ){
				var arg = [this.nfn_getDictionaryname('DEFECTQTY',true), this.nfn_getDictionaryname('INSPECTIONQTY',true)];
				this.gfn_Message("CanNotToMuch", arg, "warning", "ok");//불량 수량은(는) 검사 수량보다 많을 수 없습니다.
				return false;
			}
			break;
		}
	case "QTY" :
		{
			var pcsQty = nexacro.toNumber(this.ds_LotQty.getColumn(1,"INSPECTIONQTY"));
			if(e.newvalue !="0" && this.ds_LotQty.getColumn(1,"INSPECTIONQTY") == "0") {
				this.gfn_Message("NoInspectionQtyAndPnl", null, "warning", "ok");//검사 수량을(를) 먼저 입력하세요.
				return false;
			}
			
			var pcsQtySum = this.ds_InspectionList.getSum("QTY") + e.newvalue - e.oldvalue;
			if(pcsQty < pcsQtySum ){
				var arg = [this.nfn_getDictionaryname('DEFECTQTY',true), this.nfn_getDictionaryname('INSPECTIONQTY',true)];
				this.gfn_Message("CanNotToMuch", arg, "warning", "ok");//불량 수량은(는) 검사 수량보다 많을 수 없습니다.
				return false;
			}
			break;
		}
	}
};

/*
 *	하단 불량 그리드에 데이타 입력하면 
 */
this.ds_InspectionList_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.newvalue < 0 ) return;
	switch(e.columnid) {
	case "SPLITCONSUMABLEDEFIDVERSION":
		this.ds_ReasonConsumableLot.filter("");
		this.ds_ReasonConsumableLot.filter("SPLITCONSUMABLEDEFIDVERSION == '" + e.newvalue + "'")
		break;
	case "REASONPROCESSSEGMENTNAME" :
		this.ds_ReasonProcessSegment.filter("");
		this.ds_ReasonProcessSegment.filter("LOTID == '" + e.newvalue + "'")
		break;
	case "PNLQTY" :
		this.mfn_defectChangePnlQty(e.newvalue);
		break;
	case "QTY" :
		this.mfn_defectChangePcsQty(e.newvalue);
		break;
	default:
	}
};

/*
 *	행 추가 되면 초기값 설정
 */
this.ds_InspectionList_onrowsetchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowsetChangeEventInfo)
{
	if(e.reason == 12) //Dataset.REASON_APPEND - 12 Dataset이 추가되었 때 
	{
		this.ds_InspectionList.set_enableevent(false);
		var mRow = this.ds_LotList.rowcount == 1 ? 0 : this.ds_LotList.rowposition;
		
		this.ds_InspectionList.setColumn(e.row,"LOTID",this.ds_LotList.getColumn(mRow,"LOTID"));
		this.ds_InspectionList.setColumn(e.row,"UNIT","");
		this.ds_InspectionList.setColumn(e.row,"PNLQTY",0);
		this.ds_InspectionList.setColumn(e.row,"QTY",0);
		this.ds_InspectionList.setColumn(e.row,"DEFECTRATE",0);
		this.ds_InspectionList.setColumn(e.row,"ISUPLOAD","N");
		
		this.ds_InspectionList.setColumn(e.row,"DEGREE", nexacro.toNumber(this.ds_LotList.getColumn(mRow, "DEGREE1")) + 1);
		this.ds_InspectionList.setColumn(e.row,"REASONCODEID","LockSelfExamNonconfirm");
		this.ds_InspectionList.setColumn(e.row,"TXNHISTKEY",this.GetTXNHISTKEY());
		
		this.ds_ReasonProcessSegment.filter("");
		
		this.ds_InspectionList.set_enableevent(true);
	}
};

/*
 * 선택하면 좌측 이미지 변경 됨
 */
this.ds_InspectionList_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	var nRow = this.ds_InspectionList.rowcount == 1 ? 0 : this.ds_InspectionList.rowposition;
	
	var filterString = "ATCH_FILE_ID == '" + this.ds_InspectionList.getColumn(nRow,"IMAGERESOURCEID") + "'"
	this.ds_fileCombo.filter();
	this.ds_fileCombo.filter(filterString);
	
	if(this.ds_fileCombo.rowcount > 0)
	{
		var atchFileGuid = this.ds_fileCombo.getColumn(0,"ATCH_FILE_GUID");
		var upUrl = nexacro.getEnvironment().services["svcurl"].url +"/comm/downImage/" + atchFileGuid + ".do";
		this.div_work.form.tab_Main.Tabpage1.form.imageViewer.set_image(upUrl);
		this.div_work.form.tab_Main.Tabpage1.form.cbo_Image.set_value(atchFileGuid);
	} 
	else 
	{
		this.div_work.form.tab_Main.Tabpage1.form.cbo_Image.set_value("");
		this.div_work.form.tab_Main.Tabpage1.form.imageViewer.set_image("");
	}
	
};



/*
 *	원인 품목 셀 팝업 그리드 활성화 
 */
this.pdv_ReasonConsumableList_grd_ReasonConsumableList_oncelldblclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	//값 받아서 처리 로직 넣으세요
	var idver = this.ds_ReasonConsumableList.getColumn(this.ds_ReasonConsumableList.rowposition,"SPLITCONSUMABLEDEFIDVERSION");
	var prodName = this.ds_ReasonConsumableList.getColumn(this.ds_ReasonConsumableList.rowposition,"CONSUMABLEDEFNAME");
	var prodID = this.ds_ReasonConsumableList.getColumn(this.ds_ReasonConsumableList.rowposition,"CONSUMABLEDEFID");
	var prodVer = this.ds_ReasonConsumableList.getColumn(this.ds_ReasonConsumableList.rowposition,"CONSUMABLEDEFVERSION");
	
	this.ds_InspectionList.setColumn(this.ds_InspectionList.rowposition,"SPLITCONSUMABLEDEFIDVERSION",idver);
	this.ds_InspectionList.setColumn(this.ds_InspectionList.rowposition,"CONSUMABLEDEFNAME",prodName);
	this.ds_InspectionList.setColumn(this.ds_InspectionList.rowposition,"REASONCONSUMABLEDEFID",prodID);
	this.ds_InspectionList.setColumn(this.ds_InspectionList.rowposition,"REASONCONSUMABLEDEFVERSION",prodVer);

	this.pdv_ReasonConsumableList.closePopup();
};

/*
 *	원인 공정 셀 팝업 그리드 활성화 
 */
this.pdv_ReasonProcessSegment_grd_ReasonProcessSegment_oncelldblclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	var segName = this.ds_ReasonProcessSegment.getColumn(this.ds_ReasonProcessSegment.rowposition,"PROCESSSEGMENTNAME");
	var segID = this.ds_ReasonProcessSegment.getColumn(this.ds_ReasonProcessSegment.rowposition,"PROCESSSEGMENTID");
	var aeraID = this.ds_ReasonProcessSegment.getColumn(this.ds_ReasonProcessSegment.rowposition,"AREAID");
	var aeraName = this.ds_ReasonProcessSegment.getColumn(this.ds_ReasonProcessSegment.rowposition,"AREANAME");
	
	this.ds_InspectionList.setColumn(this.ds_InspectionList.rowposition,"REASONPROCESSSEGMENTID",segID);
	this.ds_InspectionList.setColumn(this.ds_InspectionList.rowposition,"REASONPROCESSSEGMENTNAME",segName);
	this.ds_InspectionList.setColumn(this.ds_InspectionList.rowposition,"REASONAREAID",aeraID);
	this.ds_InspectionList.setColumn(this.ds_InspectionList.rowposition,"REASONAREANAME",aeraName);

	this.pdv_ReasonProcessSegment.closePopup();
};




/*
 *	사진 등록
 */
this.fn_attach = function ()
{
	var mRow = this.ds_LotList.rowcount == 1 ? 0 : this.ds_LotList.rowposition;
	var nRow = this.ds_InspectionList.rowcount == 1 ? 0 : this.ds_InspectionList.rowposition;  
	var srcKey = "";
	if(nRow >= 0 ) {//bind:DEFECTCODE
		srcKey = this.ds_InspectionList.getColumn(nRow, "TXNHISTKEY") 
				+ "|" + this.ds_search.getColumn(0,"INSPECTIONCLASSID")
			    + "|" + this.ds_InspectionList.getColumn(nRow, "LOTID") 
			    + "|" + this.ds_InspectionList.getColumn(nRow, "DEFECTCODE") 
				+ "|" + this.ds_LotList.getColumn(mRow, "PROCESSSEGMENTID") 
			   ;
	} else {
		this.gfn_Message("NoSelections", "", "warning", "ok");
		return;
	}
	
	var jobSysCd = "PCM"; 					//업무구분코드 CMD,BAS....
	var subDir = ""; 				//세부업무약어	
	var resouceid = srcKey;					//테이블의 키 값
	var resourcetype = "QAM_INSPECTIONDEFECT"; 	//테이블명  
	var comments = "자주검사(불량)"; 		//파일설명
	var fileCnt = null; 					//업로드수
	var oArg = {arg_jobSysCd:jobSysCd
				,arg_atchSrcKey:resouceid 
				,arg_tableName:resourcetype 
				,arg_desc:comments
				,arg_subDir:subDir
				,arg_fileCnt:fileCnt
				,ds_file:this.ds_file
				};
	this.gfn_openPopup("file_upload","pcm::PCM01500P.xfdl",oArg,"");
};


// this.tab_search_Tabpage1_edt_AREAID_onkeydown = function(obj:nexacro.Edit,e:nexacro.KeyEventInfo)
// {
// 	if (e.keycode != 13) return;
// 	
// 	this.ds_search.setColumn(0,"AREAID",obj.value);
// 	this.openAREA_P00124("BA", this.ds_search);
// };



this.div_work_tab_Main_Tabpage1_cbo_Image_onitemchanged = function(obj:nexacro.Combo,e:nexacro.ItemChangeEventInfo)
{
	var atchFileGuid = e.postvalue;
	var upUrl = nexacro.getEnvironment().services["svcurl"].url +"/comm/downImage/" + atchFileGuid + ".do";
	this.div_work.form.tab_Main.Tabpage1.form.imageViewer.set_image(upUrl);
};
]]></Script>
    <Bind>
      <BindItem id="item0" compid="tab_search.Tabpage1.form.edt_AREAID" propid="value" datasetid="ds_search" columnid="AREANAME"/>
      <BindItem id="item1" compid="tab_search.Tabpage1.form.edt_PRODUCTDEFID" propid="value" datasetid="ds_search" columnid="PRODUCTDEFID"/>
      <BindItem id="item2" compid="tab_search.Tabpage1.form.cbo_PRODUCTDEFVERSION" propid="value" datasetid="ds_search" columnid="PRODUCTDEFVERSION"/>
      <BindItem id="item3" compid="tab_search.Tabpage1.form.edt_PRODUCTDEFNAME" propid="value" datasetid="ds_search" columnid="PRODUCTDEFNAME"/>
      <BindItem id="item4" compid="tab_search.Tabpage1.form.edt_LOTID" propid="value" datasetid="ds_search" columnid="LOTID"/>
      <BindItem id="item5" compid="tab_search.Tabpage1.form.edt_PROCSEGMENT" propid="value" datasetid="ds_search" columnid="PROCESSSEGMENTNAME"/>
      <BindItem id="item6" compid="div_work.form.tab_Main.Tabpage1.form.div_RegInspection.form.edt_AREA" propid="value" datasetid="ds_LotList" columnid="CURAREANAME"/>
      <BindItem id="item7" compid="div_work.form.tab_Main.Tabpage1.form.div_RegInspection.form.edt_LOTID" propid="value" datasetid="ds_LotList" columnid="LOTID"/>
      <BindItem id="item8" compid="div_work.form.tab_Main.Tabpage1.form.div_RegInspection.form.edt_InspectionUser" propid="value" datasetid="ds_search" columnid="INS_USERNAME"/>
      <BindItem id="item9" compid="div_work.form.tab_Main.Tabpage1.form.div_RegInspection.form.edt_ReinspectReason" propid="value" datasetid="ds_search" columnid="REINS_REASON"/>
      <BindItem id="item10" compid="tab_search.Tabpage1.form.cbo_PRODUCTDIVISION" propid="value" datasetid="ds_search" columnid="PRODUCTDIVISION"/>
    </Bind>
  </Form>
</FDL>
