<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="PCM00300M" width="1258" height="747" titletext="LOT 생성" onload="fn_init">
    <Layouts>
      <Layout height="747" width="1258">
        <Tab id="tab_search" taborder="0" tabindex="0" left="0" top="47" width="290" cssclass="tab_search" bottom="0">
          <Tabpages>
            <Tabpage id="Tabpage1" text="Tabpage1">
              <Layouts>
                <Layout>
                  <Static id="label00" taborder="10" text="완료여부" left="0" top="10" width="103" height="20" cssclass="sta_WF_label_point" tooltiptext="ISCOMPLETION"/>
                  <Combo id="cmb_ISSPLIT" taborder="0" text="N" left="108" top="10" height="20" index="0" value="N" width="165" innerdataset="innerdataset" codecolumn="codecolumn" datacolumn="datacolumn">
                    <Dataset id="innerdataset">
                      <ColumnInfo>
                        <Column id="codecolumn" size="256"/>
                        <Column id="datacolumn" size="256"/>
                      </ColumnInfo>
                      <Rows>
                        <Row>
                          <Col id="codecolumn">N</Col>
                          <Col id="datacolumn">N</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">Y</Col>
                          <Col id="datacolumn">Y</Col>
                        </Row>
                      </Rows>
                    </Dataset>
                  </Combo>
                  <Static id="label01" taborder="11" text="S/O번호" left="0" top="35" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PRODUCTIONORDERID"/>
                  <Static id="label02" taborder="12" text="라인" left="0" top="60" width="103" height="20" cssclass="sta_WF_label" tooltiptext="LINENO"/>
                  <Edit id="edt_productionOrderId" taborder="1" left="108" top="35" height="20" right="37"/>
                  <Button id="btn_clear" taborder="9" top="175" width="102" height="36" cssclass="btn_SA_reset" left="171" text="초기화" tooltiptext="초기화"/>
                  <Button id="btn_search" taborder="8" top="175" width="146" height="36" cssclass="btn_SA_search" left="15" text="검색" tooltiptext="검색"/>
                  <Static id="guidetip00" taborder="13" text="w&#13;&#10;15" width="15" top="70" visible="false" height="97" cssclass="guideTip" right="0"/>
                  <Static id="guidetip01" taborder="14" text="w&#13;&#10;15" width="15" top="80" visible="false" height="97" cssclass="guideTip" left="0"/>
                  <Static id="guidetip02" taborder="15" text="h10" width="45" top="0" visible="false" height="10" cssclass="guideTip" right="91"/>
                  <Static id="guidetip03" taborder="16" text="h5" width="45" top="30" visible="false" height="5" cssclass="guideTip" right="91"/>
                  <Static id="guidetip04" taborder="17" text="h20" width="45" top="155" visible="false" height="20" cssclass="guideTip" right="91"/>
                  <Static id="guidetip05" taborder="18" text="w&#13;&#10;10" width="10" top="181" visible="false" height="27" cssclass="guideTip" left="161"/>
                  <Static id="label03" taborder="19" text="품목코드" left="0" top="85" width="103" height="20" cssclass="sta_WF_label" tooltiptext="ITEMCODE"/>
                  <Button id="btn_productionOrderId" taborder="2" width="22" height="20" cssclass="btn_WF_finder" top="35" right="15" onclick="tab_search_Tabpage1_btn_productionOrderId_onclick"/>
                  <Static id="label05" taborder="20" text="생산구분" left="0" top="135" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PRODUCTIONTYPENAME"/>
                  <Static id="label04" taborder="21" text="Lot 생성여부" left="0" top="110" width="103" height="20" cssclass="sta_WF_label" tooltiptext="E3537B33EFE14DD3B402E11E43A3E18D"/>
                  <Combo id="cmb_lineNo" taborder="3" text="전체조회" left="108" top="60" height="20" codecolumn="CODEID" datacolumn="COCENM" index="0" value=" " width="165" innerdataset="ds_lineNo"/>
                  <Combo id="cmb_ISCREATE" taborder="6" text="N" left="108" top="110" height="20" index="0" value="N" width="165" innerdataset="innerdataset" codecolumn="codecolumn" datacolumn="datacolumn">
                    <Dataset id="innerdataset">
                      <ColumnInfo>
                        <Column id="codecolumn" size="256"/>
                        <Column id="datacolumn" size="256"/>
                      </ColumnInfo>
                      <Rows>
                        <Row>
                          <Col id="codecolumn">N</Col>
                          <Col id="datacolumn">N</Col>
                        </Row>
                        <Row>
                          <Col id="codecolumn">Y</Col>
                          <Col id="datacolumn">Y</Col>
                        </Row>
                      </Rows>
                    </Dataset>
                  </Combo>
                  <Combo id="cmb_productionType" taborder="7" text="CCT" left="108" top="135" height="20" codecolumn="C,ProductionType,ALL,Y,Y" index="1" value="" width="165"/>
                  <Edit id="edt_productDefId" taborder="4" left="108" top="85" height="20" right="37"/>
                  <Button id="btn_productDefId" taborder="5" width="22" height="20" cssclass="btn_WF_finder" top="85" right="15" onclick="tab_search_Tabpage1_btn_productCode_onclick"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Static id="sta_searchTitle" taborder="1" text="검색조건" left="0" top="47" width="290" height="34" cssclass="sta_WF_subTitle" usedecorate="true"/>
        <Div id="div_work" taborder="2" text="div_00" left="300" top="47" right="0" bottom="0" onclick="div_work_onclick">
          <Layouts>
            <Layout>
              <Grid id="grd_lotList" taborder="2" left="0" right="0" autoenter="select" top="77.57%" binddataset="ds_lot" bottom="0">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="150"/>
                      <Column size="230"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="품목코드"/>
                      <Cell col="1" text="Lot No."/>
                      <Cell col="2" text="수량(PNL)"/>
                      <Cell col="3" text="수량(PCS)" tooltiptext="QTY_PCS"/>
                      <Cell col="4" text="순투입"/>
                      <Cell col="5" text="과투입량" tooltiptext="OVERINPUTQTY"/>
                      <Cell col="6" text="실투입로스" tooltiptext="ACTUALINPUTLOSS"/>
                      <Cell col="7" text="순수주로스" tooltiptext="PUREORDERLOSS"/>
                      <Cell col="8" text="투입여부"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:PRODUCTDEFID" textAlign="left"/>
                      <Cell col="1" text="bind:LOTID" textAlign="left"/>
                      <Cell col="2" text="bind:PNLQTY" textAlign="right" maskeditformat="#,##0" displaytype="mask"/>
                      <Cell col="3" text="bind:QTY" textAlign="right" maskeditformat="#,##0" displaytype="mask"/>
                      <Cell col="4" text="bind:PUREINPUT" displaytype="mask" maskeditformat="#,##0" textAlign="right"/>
                      <Cell col="5" text="bind:PUREINPUTLOSS" textAlign="right" maskeditformat="#,##0" displaytype="mask"/>
                      <Cell col="6" text="bind:LOSSRATE" textAlign="right" maskeditformat="#,##0.#0" displaytype="mask"/>
                      <Cell col="7" text="bind:PUREORDER" textAlign="right" maskeditformat="#,##0.#0" displaytype="mask"/>
                      <Cell col="8" text="bind:ISINPUT"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Grid id="grd_product" taborder="3" left="0" right="0" binddataset="ds_product" autoenter="select" top="51.14%" bottom="grd_lotList:33" onheadclick="div_work_grd_product_onheadclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="48"/>
                      <Column size="150"/>
                      <Column size="300"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="138"/>
                      <Column size="129"/>
                      <Column size="97"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell displaytype="checkboxcontrol" edittype="checkbox"/>
                      <Cell col="1" text="품목코드"/>
                      <Cell col="2" text="품목명"/>
                      <Cell col="3" text="Roll/Sheet"/>
                      <Cell col="4" text="수량(PNL)"/>
                      <Cell col="5" text="Lot Size"/>
                      <Cell col="6" text="수량"/>
                      <Cell col="7" text="접합수"/>
                      <Cell col="8" text="단위"/>
                      <Cell col="9" text="실투입로스"/>
                      <Cell col="10" text="순수주로스"/>
                      <Cell col="11" text="Lot생성여부"/>
                    </Band>
                    <Band id="body">
                      <Cell displaytype="checkboxcontrol" edittype="checkbox" text="bind:CHK"/>
                      <Cell col="1" text="bind:PRODUCTDEFID" textAlign="left"/>
                      <Cell col="2" text="bind:PRODUCTDEFNAME" textAlign="left"/>
                      <Cell col="3" text="bind:RTRSHT" displaytype="normal" combocodecol="C,RTRSHT,,Y,N" textAlign="center"/>
                      <Cell col="4" text="bind:PNLQTY" maskeditformat="#,##0" displaytype="mask" textAlign="right" edittype="mask"/>
                      <Cell col="5" text="bind:LOTSIZE" maskeditformat="#,##0" displaytype="mask" textAlign="right" edittype="mask"/>
                      <Cell col="6" text="bind:QTY" maskeditformat="#,##0" displaytype="mask" textAlign="right"/>
                      <Cell col="7" text="bind:JOINTQTY" maskeditformat="#,##0" displaytype="mask" textAlign="right"/>
                      <Cell col="8" text="bind:UNIT" displaytype="normal" textAlign="center"/>
                      <Cell col="9" text="bind:ACTUALINPUTLOSS" displaytype="mask" maskeditformat="#,##0.#0" textAlign="right"/>
                      <Cell col="10" text="bind:PUREORDERLOSS" displaytype="mask" maskeditformat="#,##0.#0" textAlign="right"/>
                      <Cell col="11" text="bind:ISLOTCREATE"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Div id="div_detail" taborder="5" left="0" cssclass="div_WF_detail" text="" right="0" height="66" bottom="grd_product:34">
                <Layouts>
                  <Layout>
                    <Static id="label05" taborder="15" text="기준로스" left="59.50%" top="10" width="9.19%" height="20" cssclass="sta_WF_detailLabel2"/>
                    <Static id="label10" taborder="16" text="기준투입(PNL)" left="59.50%" top="35" width="9.19%" height="20" cssclass="sta_WF_detailLabel2_P" tooltiptext="STANDARDINPUTPNL"/>
                    <Static id="label02" taborder="9" text="순수주" left="0" top="10" width="9.19%" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="PUREORDER"/>
                    <Static id="label07" taborder="10" text="잉여재고" left="0" top="35" width="9.19%" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="SURPLUSSTOCK"/>
                    <Static id="label08" taborder="11" text="잉여재공" left="19.94%" top="35" width="9.19%" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="SURPLUSWIP"/>
                    <Static id="label04" taborder="12" text="기준투입(PCS)" left="39.67%" top="10" width="9.19%" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="STANDARDINPUTPCS" visible="false"/>
                    <Static id="label09" taborder="13" text="부족" left="39.67%" top="35" width="9.19%" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="LACKQTY"/>
                    <Static id="label03" taborder="14" text="순투입" left="19.94%" top="10" width="9.19%" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="PUREINPUT"/>
                    <Static id="label11" taborder="17" text="Lot Size" left="79.5%" top="35" width="9.00%" height="20" cssclass="sta_WF_detailLabel2_P" tooltiptext="LOTSIZE"/>
                    <MaskEdit id="msk_LotSize" taborder="8" left="label11:10" top="35" width="90" height="20" format="#,##0" onkeyup="div_work_div_detail_msk_LotSize_onkeyup"/>
                    <MaskEdit id="msk_StandardInputPnl" taborder="7" left="label10:10" top="35" height="20" format="#,##0" right="label11:0" onkeyup="div_work_div_detail_msk_StandardInputPnl_onkeyup"/>
                    <MaskEdit id="msk_LackQty" taborder="6" left="label09:10" top="35" height="20" format="#,##0" right="label10:0" onkeyup="div_work_div_detail_msk_LackQty_onkeyup"/>
                    <MaskEdit id="msk_SurplusWip" taborder="5" left="label08:10" top="35" height="20" format="#,##0" right="label09:0" onkeyup="div_work_div_detail_msk_SurplusWip_onkeyup"/>
                    <MaskEdit id="msk_SurplusStock" taborder="4" left="label07:10" top="35" height="20" format="#,##0" right="label08:0" onkeyup="div_work_div_detail_msk_SurplusStock_onkeyup"/>
                    <MaskEdit id="msk_PureInput" taborder="1" left="label03:10" top="10" height="20" format="#,##0" right="label04:0" readonly="true"/>
                    <MaskEdit id="msk_PureOrder" taborder="0" left="label02:10" top="10" height="20" format="#,##0" right="label03:0" readonly="true"/>
                    <MaskEdit id="msk_StandardInputPCS" taborder="2" left="label04:10" top="10" height="20" format="#,##0" right="label05:0" readonly="true" visible="false"/>
                    <MaskEdit id="msk_StandardLoss" taborder="3" left="label05:10" top="10" height="20" format="#,##0.#0" right="label11:0" readonly="true"/>
                  </Layout>
                </Layouts>
              </Div>
              <Grid id="grd_productionOrder" taborder="0" left="0" top="34" binddataset="ds_productionOrder" autoenter="select" right="0" bottom="div_detail:10" oncellclick="div_work_grd_productionOrder_oncellclick">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="123"/>
                      <Column size="112"/>
                      <Column size="80"/>
                      <Column size="143"/>
                      <Column size="110"/>
                      <Column size="200"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="생산구분" displaytype="text"/>
                      <Cell col="1" text="S/O번호" displaytype="text"/>
                      <Cell col="2" text="라인" displaytype="text"/>
                      <Cell col="3" text="품목코드" displaytype="text"/>
                      <Cell col="4" text="Rev" displaytype="text"/>
                      <Cell col="5" text="품목명" displaytype="text"/>
                      <Cell col="6" text="단가" displaytype="text"/>
                      <Cell col="7" text="층수" displaytype="text"/>
                      <Cell col="8" text="합수" displaytype="text"/>
                      <Cell col="9" text="산출수" displaytype="text" tooltiptext="CALCULATION"/>
                      <Cell col="10" text="수주량" displaytype="text"/>
                      <Cell col="11" text="PNL" displaytype="text"/>
                      <Cell col="12" text="면적" displaytype="text" maskeditformat="#,##0" tooltiptext="EXTENT"/>
                      <Cell col="13" text="완료여부" displaytype="text" tooltiptext="ISCOMPLETION"/>
                      <Cell col="14" text="Lot생성여부" displaytype="text"/>
                      <Cell col="15" text="사양결재여부" displaytype="text"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:PRODUCTIONTYPE" displaytype="combotext" combocodecol="C,ProductionType,,Y,N" textAlign="center"/>
                      <Cell col="1" text="bind:PRODUCTIONORDERID" textAlign="center"/>
                      <Cell col="2" text="bind:LINENO" displaytype="normal" textAlign="center"/>
                      <Cell col="3" text="bind:PRODUCTDEFID" textAlign="center"/>
                      <Cell col="4" text="bind:PRODUCTDEFVERSION" textAlign="center"/>
                      <Cell col="5" text="bind:PRODUCTDEFNAME" textAlign="left"/>
                      <Cell col="6" text="bind:SALESPRICE" displaytype="mask" maskeditformat="#,##0" textAlign="right"/>
                      <Cell col="7" text="bind:LAYER" textAlign="center"/>
                      <Cell col="8" text="bind:PCSPNL" maskeditformat="#,##0" displaytype="mask" textAlign="right"/>
                      <Cell col="9" text="bind:PCSMM" displaytype="mask" textAlign="right"/>
                      <Cell col="10" text="bind:PLANQTY" displaytype="mask" maskeditformat="#,##0" textAlign="right"/>
                      <Cell col="11" text="bind:PLANPNLQTY" maskeditformat="#,##0" textAlign="right" displaytype="mask"/>
                      <Cell col="12" text="bind:PLANMM" textAlign="right" maskeditformat="#,##0.#0" displaytype="mask"/>
                      <Cell col="13" text="bind:ISSPLIT" textAlign="center"/>
                      <Cell col="14" text="bind:ISLOTCREATE" textAlign="center"/>
                      <Cell col="15" text="bind:ISSPECAPPROVE" textAlign="center"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="title2" taborder="1" text="품목 리스트" left="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" bottom="grd_product:0" width="130" fittocontents="width" tooltiptext="GRIDPRODUCTLIST"/>
              <Static id="title3" taborder="4" text="LOT 목록" left="0" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" bottom="grd_lotList:0" height="33" width="130" fittocontents="width" tooltiptext="LOTLIST"/>
              <Static id="guidetip02" taborder="6" text="h34" width="45" top="0" visible="false" height="34" cssclass="guideTip" right="761"/>
              <Static id="guidetip02_00" taborder="7" text="h10" width="45" top="247" visible="false" height="10" cssclass="guideTip" right="751"/>
              <Static id="guidetip02_01" taborder="8" text="h34" width="45" top="323" visible="false" height="34" cssclass="guideTip" right="645"/>
              <Static id="guidetip02_01_00" taborder="9" text="h34" width="45" top="508" visible="false" height="34" cssclass="guideTip" right="645"/>
              <Button id="btn_createCancel" taborder="10" text="생성취소" top="6" width="74" height="21" font="bold 9pt &quot;Dotum&quot;" right="0" tooltiptext="CREATECANCEL" onclick="div_work_btn_createCancel_onclick"/>
              <Button id="btn_splitRelease" taborder="11" text="완료해제" top="6" width="74" height="21" font="bold 9pt &quot;Dotum&quot;" right="79" tooltiptext="SPLITRELEASE" onclick="div_work_btn_splitRelease_onclick"/>
              <Button id="btn_splitComplete" taborder="12" text="완료처리" top="6" width="74" height="21" font="bold 9pt &quot;Dotum&quot;" right="159" tooltiptext="SPLITCOMPLETE" onclick="div_work_btn_splitComplete_onclick"/>
              <Static id="sta_cnt_ds_product" taborder="13" text="Count : &lt;fc v=&quot;#f31d24&quot;&gt;0&lt;/fc&gt;" left="title2:10" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" width="140" bottom="grd_product:0" fittocontents="none" height="34"/>
              <Static id="title2_00" taborder="14" text="수주 사양 리스트" left="0" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" width="130" top="0" bottom="grd_productionOrder:0" tooltiptext="SALEORDERLIST" fittocontents="width"/>
              <Static id="sta_cnt_ds_productionOrder" taborder="15" text="Count : &lt;fc v=&quot;#f31d24&quot;&gt;0&lt;/fc&gt;" left="title2_00:10" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" width="140" fittocontents="none"/>
              <Static id="sta_cnt_ds_lot" taborder="16" text="Count : &lt;fc v=&quot;#f31d24&quot;&gt;0&lt;/fc&gt;" left="title3:10" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" width="140" bottom="grd_lotList:0" fittocontents="none" height="33"/>
              <CheckBox id="ckb_EtcProduct" taborder="17" text="기타" left="sta_cnt_ds_product:10" width="90" tooltiptext="ETCPRODUCT" bottom="grd_product:0" height="27" onchanged="div_work_ckb_EtcProduct_onchanged"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_header" taborder="3" left="0" top="0" height="47" right="0" formscrolltype="both">
          <Layouts>
            <Layout>
              <Static id="Static01" taborder="7" left="0" top="0" cssclass="sta_WF_titleBG" right="0" bottom="0"/>
              <Button id="btn_reset" taborder="0" top="16" width="26" height="24" cssclass="btn_com_reset" right="0" tooltiptext="Toolbar_Initialization" text="" initvalueid="x"/>
              <Button id="btn_print" taborder="1" top="16" width="26" height="24" cssclass="btn_com_print" right="31" tooltiptext="Toolbar_Print" onclick="fn_print" initvalueid="x"/>
              <Button id="btn_help" taborder="2" top="16" width="26" height="24" cssclass="btn_com_help" right="62" tooltiptext="MANUAL" initvalueid="x"/>
              <Button id="btn_save" taborder="3" top="16" width="26" height="24" cssclass="btn_com_save" right="93" tooltiptext="Toolbar_Save" initvalueid="x"/>
              <Static id="sta_title" taborder="8" text="화면명" left="30" top="16" width="58" height="24" cssclass="sta_WF_title" fittocontents="width" expr="nexacro.getApplication().gds_menu.lookup(&quot;PGM_ID&quot;,comp.parent.parent.parent.name,&quot;MENU_NM&quot;)"/>
              <Button id="btn_favorite" taborder="4" left="sta_title:0" top="16" width="24" height="24" cssclass="btn_WF_favorite"/>
              <Button id="btn_searchOpen" taborder="5" left="0" top="16" width="30" height="24" cssclass="btn_WF_searchOpen" onclick="nfn_searchOpen_onclick"/>
              <Static id="Static16" taborder="6" left="47" top="0" width="60" height="20" cssclass="guideTip" visible="false" text="h20"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_productionOrder" useclientlayout="true" onrowposchanged="ds_productionOrder_onrowposchanged">
        <ColumnInfo>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="LINENO" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="SALESPRICE" type="STRING" size="256"/>
          <Column id="LAYER" type="STRING" size="256"/>
          <Column id="PCSPNL" type="STRING" size="256"/>
          <Column id="PCSMM" type="STRING" size="256"/>
          <Column id="PLANQTY" type="STRING" size="256"/>
          <Column id="PLANPNLQTY" type="STRING" size="256"/>
          <Column id="PLANMM" type="STRING" size="256"/>
          <Column id="ISSPLIT" type="STRING" size="256"/>
          <Column id="ISLOTCREATE" type="STRING" size="256"/>
          <Column id="ISSPECAPPROVE" type="STRING" size="256"/>
          <Column id="PRODUCTIONTYPE" type="STRING" size="256"/>
          <Column id="STATE" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
          <Column id="PUREORDER" type="STRING" size="256"/>
          <Column id="PUREINPUT" type="STRING" size="256"/>
          <Column id="SURPLUSSTOCK" type="STRING" size="256"/>
          <Column id="SURPLUSWIP" type="STRING" size="256"/>
          <Column id="UNDERAGE" type="STRING" size="256"/>
          <Column id="STDINPUTPNLQTY" type="STRING" size="256"/>
          <Column id="LOTINPUTPNLQTY" type="STRING" size="256"/>
          <Column id="PLANENDTIME" type="STRING" size="256"/>
          <Column id="INPUTSEQUENCE" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_product" useclientlayout="true" oncolumnchanged="ds_product_oncolumnchanged">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
          <Column id="PNLQTY" type="FLOAT" size="256"/>
          <Column id="LOTSIZE" type="FLOAT" size="256"/>
          <Column id="QTY" type="FLOAT" size="256"/>
          <Column id="JOINTQTY" type="FLOAT" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="ACTUALINPUTLOSS" type="FLOAT" size="256"/>
          <Column id="PUREORDERLOSS" type="FLOAT" size="256"/>
          <Column id="MATERIALCLASS" type="STRING" size="256"/>
          <Column id="MATERIALSEQUENCE" type="STRING" size="256"/>
          <Column id="ISLOTCREATE" type="STRING" size="256"/>
          <Column id="PRODUCTDEFTYPE" type="STRING" size="256"/>
          <Column id="MULTIPLE" type="STRING" size="256"/>
          <Column id="ISINNERPUBLIC" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_lotList" useclientlayout="true">
        <ColumnInfo>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PNLQTY" type="FLOAT" size="256"/>
          <Column id="QTY" type="FLOAT" size="256"/>
          <Column id="PUREINPUT" type="FLOAT" size="256"/>
          <Column id="PUREINPUTLOSS" type="FLOAT" size="256"/>
          <Column id="LOSSRATE" type="FLOAT" size="256"/>
          <Column id="PUREORDER" type="STRING" size="256"/>
          <Column id="ISINPUT" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="JOINTQTY" type="FLOAT" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="ISLOTCREATE" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFTYPE" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_lineNo">
        <ColumnInfo>
          <Column id="CODEID" type="STRING" size="256"/>
          <Column id="COCENM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_yn">
        <ColumnInfo>
          <Column id="UOMDEFID" type="STRING" size="256"/>
          <Column id="UOMDEFNAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rtrSht">
        <ColumnInfo>
          <Column id="CODEID" type="STRING" size="256"/>
          <Column id="CODEVALUE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search">
        <ColumnInfo>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="LINENO" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="ISCREATE" type="STRING" size="256"/>
          <Column id="PRODUCTIONTYPE" type="STRING" size="256"/>
          <Column id="LANGUAGETYPE" type="STRING" size="256"/>
          <Column id="ISSPLIT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_maxSeq" useclientlayout="true">
        <ColumnInfo>
          <Column id="SEQUENCE" type="STRING" size="256"/>
          <Column id="LOTDEGREE" type="STRING" size="256"/>
          <Column id="LASTSEQUENCE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search2" useclientlayout="true">
        <ColumnInfo>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_lot" useclientlayout="true">
        <ColumnInfo>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PNLQTY" type="FLOAT" size="256"/>
          <Column id="QTY" type="FLOAT" size="256"/>
          <Column id="PUREINPUT" type="STRING" size="256"/>
          <Column id="PUREINPUTLOSS" type="FLOAT" size="256"/>
          <Column id="LOSSRATE" type="FLOAT" size="256"/>
          <Column id="PUREORDER" type="STRING" size="256"/>
          <Column id="ISINPUT" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="JOINTQTY" type="FLOAT" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="ISLOTCREATE" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFTYPE" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_lottemp" useclientlayout="true">
        <ColumnInfo>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PNLQTY" type="FLOAT" size="256"/>
          <Column id="QTY" type="FLOAT" size="256"/>
          <Column id="PUREINPUT" type="FLOAT" size="256"/>
          <Column id="PUREINPUTLOSS" type="FLOAT" size="256"/>
          <Column id="LOSSRATE" type="FLOAT" size="256"/>
          <Column id="PUREORDER" type="STRING" size="256"/>
          <Column id="ISINPUT" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="JOINTQTY" type="FLOAT" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="ISLOTCREATE" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFTYPE" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_splitSearch">
        <ColumnInfo>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="LINENO" type="STRING" size="256"/>
          <Column id="ISSPLIT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_productTemp" useclientlayout="true">
        <ColumnInfo>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
          <Column id="PNLQTY" type="FLOAT" size="256"/>
          <Column id="LOTSIZE" type="FLOAT" size="256"/>
          <Column id="QTY" type="FLOAT" size="256"/>
          <Column id="JOINTQTY" type="FLOAT" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="ACTUALINPUTLOSS" type="FLOAT" size="256"/>
          <Column id="PUREORDERLOSS" type="FLOAT" size="256"/>
          <Column id="MATERIALCLASS" type="STRING" size="256"/>
          <Column id="MATERIALSEQUENCE" type="STRING" size="256"/>
          <Column id="ISLOTCREATE" type="STRING" size="256"/>
          <Column id="PRODUCTDEFTYPE" type="STRING" size="256"/>
          <Column id="MULTIPLE" type="STRING" size="256"/>
          <Column id="ISINNERPUBLIC" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_productionOrderTemp" useclientlayout="true">
        <ColumnInfo>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="LINENO" type="STRING" size="256"/>
          <Column id="MAINSEQ" type="STRING" size="256"/>
          <Column id="SUBSEQ" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="SALESPRICE" type="STRING" size="256"/>
          <Column id="LAYER" type="STRING" size="256"/>
          <Column id="PCSPNL" type="STRING" size="256"/>
          <Column id="PCSMM" type="STRING" size="256"/>
          <Column id="PLANQTY" type="STRING" size="256"/>
          <Column id="PLANPNLQTY" type="STRING" size="256"/>
          <Column id="PLANMM" type="STRING" size="256"/>
          <Column id="ISSPLIT" type="STRING" size="256"/>
          <Column id="ISLOTCREATE" type="STRING" size="256"/>
          <Column id="ISSPECAPPROVE" type="STRING" size="256"/>
          <Column id="PRODUCTIONTYPE" type="STRING" size="256"/>
          <Column id="STATE" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
          <Column id="PUREORDER" type="STRING" size="256"/>
          <Column id="PUREINPUT" type="STRING" size="256"/>
          <Column id="SURPLUSSTOCK" type="STRING" size="256"/>
          <Column id="SURPLUSWIP" type="STRING" size="256"/>
          <Column id="UNDERAGE" type="STRING" size="256"/>
          <Column id="STDINPUTPNLQTY" type="STRING" size="256"/>
          <Column id="LOTINPUTPNLQTY" type="STRING" size="256"/>
          <Column id="PLANENDTIME" type="STRING" size="256"/>
          <Column id="INPUTSEQUENCE" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="LACKQTY" type="STRING" size="256"/>
          <Column id="STANDARDINPUT" type="STRING" size="256"/>
          <Column id="LOTPNL" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_lotListTemp" useclientlayout="true">
        <ColumnInfo>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PNLQTY" type="FLOAT" size="256"/>
          <Column id="QTY" type="FLOAT" size="256"/>
          <Column id="PUREINPUT" type="FLOAT" size="256"/>
          <Column id="PUREINPUTLOSS" type="FLOAT" size="256"/>
          <Column id="LOSSRATE" type="FLOAT" size="256"/>
          <Column id="PUREORDER" type="STRING" size="256"/>
          <Column id="ISINPUT" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="JOINTQTY" type="FLOAT" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="ISLOTCREATE" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFTYPE" type="STRING" size="256"/>
          <Column id="RTRSHT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_data">
        <ColumnInfo>
          <Column id="PRODUCTIONORDERID" type="STRING" size="256"/>
          <Column id="LINENO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.1"><![CDATA[/***************************************************************************************
 * 시스템명 	: IFC MES시스템
 * 업무명 		:  LOT 생성
 * 파일명 		: PCM00300M.xfdl
 * 작성자 		: 방성혁
 * 작성일 		: 2021.02.22
 *
 * 설  명		:  조회/수정/삭제/엑셀다운로드 기능 제공
 *---------------------------------------------------------------------------------------
 * 변경일		변경자		변경내역
 *---------------------------------------------------------------------------------------
 * 2021.02.22	방성혁   	최초작성
 *---------------------------------------------------------------------------------------
 ****************************************************************************************/

/**************************************************************************
 * 1. 필수 include
 ***************************************************************************/
include "lib::lib_bas.xjs";	//기준관리 공통 라이브러리 include
include "pcm::pcmCommon.xjs"; //pcm 에서 사용하는 공통
/**************************************************************************
 * 2. FORM 변수 선언 영역
 ***************************************************************************/
this.fv_currDate;

/**************************************************************************
 * 3. FORM LOAD
 ***************************************************************************/
this.fn_init = function (obj:Form, e:nexacro.LoadEventInfo)
{
    
	this.nfn_formInit(obj);	
	this.fn_ComboClear();
	//this.fn_getLineNo();
	
	/*
	this.ds_search.setColumn(sRow, "ENTERPRISEID", nexacro.getApplication().gds_userInfo.getColumn(0,"gv_enterpriseId"));
	this.ds_search.setColumn(sRow, "PLANTID", this.gf_getSiteType());
	
	var sSvcID = "selectLineNo";
	var sController = "/pcm00300/selectLineNo.do";
	var sInDatasets = "INPUT=ds_search";
	var sOutDatasets = "ds_line=output";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
	*/
	
};

/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 기능 : 검색
 */

/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 기능 : 검색
 */
this.fn_search = function (obj:Button, e:nexacro.ClickEventInfo)
{
    this.ds_search.clearData();
	this.ds_productionOrder.clearData();  // 수주정보 클리어
	this.ds_product.clearData();          // 제품정보 클리어
	this.ds_lot.clearData();              // Lot List 클리어
	this.setProductionOrderInfoClear();   
	//this.getProductionOrderInfo();
	this.div_work.form.ckb_EtcProduct.set_value("0");
	
	
	var sRow = this.ds_search.addRow();
	this.ds_search.setColumn(sRow, "ENTERPRISEID", nexacro.getApplication().gds_userInfo.getColumn(0,"gv_enterpriseId"));
	this.ds_search.setColumn(sRow, "PLANTID", this.gf_getSiteType());
	this.ds_search.setColumn(sRow, "PRODUCTIONORDERID", this.tab_search.Tabpage1.form.edt_productionOrderId.value);
	this.ds_search.setColumn(sRow, "LINENO", this.tab_search.Tabpage1.form.cmb_lineNo.value);
	this.ds_search.setColumn(sRow, "PRODUCTDEFID", this.tab_search.Tabpage1.form.edt_productDefId.value);
	this.ds_search.setColumn(sRow, "PRODUCTIONTYPE", this.tab_search.Tabpage1.form.cmb_productionType.value);
	this.ds_search.setColumn(sRow, "ISCREATE", this.tab_search.Tabpage1.form.cmb_ISCREATE.value);
	this.ds_search.setColumn(sRow, "ISSPLIT", this.tab_search.Tabpage1.form.cmb_ISSPLIT.value);
	this.ds_search.setColumn(sRow, "LANGUAGETYPE", nexacro.getApplication().gds_userInfo.getColumn(0,"gv_languageType"));

	
	var sSvcID = "ProductionOrderList";
	var sController = "/pcm00300/selectProductionOrderList.do";
	var sInDatasets = "INPUT=ds_search";
	var sOutDatasets = "ds_productionOrder=output";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

/*
 * 기능 : 저장
 */
this.fn_save = function (obj:Button, e:nexacro.ClickEventInfo)
{
   
// 	if (!this.gfn_dsIsUpdated(this.ds_lot) ) 
// 	{
// 		this.gfn_Message("NoSaveData", null, "warning", "ok");//this.gfn_Message("IMCMM0033", null, "warning", "ok");
// 		return;
// 	}
	
	
    this.ds_lotListTemp.clearData();
	this.ds_productionOrderTemp.clearData();
	
	var bRow = this.ds_productionOrder.rowposition;
	
	var sCnt = 0;
	for(var i = 0; i < this.ds_lot.getRowCount(); i ++)
	{
		if (this.ds_lot.getColumn(i,"ISLOTCREATE") == "N")
		{
		   var addRow =  this.ds_lotListTemp.addRow();
		   this.ds_lotListTemp.copyRow(addRow, this.ds_lot, i);
			
			sCnt ++;
		}
	}
	
	if (sCnt == 0)
	{
		this.gfn_Message("NoSaveData", null, "warning", "ok");
		return;
	}
	
	var lotInputPnlQty = 0;
	var fRow = this.ds_lotList.findRowExpr("PRODUCTDEFID =='"+this.ds_productionOrder.getColumn(bRow, "PRODUCTDEFID") +"'");
	if (this.ds_productionOrder.getColumn(bRow, "LOTINPUTPNLQTY") > 0)
	{
		if (fRow > -1)
		{
			 lotInputPnlQty =  this.div_work.form.div_detail.form.msk_LotSize.value;	
		} else {
			 lotInputPnlQty =  this.ds_productionOrder.getColumn(bRow, "LOTINPUTPNLQTY");
		}	
	}
	else
	{
		 lotInputPnlQty =  this.div_work.form.div_detail.form.msk_LotSize.value;	
	}
	
    this.ds_productionOrderTemp.copyRow(this.ds_productionOrderTemp.addRow(),this.ds_productionOrder, this.ds_productionOrder.rowposition);
	
	this.ds_productionOrderTemp.setColumn(0, "PUREORDER", this.div_work.form.div_detail.form.msk_PureOrder.value);
	this.ds_productionOrderTemp.setColumn(0, "PUREINPUT", this.div_work.form.div_detail.form.msk_PureInput.value);
	this.ds_productionOrderTemp.setColumn(0, "SURPLUSSTOCK", this.div_work.form.div_detail.form.msk_SurplusStock.value);
	this.ds_productionOrderTemp.setColumn(0, "SURPLUSWIP", this.div_work.form.div_detail.form.msk_SurplusWip.value);
	this.ds_productionOrderTemp.setColumn(0, "LACKQTY", this.div_work.form.div_detail.form.msk_LackQty.value);
	this.ds_productionOrderTemp.setColumn(0, "STANDARDINPUT", this.div_work.form.div_detail.form.msk_StandardInputPnl.value);
	this.ds_productionOrderTemp.setColumn(0, "LOTPNL", this.div_work.form.div_detail.form.msk_LotSize.value);
   
     trace(this.ds_lotListTemp.saveXML());
	 trace("======================================");
	  trace(this.ds_productionOrderTemp.saveXML());
	// -------------------------
	// 저장
	// ':U' 는 갱신된 내용만을 입력 데이터세트로 보내며, ':A' 는 모든 정보를 보냅니다.
	// ':N' 은 현재 Delete를 제외한 데이터를 Normal 상태로 보냅니다. 지정하지 않는 데이터세트는 Normal로 동작합니다
	// -------------------------
	var sSvcID       = "SaveCreateLot";
	var sController  = "/pcm00300/saveCreateLot.do";
	var sInDatasets  = "ds_productionOrderTemp=ds_productionOrderTemp:A ds_lotListTemp=ds_lotListTemp:A ";
	var sOutDatasets = "";

	var sArgs = "";
	
	//trace(this.ds_productionOrderTemp.saveXML());
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

/*
 * 기능 : 검색 초기화
 */
this.fn_searchClear = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
   this.fn_ComboClear();
};

/*
 * 기능 : 신규
 */
this.fn_new = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
  
};


/*
 * 기능 : 삭제
 */
this.fn_delete = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
 
};
/*
 * 기능 : 도움말  => 공통 처리
 */
this.fn_help = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 출력
 */
this.fn_print = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
   
};

/*
 * 기능 : work영역 초기화  => 공통처리
 */
this.fn_reset = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
 
};

/**************************************************************************
 * 5. TRANSACTION, CALLBACK 영역
 ***************************************************************************/
this.fn_callBack = function (trId, errCD, errMsg)
{
	if (errCD != 0) 
	{
		this.gfn_Message("ProcessingError", trId+ + errMsg, "error", "ok");
		return;
	}
	
	switch(trId) {
	case "selectLineNo":
// 	
// 	      this.ds_lineNo.insertRow(0);
// 	      this.ds_lineNo.setColumn(0,"CODEID","");
// 		  this.ds_lineNo.setColumn(0,"COCENM","전체조회");
// 		  this.tab_search.Tabpage1.form.cmb_lineNo.set_value("");
// 		  this.tab_search.Tabpage1.form.cmb_lineNo.set_text("전체조회");
		  this.AddAll(this.ds_lineNo,"CODEID","COCENM");
	      this.tab_search.Tabpage1.form.cmb_lineNo.set_index(0);
		break;  
	case "ProductionOrderList" :
	     if (this.ds_productionOrder.getRowCount() == 0)
	     {
			this.gfn_Message("NoSelectData", null, "error", "ok");
		 }
		break;
	case "selectLotListByProductionOrder" :
		if (this.ds_lot.getRowCount() == 0)
		{
		    this.setProductionOrderInfoClear();
			
		} 
		this.getProductionOrderInfo();
		this.productionDefinitionList();
		
	    break;
	case "SelectProductDefinitionListByProductionOrder" :
		  if (this.ds_product.getRowCount() > 0)
		  {
			 this.SetProductDefinitionListQtyLoss();
			 for(var i = 0; i < this.ds_lot.getRowCount(); i++)
		     {
                this.ds_lot.setColumn(i, "LOSSRATE"  , this.ds_product.getColumn(0, "ACTUALINPUTLOSS")) // 실투입로스
                this.ds_lot.setColumn(i, "PUREORDER" , this.ds_product.getColumn(0, "PUREORDERLOSS")) // 실투입로스
		   }
	
		  }
		break;
	case "SaveCreateLot" :
	    this.gfn_Message("ProcessingSuccess", "", "information", "ok");
	//	this.GetLotList();
	    this.fn_search();
		break;
	case "CancelCreateLot" :
		this.gfn_Message("ProcessingSuccess", "", "information", "ok");
		 this.fn_search();
	   break;
	case "updateProductionOrder_IsSplit" :
	     this.gfn_Message("ProcessingSuccess", "", "information", "ok");
		 this.fn_search();
		break;
	default:
	}

};


/**************************************************************************
 * 6. 팝업 호출/콜백
 **************************************************************************/
this.fn_popupAfter = function(sPopupId, Variant)
{  
	var rtn = this.fv_rtnValue;	
	if(this.nfn_isNull(rtn)) return;
    switch(sPopupId)
	{
		case "SEARCH_PRODUCTD" :
		    var arr_productDefId  = [];
		
			
			for(var i=0; i<rtn.length; i++){
				var colArray = rtn[i];
				 arr_productDefId.push(colArray[0]);
			}
			this.tab_search.Tabpage1.form.edt_productDefId.set_value(arr_productDefId.join(","));	
			
			
			if (rtn.length == 1)
			{
				this.tab_search.Tabpage1.form.cmb_productionType.set_value(colArray[1]);
			}
		     break;
		case "SEARCH_PRODUCTIONORDERID":
		    var arrOrderId  = [];
			var arrProduct  = [];
			
			for(var i=0; i<rtn.length; i++){
				var colArray = rtn[i];
				 arrOrderId.push(colArray[0]);
				 arrProduct.push(colArray[1]);
			}
		    this.tab_search.Tabpage1.form.edt_productionOrderId.set_value(arrOrderId.join(","));	
			this.tab_search.Tabpage1.form.edt_productDefId.set_value(arrProduct.join(","));	
			
			this.fn_getLineNo();
			
			if (rtn.length == 1)
			{
				this.tab_search.Tabpage1.form.cmb_lineNo.set_value(colArray[2]);
			}			
			break;
		case "SEARCH_SPLIT" :
		     var resultInfo = JSON.parse(rtn);
			 if(resultInfo.resultCd == "OK")
			 {
				this.fn_grd_salesOrderDo_DataSetting(resultInfo.splitQty, resultInfo.lineQty);
			 }
			break
		default :
			break;
	}
	
};
/**************************************************************************
 * 7. 기타 함수(화면 로컬 정의) 
 **************************************************************************/
this.productionDefinitionList = function()
{
    //var sRow = this.div_work.form.grd_productionOrder.getSelectedDatasetRows();
	var sRow = this.ds_productionOrder.rowposition;
    this.ds_product.set_enableevent(false);
	this.ds_search.setColumn(0, "PRODUCTIONORDERID", this.ds_productionOrder.getColumn(sRow, "PRODUCTIONORDERID"));
	this.ds_search.setColumn(0, "LINENO", this.ds_productionOrder.getColumn(sRow, "LINENO"));
	this.ds_search.setColumn(0, "PRODUCTDEFID", this.ds_productionOrder.getColumn(sRow, "PRODUCTDEFID"));
	this.ds_search.setColumn(0, "PRODUCTDEFVERSION", this.ds_productionOrder.getColumn(sRow, "PRODUCTDEFVERSION"));
	
	this.ds_product.clearData();
	var sSvcID = "SelectProductDefinitionListByProductionOrder";
	var sController = "/pcm00300/selectProductDefinitionListByProductionOrder.do";
	var sInDatasets = "INPUT=ds_search";
	var sOutDatasets = "ds_product=output";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
	
	this.ds_product.set_enableevent(true);
};
this.SetProductDefinitionListQtyLoss = function()
{
   // var sRow = this.div_work.form.grd_productionOrder.getSelectedDatasetRows();
	var sRow = this.ds_productionOrder.rowposition;
	  
	var pcsPnl           = this.ds_productionOrder.getColumn(sRow, "PCSPNL");
	var pureOrder        = this.div_work.form.div_detail.form.msk_PureOrder.value;
	var pureInput        = this.div_work.form.div_detail.form.msk_PureInput.value;
	var standardInputPcs = this.div_work.form.div_detail.form.msk_StandardInputPCS.value;
	var standardInput    = this.div_work.form.div_detail.form.msk_StandardInputPnl.value;
	var lotSize          = this.div_work.form.div_detail.form.msk_LotSize.value;
	var pureInputLoss    = pureInput < 1 ? 0 : nexacro.round(((nexacro.toNumber(pcsPnl *standardInput) / nexacro.toNumber(pureInput))*100) - 100,2);
	var pureOrderLoss    = pureInput < 1 ? 0 : nexacro.round(((nexacro.toNumber(pcsPnl *standardInput) / nexacro.toNumber(pureOrder))*100) - 100,2);
 
    this.ds_product.set_enableevent(false);
	for(var i = 0; i < this.ds_product.getRowCount(); i++)
	{
 	  
		this.ds_product.setColumn(i, "PNLQTY", standardInput);
		this.ds_product.setColumn(i, "QTY", nexacro.round(this.ds_product.getColumn(i, "JOINTQTY") * standardInput));
		
		if (standardInput > 0)
		{
			this.ds_product.setColumn(i, "ACTUALINPUTLOSS", pureInputLoss);
			this.ds_product.setColumn(i, "PUREORDERLOSS"  , pureOrderLoss);
		}
		
		if (lotSize > 0)
		{
			this.ds_product.setColumn(i, "LOTSIZE", lotSize);
		}
	}
	this.ds_product.set_enableevent(true);
	
	
};
this.setProductionOrderInfoClear = function()
{
   this.div_work.form.div_detail.form.msk_PureOrder.set_value(0);
	this.div_work.form.div_detail.form.msk_PureInput.set_value(0);
	this.div_work.form.div_detail.form.msk_StandardInputPCS.set_value(0);
	this.div_work.form.div_detail.form.msk_StandardLoss.set_value(0);
	this.div_work.form.div_detail.form.msk_SurplusStock.set_value(0);
	this.div_work.form.div_detail.form.msk_SurplusWip.set_value(0);
	this.div_work.form.div_detail.form.msk_LackQty.set_value(0);
	this.div_work.form.div_detail.form.msk_StandardInputPnl.set_value(0);
	this.div_work.form.div_detail.form.msk_LotSize.set_value(0);
};
this.getProductionOrderInfo = function()
{
    //var sRow = this.div_work.form.grd_productionOrder.getSelectedDatasetRows();
    var sRow = this.ds_productionOrder.rowposition;
	if (this.ds_lot.getRowCount() == 0)
	{
		this.div_work.form.div_detail.form.msk_PureOrder.set_value(this.ds_productionOrder.getColumn(sRow, "PLANQTY"));
	} else {
		this.div_work.form.div_detail.form.msk_PureOrder.set_value(this.ds_productionOrder.getColumn(sRow, "PUREORDER"));
		this.div_work.form.div_detail.form.msk_PureInput.set_value(this.ds_productionOrder.getColumn(sRow, "PUREINPUT"));
		this.div_work.form.div_detail.form.msk_SurplusStock.set_value(this.ds_productionOrder.getColumn(sRow, "SURPLUSSTOCK"));
		this.div_work.form.div_detail.form.msk_SurplusWip.set_value(this.ds_productionOrder.getColumn(sRow, "SURPLUSWIP"));
		this.div_work.form.div_detail.form.msk_LackQty.set_value(this.ds_productionOrder.getColumn(sRow, "UNDERAGE"));
		this.div_work.form.div_detail.form.msk_StandardInputPnl.set_value(this.ds_productionOrder.getColumn(sRow, "STDINPUTPNLQTY"));
		this.div_work.form.div_detail.form.msk_LotSize.set_value(this.ds_productionOrder.getColumn(sRow, "LOTINPUTPNLQTY"));
		
		this.calcProductionOrderInfo();
	}
	
    
	
};
 this.GetLotList = function()
 {
    // var sRow = this.div_work.form.grd_productionOrder.getSelectedDatasetRows();
	var sRow = this.ds_productionOrder.rowposition;

	this.ds_search.setColumn(0, "LINENO", this.ds_productionOrder.getColumn(sRow, "LINENO"));
	this.ds_search.setColumn(0, "PRODUCTDEFID", this.ds_productionOrder.getColumn(sRow, "PRODUCTDEFID"));
	this.ds_search.setColumn(0, "PRODUCTIONORDERID", this.ds_productionOrder.getColumn(sRow, "PRODUCTIONORDERID"));
	this.ds_lot.clearData();
	
	var sSvcID = "selectLotListByProductionOrder";
	var sController = "/pcm00300/selectLotListByProductionOrder.do";
	var sInDatasets = "INPUT=ds_search";
	var sOutDatasets = "ds_lot=output";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);	
 };
 
this.setProductCheckStatus = function(status)
{
	for(var i = 0; i < this.ds_product.getRowCount(); i++)
	{
		var materialClass =  this.ds_product.getColumn(i, "MATERIALCLASS");
		
		if (materialClass != "FG")
		{
			this.ds_product.setColumn(i, "CHK", status);
		}
	}
};
 this.maxSequence = function(lotStartNo, rtrSht)
 {
    this.ds_search2.clearData();
	this.ds_maxSeq.clearData();
	var sRow = this.ds_search2.addRow();
	
	this.ds_search2.setColumn(sRow, "LOTID", lotStartNo);
	this.ds_search2.setColumn(sRow, "RTRSHT", rtrSht);
	var sSvcID = "getLotIdMaxSequence";
	var sController = "/pcm00300/getLotIdMaxSequence.do";
	var sInDatasets = "INPUT=ds_search2";
	var sOutDatasets = "ds_maxSeq=output";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs,"","",false);
	
	return  this.ds_maxSeq.getColumn(0,"SEQUENCE");


 };
 
this.GetBase36String = function(value)
{
	var data = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	var idx = value % 36 ;
	
	return data.substring(idx,1);
	
	
};

this.calcProductionOrderInfo = function()
{
      //  var sRow = this.div_work.form.grd_productionOrder.getSelectedDatasetRows();
	    var sRow = this.ds_productionOrder.rowposition;
		var planQty        = this.ds_productionOrder.getColumn(sRow, "PLANQTY");
		var pcsPnl         = this.nfn_isNull(this.ds_productionOrder.getColumn(sRow, "PCSPNL")) ? 0 : this.ds_productionOrder.getColumn(sRow, "PCSPNL");
		var surplusStock   = this.nfn_isNull(this.div_work.form.div_detail.form.msk_SurplusStock.value) ? 0 : this.div_work.form.div_detail.form.msk_SurplusStock.value;
		var surplusWip     = this.nfn_isNull(this.div_work.form.div_detail.form.msk_SurplusWip.value) ? 0 : this.div_work.form.div_detail.form.msk_SurplusWip.value;
		var lackQty        = this.nfn_isNull(this.div_work.form.div_detail.form.msk_LackQty.value) ? 0 : this.div_work.form.div_detail.form.msk_LackQty.value;
	    var standardInput  = this.nfn_isNull(this.div_work.form.div_detail.form.msk_StandardInputPnl.value) ? 0 : this.div_work.form.div_detail.form.msk_StandardInputPnl.value;
		var lotPnl         = this.nfn_isNull(this.div_work.form.div_detail.form.msk_LotSize.value) ? 0 : this.div_work.form.div_detail.form.msk_LotSize.value;

		this.div_work.form.div_detail.form.msk_PureInput.set_value(nexacro.toNumber(planQty) - (nexacro.toNumber(surplusStock) + nexacro.toNumber(surplusWip)) + nexacro.toNumber(lackQty));
		this.div_work.form.div_detail.form.msk_StandardInputPCS.set_value(standardInput * pcsPnl);
		
		var pureInput = this.div_work.form.div_detail.form.msk_PureInput.value;
		var pureOrder = this.div_work.form.div_detail.form.msk_PureOrder.value;
		var standardInputPcs = this.div_work.form.div_detail.form.msk_StandardInputPCS.value;

		var standardLoss = nexacro.round(((standardInputPcs / pureOrder) * 100) - 100,2);

		if (standardInput > 0 && lotPnl > 0)
		{
		   this.div_work.form.div_detail.form.msk_StandardLoss.set_value(standardLoss);
			
		}
};
this.fn_getLineNo = function()
{
    this.ds_search.clearData();
	this.ds_lineNo.clearData();
	
	var sRow = this.ds_search.addRow();
	
	this.ds_search.setColumn(sRow, "ENTERPRISEID", nexacro.getApplication().gds_userInfo.getColumn(0,"gv_enterpriseId"));
	this.ds_search.setColumn(sRow, "PLANTID"          , this.gf_getSiteType());
	this.ds_search.setColumn(sRow, "PRODUCTDEFID", this.tab_search.Tabpage1.form.edt_productDefId.value);
	var sSvcID = "selectLineNo";
	var sController = "/pcm00300/selectLineNo.do";
	var sInDatasets = "INPUT=ds_search";
	var sOutDatasets = "ds_lineNo=output";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs, "", "", false); 
};

this.fn_ComboClear = function()
{
	this.ds_lineNo.clearData();
	this.AddAll(this.ds_lineNo,"CODEID","COCENM");
	this.tab_search.Tabpage1.form.cmb_lineNo.set_index(0);
};

/**************************************************************************
 * 8. 이벤트
 ***************************************************************************/

this.tab_search_Tabpage1_btn_productCode_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	// gfn_openPopup(arg_type, popupCd, popupNm, rtnCols, paramCols, paramValues, searchStr);
	//-----------------
	// arg_type    : A::사용자가 선택, B:: 한건존재시 자동 셋팅
	// popupCd     : 공통팝업 관리 화면에서 생성되는 팝업코드
	// popupNm     : 변경할팝업화면명 , 변경하지 않을 경우 팝업화면 타이틀은 관리화면의 타이틀로 지정됨
	// rtnCols     : 구분자 : "|"   : 그리드에 출력될 컬럼 지정 (않을 경우 관리화면의 그리드로 출력됨)
	// paramCols   : 구분자 : "|" : where 구문에 들어갈 컬럼
	// paramValues : 구분자 : "|"  : where 구문에 들어갈 컬럼에 대한 값
	// searchStr   : 팝업 조회조건 콤보값 = 조회 값 
	 var txtSearch = ""
	if (!this.nfn_isNull(this.tab_search.Tabpage1.form.edt_productDefId.value))
	{
		txtSearch = "PRODUCTDEFID="+ this.tab_search.Tabpage1.form.edt_productDefId.value;
	}
	
	var popupId = "SEARCH_PRODUCTD";
	var oArg = {};
	oArg.arg_type = "CA";
	oArg.arg_popupCd = "P00022";
	oArg.arg_popupNm = "";
	oArg.arg_rtnCols = "PRODUCTDEFID|PRODUCTIONTYPE";
	oArg.arg_paramCols = "";
	oArg.arg_paramValues = "";
	oArg.arg_searchStr = txtSearch;
			   
	this.gfn_openPopup(popupId,"cmd::CMSA00100P.xfdl",oArg,"width=830,height=700");
};


this.div_work_ckb_EtcProduct_onchanged = function(obj:nexacro.CheckBox,e:nexacro.CheckBoxChangedEventInfo)
{
	if (this.ds_product.rowcount < 1)
	{
	    this.div_work.form.ckb_EtcProduct.value = "0";
		return false;
	}
	
	this.setProductCheckStatus(this.div_work.form.ckb_EtcProduct.value);
};

this.ds_product_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
    if(e.row < 0) return false;
    
	if (e.columnid == "CHK")
	{
	
		this.ds_lotList.clearData();
		this.ds_lottemp.clearData();
		
	   
		
	   // var sRow = this.div_work.form.grd_productionOrder.getSelectedDatasetRows();
		var sRow = this.ds_productionOrder.rowposition;
		var productionOrderId = this.ds_productionOrder.getColumn(sRow,"PRODUCTIONORDERID");
		var productDefId      = this.ds_productionOrder.getColumn(sRow,"PRODUCTDEFID");
		var state             = this.ds_productionOrder.getColumn(sRow,"STATE");
		var cRow              = this.ds_lot.findRowExpr("ISLOTCREATE == 'Y'");
		var rowCnt            = 0;
		if (state == "LotCreate")
		{
			return false;
		}
		
		if (cRow > -1)
		{
			for(var i = 0; i < this.ds_lot.getRowCount(); i++)
			{
				if (this.ds_lot.getColumn(i,"ISLOTCREATE") == "Y")
				{
					this.ds_lottemp.copyRow(this.ds_lottemp.addRow(),this.ds_lot,i);
					rowCnt ++;
				}
			}
		}

		for(var k = 0 ; k < this.ds_product.getRowCount(); k++)
		{
			if (this.ds_product.getColumn(k,"CHK") == "0")
			{
				continue;
			}
			if (this.ds_product.getColumn(k,"ISLOTCREATE") == "N")
			{
				var siteCode     = "";
				var lotNo        = "";
				var productType  = ""; 
				var rtrSht   = this.ds_product.getColumn(k,"RTRSHT");
				if (this.nfn_isNull(rtrSht))
				{
					this.gfn_Message("NotInputProductRTRSHT", "", "error", "ok");
					this.ds_product.setColumn(k, "CHK", 0);
					return false;
				}
				switch(this.ds_productionOrder.getColumn(sRow,"PRODUCTIONTYPE")) {
					case "Production":
						productType = "M";
						break;
					case "Sample":
					case "SampleTest" :
						productType = "S";
						break;
					case "FirstProduction":
						productType = "P";
						break;
					case "Test":
						productType = "T";
						break;
					default :
						productType = "C";
						break;
				}
				switch(this.gf_getSiteType()) {
				case "IFC" :
					siteCode = "F";
					break;
				case "IFV" :
					siteCode = "Y";
					break;
				case "CCT":
					siteCode = "C";
					break;
				case "YPE":
					siteCode = "Y";
					break;
				case "YPEV":
					siteCode = "P";
					break;
				default:
					break;
				}
				
				var migLot = this.ds_lot.findRowExpr("DESCRIPTION == 'MIG'");
				var lotStartNo = "";
				var sequence   = "";
				
				if (migLot > -1)
				{
					var normalLot = this.ds_lot.findRowExpr("DESCRIPTION == NULL");
					if (normalLot > -1)
					{
					   lotNo = this.ds_lot.getColumn(normalLot, "LOTID").substring(0,11);
					}
					else
					{
					   lotStartNo = this.ds_lot.getColumn(migLot, "LOTID").substring(2, 6) + siteCode;
					   sequence   = this.maxSequence(lotStartNo, rtrSht);
					   lotNo      = productType+lotStartNo + this.gfn_right( "000"+sequence, 3);
					}
					
				}
				else
				{
					if (rowCnt > 0)
					{
						lotNo = this.ds_lottemp.getColumn(0, "LOTID").substring(0,11);
						
					} else {
					   
						lotStartNo =  this.gfn_right(this.gfn_today(),6) + siteCode;
						sequence  = this.maxSequence(lotStartNo,rtrSht);
						lotNo = productType+lotStartNo + this.gfn_right( "000"+sequence, 3);
					}
				}
				var reInput = "1";
				var materialClass    = this.ds_product.getColumn(k, "MATERIALCLASS");
				var materialSequence = this.ds_product.getColumn(k, "MATERIALSEQUENCE");
				
				if (this.nfn_isNull(materialClass) || this.nfn_isNull(materialSequence))
				{
					this.gfn_Message("NotExistsMaterialInfo", "", "error", "ok");
					return false;
				}
				
				var material    = "";
			//	if (this.ds_product.getColumn(k, "PRODUCTDEFTYPE") == "SubAssembly" && nexacro.toNumber(materialSequence) == 0)
				if (this.ds_product.getColumn(k, "PRODUCTDEFTYPE") == "SubAssembly")
				{
		// 			var materialSeq = 1;
		// 			var materialCnt = 0;
		// 			for(var i = 0; i < this.ds_lotList.getRowCount(); i++)
		// 			{
		// 				 if ( this.ds_lot.getColumn(i,"LOTID").substring(13,2) == materialClass)
		// 				 {
		// 					materialCnt ++;
		// 				 }
		// 			}
		// 			
		// 			if (materialCnt > 0)
		// 			{
		// 				 materialSeq = (materialCnt + 1);
		// 			}
		// 			material = materialClass + this.gfn_right( "00"+ materialSeq, 2);
					material = this.gfn_right( this.ds_product.getColumn(k, "PRODUCTDEFID"), 7);
				}
				else
				{
					//material = materialClass + this.gfn_right( "00"+ materialSeq, 2);
					material = materialClass ;
				}
				var lotDegree  = new Array();
				var txtDegree  = "";
				var lotSplit = "000";
				var planQty          = this.ds_productionOrder.getColumn(sRow, "PLANQTY");
				var pcsPnl           = this.ds_productionOrder.getColumn(sRow, "PCSPNL");
				var pureOrder        = this.div_work.form.div_detail.form.msk_PureOrder.value;
				var pureInput        = this.div_work.form.div_detail.form.msk_PureInput.value;
				var standardInput    = this.div_work.form.div_detail.form.msk_StandardInputPnl.value;
				var lotPnl           = this.ds_product.getColumn(k, "LOTSIZE");
				var pnlQty           = this.ds_product.getColumn(k, "PNLQTY");
				var jointQty         = this.ds_product.getColumn(k, "JOINTQTY");
				var actualInputLoss  = this.ds_product.getColumn(k, "ACTUALINPUTLOSS");  //실투입로스
				var pureOrderLoss    = this.ds_product.getColumn(k, "PUREORDERLOSS");    //순수주로스
				
				switch(rtrSht) {
					case "RTR": 
						lotDegree.push("000");
						lotSplit = "000";
					break;
				case "SHT":
				   
					var nShtLotDegree =  Math.ceil(pnlQty / lotPnl) ;

					var totalSeq = 1;
					var lastSeq = 1;

					for (var i = 0; i < nShtLotDegree; i++)
					{
						if (i >= 999)
						{
							if (totalSeq % 100 == 0)
								totalSeq++;

							var startIndex = totalSeq.substring(0,2) ; 

							if (lastSeq > 99)
								lastSeq = 1;
								lotDegree.push(this.GetBase36String(startIndex) + this.gfn_right( "00"+ lastSeq, 2));
							//lotDegree.Add(CommonFunction.GetBase36String(startIndex) + lastSeq.ToString("00"));
						}
						else
						{
							//lotDegree.Add(lastSeq.ToString("000"));
							 lotDegree.push(this.gfn_right( "000"+ lastSeq, 3));
						}

						totalSeq++;
						lastSeq++;
					}

					lotSplit = "001";

					break;
				default:
				}
				var addCount = 0;
				for(var i = 0; i < lotDegree.length; i++)
				{
				  // var lotId = string.Join("-", lotNo, reInput, material, value, lotSplit);
					var lotId = lotNo+"-"+reInput+"-"+material+"-"+lotDegree[i]+"-"+lotSplit;
					var dRow = this.ds_lotList.addRow();
					var aaa = nexacro.round(pnlQty / lotPnl,0);
					this.ds_lotList.setColumn(dRow, "ENTERPRISEID", nexacro.getApplication().gds_userInfo.getColumn(0,"gv_enterpriseId"));
					this.ds_lotList.setColumn(dRow, "PLANTID", this.gf_getSiteType());
					this.ds_lotList.setColumn(dRow, "PRODUCTIONORDERID", productionOrderId);
					this.ds_lotList.setColumn(dRow, "PRODUCTDEFID", this.ds_product.getColumn(k,"PRODUCTDEFID"));
					this.ds_lotList.setColumn(dRow, "PRODUCTDEFVERSION", this.ds_product.getColumn(k,"PRODUCTDEFVERSION"));
					this.ds_lotList.setColumn(dRow, "LOTID", lotId);
					this.ds_lotList.setColumn(dRow, "PNLQTY", rtrSht == "RTR" ? pnlQty : nexacro.toNumber(addCount) == Math.floor(pnlQty / lotPnl) ? (pnlQty % lotPnl) : lotPnl);
				//	this.ds_lotList.setColumn(dRow, "QTY", rtrSht == " pnlQty * jointQty) : Math.floor(this.ds_lotList.getColumn(dRow, "PNLQTY") * jointQty ));
					this.ds_lotList.setColumn(dRow, "QTY", this.ds_lotList.getColumn(dRow, "PNLQTY") * jointQty);
					this.ds_lotList.setColumn(dRow, "JOINTQTY", jointQty);
				//	this.ds_lotList.setColumn(dRow, "PUREINPUT", Math.ceil(pureInput / pcsPnl) * jointQty * (this.ds_lotList.getColumn(dRow, "PNLQTY") / standardInput));
				//	this.ds_lotList.setColumn(dRow, "PUREINPUTLOSS", nexacro.toNumber(this.ds_lotList.getColumn(dRow, "QTY") - this.ds_lotList.getColumn(dRow, "PUREINPUT")));
					this.ds_lotList.setColumn(dRow, "PUREINPUTLOSS", Math.ceil((this.ds_lotList.getColumn(dRow, "QTY") *(pureOrderLoss)/100)));
					this.ds_lotList.setColumn(dRow, "PUREINPUT", this.ds_lotList.getColumn(dRow, "QTY") - this.ds_lotList.getColumn(dRow, "PUREINPUTLOSS"));
					this.ds_lotList.setColumn(dRow, "LOSSRATE", actualInputLoss);
					this.ds_lotList.setColumn(dRow, "PUREORDER", pureOrderLoss);
					this.ds_lotList.setColumn(dRow, "UNIT", this.ds_product.getColumn(k,"UNIT"));
					this.ds_lotList.setColumn(dRow, "ISINPUT", "N");
					this.ds_lotList.setColumn(dRow, "ISLOTCREATE", "N");  
					this.ds_lotList.setColumn(dRow, "RTRSHT", rtrSht);
					addCount ++;
                    trace("pureInput = "+ pureInput + ", pcsPnl = " + pcsPnl + ", jointQty = " + jointQty + ", PNLQTY = " + this.ds_lotList.getColumn(dRow, "PNLQTY") + ", standardInput = " + standardInput);
		 
				}
				
			}
		}
		
		this.ds_lottemp.mergeData(this.ds_lotList);
		this.ds_lot.copyData(this.ds_lottemp);
		this.div_work.form.sta_cnt_ds_lot.set_text("Count : <fc v='#f31d24'>"+this.ds_lot.getRowCount()+"</fc>");
		//this.div_work.form.sta_cnt_ds_lot.text='Count : <fc v="#f31d24">'+this.ds_lot.getRowCount()+'</fc>';
	} else if (e.columnid=="PNLQTY")
	{
		 this.ds_product.setColumn(e.row,"QTY", nexacro.round(e.newvalue) * nexacro.round(this.ds_product.getColumn(e.row, "JOINTQTY")))
	}
};




this.div_work_div_detail_msk_StandardInputPnl_onkeyup = function(obj:nexacro.MaskEdit,e:nexacro.KeyEventInfo)
{
    this.calcProductionOrderInfo();
	this.SetProductDefinitionListQtyLoss();
};

this.div_work_div_detail_msk_LotSize_onkeyup = function(obj:nexacro.MaskEdit,e:nexacro.KeyEventInfo)
{
    this.calcProductionOrderInfo();
	this.SetProductDefinitionListQtyLoss();
};

this.div_work_div_detail_msk_LackQty_onkeyup = function(obj:nexacro.MaskEdit,e:nexacro.KeyEventInfo)
{
   this.calcProductionOrderInfo();
	this.SetProductDefinitionListQtyLoss();
};

this.div_work_div_detail_msk_SurplusWip_onkeyup = function(obj:nexacro.MaskEdit,e:nexacro.KeyEventInfo)
{
    this.calcProductionOrderInfo();
	this.SetProductDefinitionListQtyLoss();
};

this.div_work_div_detail_msk_SurplusStock_onkeyup = function(obj:nexacro.MaskEdit,e:nexacro.KeyEventInfo)
{
    this.calcProductionOrderInfo();
	this.SetProductDefinitionListQtyLoss();
};

this.ds_productionOrder_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
    if(e.newrow < 0) return false;
	//this.setProductionOrderInfoClear();
	//this.getProductionOrderInfo();
	this.div_work.form.ckb_EtcProduct.set_value("0");
	// trace('this.ds_productionOrder.getColumn(e.row, "PLANQTY") = ' + this.ds_productionOrder.getColumn(e.row, "PLANQTY"));
	//this.div_work.form.div_detail.form.msk_PureOrder.set_value(this.ds_productionOrder.getColumn(e.row, "PLANQTY"));

	this.div_work.form.grd_product.setCellProperty("head", 0, "text", '0');

	this.GetLotList();
};
//완료처리 버튼 클릭시
this.div_work_btn_splitComplete_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
   var bRtn = this.gfn_confirm("SplitComplete", "information")
	if(bRtn == false)  return;
	
	this.ds_splitSearch.clearData();
	var sRow = this.ds_splitSearch.addRow();
	var dRow = this.ds_productionOrder.rowposition;
	this.ds_splitSearch.setColumn(sRow, "PRODUCTIONORDERID", this.ds_productionOrder.getColumn(dRow, "PRODUCTIONORDERID"));
	this.ds_splitSearch.setColumn(sRow, "LINENO", this.ds_productionOrder.getColumn(dRow, "LINENO"));
	this.ds_splitSearch.setColumn(sRow, "ISSPLIT", "Y");
	
	var sSvcID = "updateProductionOrder_IsSplit";
	var sController = "/pcm00300/updateProductionOrder_IsSplit.do";
	var sInDatasets = "INPUT=ds_splitSearch";
	var sOutDatasets = "";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

//완료해제 버튼 클릭시
this.div_work_btn_splitRelease_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
    var bRtn = this.gfn_confirm("SplitRelease", "information")
	if(bRtn == false)  return;
	this.ds_splitSearch.clearData();
	var sRow = this.ds_splitSearch.addRow();
	var dRow = this.ds_productionOrder.rowposition;
	this.ds_splitSearch.setColumn(sRow, "PRODUCTIONORDERID", this.ds_productionOrder.getColumn(dRow, "PRODUCTIONORDERID"));
	this.ds_splitSearch.setColumn(sRow, "LINENO", this.ds_productionOrder.getColumn(dRow, "LINENO"));
	this.ds_splitSearch.setColumn(sRow, "ISSPLIT", "N");
	
	var sSvcID = "updateProductionOrder_IsSplit";
	var sController = "/pcm00300/updateProductionOrder_IsSplit.do";
	var sInDatasets = "INPUT=ds_splitSearch";
	var sOutDatasets = "";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};
// 생성취소 버튼 클릭시
this.div_work_btn_createCancel_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
    var bRow = this.ds_productionOrder.rowposition;
	var fRow =  this.ds_product.findRowExpr("CHK == '1'");
	if (fRow == -1)
	{
		this.gfn_Message("GridNoChecked", null, "error", "ok");	
		return false;
		
	}
	this.ds_productTemp.clearData();
	var productionOrderId = this.ds_productionOrder.getColumn(bRow, "PRODUCTIONORDERID");
	var lineNo            = this.ds_productionOrder.getColumn(bRow, "LINENO");
	var messArr           = new Array();
	    messArr[0]        = productionOrderId;
		messArr[1]        = lineNo;
		
	var bRtn = this.gfn_confirm("CancelCreateLotConfirm", "information", messArr)
	if(bRtn == false)  return;
	
	var cnt = 0;
	for(var i = 0 ; i < this.ds_product.getRowCount(); i++)
	{
		if (this.ds_product.getColumn(i, "CHK") == "1")
		{
			if (this.ds_product.getColumn(i, "ISLOTCREATE") == "Y")
			{
			   this.ds_productTemp.copyRow(this.ds_productTemp.addRow(), this.ds_product, i);
			  // trace(this.ds_productTemp.saveXML());
				cnt ++;
			}
		}
	}
	
	if (cnt == 0)
	{
		this.gfn_Message("NotExistsLotCreateCancel", null, "error", "ok");	
		return false;
	}
	
// 	for(var i = 0; i < this.ds_productTemp.getRowCount(); i++)
// 	{
// 		this.ds_productTemp.setColumn(i, "PRODUCTIONORDERID", productionOrderId);
// 		this.ds_productTemp.setColumn(i, "LINENO", lineNo);
// 	}
    this.ds_data.clearData();
	
	this.ds_data.addRow(); 
	this.ds_data.setColumn(0, "PRODUCTIONORDERID", productionOrderId);
	this.ds_data.setColumn(0, "LINENO", lineNo);
	
	var sSvcID = "CancelCreateLot";
	var sController = "/pcm00300/cancelCreateLot.do";
	var sInDatasets = "ds_data=ds_data ds_productTemp=ds_productTemp";
	var sOutDatasets = "";
	var sArgs = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
	
};

this.tab_search_Tabpage1_btn_productionOrderId_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	// gfn_openPopup(arg_type, popupCd, popupNm, rtnCols, paramCols, paramValues, searchStr);
	//-----------------
	// arg_type    : A::사용자가 선택, B:: 한건존재시 자동 셋팅
	// popupCd     : 공통팝업 관리 화면에서 생성되는 팝업코드
	// popupNm     : 변경할팝업화면명 , 변경하지 않을 경우 팝업화면 타이틀은 관리화면의 타이틀로 지정됨
	// rtnCols     : 구분자 : "|"   : 그리드에 출력될 컬럼 지정 (않을 경우 관리화면의 그리드로 출력됨)
	// paramCols   : 구분자 : "|" : where 구문에 들어갈 컬럼
	// paramValues : 구분자 : "|"  : where 구문에 들어갈 컬럼에 대한 값
	// searchStr   : 팝업 조회조건 콤보값 = 조회 값 
	 var txtSearch = ""
	if (!this.nfn_isNull(this.tab_search.Tabpage1.form.edt_productionOrderId.value))
	{
		txtSearch = "PRODUCTIONORDERID="+ this.tab_search.Tabpage1.form.edt_productionOrderId.value;
	}
	
	var popupId = "SEARCH_PRODUCTIONORDERID";
	var oArg = {};
	oArg.arg_type = "CA";
	oArg.arg_popupCd = "P00130";
	oArg.arg_popupNm = "";
	oArg.arg_rtnCols = "PRODUCTIONORDERID|PRODUCTDEFID|LINENO";
	oArg.arg_paramCols = "";
	oArg.arg_paramValues = "";
	oArg.arg_searchStr = txtSearch;
			   
	this.gfn_openPopup(popupId,"cmd::CMSA00100P.xfdl",oArg,"width=830,height=700");
};

this.div_work_grd_product_onheadclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	
};
]]></Script>
  </Form>
</FDL>
