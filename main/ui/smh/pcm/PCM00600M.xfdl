<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="PCM00600M" width="1258" height="747" titletext="LOT_CARD_출력" onload="fn_init">
    <Layouts>
      <Layout height="747" width="1258">
        <Div id="div_header" taborder="0" left="0" top="0" height="47" right="0" formscrolltype="both">
          <Layouts>
            <Layout>
              <Static id="Static00" taborder="0" left="0" top="0" cssclass="sta_WF_titleBG" right="0" bottom="0" text=""/>
              <Static id="Static01" taborder="1" left="47" top="0" width="60" height="20" cssclass="guideTip" visible="false" text="h20"/>
              <Button id="btn_searchOpen" taborder="2" left="0" top="16" width="30" height="24" cssclass="btn_WF_searchOpen" onclick="nfn_searchOpen_onclick"/>
              <Button id="btn_help" taborder="3" top="16" width="26" height="24" cssclass="btn_com_help" right="62" tooltiptext="MANUAL" initvalueid="x"/>
              <Button id="btn_print" taborder="4" top="16" width="26" height="24" cssclass="btn_com_print" right="31" tooltiptext="Toolbar_Print" onclick="fn_print" initvalueid="x"/>
              <Button id="btn_reset" taborder="5" top="16" width="26" height="24" cssclass="btn_com_reset" right="0" tooltiptext="Toolbar_Initialization" text="" initvalueid="x"/>
              <Button id="btn_favorite" taborder="6" left="168" top="16" width="24" height="24" cssclass="btn_WF_favorite"/>
              <Static id="sta_title" taborder="7" text="LOT CARD 출력" left="30" top="16" width="138" height="24" cssclass="sta_WF_title" fittocontents="width" tooltiptext="MENU_PG-SG-0070" expr="nexacro.getApplication().gds_menu.lookup(&quot;PGM_ID&quot;,comp.parent.parent.parent.name,&quot;MENU_NM&quot;)"/>
            </Layout>
          </Layouts>
        </Div>
        <Tab id="tab_search" taborder="1" tabindex="0" left="0" top="47" width="290" cssclass="tab_search" bottom="0">
          <Tabpages>
            <Tabpage id="Tabpage1" text="Tabpage1">
              <Layouts>
                <Layout>
                  <Static id="Static00" text="w&#13;&#10;15" width="15" height="290" left="0" top="0" visible="false" cssclass="guideTip"/>
                  <Static id="Static01" text="w&#13;&#10;15" width="15" height="290" top="0" right="0" visible="false" cssclass="guideTip"/>
                  <Static id="Static02" text="h10" width="45" height="10" top="0" right="91" visible="false" cssclass="guideTip"/>
                  <Static id="Static03" text="h5" width="45" height="5" top="30" right="91" visible="false" cssclass="guideTip"/>
                  <Static id="sta_plantid" text="Site" width="103" height="20" left="0" top="10" cssclass="sta_WF_label"/>
                  <Combo id="cbo_plantid" taborder="1" width="165" height="20" left="sta_plantid:5" bottom="sta_plantid:-20" index="0" text="선택" codecolumn="C,SiteType,ALL,Y,Y"/>
                  <Static id="sta_inputdate" text="투입기간" width="103" height="20" left="0" top="sta_plantid:5" cssclass="sta_WF_label"/>
                  <Calendar id="cal_inputdate_s" taborder="2" height="20" left="sta_inputdate:5" right="15" bottom="sta_inputdate:-20" dateformat="yyyy-MM-dd" oninput="tab_search_Tabpage1_cal_inputdate_oninput"/>
                  <Combo id="cbo_inputdatetype" taborder="3" width="88" height="20" left="Static00:0" top="sta_inputdate:5" index="1" value="" codecolumn="C,searchPeriodType,,Y,Y" onitemchanged="tab_search_Tabpage1_cbo_inputdatetype_onitemchanged"/>
                  <Calendar id="cal_inputdate_e" taborder="2" height="20" left="cbo_inputdatetype:5" right="15" bottom="cbo_inputdatetype:-20" dateformat="yyyy-MM-dd" oninput="tab_search_Tabpage1_cal_inputdate_oninput"/>
                  <Static id="sta_productdefid" text="품목코드" width="103" height="20" left="0" top="cbo_inputdatetype:5" cssclass="sta_WF_label"/>
                  <Edit id="edt_productdefid" taborder="4" height="20" left="sta_productdefid:5" right="37" bottom="sta_productdefid:-20"/>
                  <Button id="btn_productdefid" taborder="5" width="22" height="20" right="15" bottom="sta_productdefid:-20" cssclass="btn_WF_finder" onclick="tab_search_Tabpage1_btn_popup_onclick"/>
                  <Static id="sta_productdefversion" text="Rev." width="103" height="20" left="0" top="sta_productdefid:5" cssclass="sta_WF_label"/>
                  <Combo id="cbo_productdefversion" taborder="6" width="165" height="20" left="sta_productdefversion:5" bottom="sta_productdefversion:-20" index="0" text="선택" codecolumn="CODECOLUMN" datacolumn="DATACOLUMN" innerdataset="innerdataset">
                    <Dataset id="innerdataset">
                      <ColumnInfo>
                        <Column id="CODECOLUMN" size="256"/>
                        <Column id="DATACOLUMN" size="256"/>
                      </ColumnInfo>
                      <Rows>
                        <Row>
                          <Col id="CODECOLUMN"/>
                          <Col id="DATACOLUMN">전체</Col>
                        </Row>
                      </Rows>
                    </Dataset>
                  </Combo>
                  <Static id="sta_productname" text="품목명" width="103" height="20" left="0" top="sta_productdefversion:5" cssclass="sta_WF_label"/>
                  <Edit id="edt_productname" taborder="7" height="20" left="sta_productname:5" right="15" bottom="sta_productname:-20"/>
                  <Static id="sta_lotid" text="Lot No." width="103" height="20" left="0" top="sta_productname:5" cssclass="sta_WF_label"/>
                  <Edit id="edt_lotid" taborder="8" height="20" left="sta_lotid:5" right="37" bottom="sta_lotid:-20"/>
                  <Button id="btn_lotid" taborder="9" width="22" height="20" right="15" bottom="sta_lotid:-20" cssclass="btn_WF_finder" onclick="tab_search_Tabpage1_btn_popup_onclick"/>
                  <Static id="sta_areaid" text="작업장" width="103" height="20" left="0" top="sta_lotid:5" cssclass="sta_WF_label"/>
                  <Edit id="edt_areaid" taborder="10" height="20" left="sta_areaid:5" right="37" bottom="sta_areaid:-20"/>
                  <Button id="btn_areaid" taborder="11" width="22" height="20" right="15" bottom="sta_areaid:-20" cssclass="btn_WF_finder" onclick="tab_search_Tabpage1_btn_popup_onclick"/>
                  <Static id="sta_lottype" text="생산구분" width="103" height="20" left="0" top="sta_areaid:5" cssclass="sta_WF_label"/>
                  <Combo id="cbo_lottype" taborder="12" width="165" height="20" left="sta_lottype:5" bottom="sta_lottype:-20" index="0" text="선택" codecolumn="C,ProductionType,ALL,Y,Y"/>
                  <Static id="sta_productdeftype" text="제품구분" width="103" height="20" left="0" top="sta_lottype:5" cssclass="sta_WF_label"/>
                  <Combo id="cbo_productdeftype" taborder="13" width="165" height="20" left="sta_productdeftype:5" bottom="sta_productdeftype:-20" index="0" text="선택" codecolumn="C,ProductDivision2,ALL,Y,Y"/>
                  <Static id="sta_worktype" text="작업구분" width="103" height="20" left="0" top="sta_productdeftype:5" cssclass="sta_WF_label"/>
                  <Combo id="cbo_worktype" taborder="14" width="165" height="20" left="sta_worktype:5" bottom="sta_worktype:-20" index="0" text="선택" codecolumn="C,LotWorkType,ALL,Y,Y"/>
                  <Static id="sta_wipstate" text="재공상태" width="103" height="20" left="0" top="sta_worktype:5" cssclass="sta_WF_label"/>
                  <Combo id="cbo_wipstate" taborder="15" width="165" height="20" left="sta_wipstate:5" bottom="sta_wipstate:-20" index="0" text="선택" codecolumn="C,WipState,ALL,Y,Y"/>
                  <Static id="sta_productionorderid" text="S/O번호" width="103" height="20" left="0" top="sta_wipstate:5" cssclass="sta_WF_label"/>
                  <Edit id="edt_productionorderid" taborder="16" height="20" left="sta_productionorderid:5" right="37" bottom="sta_productionorderid:-20"/>
                  <Button id="btn_productionorderid" taborder="17" width="22" height="20" right="15" bottom="sta_productionorderid:-20" cssclass="btn_WF_finder" onclick="tab_search_Tabpage1_btn_popup_onclick"/>
                  <Static id="Static04" text="h20" width="45" height="20" top="sta_productionorderid:0" right="91" visible="false" cssclass="guideTip"/>
                  <Button id="btn_search" taborder="18" text="검색" width="146" height="36" left="15" top="Static04:0" tooltiptext="Toolbar_Search" cssclass="btn_SA_search" onclick="fn_search"/>
                  <Static id="Static05" text="w&#13;&#10;10" width="10" height="27" bottom="btn_search:-32" left="161" visible="false" cssclass="guideTip"/>
                  <Button id="btn_clear2" taborder="19" text="초기화" width="102" height="36" top="Static04:0" left="171" tooltiptext="Toolbar_Initialization" cssclass="btn_SA_reset" onclick="fn_searchClear"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Div id="div_work" taborder="2" text="div_00" left="300" top="47" right="0" bottom="0">
          <Layouts>
            <Layout>
              <Button id="btn_xlDn_grd_lotcardlist" taborder="1" top="6" width="29" height="24" cssclass="btn_WF_grdExcelDown" tooltiptext="GridExport" right="0" initvalueid="x"/>
              <Grid id="grd_lotcardlist" taborder="0" left="0" top="34" right="0" bottom="0" autoenter="select" binddataset="ds_lotcardlist">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="40"/>
                      <Column size="40"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="99"/>
                      <Column size="39"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="65"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text=""/>
                      <Cell col="1" text="" displaytype="checkboxcontrol" edittype="checkbox"/>
                      <Cell col="2" text="S/O번호"/>
                      <Cell col="3" text="Site ID"/>
                      <Cell col="4" text="작업구분"/>
                      <Cell col="5" text="작업장"/>
                      <Cell col="6" text="품목코드"/>
                      <Cell col="7" text="Rev."/>
                      <Cell col="8" text="품목명"/>
                      <Cell col="9" text="Lot No."/>
                      <Cell col="10" text="공정수순"/>
                      <Cell col="11" text="공정명"/>
                      <Cell col="12" text="UOM"/>
                      <Cell col="13" text="PNL"/>
                      <Cell col="14" text="PCS"/>
                      <Cell col="15" text="MM"/>
                      <Cell col="16" text="투입일자"/>
                      <Cell col="17" text="생산구분"/>
                    </Band>
                    <Band id="body">
                      <Cell expr="expr:currow + 1" textAlign="center"/>
                      <Cell col="1" displaytype="checkboxcontrol" edittype="checkbox"/>
                      <Cell col="2"/>
                      <Cell col="3"/>
                      <Cell col="4"/>
                      <Cell col="5"/>
                      <Cell col="6"/>
                      <Cell col="7"/>
                      <Cell col="8"/>
                      <Cell col="9"/>
                      <Cell col="10"/>
                      <Cell col="11"/>
                      <Cell col="12"/>
                      <Cell col="13"/>
                      <Cell col="14"/>
                      <Cell col="15"/>
                      <Cell col="16"/>
                      <Cell col="17" combocodecol="C,ProductionType,,Y," displaytype="combotext" text="bind:LOTTYPE"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <CheckBox id="chk_MATERIALPRINT" taborder="2" text="자재출력" top="8" height="20" value="false" readonly="false" fittocontents="width" tooltiptext="MATERIALPRINT" accessibilityenable="true" right="btn_xlDn_grd_lotcardlist:10" width="74"/>
              <Static id="sta_subMainTitle" taborder="3" text="LOT CARD 출력" left="0" height="34" cssclass="sta_WF_subTitle" top="0" fittocontents="width" width="120" tooltiptext="MENU_PG-SG-0070"/>
              <Static id="sta_cnt_ds_lotcardlist" taborder="4" text="Count : &lt;fc v=&quot;#f31d24&quot;&gt;0&lt;/fc&gt;" left="122" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" padding="5px 0px 0px" width="178"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="sta_searchTitle" taborder="3" text="검색조건" left="0" top="47" width="281" height="34" cssclass="sta_WF_subTitle" fittocontents="width" usedecorate="true" tooltiptext="SEARCH_CONDITION_GROUP"/>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[/***************************************************************************************
 * 시스템명 	: IFC MES시스템
 * 업무명 		: LOT CARD 출력
 * 파일명 		: PCM00600M.xfdl
 * 작성자 		: 장병곤
 * 작성일 		: 2021.03.09
 *
 * 설  명		:  조회/수정/삭제/엑셀다운로드 기능 제공
 *---------------------------------------------------------------------------------------
 * 변경일		변경자		변경내역
 *---------------------------------------------------------------------------------------
 * 2021.03.09	장병곤   	최초작성
 *---------------------------------------------------------------------------------------
 ****************************************************************************************/

/**************************************************************************
 * 1. 필수 include
 ***************************************************************************/
include "lib::lib_bas.xjs";	//기준관리 공통 라이브러리 include

/**************************************************************************
 * 2. FORM 변수 선언 영역
 ***************************************************************************/
this.fv_currDate;

/**************************************************************************
 * 3. FORM LOAD
 ***************************************************************************/
this.fn_init = function (obj:Form, e:nexacro.LoadEventInfo)
{
	this.fn_initParam();	
	this.nfn_formInit(obj);	
	this.fn_initCombo();
	this.fn_initGrid();	
	this.fn_initEvent();
};

/* 초기값 셋팅 */
this.fn_initParam = function ()
{
	/*
	// 화면 호출시 셋팅된 argument 가 존재하면 가져온다.
	var sArgName = this.gfn_getFrameAguments("menuName");
	if (sArgName != "")
	{
		trace("PCM04900M argument : ?" + sArgName);
		var sArgArr = this.gfn_getFrameAguments("objList");
		trace("PCM04900M argument : ?" + sArgArr);
	}
	*/
}

/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 기능 : 검색
*/
/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 기능 : 검색
*/
this.fn_search = function (obj:Button, e:nexacro.ClickEventInfo)
{
	 if (this.nfn_isNull(this.tab_search.Tabpage1.form.cal_inputdate_s.value))
	{
		this.gfn_Message("투입기간(FROM)을 입력햐여 주십시요", "", "error", "ok");
		this.tab_search.Tabpage1.form.cal_inputdate_s.setFocus();
		return false;
	}
	if (this.nfn_isNull(this.tab_search.Tabpage1.form.cal_inputdate_e.value))
	{
		this.gfn_Message("투입기간(To)을 입력햐여 주십시요", "", "error", "ok");
		this.tab_search.Tabpage1.form.cal_inputdate_e.setFocus();
		return false;
	}
	
	this.ds_search.setColumn( 0, "P_PRODUCTDEFVERSION_T", this.tab_search.Tabpage1.form.cbo_productdefversion.value );
	this.ds_lotcardlist.clearData();
	
	var sSvcID 			= "selectLotCardList";
	var sController 	= "/pcm00600/selectPrintLotCardList.do";
	var sInDatasets 	= "INPUT=ds_search";
	var sOutDatasets 	= "ds_lotcardlist=output";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

/*
 * 기능 : 저장
*/
this.fn_save = function (obj:Button, e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 검색 초기화
*/
this.fn_searchClear = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.tab_search.Tabpage1.form.edt_productdefid.set_value(      "" );
	this.tab_search.Tabpage1.form.edt_productname.set_value(       "" );
	this.tab_search.Tabpage1.form.edt_lotid.set_value(             "" );
	this.tab_search.Tabpage1.form.edt_areaid.set_value(            "" );
	this.tab_search.Tabpage1.form.edt_productionorderid.set_value( "" );

	this.ds_search.setColumn( 0, "P_USER",             this.gf_getUserAcnt() );
	this.ds_search.setColumn( 0, "P_LANGUAGETYPE", this.gf_getLanguageType() );
	this.ds_search.setColumn( 0, "P_PLANTID",          this.gf_getSiteType() );
	
	for (var i = 0; i < this.ds_search.getColCount(); i++)
	{
		switch (this.ds_search.getColID(i))
		{
			case "P_USER"         : 
			case "P_LANGUAGETYPE" : 
			case "P_PLANTID"      :
			{
			}
			break;
			default :
			{
				this.ds_search.setColumn( 0, this.ds_search.getColID(i), "" );
			}
			break;
		}
	};
	
	this.tab_search.Tabpage1.form.cbo_inputdatetype.set_value( "THISWEEK" );
	this.tab_search.Tabpage1.form.cal_inputdate_s.set_value( this.ds_periodType.getColumn( 0, "THISWEEK_S" ) );
	this.tab_search.Tabpage1.form.cal_inputdate_e.set_value( this.ds_periodType.getColumn( 0, "THISWEEK_E" ) );

	this.tab_search.Tabpage1.form.cbo_lottype.set_index(        0 );
	this.tab_search.Tabpage1.form.cbo_productdeftype.set_index( 0 );
	this.tab_search.Tabpage1.form.cbo_worktype.set_index(       0 );
	this.tab_search.Tabpage1.form.cbo_wipstate.set_index(       0 );
};

/*
 * 기능 : 신규
*/
this.fn_new = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 삭제
*/
this.fn_delete = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 도움말  => 공통 처리
*/
this.fn_help = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 출력
*/
this.fn_print = function(obj:nexacro.Button, e:nexacro.ClickEventInfo)
{
	// trace( '>>>>  ? ' +  this.ds_lotcardlist.saveXML() );	
	var chk = [];
	var wok = [];
	for (var i = 0; i < this.ds_lotcardlist.rowcount; i++)
	{
		if (this.ds_lotcardlist.getColumn( i, "CHK" ) == true)
		{
			chk.push(                                                            this.ds_lotcardlist.getColumn( i, "LOTID" ) );
			wok.push( this.ds_lotcardlist.getColumn( i, "LOTID" ) + "|" + this.ds_lotcardlist.getColumn( i, "WORKTYPENAME" ) );
		}
		else
		{
			continue;
		}
	}

	if (chk.length <= 0)
	{
		this.gfn_Message("SelectPrintLot 선택 해주십시요", "", "error", "ok");
		return;
	}
	
	this.ds_search.setColumn( 0, "P_LOTID_T",        chk );
	this.ds_search.setColumn( 0, "P_WORKTYPENAME_T", wok );
	  
	var sSvcID 			= "selectLotInfoOnPrintLotCard";
	var sController 	= "/pcm00600/selectLotInfoOnPrintLotCard.do";
	var sInDatasets 	= "INPUT=ds_search";
	var sOutDatasets 	= "ds_lotinfoonprintlotcard=output";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);

};

/*
 * 기능 : work영역 초기화  => 공통처리
*/
this.fn_reset = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/**************************************************************************
 * 5. TRANSACTION, CALLBACK 영역
 ***************************************************************************/
this.fn_callBack = function (trId, errCD, errMsg)
{
	trace('fn_callBack trId ?' + trId);
	//this.div_work.form.staTitle.set_text( "LOT CARD 출력 <fc v='#f31d24'>" + this.ds_lotcardlist.getRowCount() + "</fc><fc v='#999999'> 건</fc>" );
	if (errCD != 0) 
	{
		this.gfn_Message("ProcessingError", trId + errMsg, "error", "ok");
		return;
	}

	switch (trId)
	{
		case "selectComboList" : 
		{
			this.addChild("ds_productdefversion", new Dataset());
			this.ds_productdefversion.addColumn( "CODECOLUMN", "STRING", 255);
			this.ds_productdefversion.addColumn( "DATACOLUMN", "STRING", 255);
			this.ds_combo.filter( "" );
			this.ds_combo.filter("CODECOLYPE == 'ALL' || CODECOLYPE == 'REV'");
			this.ds_productdefversion.copyData(this.ds_combo, true);
			this.tab_search.Tabpage1.form.cbo_productdefversion.setInnerDataset( this.ds_productdefversion );
			
			this.basfn_getPeriodData( "ds_periodType" );
			this.tab_search.Tabpage1.form.cbo_inputdatetype.set_value( "THISWEEK" );
			this.tab_search.Tabpage1.form.cal_inputdate_s.set_value( this.ds_periodType.getColumn( 0, "THISWEEK_S" ) );
			this.tab_search.Tabpage1.form.cal_inputdate_e.set_value( this.ds_periodType.getColumn( 0, "THISWEEK_E" ) );

			this.tab_search.Tabpage1.form.cbo_lottype.set_index(        0 );
			this.tab_search.Tabpage1.form.cbo_productdeftype.set_index( 0 );
			this.tab_search.Tabpage1.form.cbo_worktype.set_index(       0 );
			this.tab_search.Tabpage1.form.cbo_wipstate.set_index(       0 );
			
			this.addChild("ds_lotinfoonprintlotcard",                   new Dataset() );
			this.addChild("ds_processresultandroutingforlotcardnormal", new Dataset() );
		}
		break;
		case "selectLotCardList" : 
		{
			if (this.ds_lotcardlist.getRowCount() == 0)
			{
				this.gfn_Message("NoSelectData", null, "error", "ok");
				return;
			};	
			
			this.ds_lotcardlist.addColumn( "CHK", "STRING", 255 );
			this.ds_lotcardlist.getColumnInfo("PNL").type = "FLOAT";
			this.ds_lotcardlist.getColumnInfo("PCS").type = "FLOAT";
			this.ds_lotcardlist.getColumnInfo("MM").type = "FLOAT";
			//this.div_work.form.staTitle.set_text( "LOT CARD 출력 <fc v='#f31d24'>" + this.ds_lotcardlist.getRowCount() + "</fc><fc v='#999999'> 건</fc>" );
		}
		break;
		case "selectLotInfoOnPrintLotCard"  :
		{
			trace( 'ds_processresultandroutingforlotcardnormal :: ? ' +  this.ds_lotinfoonprintlotcard.saveXML() );	
			if (this.ds_lotinfoonprintlotcard.rowcount < 1)
			{
				this.gfn_Message("NoSelectData", null, "error", "ok");
				return;
			};
			
			var sSvcID 			= "selectProcessResultAndRoutingForLotCardNormal";
			var sController 	= "/pcm00600/selectProcessResultAndRoutingForLotCardNormal.do";
			var sInDatasets 	= "INPUT=ds_search";
			var sOutDatasets 	= "ds_processresultandroutingforlotcardnormal=output";
			var sArgs 			= "";
			this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
		}
		break;
		case "selectProcessResultAndRoutingForLotCardNormal" :
		{
			trace( 'ds_processresultandroutingforlotcardnormal :: ? ' +  this.ds_processresultandroutingforlotcardnormal.saveXML() );	
			if (this.ds_lotinfoonprintlotcard.rowcount < 1)
			{
				this.gfn_Message("NoSelectData", null, "error", "ok");
				return;
			};
			
			//정상 LOTCARD와 재작업LOTCARD 분리해서 리포트 출력
			var nomalChk = [];
			var nomalWok = [];
			var reworkChk = [];
			var reworkWok = [];
			for (var i = 0; i < this.ds_lotcardlist.rowcount; i++)
			{
				if (this.ds_lotcardlist.getColumn( i, "CHK" ) == true)
				{
					if(this.ds_lotcardlist.getColumn( i, "WORKTYPE") == "Normal")
					{
						nomalChk.push(                                                            this.ds_lotcardlist.getColumn( i, "LOTID" ) );
						nomalWok.push( this.ds_lotcardlist.getColumn( i, "LOTID" ) + "|" + this.ds_lotcardlist.getColumn( i, "WORKTYPENAME" ) );
					}
					else
					{
						reworkChk.push(                                                            this.ds_lotcardlist.getColumn( i, "LOTID" ) );
						reworkWok.push( this.ds_lotcardlist.getColumn( i, "LOTID" ) + "|" + this.ds_lotcardlist.getColumn( i, "WORKTYPENAME" ) );
					}
				}
				else
				{
					continue;
				}
			}
			//[M210616F001-1-FG-006-004][ko-KR][M210616F001-1-FG-006-004|정상][M210616F002-1-FG-010-001]			
			//2개이상일때 [M210616F001-1-FG-006-004,M210616F001-1-FG-006-004][ko-KR][M210616F001-1-FG-006-004|정상,M210616F001-1-FG-006-004|정상][M210616F001-1-FG-006-004,M210616F001-1-FG-006-004]
			var nomalFieId = "[" + nomalChk + "][" + this.ds_search.getColumn( 0, "P_LANGUAGETYPE" ) + "][" +  nomalWok +  "]";
			//[M210616F002-1-FG-010-001] [ko-KR] [M210616F002-1-FG-010-001|재작업]
			//2개이상일때 [M210616F002-1-FG-010-001,M210616F002-1-FG-010-001] [ko-KR] [M210616F002-1-FG-010-001|재작업,M210616F002-1-FG-010-001|재작업]
			var reworkFieId = "[" + reworkChk + "][" + this.ds_search.getColumn( 0, "P_LANGUAGETYPE" ) + "][" +  reworkWok +  "]";
			
			
			if(this.div_work.form.chk_MATERIALPRINT.value == true)
			{
				nomalFieId = nomalFieId + "[" +  nomalChk +  "]";
			}
			else
			{
				nomalFieId = nomalFieId + "[]";
			}
			//정상
			if (nomalChk.length > 0)
			{
				var oArg = {
					sRptPath   : "/pcm/",
					sRptName   : "PCM00600R.mrd",
					strField   : nomalFieId,
					bModalless : false
				};
				
				var sOption = "titletext=LOT CARD 출력,modeless=false";
				this.gfn_reportPopup("reportViewer", "common::com_report.xfdl", oArg, sOption);
			}
			//재작업
			if (reworkChk.length > 0)
			{
				var oArg = {
					sRptPath   : "/pcm/",
					sRptName   : "PCM02900R.mrd",
					strField   : reworkFieId,
					bModalless : false
				};
				
				var sOption = "titletext=LOT CARD 출력,modeless=false";
				this.gfn_reportPopup("reportViewerRework", "common::com_report.xfdl", oArg, sOption);
			}
 			
		}
		break;
		default :
		{
		}
	};

};

/**************************************************************************
 * 6. 팝업 호출/콜백
 **************************************************************************/
this.fn_popupAfter = function(sPopupId, Variant)
{  
	var rtn = this.fv_rtnValue;	
	if (this.nfn_isNull(rtn)) 
	{
		return;
	};
	
	trace( '>>>>  ? ' + sPopupId + ':' +  rtn);	
	switch (sPopupId)
	{
		case "POPUP_PRODUCTDEFID" : 
		{
			rtn = this.gfn_split(rtn, ",");
			if (rtn.length == 3)
			{
				this.tab_search.Tabpage1.form.edt_productdefid.set_value(      rtn[0] );
				this.tab_search.Tabpage1.form.edt_productname.set_value(       rtn[1] );
				this.tab_search.Tabpage1.form.cbo_productdefversion.set_value( rtn[2] );
			}
			else
			{
				var productdefid      = [];
				var productname       = [];
				var productdefversion = [];
				for (var i = 0; i < rtn.length; i++)
				{
					if ((i % 3)     == 0)
					{
						productdefid.push(rtn[i]);
					} 
					else if ((i % 3) == 1)
					{
						productname.push(rtn[i]);
					}
					else
					{
						productdefversion.push(rtn[i]);
					}
				}
				
				this.tab_search.Tabpage1.form.edt_productdefid.set_value( productdefid.join( "," ) );
				this.tab_search.Tabpage1.form.edt_productname.set_value(                        "" );
				
				this.ds_search.setColumn( 0, "P_PRODUCTDEFID",             productdefid.join( "," ) );
				this.ds_search.setColumn( 0, "P_PRODUCTDEFVERSION_T", productdefversion.join( "," ) );
				this.tab_search.Tabpage1.form.cbo_productdefversion.set_index(                   0 );
			}
		}
		break;
		case "POPUP_LOTID" :
		{
			this.tab_search.Tabpage1.form.edt_lotid.set_value(rtn);
		}	
		break;
		case "POPUP_AREAID" :
		{
			rtn = this.gfn_split(rtn, ",");
			if (rtn.length == 2)
			{
				this.tab_search.Tabpage1.form.edt_areaid.set_value(rtn[1]);
				this.ds_search.setColumn( 0, "P_AREAID",      rtn[0] );
			}
			else
			{
				var value = [];
				var dsval = [];
				for (var i = 0; i < rtn.length; i++)
				{
					if ((i % 2) == 0)
					{
						dsval.push(rtn[i]);
					}
					else
					{
						value.push(rtn[i]);
					}
				}
				
				this.tab_search.Tabpage1.form.edt_areaid.set_value(value.join(","));
				this.ds_search.setColumn( 0, "P_AREAID",          dsval.join(",") );
			}
		}	
		break;
		case "POPUP_PRODUCTIONORDERID" :
		{
			this.tab_search.Tabpage1.form.edt_productionorderid.set_value( rtn);
			this.ds_search.setColumn(           0, "P_PRODUCTIONORDERID", rtn );
		}	
		break;
		default:
		{
		}
		break;
	};
};

/**************************************************************************
 * 7. 기타 함수(화면 로컬 정의) 
 **************************************************************************/
this.fn_initCombo = function ()
{ 
	var search = [
		 "P_USER"
		,"P_LANGUAGETYPE"
		,"P_PLANTID"
		,"P_INPUTDATE_S"
		,"P_INPUTDATE_E"
		,"P_PRODUCTDEFID"
		,"P_PRODUCTDEFVERSION"
		,"P_PRODUCTNAME"
		,"P_LOTID"
		,"P_AREAID"
		,"P_LOTTYPE"
		,"P_PRODUCTDEFTYPE"
		,"P_PROCESSSEGMENTID"
		,"P_LOTTYPE"
		,"P_WORKTYPE"
		,"P_WIPSTATE"
		,"P_PRODUCTIONORDERID"
		,"P_PRODUCTDEFVERSION_T"
		,"P_LOTID_T"
		,"P_WORKTYPENAME_T"
	];

	for (var i = 0; i < search.length; i++)
	{
		this.ds_search.addColumn( search[i], "STRING", 255);
	};

	this.ds_search.addRow();
	for (var i = 0; i < search.length; i++)
	{
		this.ds_search.setColumn( 0, search[i], "" );
	};
	this.ds_search.setColumn( 0, "P_USER",             this.gf_getUserAcnt() );
	this.ds_search.setColumn( 0, "P_LANGUAGETYPE", this.gf_getLanguageType() );
	this.ds_search.setColumn( 0, "P_PLANTID",          this.gf_getSiteType() );
	
	var sSvcID 			= "selectComboList";
	var sController 	= "/pcm04900/selectComboList.do";
	var sInDatasets 	= "INPUT=ds_search";
	var sOutDatasets 	= "ds_combo=output";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};
 
this.fn_initGrid = function ()
{
	// ds 세팅 및 포맷타입 설정
	var layout = [
		 ""						//
		,"CHK"					// 
		,"PRODUCTIONORDERID"	// S/O번호
		,"PLANTID"				// Site ID
		,"WORKTYPENAME"			// 작업구분
		,"AREANAME"				// 작업장
		,"PRODUCTDEFID"			// 품목코드
		,"PRODUCTDEFVERSION"	// Rev.
		,"PRODUCTDEFNAME"		// 품목명
		,"LOTID"				// Lot No
		,"USERSEQUENCE"			// 공정수순
		,"PROCESSSEGMENTNAME"	// 공정명
		,"UOM"					// UOM
		,"PNL"					// PNL
		,"PCS"					// PCS
		,"MM"					// MM
		,"INPUTDATE"            // 투입일자
	];

	// ds 세팅 및 포맷타입 설정
	var type = [
		 ""				//
		,""		        // 
		,"LEFT"			// S/O번호
		,"CENTER"		// Site ID
		,"CENTER"	    // 작업구분
		,"LEFT"			// 작업장
		,"LEFT"			// 품목코드
		,"LEFT"			// Rev.
		,"CENTER"		// 품목명
		,"CENTER"		// Lot No
		,"CENTER"		// 공정수순
		,"CENTER"		// 공정명
		,"RIGHT"		// UOM
		,"RIGHT"		// PNL
		,"RIGHT"		// PCS
		,"RIGHT"		// MM
		,"RIGHT"		// 투입일자
	];
	
	this.ds_layout.addColumn( "BIND_ID", "STRING", 255);
	this.ds_layout.addColumn( "TYPE_ID", "STRING", 255);
	for (var i = 0; i < layout.length; i++)
	{
		this.ds_layout.addRow();
		this.ds_layout.setColumn( i, "BIND_ID", layout[i] );
		this.ds_layout.setColumn( i, "TYPE_ID",   type[i] );
	};

	for (var i = 0; i < layout.length; i++)
	{
		this.div_work.form.grd_lotcardlist.setCellProperty( "body", i, "text", "bind:" + this.ds_layout.getColumn( i, "BIND_ID" ) );
		if (this.ds_layout.getColumn( i, "BIND_ID" ) != "CHK")
		{
			this.div_work.form.grd_lotcardlist.setCellProperty( "body", i, "displaytype",                               "normal"  );
		}
		
		this.div_work.form.grd_lotcardlist.setCellProperty( "body", i, "textAlign",      this.ds_layout.getColumn( i, "TYPE_ID" ) );
	};
	
	this.div_work.form.grd_lotcardlist.setFormatColProperty(  2, "size",  70 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty(  3, "size",  60 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty(  4, "size",  70 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty(  5, "size", 120 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty(  6, "size",  70 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty(  7, "size",  40 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty(  8, "size", 240 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty(  9, "size", 200 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty( 10, "size",  60 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty( 11, "size", 140 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty( 12, "size",  60 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty( 13, "size",  60 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty( 14, "size",  60 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty( 15, "size",  60 );
	this.div_work.form.grd_lotcardlist.setFormatColProperty( 16, "size", 140 );
};

this.fn_initEvent = function ()
{
	this.tab_search.Tabpage1.form.btn_edt_productdefid.addEventHandler( "onclick", this.tab_search.Tabpage1.form.btn_edt_onclick, this);
};
 
/**************************************************************************
 * 8. 이벤트
 ***************************************************************************/
this.tab_search.Tabpage1.form.btn_edt_onclick = function(obj:nexacro.Button, e:nexacro.ClickEventInfo)
{
	trace( '>>>>  ? ' + ':' +  obj.name );	
	switch(obj.name)
	{
		case "btn_edt_productdefid" :
		case "btn_edt_productname"  :
		{
			this.ds_search.setColumn( 0, "P_PRODUCTDEFID",              "" );
			this.tab_search.Tabpage1.form.cbo_productdefversion.set_index(0);
			this.ds_search.setColumn( 0, "P_PRODUCTNAME",               "" );
			this.ds_search.setColumn( 0, "P_PRODUCTDEFVERSION_T",       "" );
		}
		break;
		default :
		{
		}
	};
};
 
this.tab_search_Tabpage1_btn_popup_onclick = function(obj:nexacro.Button, e:nexacro.ClickEventInfo)
{

	// gfn_openPopup(arg_type, popupCd, popupNm, rtnCols, paramCols, paramValues, searchStr);
	//-----------------
	// arg_type    : A::사용자가 선택, B:: 한건존재시 자동 셋팅 : C:
	// popupCd     : 공통팝업 관리 화면에서 생성되는 팝업코드
	// popupNm     : 변경할팝업화면명 , 변경하지 않을 경우 팝업화면 타이틀은 관리화면의 타이틀로 지정됨
	// rtnCols     : 구분자 : "|"   : 그리드에 출력될 컬럼 지정 (않을 경우 관리화면의 그리드로 출력됨)
	// paramCols   : 구분자 : "|" : where 구문에 들어갈 컬럼
	// paramValues : 구분자 : "|"  : where 구문에 들어갈 컬럼에 대한 값
	// searchStr   : 팝업 조회조건 콤보값 = 조회 값 
	var oArg = {};
	switch(obj.name)
	{
		case "btn_productdefid" :
		{
			if (this.tab_search.Tabpage1.form.edt_productdefid.value != "")
			{
				oArg.arg_type        = "CA"; 
			}
			else
			{
				oArg.arg_type        = "C"; 
			}
			oArg.arg_popupCd     = "P00160";
			oArg.arg_popupNm     = "품목 선택";
			oArg.arg_rtnCols     = "PRODUCTDEFID|PRODUCTDEFNAME|PRODUCTDEFVERSION";
			oArg.arg_paramCols   = "P_POPTYPE";
			oArg.arg_paramValues = "PRODUCTDEFINITION";
			oArg.arg_searchStr   = "P_PRODUCTDEFNAME=" + this.tab_search.Tabpage1.form.edt_productdefid.value;
			this.gfn_openPopup( "POPUP_PRODUCTDEFID", "cmd::CMSA00100P.xfdl", oArg, "width=800,height=800");
		}
		break;
		case "btn_lotid" :
		{
			if (this.ds_search.getColumn( 0, "P_LOTID" ) != "")
			{
				oArg.arg_type        = "BA"; 
			}
			else
			{
				oArg.arg_type        = "B"; 
			}
			oArg.arg_popupCd     = "P00159";
			oArg.arg_popupNm     = "Lot No 선택";
			oArg.arg_rtnCols     = "LOTID";
			oArg.arg_paramCols   = "P_POPTYPE|P_LANGUAGETYPE";
			oArg.arg_paramValues = "LOTID|" + this.gf_getLanguageType();
			oArg.arg_searchStr   = "P_LOTID=" + this.ds_search.getColumn( 0, "P_LOTID" );
			this.gfn_openPopup( "POPUP_LOTID", "cmd::CMSA00100P.xfdl", oArg, "width=800,height=800");
		}
		break;
		case "btn_areaid" :
		{
			if (this.ds_search.getColumn( 0, "P_AREAID" ) != "")
			{
				oArg.arg_type        = "CA"; 
			}
			else
			{
				oArg.arg_type        = "C"; 
			}
			oArg.arg_popupCd     = "P00157";
			oArg.arg_popupNm     = "작업장 선택";
			oArg.arg_rtnCols     = "AREAID|AREANAME";
			oArg.arg_paramCols   = "P_POPTYPE|P_LANGUAGETYPE|P_USER|P_PLANTID";
			oArg.arg_paramValues = "AREALISTBYAUTHORITY|" + this.gf_getLanguageType() + "|" + this.gf_getUserAcnt() + "|" + this.ds_search.getColumn( 0, "P_PLANTID" );
			oArg.arg_searchStr   = "P_DICTIONARY=" +this.tab_search.Tabpage1.form.edt_areaid.value;
			this.gfn_openPopup( "POPUP_AREAID", "cmd::CMSA00100P.xfdl", oArg, "width=800,height=800");
		}
		break;
		case "btn_productionorderid" :
		{
			if (this.ds_search.getColumn( 0, "P_PRODUCTIONORDERID" ) != "")
			{
				oArg.arg_type        = "BA"; 
			}
			else
			{
				oArg.arg_type        = "B"; 
			}
			oArg.arg_popupCd     = "P00189";
			oArg.arg_popupNm     = "S/O 번호";
			oArg.arg_rtnCols     = "PRODUCTIONORDERID";
			oArg.arg_paramCols   = "P_POPTYPE|P_LANGUAGETYPE|P_PLANTID";
			oArg.arg_paramValues = "PRODUCTIONORDERID|"   + this.gf_getLanguageType() + "|" + this.ds_search.getColumn( 0, "P_PLANTID" );
			oArg.arg_searchStr   = "P_PRODUCTIONORDERID=" + this.tab_search.Tabpage1.form.edt_productionorderid.value;
			this.gfn_openPopup( "POPUP_PRODUCTIONORDERID", "cmd::CMSA00100P.xfdl", oArg, "width=800,height=800");
		}
		break;
		default :
		{
		}
	};
};

this.tab_search_Tabpage1_cbo_inputdatetype_onitemchanged = function(obj:nexacro.Combo, e:nexacro.InnerdataChangedEventInfo)
{
	if (e.postvalue != "CUSTOM")
	{	
		this.tab_search.Tabpage1.form.cal_inputdate_s.set_value( this.ds_periodType.getColumn( 0, e.postvalue + "_S" ) );
		this.tab_search.Tabpage1.form.cal_inputdate_e.set_value( this.ds_periodType.getColumn( 0, e.postvalue + "_E" ) );
	}
};

this.tab_search_Tabpage1_cal_inputdate_oninput = function(obj:nexacro.Calendar, e:nexacro.InputEventInfo)
{
	if (this.tab_search.Tabpage1.form.cbo_inputdatetype.value != "CUSTOM")
	{
		this.tab_search.Tabpage1.form.cbo_inputdatetype.set_value( "CUSTOM" );
	}
};
]]></Script>
    <Objects>
      <Dataset id="ds_search"/>
      <Dataset id="ds_combo"/>
      <Dataset id="ds_layout"/>
      <Dataset id="ds_lotcardlist"/>
      <Dataset id="ds_grdMenu"/>
      <Dataset id="ds_list">
        <ColumnInfo>
          <Column id="code" type="BIGDECIMAL" size="256"/>
          <Column id="value" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="code">1</Col>
            <Col id="value">QCAction003</Col>
          </Row>
          <Row>
            <Col id="code">2</Col>
            <Col id="value">QCAction004</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_paramList" useclientlayout="true">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="value" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <!--//Site-->
      <BindItem id="item01" compid="tab_search.Tabpage1.form.cbo_plantid" propid="value" datasetid="ds_search" columnid="P_PLANTID"/>
      <!--//투입기간-->
      <BindItem id="item021" compid="tab_search.Tabpage1.form.cal_inputdate_s" propid="value" datasetid="ds_search" columnid="P_INPUTDATE_S"/>
      <BindItem id="item022" compid="tab_search.Tabpage1.form.cal_inputdate_e" propid="value" datasetid="ds_search" columnid="P_INPUTDATE_E"/>
      <!--//품목코드-->
      <BindItem id="item03" compid="tab_search.Tabpage1.form.edt_productdefid" propid="value" datasetid="ds_search" columnid="P_PRODUCTDEFID"/>
      <!--//Rev.-->
      <BindItem id="item04" compid="tab_search.Tabpage1.form.cbo_productdefversion" propid="value" datasetid="ds_search" columnid="P_PRODUCTDEFVERSION"/>
      <!--//품목명-->
      <BindItem id="item05" compid="tab_search.Tabpage1.form.edt_productname" propid="value" datasetid="ds_search" columnid="P_PRODUCTNAME"/>
      <!--//Lot No.-->
      <BindItem id="item06" compid="tab_search.Tabpage1.form.edt_lotid" propid="value" datasetid="ds_search" columnid="P_LOTID"/>
      <!--//작업장-->
      <BindItem id="item07" compid="tab_search.Tabpage1.form.edt_areaid" propid="value" datasetid="ds_search" columnid="P_AREAID"/>
      <!--//생산구분-->
      <BindItem id="item08" compid="tab_search.Tabpage1.form.cbo_lottype" propid="value" datasetid="ds_search" columnid="P_LOTTYPE"/>
      <!--//제품구분-->
      <BindItem id="item09" compid="tab_search.Tabpage1.form.cbo_productdeftype" propid="value" datasetid="ds_search" columnid="P_PRODUCTDEFTYPE"/>
      <!--//작업구분-->
      <BindItem id="item10" compid="tab_search.Tabpage1.form.cbo_worktype" propid="value" datasetid="ds_search" columnid="P_WORKTYPE"/>
      <!--//재공상태-->
      <BindItem id="item11" compid="tab_search.Tabpage1.form.cbo_wipstate" propid="value" datasetid="ds_search" columnid="P_WIPSTATE"/>
      <!--//S/O번호-->
      <BindItem id="item12" compid="tab_search.Tabpage1.form.edt_productionorderid" propid="value" datasetid="ds_search" columnid="P_PRODUCTIONORDERID"/>
      <BindItem id="item0" compid="div_work.form.chk_MATERIALPRINT" propid="value" datasetid="ds_detailSearch" columnid="ISLOTCARDPRINT"/>
    </Bind>
  </Form>
</FDL>
