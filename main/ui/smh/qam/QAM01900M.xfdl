<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="QAM01900M" width="1258" height="747" titletext="불량품 폐기취소" tooltiptext="MENU_PG-QC-0760" onload="fn_init">
    <Layouts>
      <Layout height="747" width="1258">
        <Div id="div_header" taborder="0" left="0" top="0" height="47" right="0" formscrolltype="both">
          <Layouts>
            <Layout>
              <Static id="Static01" taborder="7" left="0" top="0" cssclass="sta_WF_titleBG" right="0" bottom="0"/>
              <Button id="btn_reset" taborder="0" top="16" width="26" height="24" cssclass="btn_com_reset" right="0" tooltiptext="Toolbar_Initialization" text="" initvalueid="x"/>
              <Button id="btn_help" taborder="1" top="16" width="26" height="24" cssclass="btn_com_help" right="btn_reset:0" tooltiptext="MANUAL" initvalueid="x"/>
              <Static id="sta_title" taborder="4" left="30" top="16" width="122" height="24" cssclass="sta_WF_title" fittocontents="width" expr="nexacro.getApplication().gds_menu.lookup(&quot;PGM_ID&quot;,comp.parent.parent.parent.name,&quot;MENU_NM&quot;)" tooltiptext="MENU_PG-QC-0760"/>
              <Button id="btn_favorite" taborder="3" left="sta_title:0" top="16" width="24" height="24" cssclass="btn_WF_favorite"/>
              <Button id="btn_searchOpen" taborder="5" left="0" top="16" width="30" height="24" cssclass="btn_WF_searchOpen" onclick="nfn_searchOpen_onclick"/>
              <Static id="Static16" taborder="6" left="47" top="0" width="60" height="20" cssclass="guideTip" visible="false" text="h20"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_work" taborder="1" text="div_00" left="300" top="47" right="0" bottom="0">
          <Layouts>
            <Layout>
              <Tab id="tab" taborder="0" tabindex="0" left="0" top="0" right="0" bottom="0" cssclass="tab_master">
                <Tabpages>
                  <Tabpage id="Tab1" text="불량취소" tooltiptext="DEFECTCANCEL">
                    <Layouts>
                      <Layout>
                        <Static id="title0" taborder="0" text="불량 Lot" left="0" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" fittocontents="width" right="708" tooltiptext="DEFECTLOT"/>
                        <Button id="btn_saveDefectCancel" taborder="10" top="50.3%" width="70" height="24" cssclass="btn_WF_black" text="불량취소" tooltiptext="DEFECTCANCEL" onclick="fn_save" right="0"/>
                        <Button id="btn_suttleUp" taborder="3" left="50.42%" width="24" cssclass="btn_WF_shuttleT" top="50.3%" height="24" onclick="btn_suttleUp_onclick"/>
                        <Button id="btn_suttleDown" taborder="5" top="50.3%" height="24" cssclass="btn_WF_shuttleB" right="btn_suttleUp:10" width="24" onclick="btn_suttleDown_onclick"/>
                        <Div id="div_lotInfo" taborder="7" left="0" height="57" cssclass="div_WF_detail" text="" right="0" top="btn_suttleUp:16.67%">
                          <Layouts>
                            <Layout>
                              <MaskEdit id="msk_pnl" taborder="0" left="76.78%" top="30" width="9.31%" height="20" value="0" readonly="true" enable="false"/>
                              <Edit id="edt_lotId" taborder="1" left="76.78%" top="5" height="20" readonly="true" enable="true" text="210202F001-1-FG00-001-001" right="5"/>
                              <Static id="sta_lotId" taborder="2" text="Lot No." left="65.90%" top="5" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="LOTID" right="edt_lotId:5"/>
                              <Static id="sta_pnl" taborder="3" text="PNL" left="65.90%" top="30" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="PNL" right="msk_pnl:5"/>
                              <Edit id="edt_itemName" taborder="4" left="40.79%" top="5" height="20" right="sta_lotId:0" text="E A40N02E RF CAMERA(6L)-M3/4L" readonly="true" enable="false"/>
                              <MaskEdit id="msk_pcs" taborder="5" left="40.79%" top="30" height="20" value="0" readonly="true" enable="false" right="sta_pnl:151" format="#,##0"/>
                              <Static id="sta_pcs" taborder="6" text="PCS" left="31%" top="30" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="PCS" right="msk_pcs:5"/>
                              <Static id="sta_itemName" taborder="7" text="품목명" left="31%" top="5" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="ITEMNAME" right="edt_itemName:5"/>
                              <Edit id="edt_itemId" taborder="8" left="10.98%" top="5" height="20" text="1060829B5" readonly="true" right="sta_itemName:0" enable="false"/>
                              <Static id="sta_itemId" taborder="9" text="품목코드" left="0" top="5" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="ITEMID" right="edt_itemId:5"/>
                              <Edit id="edt_defectLotId" taborder="11" left="10.98%" top="30" height="20" text="210202F001-1-FG00-001-A02" readonly="true" right="sta_pcs:0" enable="true"/>
                              <Static id="sta_defectLotId" taborder="10" text="불량 Lot No" left="0" top="30" height="20" cssclass="sta_WF_detailLabel2" tooltiptext="DEFECTLOTID" right="edt_defectLotId:5"/>
                            </Layout>
                          </Layouts>
                        </Div>
                        <Grid id="grd_lotDefectList" taborder="1" left="0" top="34" autoenter="select" right="0" binddataset="ds_lotDefectList" bottom="btn_suttleUp:5" onheadclick="div_work_tab_Tab1_grd_lotDefectList_onheadclick">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="40"/>
                                <Column size="30"/>
                                <Column size="150"/>
                                <Column size="80"/>
                                <Column size="200"/>
                                <Column size="60"/>
                                <Column size="210"/>
                                <Column size="220"/>
                                <Column size="80"/>
                                <Column size="180"/>
                                <Column size="80"/>
                                <Column size="60"/>
                                <Column size="120"/>
                                <Column size="100"/>
                                <Column size="50"/>
                                <Column size="200"/>
                                <Column size="60"/>
                                <Column size="210"/>
                                <Column size="150"/>
                                <Column size="150"/>
                                <Column size="60"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="120"/>
                                <Column size="150"/>
                                <Column size="60"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell rowspan="2" text="No"/>
                                <Cell col="1" rowspan="2" displaytype="normal" edittype="none"/>
                                <Cell col="2" colspan="13" text="불량정보" cssclass="cell_headMaster" tooltiptext="DEFECTINFO"/>
                                <Cell col="15" colspan="6" text="원인공정" cssclass="cell_headMaster" tooltiptext="CAUSEPROCESS"/>
                                <Cell col="21" colspan="8" text="기타정보" cssclass="cell_headMaster" tooltiptext="ETC"/>
                                <Cell row="1" col="2" text="처리일시" tooltiptext="PROCESSDATE"/>
                                <Cell row="1" col="3" text="품목코드" tooltiptext="PRODUCTDEFID"/>
                                <Cell row="1" col="4" text="품목명" tooltiptext="PRODUCTDEFNAME"/>
                                <Cell row="1" col="5" text="Rev" tooltiptext="PRODUCTDEFVERSION"/>
                                <Cell row="1" col="6" text="Lot No" tooltiptext="Lot No"/>
                                <Cell row="1" col="7" text="불량 Lot No" tooltiptext="DEFECTLOTID"/>
                                <Cell row="1" col="8" text="불량 코드" tooltiptext="DEFECTCODE"/>
                                <Cell row="1" col="9" text="불량명" tooltiptext="DEFECTNAME"/>
                                <Cell row="1" col="10" text="PCS" tooltiptext="PCS"/>
                                <Cell row="1" col="11" text="공정수순" tooltiptext="USERSEQUENCE"/>
                                <Cell row="1" col="12" text="공정명" tooltiptext="PROCESSSEGMENTNAME"/>
                                <Cell row="1" col="13" text="작업장" tooltiptext="AREANAME"/>
                                <Cell row="1" col="14" text="Site ID" tooltiptext="PLANTID"/>
                                <Cell row="1" col="15" text="원인품목" tooltiptext="REASONPRODUCT"/>
                                <Cell row="1" col="16" text="Rev" tooltiptext="Rev"/>
                                <Cell row="1" col="17" text="원인 LotID" tooltiptext="REASONCONSUMABLELOTID"/>
                                <Cell row="1" col="18" text="원인공정" tooltiptext="REASONSEGMENT"/>
                                <Cell row="1" col="19" text="원인작업장" tooltiptext="REASONAREA"/>
                                <Cell row="1" col="20" text="원인불명" tooltiptext="ISUNKNOWN"/>
                                <Cell row="1" col="21" text="양산구분" tooltiptext="LOTTYPENAME"/>
                                <Cell row="1" col="22" text="반출수량" tooltiptext="OUTBOUNDQTY"/>
                                <Cell row="1" col="23" text="보관처" tooltiptext="STORAGE"/>
                                <Cell row="1" col="24" text="확정일시" tooltiptext="DEFINETIME"/>
                                <Cell row="1" col="25" text="확정상태" tooltiptext="CONFIRMATIONSTATUS"/>
                                <Cell row="1" col="26" text="공정진행상태" tooltiptext="PROCESSSTATE"/>
                                <Cell row="1" col="27" text="UOM" tooltiptext="UOM"/>
                                <Cell row="1" col="28" text="처리STEP" tooltiptext="PROCESSSTEP"/>
                              </Band>
                              <Band id="body">
                                <Cell text="expr:currow+1"/>
                                <Cell col="1" text="bind:CHK" displaytype="checkboxcontrol" edittype="checkbox"/>
                                <Cell col="2" text="bind:PROCESSDATE" calendareditformat="yyyy-MM-dd HH:mm:ss" calendardateformat="yyyy-MM-dd HH:mm:ss" displaytype="date"/>
                                <Cell col="3" text="bind:PRODUCTDEFID"/>
                                <Cell col="4" text="bind:PRODUCTDEFNAME" textAlign="left"/>
                                <Cell col="5" text="bind:PRODUCTDEFVERSION"/>
                                <Cell col="6" text="bind:PARENTLOTID"/>
                                <Cell col="7" text="bind:LOTID"/>
                                <Cell col="8" text="bind:JOINCODE"/>
                                <Cell col="9" text="bind:JOINNAME" textAlign="left"/>
                                <Cell col="10" text="bind:DEFECTPCSQTY" textAlign="right"/>
                                <Cell col="11" text="bind:USERSEQUENCE" textAlign="right"/>
                                <Cell col="12" text="bind:PROCESSSEGMENTNAME" textAlign="left"/>
                                <Cell col="13" text="bind:AREANAME" textAlign="left"/>
                                <Cell col="14" text="bind:PLANTID"/>
                                <Cell col="15" text="bind:REASONCONSUMABLEDEFNAME" textAlign="left"/>
                                <Cell col="16" text="bind:REASONCONSUMABLEDEFVERSION"/>
                                <Cell col="17" text="bind:REASONCONSUMABLELOTID"/>
                                <Cell col="18" text="bind:REASONSEGMENTNAME" textAlign="left"/>
                                <Cell col="19" text="bind:REASONAREANAME" textAlign="left"/>
                                <Cell col="20" text="bind:ISUNKNOWN"/>
                                <Cell col="21" text="bind:LOTTYPENAME"/>
                                <Cell col="22" text="bind:OUTBOUNDQTY" textAlign="right" maskeditformat="#,###,##0" displaytype="mask"/>
                                <Cell col="23" text="bind:RECEIVEAREANAME"/>
                                <Cell col="24" text="bind:DEFINETIME" calendardateformat="yyyy-MM-dd HH:mm:ss" calendareditformat="yyyy-MM-dd HH:mm:ss" displaytype="date"/>
                                <Cell col="25" text="bind:CONFIRMATIONSTATUS"/>
                                <Cell col="26" text="bind:PROCESSSTATENAME"/>
                                <Cell col="27" text="bind:UOM"/>
                                <Cell col="28" text="bind:OCCURREDSTEPNAME"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Button id="btn_xlDn_grd_lotDefectList" taborder="2" top="6" width="29" height="24" cssclass="btn_WF_grdExcelDown" tooltiptext="엑셀업로드" right="0"/>
                        <Static id="Static12_00_00_00_01_00_00" taborder="4" text="h5" width="58" top="330" visible="false" height="5" cssclass="guideTip" right="450"/>
                        <Static id="Static12_00_00_00_01_00_00_00" taborder="6" text="h15" width="58" top="358" visible="false" height="5" cssclass="guideTip" left="450"/>
                        <Grid id="grd_lotDefectCountList" taborder="8" left="0" top="div_lotInfo:10" width="497" binddataset="ds_lotDefectCountList" autoenter="select" bottom="0" autofittype="col">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="30"/>
                                <Column size="50"/>
                                <Column size="50"/>
                                <Column size="50"/>
                                <Column size="50"/>
                                <Column size="80"/>
                                <Column size="185"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell rowspan="2" displaytype="checkboxcontrol" edittype="checkbox"/>
                                <Cell col="1" colspan="2" text="불량수량" cssclass="cell_headMaster" tooltiptext="DEFECTCOUNT"/>
                                <Cell col="3" colspan="2" text="취소수량" cssclass="cell_headMaster" tooltiptext="CANCELCOUNT"/>
                                <Cell col="5" colspan="2" text="불량정보" cssclass="cell_headMaster,cell_end" tooltiptext="DEFECTINFO"/>
                                <Cell row="1" col="1" text="PCS" tooltiptext="PCS"/>
                                <Cell row="1" col="2" text="UOM" tooltiptext="UOM"/>
                                <Cell row="1" col="3" text="PCS" tooltiptext="PCS"/>
                                <Cell row="1" col="4" text="PNL" tooltiptext="PNL"/>
                                <Cell row="1" col="5" text="불량코드" tooltiptext="DEFECTCODE"/>
                                <Cell row="1" col="6" text="불량명" tooltiptext="DEFECTNAME"/>
                              </Band>
                              <Band id="body">
                                <Cell text="bind:CHK" displaytype="checkboxcontrol" edittype="checkbox"/>
                                <Cell col="1" text="bind:DEFECTPCSQTY" textAlign="right"/>
                                <Cell col="2" text="bind:UOM"/>
                                <Cell col="3" text="bind:CANCELPCSQTY" textAlign="right" displaytype="mask" edittype="mask" editinputtype="number" maskeditformat="#,###,###0" maskeditautoselect="true"/>
                                <Cell col="4" text="bind:CANCELPNLQTY" textAlign="right" displaytype="mask" edittype="mask" editinputtype="number" maskeditformat="#,###,###0" maskeditautoselect="true"/>
                                <Cell col="5" text="bind:JOINCODE"/>
                                <Cell col="6" text="bind:JOINNAME" textAlign="left"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                        <Grid id="grd_routingList" taborder="9" left="506" top="div_lotInfo:10" binddataset="ds_routingList" autoenter="select" bottom="0" right="0" onexpandup="fn_grid_onexpandup">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="100"/>
                                <Column size="50"/>
                                <Column size="80"/>
                                <Column size="140"/>
                                <Column size="26"/>
                                <Column size="80"/>
                                <Column size="140"/>
                                <Column size="160"/>
                                <Column size="80"/>
                                <Column size="160"/>
                                <Column size="160"/>
                                <Column size="160"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell colspan="3" text="Original Lot Merge" cssclass="cell_headMaster" tooltiptext="ORIGINALLOTMERGE"/>
                                <Cell col="3" colspan="5" text="투입공정" cssclass="cell_headMaster" tooltiptext="INPUTSEGMENT"/>
                                <Cell col="8" colspan="3" text="재작업 후 공정" cssclass="cell_headMaster" tooltiptext="RETURNSEGMENT"/>
                                <Cell col="11" text="기타정보" cssclass="cell_headMaster"/>
                                <Cell row="1" text="Original Lot Merge"/>
                                <Cell row="1" col="1" text="Check" tooltiptext="Check"/>
                                <Cell row="1" col="2" text="취소사유" tooltiptext="REASONCANCEL"/>
                                <Cell row="1" col="3" colspan="2" text="라우팅명" tooltiptext="ROUTINGNAME"/>
                                <Cell row="1" col="5" text="공정수순" tooltiptext="USERSEQUENCE"/>
                                <Cell row="1" col="6" text="공정명" tooltiptext="PROCESSSEGMENTNAME"/>
                                <Cell row="1" col="7" text="자원명" tooltiptext="RESOURCENAME"/>
                                <Cell row="1" col="8" text="공정수순" tooltiptext="USERSEQUENCE"/>
                                <Cell row="1" col="9" text="공정명" tooltiptext="PROCESSSEGMENTNAME"/>
                                <Cell row="1" col="10" text="자원명" tooltiptext="RESOURCENAME"/>
                                <Cell row="1" col="11" text="설명"/>
                              </Band>
                              <Band id="body">
                                <Cell text="bind:ISORIGINALLOTMERGE"/>
                                <Cell col="1" text="bind:MERGECHECK" displaytype="checkboxcontrol" edittype="checkbox"/>
                                <Cell col="2" text="bind:CANCELCODE" displaytype="combotext" edittype="combo" combocodecol="C,ReasonCancel,,Y,Y"/>
                                <Cell col="3" text="bind:INPUTPROCESSDEFNAME" expandimage="url('theme://images/grd_expand.png')" expandshow="expr:dataset.getRowType(currow) ==2 ? 'show':'hide'" expandsize="24" textAlign="left"/>
                                <Cell col="4" expandshow="expr:dataset.getRowType(currow) ==2 ? 'show':'hide'" expandsize="24" expandimage="url('theme://images/img_WF_inputDel_P.png')" text="bind:X_T_BTN"/>
                                <Cell col="5" text="bind:INPUTUSERSEQUENCE"/>
                                <Cell col="6" text="bind:INPUTSEGMENTNAME"/>
                                <Cell col="7" text="bind:INPUTRESOURCENAME"/>
                                <Cell col="8" text="bind:RETURNUSERSEQUENCE"/>
                                <Cell col="9" text="bind:RETURNSEGMENTNAME"/>
                                <Cell col="10" text="bind:RETURNRESOURCENAME"/>
                                <Cell col="11" text="bind:설명"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                      </Layout>
                    </Layouts>
                  </Tabpage>
                  <Tabpage id="Tab3" text="내역조회" tooltiptext="HISTORYQUERY">
                    <Layouts>
                      <Layout>
                        <Static id="sta_cnt_ds_defectCancleHistList" taborder="3" left="300" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" right="504" padding="5px 0px 0px" text="Count : &lt;fc v=&quot;#f31d24&quot;&gt;0&lt;/fc&gt;"/>
                        <Static id="subtitle1" taborder="0" text="취소내역" left="0" top="0" height="34" cssclass="sta_WF_subTitle" usedecorate="true" fittocontents="width" right="sta_cnt_ds_defectCancleHistList:50"/>
                        <Button id="btn_xlDn_grd_defectCancleHistList" taborder="1" top="6" width="29" height="24" cssclass="btn_WF_grdExcelDown" tooltiptext="엑셀업로드" right="0"/>
                        <Grid id="grd_defectCancleHistList" taborder="2" left="0" top="34" autoenter="select" binddataset="ds_defectCancleHistList" bottom="0" right="0" oncelldblclick="fn_gridOncelldblclick">
                          <Formats>
                            <Format id="default">
                              <Columns>
                                <Column size="40"/>
                                <Column size="150"/>
                                <Column size="80"/>
                                <Column size="200"/>
                                <Column size="60"/>
                                <Column size="210"/>
                                <Column size="80"/>
                                <Column size="180"/>
                                <Column size="80"/>
                                <Column size="60"/>
                                <Column size="120"/>
                                <Column size="80"/>
                                <Column size="60"/>
                                <Column size="210"/>
                                <Column size="210"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="80"/>
                                <Column size="60"/>
                                <Column size="200"/>
                              </Columns>
                              <Rows>
                                <Row size="24" band="head"/>
                                <Row size="24" band="head"/>
                                <Row size="24"/>
                              </Rows>
                              <Band id="head">
                                <Cell rowspan="2" text="No"/>
                                <Cell col="1" colspan="13" text="취소정보" cssclass="cell_headMaster" tooltiptext="CANCELINFO"/>
                                <Cell col="14" colspan="6" text="기타정보" cssclass="cell_headMaster"/>
                                <Cell row="1" col="1" text="취소일시"/>
                                <Cell row="1" col="2" text="품목코드" tooltiptext="PRODUCTDEFID"/>
                                <Cell row="1" col="3" text="품목명" tooltiptext="PRODUCTDEFNAME"/>
                                <Cell row="1" col="4" text="Rev" tooltiptext="PRODUCTDEFVERSION"/>
                                <Cell row="1" col="5" text="Lot No." tooltiptext="LOTID"/>
                                <Cell row="1" col="6" text="불량코드" tooltiptext="DEFECTCODE"/>
                                <Cell row="1" col="7" text="불량코드명" tooltiptext="DEFECTCODENAME"/>
                                <Cell row="1" col="8" text="PCS" tooltiptext="PCS"/>
                                <Cell row="1" col="9" text="공정수순" tooltiptext="USERSEQUENCE"/>
                                <Cell row="1" col="10" text="공정명" tooltiptext="PROCESSSEGMENTNAME"/>
                                <Cell row="1" col="11" text="작업장" tooltiptext="AREANAME"/>
                                <Cell row="1" col="12" text="Site ID" tooltiptext="PLANTID"/>
                                <Cell row="1" col="13" text="불량 Lot No" tooltiptext="DEFECTLOTID"/>
                                <Cell row="1" col="14" text="Repair Lot No"/>
                                <Cell row="1" col="15" text="취소사유" tooltiptext="REASONCANCEL"/>
                                <Cell row="1" col="16" text="취소구분" tooltiptext="CANCELTYPE"/>
                                <Cell row="1" col="17" text="취소자" tooltiptext="CANCELUSER"/>
                                <Cell row="1" col="18" text="UOM" tooltiptext="UOM"/>
                                <Cell row="1" col="19" text="설명" tooltiptext="DESCRIPTION"/>
                              </Band>
                              <Band id="body">
                                <Cell text="expr:currow+1"/>
                                <Cell col="1" text="bind:CANCELTIME" calendardateformat="yyyy-MM-dd HH:mm:ss" calendareditformat="yyyy-MM-dd HH:mm:ss" displaytype="date"/>
                                <Cell col="2" text="bind:PRODUCTDEFID"/>
                                <Cell col="3" text="bind:PRODUCTDEFNAME" textAlign="left"/>
                                <Cell col="4" text="bind:PRODUCTDEFVERSION"/>
                                <Cell col="5" text="bind:PARENTLOTID"/>
                                <Cell col="6" text="bind:JOINCODE"/>
                                <Cell col="7" text="bind:JOINNAME" textAlign="left"/>
                                <Cell col="8" text="bind:PCSQTY" displaytype="mask" maskeditformat="#,###,###,##0" textAlign="right"/>
                                <Cell col="9" text="bind:USERSEQUENCE" textAlign="right"/>
                                <Cell col="10" text="bind:PROCESSSEGMENTNAME" textAlign="left"/>
                                <Cell col="11" text="bind:AREANAME" textAlign="left"/>
                                <Cell col="12" text="bind:PLANTID"/>
                                <Cell col="13" text="bind:LOTID"/>
                                <Cell col="14" text="bind:REPAIRLOTNO"/>
                                <Cell col="15" text="bind:CANCELREASON"/>
                                <Cell col="16" text="bind:CANCELTYPE"/>
                                <Cell col="17" text="bind:CANCELUSER"/>
                                <Cell col="18" text="bind:UNIT"/>
                                <Cell col="19" text="bind:DESCRIPTION"/>
                              </Band>
                            </Format>
                          </Formats>
                        </Grid>
                      </Layout>
                    </Layouts>
                  </Tabpage>
                </Tabpages>
              </Tab>
            </Layout>
          </Layouts>
        </Div>
        <Tab id="tab_search" taborder="2" tabindex="0" left="0" top="47" width="290" cssclass="tab_search" bottom="0">
          <Tabpages>
            <Tabpage id="Tab1" text="Tabpage1">
              <Layouts>
                <Layout>
                  <Combo id="cbo_period" taborder="2" left="10" top="60" width="94" height="20" index="-1" value="" innerdataset="gds_period" codecolumn="code" datacolumn="desc" canitemchange="tab_search_Tab1_cbo_period_canitemchange"/>
                  <Static id="sta_area" taborder="16" text="작업장" left="0" top="85" width="103" height="20" cssclass="sta_WF_label" tooltiptext="AREA"/>
                  <Edit id="edt_defectlotId" taborder="8" left="108" top="135" width="165" height="20"/>
                  <Combo id="cbo_lotType" taborder="10" left="108" top="185" width="165" height="20" codecolumn="C,LotType,ALL,Y,Y"/>
                  <Static id="sta_site" taborder="15" text="Site" left="0" top="10" width="103" height="20" cssclass="sta_WF_label_point" tooltiptext="SITE"/>
                  <Button id="btn_clear" taborder="14" top="275" width="102" height="36" cssclass="btn_SA_reset" left="171" text="초기화" tooltiptext="Toolbar_Initialization" onclick="fn_searchClear"/>
                  <Button id="btn_search" taborder="12" top="275" width="146" height="36" cssclass="btn_SA_search" left="15" text="검색" tooltiptext="Toolbar_Search" onclick="fn_search"/>
                  <Static id="guidetip02" taborder="17" text="h10" width="45" top="0" visible="false" height="10" cssclass="guideTip" right="91"/>
                  <Static id="guidetip04" taborder="18" text="h20" width="45" top="255" visible="false" height="20" cssclass="guideTip" right="91"/>
                  <Static id="guidetip05" taborder="19" text="w&#13;&#10;10" width="10" top="281" visible="false" height="27" cssclass="guideTip" left="161"/>
                  <Static id="sta_createDate" taborder="20" text="조회기간" left="0" top="35" width="103" height="20" cssclass="sta_WF_label_point" tooltiptext="SEARCHPERIOD"/>
                  <Edit id="edt_area" taborder="4" left="108" top="85" height="20" right="37" canchange="fn_popup_canchange"/>
                  <Button id="btn_area" taborder="5" width="22" height="20" cssclass="btn_WF_finder" top="85" right="15" onclick="fn_popup_click"/>
                  <Combo id="cbo_plantId" taborder="0" left="108" top="10" width="165" height="20" codecolumn="C,SiteType,ALL,Y,N"/>
                  <Static id="sta_productionDefinition" taborder="21" text="품목" left="0" top="110" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PRODUCTIONDEFINITION"/>
                  <Static id="sta_defectlotId" taborder="22" text="불량 Lot No" left="0" top="135" width="103" height="20" cssclass="sta_WF_label" tooltiptext="DEFECTLOTID"/>
                  <Static id="sta_lotId" taborder="23" text="Lot No." left="0" top="160" width="103" height="20" cssclass="sta_WF_label" tooltiptext="LOTID"/>
                  <Combo id="cbo_processsegmentType" taborder="11" left="108" top="210" width="165" height="20" codecolumn="C,ProcessSegmentType,ALL,Y,Y"/>
                  <Static id="sta_lotproducTtype" taborder="24" text="양산구분" left="0" top="185" width="103" height="20" cssclass="sta_WF_label" tooltiptext="LOTPRODUCTTYPE"/>
                  <Static id="sta_processsegmentType" taborder="25" text="공정구분" left="0" top="210" width="103" height="20" cssclass="sta_WF_label" tooltiptext="PROCESSSEGMENTTYPE"/>
                  <Edit id="edt_parentLotId" taborder="9" left="108" top="160" width="165" height="20"/>
                  <Edit id="edt_productDef" taborder="6" left="108" top="110" height="20" right="37" canchange="fn_popup_canchange"/>
                  <Button id="btn_productDef" taborder="7" width="22" height="20" cssclass="btn_WF_finder" top="110" right="15" onclick="fn_popup_click"/>
                  <Edit id="edt_productDef_id" taborder="26" left="126" top="380" height="20" right="19" visible="false" tooltiptext="조회조건품목ID" background="thistle" enable="false"/>
                  <Edit id="edt_area_id" taborder="28" left="126" top="355" height="20" right="19" visible="false" tooltiptext="조회조건작업장ID" background="thistle" enable="false"/>
                  <Div id="div_dateFrom" taborder="1" left="108" top="35" height="20" url="common::com_calendar.xfdl" right="15" text="" onkeydown="fn_preiodChang" onrbuttondown="tab_search_Tab1_div_dateFrom_onrbuttondown" onrbuttonup="tab_search_Tab1_div_dateFrom_onrbuttonup"/>
                  <Div id="div_dateTo" taborder="3" left="108" top="60" height="20" url="common::com_calendar.xfdl" right="15" text="" onkeydown="fn_preiodChang"/>
                  <Static id="label08" taborder="27" text="확정여부" left="0" top="235" width="103" height="20" cssclass="sta_WF_label"/>
                  <Combo id="cbo_confirm" taborder="13" left="108" top="235" width="165" height="20" codecolumn="C,YesNo,ALL,Y,Y" text="" index="-1"/>
                  <Static id="sta_area_id" taborder="29" text="작업장ID" left="25" top="356" height="20" visible="false" textAlign="right" right="edt_area_id:10"/>
                  <Static id="sta_production_id" taborder="30" text="품목Revision" left="25" top="376" height="20" visible="false" textAlign="right" right="edt_productDef_id:10"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Static id="sta_searchTitle" taborder="3" text="검색조건" left="0" top="47" width="290" height="34" cssclass="sta_WF_subTitle" usedecorate="true" tooltiptext="SEARCH_CONDITION_GROUP"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_search" useclientlayout="true">
        <ColumnInfo>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="LANGUAGETYPE" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="USERID" type="STRING" size="256"/>
          <Column id="PERIODFR" type="STRING" size="256"/>
          <Column id="PERIODTO" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PARENTLOTID" type="STRING" size="256"/>
          <Column id="LOTTYPE" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTTYPE" type="STRING" size="256"/>
          <Column id="CONFIRMATION" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_searchRouting" useclientlayout="true">
        <ColumnInfo>
          <Column id="LANGUAGETYPE" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PROCESSDEFID" type="STRING" size="256"/>
          <Column id="PROCESSDEFVERSION" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="JOBFLAG" type="STRING" size="256" description="값변경시와 저장시를 구분하기 위해"/>
          <Column id="VERSION" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_lotDefectList" cancolumnchange="ds_lotDefectList_cancolumnchange" useclientlayout="true">
        <ColumnInfo>
          <Column id="No" type="STRING" size="256"/>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="PROCESSDATE" type="STRING" size="256" description="처리일시"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256" description="품목 ID"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256" description="품목 Version"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256" description="품목명"/>
          <Column id="ENTERPRISEID" type="STRING" size="256" description="회사 ID"/>
          <Column id="PLANTID" type="STRING" size="256" description="Site ID"/>
          <Column id="USERSEQUENCE" type="STRING" size="256" description="공정수순"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256" description="공정 ID"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256" description="공정 Version"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256" description="공정명"/>
          <Column id="AREAID" type="STRING" size="256" description="작업장 ID"/>
          <Column id="AREANAME" type="STRING" size="256" description="작업장명"/>
          <Column id="PARENTLOTID" type="STRING" size="256" description="부모 Lot No"/>
          <Column id="LOTID" type="STRING" size="256" description="Lot No"/>
          <Column id="TXNHISTKEY" type="STRING" size="256" description="Txn HistKey"/>
          <Column id="DEFECTCODE" type="STRING" size="256" description="불량코드"/>
          <Column id="DEFECTNAME" type="STRING" size="256" description="불량명"/>
          <Column id="QCSEGMENTID" type="STRING" size="256" description="품질공정 ID"/>
          <Column id="QCSEGMENTNAME" type="STRING" size="256" description="품질공정명"/>
          <Column id="DEFECTPCSQTY" type="INT" size="256" description="불량 PCS수량"/>
          <Column id="DEFECTPNLQTY" type="FLOAT" size="256" description="불량 PNL수량"/>
          <Column id="PANELPERQTY" type="FLOAT" size="256" description="PNL당 PCS수량"/>
          <Column id="UOM" type="STRING" size="256" description="UOM 단위(불량처리단위)"/>
          <Column id="REASONCONSUMABLEDEFID" type="STRING" size="256" description="원인품목 ID"/>
          <Column id="REASONCONSUMABLEDEFVERSION" type="STRING" size="256" description="원인품목 Version"/>
          <Column id="REASONCONSUMABLEDEFNAME" type="STRING" size="256" description="원인품목명"/>
          <Column id="REASONCONSUMABLELOTID" type="STRING" size="256" description="원인자재 Lot No"/>
          <Column id="REASONSEGMENTID" type="STRING" size="256" description="원인공정 ID"/>
          <Column id="REASONSEGMENTVERSION" type="STRING" size="256" description="원인공정 Version"/>
          <Column id="REASONSEGMENTNAME" type="STRING" size="256" description="원인공정명"/>
          <Column id="REASONAREAID" type="STRING" size="256" description="원인작업장 ID"/>
          <Column id="REASONAREANAME" type="STRING" size="256" description="원인작업장명"/>
          <Column id="ISUNKNOWN" type="STRING" size="256" description="원인불명"/>
          <Column id="LOTTYPE" type="STRING" size="256" description="양산구분 ID"/>
          <Column id="LOTTYPENAME" type="STRING" size="256" description="양산구분명"/>
          <Column id="OUTBOUNDQTY" type="INT" size="256" description="반출수량"/>
          <Column id="RECEIVEAREAID" type="STRING" size="256" description="인수작업장 ID"/>
          <Column id="RECEIVEAREANAME" type="STRING" size="256" description="인수작업장명"/>
          <Column id="DEFINETIME" type="STRING" size="256" description="확정일시"/>
          <Column id="STATUS" type="STRING" size="256" description="확정상태"/>
          <Column id="DEFECTCODECOUNT" type="STRING" size="256" description="Lot별 불량코드갯수"/>
          <Column id="SUMLOTDEFECTQTY" type="STRING" size="256" description="Lot별 불량수량"/>
          <Column id="ISORIGINALLOTMERGE" type="STRING" size="256" description="OriginalLotMerge 가능여부"/>
          <Column id="ISORIGINALLOTMERGECODE" type="STRING" size="256" description="OriginalLotMerge 가능여부 코드"/>
          <Column id="MERGECHECK" type="STRING" size="256" description="OriginalLotMerge 가능여부에 따른 Check"/>
          <Column id="CANCELPCSQTY" type="INT" size="256" description="취소 PCS수량"/>
          <Column id="CANCELPNLQTY" type="FLOAT" size="256" description="취소 PNL수량"/>
          <Column id="ROUTINGTYPE" type="STRING" size="256" description="Routing Type"/>
          <Column id="CANCELCODE" type="STRING" size="256" description="취소사유코드"/>
          <Column id="INPUTPROCESSDEFID" type="STRING" size="256" description="투입 라우팅 ID"/>
          <Column id="INPUTPROCESSDEFVERSION" type="STRING" size="256" description="투입 라우팅 Version"/>
          <Column id="INPUTPROCESSDEFNAME" type="STRING" size="256" description="투입 라우팅명"/>
          <Column id="INPUTUSERSEQUENCE" type="STRING" size="256" description="투입 공정수순"/>
          <Column id="INPUTSEGMENTID" type="STRING" size="256" description="투입 공정 ID"/>
          <Column id="INPUTSEGMENTVERSION" type="STRING" size="256" description="투입 공정 Verison"/>
          <Column id="INPUTSEGMENTNAME" type="STRING" size="256" description="투입 공정명"/>
          <Column id="INPUTAREAID" type="STRING" size="256" description="투입 작업장 ID"/>
          <Column id="INPUTAREANAME" type="STRING" size="256" description="투입 작업장명"/>
          <Column id="INPUTRESOURCEID" type="STRING" size="256" description="투입 Resource ID 컬럼 세팅"/>
          <Column id="INPUTRESOURCENAME" type="STRING" size="256" description="투입 Resource명 컬럼 세팅"/>
          <Column id="REPAIRLOTNO" type="STRING" size="256" description="Repair Lot No"/>
          <Column id="INPUTPROCESSPATHID" type="STRING" size="256" description="투입 라우팅 상세 ID 컬럼 세팅"/>
          <Column id="RETURNPROCESSDEFID" type="STRING" size="256" description="재작업 후 라우팅 ID 컬럼 세팅"/>
          <Column id="RETURNPROCESSDEFVERSION" type="STRING" size="256" description="재작업 후 라우팅 Version 컬럼 세팅"/>
          <Column id="RETURNPROCESSPATHID" type="STRING" size="256" description="재작업 후 라우팅 상세 정의 ID 컬럼 세팅"/>
          <Column id="RETURNUSERSEQUENCE" type="STRING" size="256" description="재작업 후 공정수순 컬럼 세팅"/>
          <Column id="RETURNSEGMENTID" type="STRING" size="256" description="재작업 후 공정 ID 컬럼 세팅"/>
          <Column id="RETURNSEGMENTVERSION" type="STRING" size="256" description="재작업 후 공정 Version 컬럼 세팅"/>
          <Column id="RETURNSEGMENTNAME" type="STRING" size="256" description="재작업 후 공정명 컬럼 세팅"/>
          <Column id="RETURNAREAID" type="STRING" size="256" description="재작업 후 작업장 ID 세팅"/>
          <Column id="RETURNAREANAME" type="STRING" size="256" description="재작업 후 작업장명 컬럼 세팅"/>
          <Column id="RETURNRESOURCEID" type="STRING" size="256" description="재작업 후 Resource ID 컬럼 세팅"/>
          <Column id="RETURNRESOURCENAME" type="STRING" size="256" description="재작업 후 Resource명 컬럼 세팅"/>
          <Column id="DESCRIPTION" type="STRING" size="256" description="비고"/>
          <Column id="PROCESSSTATE" type="STRING" size="256" description="Lot의 공정진행상태"/>
          <Column id="PROCESSSTATENAME" type="STRING" size="256" description="Lot의 공정진행상태명"/>
          <Column id="WORKCOUNT" type="STRING" size="256" description="Lot Work Count"/>
          <Column id="PARENTPROCESSDEFID" type="STRING" size="256" description="부모 Lot의 라우팅 ID"/>
          <Column id="PARENTPROCESSDEFVERSION" type="STRING" size="256" description="부모 Lot의 라우팅  Version"/>
          <Column id="ISMIGRATION" type="STRING" size="256" description="MIG 데이터여부"/>
          <Column id="PROCESSPATHSTACK" type="STRING" size="256" description="현재 불량의 ProcessPathId"/>
          <Column id="JOINCODE" type="STRING" size="256"/>
          <Column id="JOINNAME" type="STRING" size="256"/>
          <Column id="OCCURREDSTEPNAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_reworkLotDefectList">
        <ColumnInfo>
          <Column id="PROCESSDEFID" type="STRING" size="256" description="투입 라우팅 ID"/>
          <Column id="PROCESSDEFVERSION" type="STRING" size="256" description="투입 라우팅 Version"/>
          <Column id="PROCESSDEFNAME" type="STRING" size="256" description="투입 라우팅명"/>
          <Column id="PROCESSPATHID" type="STRING" size="256" description="라우팅 상세 ID"/>
          <Column id="USERSEQUENCE" type="STRING" size="256" description="순서"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256" description="투입 공정 ID"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256" description="투입 공정 VERSION"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256" description="투입 공정명"/>
          <Column id="AREAID" type="STRING" size="256" description="투입 작업장 ID"/>
          <Column id="RESOURCEID" type="STRING" size="256" description="투입 Resource ID"/>
          <Column id="RESOURCENAME" type="STRING" size="256" description="투입 Resource명"/>
          <Column id="CHK" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_defectCancleHistList">
        <ColumnInfo>
          <Column id="No" type="STRING" size="256"/>
          <Column id="CANCELTIME" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="USERSEQUENCE" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="AREANAME" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PARENTLOTID" type="STRING" size="256"/>
          <Column id="DEFECTCODE" type="STRING" size="256"/>
          <Column id="DEFECTCODENAME" type="STRING" size="256"/>
          <Column id="QCSEGMENTID" type="STRING" size="256"/>
          <Column id="QCSEGMENTNAME" type="STRING" size="256"/>
          <Column id="PCSQTY" type="STRING" size="256"/>
          <Column id="PANELQTY" type="STRING" size="256"/>
          <Column id="UNIT" type="STRING" size="256"/>
          <Column id="CANCELUSER" type="STRING" size="256"/>
          <Column id="TXNHISTKEY" type="STRING" size="256"/>
          <Column id="REPAIRLOTNO" type="STRING" size="256"/>
          <Column id="CANCELREASON" type="STRING" size="256"/>
          <Column id="PROCESSDEFID" type="STRING" size="256"/>
          <Column id="PROCESSDEFVERSION" type="STRING" size="256"/>
          <Column id="PROCESSDEFNAME" type="STRING" size="256"/>
          <Column id="PROCESSPATHID" type="STRING" size="256"/>
          <Column id="INPUTSEGMENTID" type="STRING" size="256"/>
          <Column id="INPUTUSERSEQUENCE" type="STRING" size="256"/>
          <Column id="CANCELROUTINGTYPE" type="STRING" size="256"/>
          <Column id="CANCELTYPE" type="STRING" size="256"/>
          <Column id="REQUESTNO" type="STRING" size="256"/>
          <Column id="RESOURCEID" type="STRING" size="256"/>
          <Column id="RESOURCENAME" type="STRING" size="256"/>
          <Column id="RETURNPROCESSPATHID" type="STRING" size="256"/>
          <Column id="RETURNUSERSEQUENCE" type="STRING" size="256"/>
          <Column id="RETURNPROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="RETURNPROCESSSEGMENTVERSION" type="STRING" size="256"/>
          <Column id="RETURNAREAID" type="STRING" size="256"/>
          <Column id="RETURNRESOURCEID" type="STRING" size="256"/>
          <Column id="RETURNRESOURCENAME" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="JOINCODE" type="STRING" size="256"/>
          <Column id="JOINNAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_productRoutingList">
        <ColumnInfo>
          <Column id="PROCESSDEFID" type="STRING" size="256"/>
          <Column id="PROCESSDEFVERSION" type="STRING" size="256"/>
          <Column id="PROCESSDEFNAME" type="STRING" size="256"/>
          <Column id="USERSEQUENCE" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="PATHSEQUENCE" type="STRING" size="256"/>
          <Column id="RESOURCEID" type="STRING" size="256"/>
          <Column id="RESOURCENAME" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="DISPLAYSEQUENCE" type="STRING" size="256"/>
          <Column id="ROWNUM" type="STRING" size="256"/>
          <Column id="JOBFLAG" type="STRING" size="256" description="값변경시와 불량취소시 리턴이 달라서 구분값으로 사용"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_resultInfo">
        <ColumnInfo>
          <Column id="COUNT" type="STRING" size="256" description="체크값"/>
          <Column id="LOTID" type="STRING" size="256" description="저장후 결과"/>
          <Column id="QTY" type="STRING" size="256" description="저장후 결과"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="LOTID">200908F003-1-FG00-001-009</Col>
            <Col id="QTY">3</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_saveEtcParam" useclientlayout="true">
        <ColumnInfo>
          <Column id="CANCELUSER" type="STRING" size="256"/>
          <Column id="CANCELDATE" type="STRING" size="256"/>
          <Column id="LOTID" type="STRING" size="256"/>
          <Column id="PARENTLOTID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256"/>
          <Column id="PANELPERQTY" type="FLOAT" size="256"/>
          <Column id="TOTALDEFECTQTY" type="FLOAT" size="256"/>
          <Column id="CANCELDEFECTPCS" type="FLOAT" size="256"/>
          <Column id="CANCELDEFECTPNL" type="FLOAT" size="256"/>
          <Column id="ISNEXTSEGMENT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_reportParamList" useclientlayout="true">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="value" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_lotDefectCountList" oncolumnchanged="ds_lotDefectCountList_oncolumnchanged" useclientlayout="true">
        <ColumnInfo>
          <Column id="No" type="STRING" size="256"/>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="PROCESSDATE" type="STRING" size="256" description="처리일시"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256" description="품목 ID"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256" description="품목 Version"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256" description="품목명"/>
          <Column id="ENTERPRISEID" type="STRING" size="256" description="회사 ID"/>
          <Column id="PLANTID" type="STRING" size="256" description="Site ID"/>
          <Column id="USERSEQUENCE" type="STRING" size="256" description="공정수순"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256" description="공정 ID"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256" description="공정 Version"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256" description="공정명"/>
          <Column id="AREAID" type="STRING" size="256" description="작업장 ID"/>
          <Column id="AREANAME" type="STRING" size="256" description="작업장명"/>
          <Column id="PARENTLOTID" type="STRING" size="256" description="부모 Lot No"/>
          <Column id="LOTID" type="STRING" size="256" description="Lot No"/>
          <Column id="TXNHISTKEY" type="STRING" size="256" description="Txn HistKey"/>
          <Column id="DEFECTCODE" type="STRING" size="256" description="불량코드"/>
          <Column id="DEFECTNAME" type="STRING" size="256" description="불량명"/>
          <Column id="QCSEGMENTID" type="STRING" size="256" description="품질공정 ID"/>
          <Column id="QCSEGMENTNAME" type="STRING" size="256" description="품질공정명"/>
          <Column id="DEFECTPCSQTY" type="INT" size="256" description="불량 PCS수량"/>
          <Column id="DEFECTPNLQTY" type="FLOAT" size="256" description="불량 PNL수량"/>
          <Column id="PANELPERQTY" type="FLOAT" size="256" description="PNL당 PCS수량"/>
          <Column id="UOM" type="STRING" size="256" description="UOM 단위(불량처리단위)"/>
          <Column id="REASONCONSUMABLEDEFID" type="STRING" size="256" description="원인품목 ID"/>
          <Column id="REASONCONSUMABLEDEFVERSION" type="STRING" size="256" description="원인품목 Version"/>
          <Column id="REASONCONSUMABLEDEFNAME" type="STRING" size="256" description="원인품목명"/>
          <Column id="REASONCONSUMABLELOTID" type="STRING" size="256" description="원인자재 Lot No"/>
          <Column id="REASONSEGMENTID" type="STRING" size="256" description="원인공정 ID"/>
          <Column id="REASONSEGMENTVERSION" type="STRING" size="256" description="원인공정 Version"/>
          <Column id="REASONSEGMENTNAME" type="STRING" size="256" description="원인공정명"/>
          <Column id="REASONAREAID" type="STRING" size="256" description="원인작업장 ID"/>
          <Column id="REASONAREANAME" type="STRING" size="256" description="원인작업장명"/>
          <Column id="ISUNKNOWN" type="STRING" size="256" description="원인불명"/>
          <Column id="LOTTYPE" type="STRING" size="256" description="양산구분 ID"/>
          <Column id="LOTTYPENAME" type="STRING" size="256" description="양산구분명"/>
          <Column id="OUTBOUNDQTY" type="INT" size="256" description="반출수량"/>
          <Column id="RECEIVEAREAID" type="STRING" size="256" description="인수작업장 ID"/>
          <Column id="RECEIVEAREANAME" type="STRING" size="256" description="인수작업장명"/>
          <Column id="DEFINETIME" type="STRING" size="256" description="확정일시"/>
          <Column id="STATUS" type="STRING" size="256" description="확정상태"/>
          <Column id="DEFECTCODECOUNT" type="STRING" size="256" description="Lot별 불량코드갯수"/>
          <Column id="SUMLOTDEFECTQTY" type="STRING" size="256" description="Lot별 불량수량"/>
          <Column id="ISORIGINALLOTMERGE" type="STRING" size="256" description="OriginalLotMerge 가능여부"/>
          <Column id="ISORIGINALLOTMERGECODE" type="STRING" size="256" description="OriginalLotMerge 가능여부 코드"/>
          <Column id="MERGECHECK" type="STRING" size="256" description="OriginalLotMerge 가능여부에 따른 Check"/>
          <Column id="CANCELPCSQTY" type="INT" size="256" description="취소 PCS수량"/>
          <Column id="CANCELPNLQTY" type="FLOAT" size="256" description="취소 PNL수량"/>
          <Column id="ROUTINGTYPE" type="STRING" size="256" description="Routing Type"/>
          <Column id="CANCELCODE" type="STRING" size="256" description="취소사유코드"/>
          <Column id="INPUTPROCESSDEFID" type="STRING" size="256" description="투입 라우팅 ID"/>
          <Column id="INPUTPROCESSDEFVERSION" type="STRING" size="256" description="투입 라우팅 Version"/>
          <Column id="INPUTPROCESSDEFNAME" type="STRING" size="256" description="투입 라우팅명"/>
          <Column id="INPUTUSERSEQUENCE" type="STRING" size="256" description="투입 공정수순"/>
          <Column id="INPUTSEGMENTID" type="STRING" size="256" description="투입 공정 ID"/>
          <Column id="INPUTSEGMENTVERSION" type="STRING" size="256" description="투입 공정 Verison"/>
          <Column id="INPUTSEGMENTNAME" type="STRING" size="256" description="투입 공정명"/>
          <Column id="INPUTAREAID" type="STRING" size="256" description="투입 작업장 ID"/>
          <Column id="INPUTAREANAME" type="STRING" size="256" description="투입 작업장명"/>
          <Column id="INPUTRESOURCEID" type="STRING" size="256" description="투입 Resource ID 컬럼 세팅"/>
          <Column id="INPUTRESOURCENAME" type="STRING" size="256" description="투입 Resource명 컬럼 세팅"/>
          <Column id="REPAIRLOTNO" type="STRING" size="256" description="Repair Lot No"/>
          <Column id="INPUTPROCESSPATHID" type="STRING" size="256" description="투입 라우팅 상세 ID 컬럼 세팅"/>
          <Column id="RETURNPROCESSDEFID" type="STRING" size="256" description="재작업 후 라우팅 ID 컬럼 세팅"/>
          <Column id="RETURNPROCESSDEFVERSION" type="STRING" size="256" description="재작업 후 라우팅 Version 컬럼 세팅"/>
          <Column id="RETURNPROCESSPATHID" type="STRING" size="256" description="재작업 후 라우팅 상세 정의 ID 컬럼 세팅"/>
          <Column id="RETURNUSERSEQUENCE" type="STRING" size="256" description="재작업 후 공정수순 컬럼 세팅"/>
          <Column id="RETURNSEGMENTID" type="STRING" size="256" description="재작업 후 공정 ID 컬럼 세팅"/>
          <Column id="RETURNSEGMENTVERSION" type="STRING" size="256" description="재작업 후 공정 Version 컬럼 세팅"/>
          <Column id="RETURNSEGMENTNAME" type="STRING" size="256" description="재작업 후 공정명 컬럼 세팅"/>
          <Column id="RETURNAREAID" type="STRING" size="256" description="재작업 후 작업장 ID 세팅"/>
          <Column id="RETURNAREANAME" type="STRING" size="256" description="재작업 후 작업장명 컬럼 세팅"/>
          <Column id="RETURNRESOURCEID" type="STRING" size="256" description="재작업 후 Resource ID 컬럼 세팅"/>
          <Column id="RETURNRESOURCENAME" type="STRING" size="256" description="재작업 후 Resource명 컬럼 세팅"/>
          <Column id="DESCRIPTION" type="STRING" size="256" description="비고"/>
          <Column id="PROCESSSTATE" type="STRING" size="256" description="Lot의 공정진행상태"/>
          <Column id="PROCESSSTATENAME" type="STRING" size="256" description="Lot의 공정진행상태명"/>
          <Column id="WORKCOUNT" type="STRING" size="256" description="Lot Work Count"/>
          <Column id="PARENTPROCESSDEFID" type="STRING" size="256" description="부모 Lot의 라우팅 ID"/>
          <Column id="PARENTPROCESSDEFVERSION" type="STRING" size="256" description="부모 Lot의 라우팅  Version"/>
          <Column id="ISMIGRATION" type="STRING" size="256" description="MIG 데이터여부"/>
          <Column id="PROCESSPATHSTACK" type="STRING" size="256" description="현재 불량의 ProcessPathId"/>
          <Column id="JOINCODE" type="STRING" size="256"/>
          <Column id="JOINNAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_routingList" cancolumnchange="ds_routingList_cancolumnchange" useclientlayout="true">
        <ColumnInfo>
          <Column id="Column0" type="STRING" size="256"/>
          <Column id="No" type="STRING" size="256"/>
          <Column id="CHK" type="STRING" size="256"/>
          <Column id="PROCESSDATE" type="STRING" size="256" description="처리일시"/>
          <Column id="PRODUCTDEFID" type="STRING" size="256" description="품목 ID"/>
          <Column id="PRODUCTDEFVERSION" type="STRING" size="256" description="품목 Version"/>
          <Column id="PRODUCTDEFNAME" type="STRING" size="256" description="품목명"/>
          <Column id="ENTERPRISEID" type="STRING" size="256" description="회사 ID"/>
          <Column id="PLANTID" type="STRING" size="256" description="Site ID"/>
          <Column id="USERSEQUENCE" type="STRING" size="256" description="공정수순"/>
          <Column id="PROCESSSEGMENTID" type="STRING" size="256" description="공정 ID"/>
          <Column id="PROCESSSEGMENTVERSION" type="STRING" size="256" description="공정 Version"/>
          <Column id="PROCESSSEGMENTNAME" type="STRING" size="256" description="공정명"/>
          <Column id="AREAID" type="STRING" size="256" description="작업장 ID"/>
          <Column id="AREANAME" type="STRING" size="256" description="작업장명"/>
          <Column id="PARENTLOTID" type="STRING" size="256" description="부모 Lot No"/>
          <Column id="LOTID" type="STRING" size="256" description="Lot No"/>
          <Column id="TXNHISTKEY" type="STRING" size="256" description="Txn HistKey"/>
          <Column id="DEFECTCODE" type="STRING" size="256" description="불량코드"/>
          <Column id="DEFECTNAME" type="STRING" size="256" description="불량명"/>
          <Column id="QCSEGMENTID" type="STRING" size="256" description="품질공정 ID"/>
          <Column id="QCSEGMENTNAME" type="STRING" size="256" description="품질공정명"/>
          <Column id="DEFECTPCSQTY" type="INT" size="256" description="불량 PCS수량"/>
          <Column id="DEFECTPNLQTY" type="FLOAT" size="256" description="불량 PNL수량"/>
          <Column id="PANELPERQTY" type="FLOAT" size="256" description="PNL당 PCS수량"/>
          <Column id="UOM" type="STRING" size="256" description="UOM 단위(불량처리단위)"/>
          <Column id="REASONCONSUMABLEDEFID" type="STRING" size="256" description="원인품목 ID"/>
          <Column id="REASONCONSUMABLEDEFVERSION" type="STRING" size="256" description="원인품목 Version"/>
          <Column id="REASONCONSUMABLEDEFNAME" type="STRING" size="256" description="원인품목명"/>
          <Column id="REASONCONSUMABLELOTID" type="STRING" size="256" description="원인자재 Lot No"/>
          <Column id="REASONSEGMENTID" type="STRING" size="256" description="원인공정 ID"/>
          <Column id="REASONSEGMENTVERSION" type="STRING" size="256" description="원인공정 Version"/>
          <Column id="REASONSEGMENTNAME" type="STRING" size="256" description="원인공정명"/>
          <Column id="REASONAREAID" type="STRING" size="256" description="원인작업장 ID"/>
          <Column id="REASONAREANAME" type="STRING" size="256" description="원인작업장명"/>
          <Column id="ISUNKNOWN" type="STRING" size="256" description="원인불명"/>
          <Column id="LOTTYPE" type="STRING" size="256" description="양산구분 ID"/>
          <Column id="LOTTYPENAME" type="STRING" size="256" description="양산구분명"/>
          <Column id="OUTBOUNDQTY" type="INT" size="256" description="반출수량"/>
          <Column id="RECEIVEAREAID" type="STRING" size="256" description="인수작업장 ID"/>
          <Column id="RECEIVEAREANAME" type="STRING" size="256" description="인수작업장명"/>
          <Column id="DEFINETIME" type="STRING" size="256" description="확정일시"/>
          <Column id="STATUS" type="STRING" size="256" description="확정상태"/>
          <Column id="DEFECTCODECOUNT" type="STRING" size="256" description="Lot별 불량코드갯수"/>
          <Column id="SUMLOTDEFECTQTY" type="STRING" size="256" description="Lot별 불량수량"/>
          <Column id="ISORIGINALLOTMERGE" type="STRING" size="256" description="OriginalLotMerge 가능여부"/>
          <Column id="ISORIGINALLOTMERGECODE" type="STRING" size="256" description="OriginalLotMerge 가능여부 코드"/>
          <Column id="MERGECHECK" type="STRING" size="256" description="OriginalLotMerge 가능여부에 따른 Check"/>
          <Column id="CANCELPCSQTY" type="INT" size="256" description="취소 PCS수량"/>
          <Column id="CANCELPNLQTY" type="FLOAT" size="256" description="취소 PNL수량"/>
          <Column id="ROUTINGTYPE" type="STRING" size="256" description="Routing Type"/>
          <Column id="CANCELCODE" type="STRING" size="256" description="취소사유코드"/>
          <Column id="INPUTPROCESSDEFID" type="STRING" size="256" description="투입 라우팅 ID"/>
          <Column id="INPUTPROCESSDEFVERSION" type="STRING" size="256" description="투입 라우팅 Version"/>
          <Column id="INPUTPROCESSDEFNAME" type="STRING" size="256" description="투입 라우팅명"/>
          <Column id="INPUTUSERSEQUENCE" type="STRING" size="256" description="투입 공정수순"/>
          <Column id="INPUTSEGMENTID" type="STRING" size="256" description="투입 공정 ID"/>
          <Column id="INPUTSEGMENTVERSION" type="STRING" size="256" description="투입 공정 Verison"/>
          <Column id="INPUTSEGMENTNAME" type="STRING" size="256" description="투입 공정명"/>
          <Column id="INPUTAREAID" type="STRING" size="256" description="투입 작업장 ID"/>
          <Column id="INPUTAREANAME" type="STRING" size="256" description="투입 작업장명"/>
          <Column id="INPUTRESOURCEID" type="STRING" size="256" description="투입 Resource ID 컬럼 세팅"/>
          <Column id="INPUTRESOURCENAME" type="STRING" size="256" description="투입 Resource명 컬럼 세팅"/>
          <Column id="REPAIRLOTNO" type="STRING" size="256" description="Repair Lot No"/>
          <Column id="INPUTPROCESSPATHID" type="STRING" size="256" description="투입 라우팅 상세 ID 컬럼 세팅"/>
          <Column id="RETURNPROCESSDEFID" type="STRING" size="256" description="재작업 후 라우팅 ID 컬럼 세팅"/>
          <Column id="RETURNPROCESSDEFVERSION" type="STRING" size="256" description="재작업 후 라우팅 Version 컬럼 세팅"/>
          <Column id="RETURNPROCESSPATHID" type="STRING" size="256" description="재작업 후 라우팅 상세 정의 ID 컬럼 세팅"/>
          <Column id="RETURNUSERSEQUENCE" type="STRING" size="256" description="재작업 후 공정수순 컬럼 세팅"/>
          <Column id="RETURNSEGMENTID" type="STRING" size="256" description="재작업 후 공정 ID 컬럼 세팅"/>
          <Column id="RETURNSEGMENTVERSION" type="STRING" size="256" description="재작업 후 공정 Version 컬럼 세팅"/>
          <Column id="RETURNSEGMENTNAME" type="STRING" size="256" description="재작업 후 공정명 컬럼 세팅"/>
          <Column id="RETURNAREAID" type="STRING" size="256" description="재작업 후 작업장 ID 세팅"/>
          <Column id="RETURNAREANAME" type="STRING" size="256" description="재작업 후 작업장명 컬럼 세팅"/>
          <Column id="RETURNRESOURCEID" type="STRING" size="256" description="재작업 후 Resource ID 컬럼 세팅"/>
          <Column id="RETURNRESOURCENAME" type="STRING" size="256" description="재작업 후 Resource명 컬럼 세팅"/>
          <Column id="DESCRIPTION" type="STRING" size="256" description="비고"/>
          <Column id="PROCESSSTATE" type="STRING" size="256" description="Lot의 공정진행상태"/>
          <Column id="PROCESSSTATENAME" type="STRING" size="256" description="Lot의 공정진행상태명"/>
          <Column id="WORKCOUNT" type="STRING" size="256" description="Lot Work Count"/>
          <Column id="PARENTPROCESSDEFID" type="STRING" size="256" description="부모 Lot의 라우팅 ID"/>
          <Column id="PARENTPROCESSDEFVERSION" type="STRING" size="256" description="부모 Lot의 라우팅  Version"/>
          <Column id="ISMIGRATION" type="STRING" size="256" description="MIG 데이터여부"/>
          <Column id="PROCESSPATHSTACK" type="STRING" size="256" description="현재 불량의 ProcessPathId"/>
          <Column id="JOINCODE" type="STRING" size="256"/>
          <Column id="JOINNAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.1"><![CDATA[/***************************************************************************************
 * 시스템명       : IFC MES시스템
 * 업무명         : 불량품 폐기취소(품질관리 - 불량품 관리)
 * 파일명         : QAM019000M.xfdl
 * 작성자         : yanghee.kim
 * 작성일         : 2021.04.18
 *
 * 설  명         : 
 *---------------------------------------------------------------------------------------
 * 변경일        변경자      변경내역
 *---------------------------------------------------------------------------------------
 * 2021.04.18   yanghee.kim   최초작성
 *---------------------------------------------------------------------------------------
 ****************************************************************************************/

/**************************************************************************
 * 1. 필수 include
 ***************************************************************************/
include "lib::lib_qam.xjs";	//품질관리 공통 라이브러리 include

/**************************************************************************
 * 2. FORM 변수 선언 영역
 ***************************************************************************/
this.div_lotInfo = this.div_work.form.tab.Tab1.form.div_lotInfo.form;
this.totalDefectQty=0; //해당LOT의 불량 총수량

/**************************************************************************
 * 3. FORM LOAD
 ***************************************************************************/
this.fn_init = function (obj:Form, e:nexacro.LoadEventInfo)
{
    this.nfn_formInit(obj);	
	
	//global value setting
	this.qamfn_setGlobalValue()
    
	//접속사용자의 PLANT 조회
	this.qamfn_searchUserPlant("ds_userAuthorityPlantList", this.tab_search.Tab1.form.cbo_plantId); 
	
	//조회기간 onchanged Event 추가
	this.tab_search.Tab1.form.div_dateFrom.form.pdiv_data.form.calStart.addEventHandler("onchanged", this.fn_preiodChang, this);
	this.tab_search.Tab1.form.div_dateTo.form.pdiv_data.form.calStart.addEventHandler("onchanged", this.fn_preiodChang, this);
	
	//그리드 Head와 Body가 불일치하는 현상이 있어 공통 Event 제거
    this.div_work.form.tab.Tab1.form.grd_lotDefectList.removeEventHandler("onheadclick", this.nfn_grd_onheadclick , this);

	this.fn_formInit();    //최초 호출되는 초기화 함수	
};

/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 이벤트 : 불량취소 버튼 클릭시
 */
this.fn_save = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	//품목라우팅을 태우는 경우에는 사용자 지정 재작업라우팅 테이블을 초기화해준다.
	if (this.ds_routingList.getColumn(0, "ROUTINGTYPE") == "Product")
	{
	    this.ds_reworkLotDefectList.ClearData(); //checkpoint
	}
	else
	{
		this.ds_reworkLotDefectList.addColumn("LOTID");
		var lotId = this.div_work.form.tab.Tab1.form.div_lotInfo.form.edt_lotId.value;
		
		for(var i=0; i<this.ds_reworkLotDefectList.getCount();i++)
		{
			this.ds_reworkLotDefectList.setColumn(i, "LOTID", lotId);
		}
	}

    if (!this.gfn_dsIsUpdated(this.ds_lotDefectCountList))
    {
        this.gfn_Message("NoSaveData", null, "warning", "ok");
        return;
    }
	
	var totalCancelPcs = this.div_lotInfo.msk_pcs.value;
	
	// 저장할 총 취소수량이 0이라면 Exception
	if ( nexacro.toNumber(totalCancelPcs) == 0)
	{
		this.gfn_Message("CancelQtyIsZero", null, "warning", "ok");
		return false;
	}
	
	// 취소할 불량중에 취소수량이 0인것이 있다면 Exception
	var zeroCount = this.ds_lotDefectCountList.getCaseCount("CANCELPCSQTY == 0");
	if (zeroCount > 0)
	{
		this.gfn_Message("CancelDefectIsZero", null, "warning", "ok");
		return false;
	}
	
	// Original Lot Merge가 아닌데, 라우팅이 선택되지 않았다면 Exception
	var aa =this.ds_routingList.getColumn(0, "MERGECHECK");
	if (   (    this.nfn_isNull(this.ds_routingList.getColumn(0, "MERGECHECK")) 
	         || this.ds_routingList.getColumn(0, "MERGECHECK") == 0 )
	    && (    this.nfn_isNull(this.ds_routingList.getColumn(0, "INPUTPROCESSDEFNAME")) 
	         && this.nfn_isNull(this.ds_routingList.getColumn(0, "INPUTPROCESSDEFID"))))
	{
		this.gfn_Message("NecessaryRouting", null, "warning", "ok");
		return false;
	}	
	
	// 실제 업무상 불량취소시 반출수량이 있으면 해당 실물이 없을 수 있기 때문에 반출수량을 감안하여 취소하여야 합니다.
	var totalOutboundQty = this.ds_lotDefectCountList.getSum("OUTBOUNDQTY");
	var totalDefectQty = this.ds_lotDefectCountList.getSum("DEFECTPCSQTY");
	var totalCancelPcs = this.ds_lotDefectCountList.getSum("CANCELPCSQTY");
	
	if (nexacro.toNumber(totalCancelPcs) > (nexacro.toNumber(totalDefectQty) - nexacro.toNumber(totalOutboundQty)))
	{
		if (!this.gfn_Message("ConfExistsOutBoundQty", "", "conf", "yesno")) return;	
	}
	else
	{
		if (!this.gfn_Message("DoDefectCancel", "", "conf", "yesno")) return;
	}
		
	var isNextSegment = this.fn_searchProductRouting(this.ds_lotDefectCountList, "S");
	this.fn_searchTotalLotDefect(this.ds_lotDefectCountList.getColumn(0, "LOTID"));
	
	this.ds_saveEtcParam.clearData();
	var nRow = this.ds_saveEtcParam.addRow();

	var cancelPcs = this.div_lotInfo.msk_pcs.value;// 취소할 총 불량 PCS
	var cancelPnl = this.div_lotInfo.msk_pnl.value; // 취소할 총 불량 PNL
	
	this.ds_saveEtcParam.setColumn(nRow, "CANCELUSER"        , this.qam_userId);
	this.ds_saveEtcParam.setColumn(nRow, "CANCELDATE"	     , this.nfn_getCurrentSystemTime(0));
	this.ds_saveEtcParam.setColumn(nRow, "LOTID"             , this.ds_lotDefectCountList.getColumn(0, "LOTID"));
	this.ds_saveEtcParam.setColumn(nRow, "PARENTLOTID"       , this.ds_lotDefectCountList.getColumn(0, "PARENTLOTID"));
	this.ds_saveEtcParam.setColumn(nRow, "PRODUCTDEFID"      , this.ds_lotDefectCountList.getColumn(0, "PRODUCTDEFID"));
	this.ds_saveEtcParam.setColumn(nRow, "PRODUCTDEFVERSION" , this.ds_lotDefectCountList.getColumn(0, "PRODUCTDEFVERSION"));
	this.ds_saveEtcParam.setColumn(nRow, "PANELPERQTY"       , this.ds_lotDefectCountList.getColumn(0, "PANELPERQTY"));
	this.ds_saveEtcParam.setColumn(nRow, "TOTALDEFECTQTY"    , this.totalDefectQty);
	this.ds_saveEtcParam.setColumn(nRow, "CANCELDEFECTPCS"   , cancelPcs);
	this.ds_saveEtcParam.setColumn(nRow, "CANCELDEFECTPNL"   , cancelPnl);
	this.ds_saveEtcParam.setColumn(nRow, "ISNEXTSEGMENT"     , isNextSegment);
	
	trace(this.ds_lotDefectCountList.saveXML());
	trace(this.ds_routingList.saveXML());
	trace(this.ds_reworkLotDefectList.saveXML());
	trace(this.ds_saveEtcParam.saveXML());

    this.ds_resultInfo.clearData();	
	// -------------------------
	// 저장
	// ':U' 는 갱신된 내용만을 입력 데이터세트로 보내며, ':A' 는 모든 정보를 보냅니다.
	// ':N' 은 현재 Delete를 제외한 데이터를 Normal 상태로 보냅니다. 지정하지 않는 데이터세트는 Normal로 동작합니다
	// -------------------------
	var sSvcID        = "saveLotDefectCancel";
	var sController   = "/qam01900/saveLotDefectCancel.do";
	var sInDatasets   = "ds_lotDefectCountList=ds_lotDefectCountList:U ds_routingList=ds_routingList:A ds_reworkLotDefectList=ds_reworkLotDefectList:U ds_saveEtcParam=ds_saveEtcParam:U";
	var sOutDatasets  = "ds_resultInfo=output";
	var sArgs         = "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

/*
 * 기능 : 검색
 */
this.fn_search = function (obj:Button, e:nexacro.ClickEventInfo)
{
    var tabIdx = this.div_work.form.tab.tabindex;
    switch (tabIdx)
    {
        case 0:
            this.fn_searchLotDefectList();  //탭1 불량취소
        break;
        case 1:
            this.fn_searchCancelHistList(); //탭2 내역조회
        break;
    }
};

/*
 * 기능 : 조회조건 SET
 */
this.fn_setSearchParam = function()
{
    this.ds_search.clearData();	
	var nRow = this.ds_search.addRow();	
	this.ds_search.setColumn(nRow, "ENTERPRISEID",        this.qam_enterpriseId);
	this.ds_search.setColumn(nRow, "LANGUAGETYPE",        this.qam_lang);
	this.ds_search.setColumn(nRow, "USERID",              this.qam_userId);
    this.ds_search.setColumn(nRow, "PLANTID",             this.tab_search.Tab1.form.cbo_plantId.value);
	this.ds_search.setColumn(nRow, "PERIODFR",            this.tab_search.Tab1.form.div_dateFrom.form.calStart.value);
	this.ds_search.setColumn(nRow, "PERIODTO",            this.tab_search.Tab1.form.div_dateTo.form.calStart.value);
	this.ds_search.setColumn(nRow, "AREAID",              this.tab_search.Tab1.form.edt_area_id.value);
	this.ds_search.setColumn(nRow, "PRODUCTDEFID",        this.tab_search.Tab1.form.edt_productDef_id.value);
	this.ds_search.setColumn(nRow, "LOTID",               this.tab_search.Tab1.form.edt_defectlotId.value);
	this.ds_search.setColumn(nRow, "PARENTLOTID",         this.tab_search.Tab1.form.edt_parentLotId.value);
	this.ds_search.setColumn(nRow, "LOTTYPE",             this.tab_search.Tab1.form.cbo_lotType.value);
	this.ds_search.setColumn(nRow, "PROCESSSEGMENTTYPE",  this.tab_search.Tab1.form.cbo_processsegmentType.value);
    this.ds_search.setColumn(nRow, "CONFIRMATION",        this.tab_search.Tab1.form.cbo_confirm.value);
};

/*
 * 기능 : 탭1 불량취소
 */
this.fn_searchLotDefectList = function ()
{
	this.ds_lotDefectList.clearData();
	this.ds_lotDefectCountList.clearData();
	this.ds_routingList.clearData();
	
	//div_lotInfo 데이터 초기화
	this.fn_setInitialDivLotInfo();	
    
	//조회조건 SET
    this.fn_setSearchParam();
    
	var sSvcID        = "selectLotDefectCodeList";
    var sController   = "/qam01900/selectLotDefectCodeList.do";
    var sInDatasets   = "INPUT=ds_search";
    var sOutDatasets  = "ds_lotDefectList=output";
    var sArgs         = "";
    this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);	
};  

/*
 * 기능 : 탭2 내역조회
 */
this.fn_searchCancelHistList = function ()
{
	this.ds_defectCancleHistList.clearData();
	
	//조회조건 SET
    this.fn_setSearchParam();
    
	var sSvcID        = "selectDefectCancelHistoryList";
    var sController   = "/qam01900/selectDefectCancelHistoryList.do";
    var sInDatasets   = "INPUT=ds_search";
    var sOutDatasets  = "ds_defectCancleHistList=output";
    var sArgs         = "";
    this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
}; 

/**************************************************************************
 * 5. TRANSACTION, CALLBACK 영역
 ***************************************************************************/
this.fn_callBack = function (trId, errCD, errMsg)
{
    if (errCD < 0)
    {
        this.gfn_Message("ProcessingError", trId + errMsg, "error", "ok");
    }
    else
    {
	    if (trId == "selectProductRoutingPreviousProcessPathsList")
        {
// 			if (this.ds_productRoutingList.rowcount == 0)
// 			{
// 				this.gfn_Message("LastProcesssegmentIsNotTakeoverGoods", null, "info", "ok"); //해당공정이 마지막 공정이므로 양품인계가 불가능합니다.
// 				return false;
// 			}
		}
		else if (trId == "selectTotalLotDefectInfo")
        {
// 			if (this.ds_resultInfo.rowcount == 0)
// 			{
// 				this.totalDefectQty = this.ds_resultInfo.getColumn(0, "COUNT");
// 			}
		}
		else if (trId == "selectLotDefectCodeList")
        {
			if (this.ds_lotDefectList.rowcount < 1)
			{
				this.gfn_Message("NoSelectData", null, "info", "ok");
				return;
			}
		}		
		else if (trId == "selectDefectCancelHistoryList")
        {
			if (this.ds_defectCancleHistList.rowcount < 1)
			{
				this.gfn_Message("NoSelectData", null, "info", "ok");
				return;
			}
		}		
        else if (trId == "saveLotDefectCancel")
        {
			//조회값이 NULL이라서 변경되지 않았을 경우 값이 <undefined>라서 추가함
			var count = this.ds_routingList.getCaseCount("MERGECHECK == '0' || MERGECHECK == undefined ");

            // Split할 불량이 하나도 없다면 Repiar Lot 생성하지 않음
			if (count == 0)
			{
				this.gfn_Message("SuccessSave", null, "info", "ok");
				this.fn_search();
			}
			else
			{
				var lotId = this.ds_resultInfo.getColumn(0, "LOTID");
				var qty = " "+this.ds_resultInfo.getColumn(0, "QTY"); //메시지 띠울시 다국어 체크를 하는데 dictionaryid가 숫자인 경우가 있어 앞에 공백추가
				this.gfn_Message("CompleteDefectCancelParam", [lotId, qty], "info", "ok");
				this.fn_search();
				
				// 품목라우팅일때
				if (this.ds_reworkLotDefectList.rowcount == 0)
				{
					this.fn_callReport(lotId, this.nfn_getDictionaryname("NORMALWORKTIME", true)); //LotWorkType(Normal:정상)
				}
				// 재작업라우팅일때
				else
				{
				    this.fn_callReport(lotId, this.nfn_getDictionaryname("NORMALWORKTIME", true)); //LotWorkType(Normal:정상)
					this.fn_callReport(lotId, this.nfn_getDictionaryname("REWORK", true)); //LotWorkType(IsRework:재작업)
				}
				
			}
        }
    }
};

/*
 * 기능 : 레포트 호출
 */
this.fn_callReport = function (pLotId, pLotWorkType)
{
	var workType = pLotId+ "|" + pLotWorkType;
	var oArg = {
		sRptPath   : "/PCM/",
		sRptName   : "PCM00600R.mrd",
		strField   : "[" + pLotId + "][" + this.qam_lang + "][" +  workType +  "][]",
		bModalless : false
	};
	
    var title 	= this.nfn_nvl(this.nfn_getDictionarynameUpper("LOTCARDPRINT"),"LOT Card 출력");
	var sOption = "titletext="+title+",modeless=false";
	
	this.gfn_reportPopup("reportViewer", "common::com_report.xfdl", oArg, sOption);	
};

/**************************************************************************
 * 6. 팝업 호출/콜백
 **************************************************************************/
 this.fn_openPop = function(svcId, popId)
{
    // gfn_openPopup(arg_type, popupCd, popupNm, rtnCols, paramCols, paramValues, searchStr);
    //-----------------
    // arg_type    : A::사용자가 선택, B:: 한건존재시 자동 셋팅, C::사용자 멀티 선택
    // popupCd     : 공통팝업 관리 화면에서 생성되는 팝업코드
    // popupNm     : 변경할팝업화면명 , 변경하지 않을 경우 팝업화면 타이틀은 관리화면의 타이틀로 지정됨
    // rtnCols     : 구분자 : "|"   : 그리드에 출력될 컬럼 지정 (않을 경우 관리화면의 그리드로 출력됨)
    // paramCols   : 구분자 : "|" : where 구문에 들어갈 컬럼
    // paramValues : 구분자 : "|"  : where 구문에 들어갈 컬럼에 대한 값
    // searchStr   : 팝업 조회조건 콤보값 = 조회 값

    var popupId = svcId;
    var oArg = {};
    var opts = "width=650,height=500";

    oArg.arg_type = "BA";
    oArg.arg_popupCd = popId;
    oArg.arg_popupNm = "";
    oArg.arg_paramCols = "";
    oArg.arg_paramValues = "";
    oArg.arg_searchStr = "";
	
    if(popupId == "SRCH_AREA228")    /*조회조건-작업장*/
    {
        opts = "width=450,height=500";
		oArg.arg_paramCols   = "LANGUAGETYPE|PLANTID|USER_ID";
        oArg.arg_paramValues = this.qam_lang +'|'+ this.qam_plantId +'|'+ this.qam_userId;
        oArg.arg_rtnCols     = "AREAID|AREANAME";
		oArg.arg_searchStr   = "AREAIDNAME=" + this.tab_search.Tab1.form.edt_area.value;
    }
	else if(popupId == "SRCH_PRODUCTDEF218")    /*조회조건-품목*/
    {
		oArg.arg_paramCols   = "PLANTID";
        oArg.arg_paramValues = this.qam_plantId;
        oArg.arg_rtnCols     = "PRODUCTDEFIDVERSION|PRODUCTDEFNAME";
		oArg.arg_searchStr   = "PRODUCTDEFIDNAME=" + this.tab_search.Tab1.form.edt_productDef.value;
    }

    this.gfn_openPopup(popupId,"cmd::CMSA00100P.xfdl",oArg,opts);
};

//팝업 결과 리턴
this.fn_popupAfter = function(sPopupId, Variant)
{
	if (sPopupId == "ROUTINGNAME") //라우팅 선택(QAM01900P1)
    {
	    var rtn = this.qam_rtnValue[0];
		var nRow = this.ds_routingList.rowposition;	
		
		if (!this.nfn_isNull(rtn))
		{
			this.ds_routingList.setColumn(nRow, "INPUTPROCESSDEFID",        rtn[0]);    // PROCESSDEFID            // 재작업 라우팅-투입 라우팅 ID
			this.ds_routingList.setColumn(nRow, "INPUTPROCESSDEFVERSION",   rtn[1]);    // PROCESSDEFVERSION       // 재작업 라우팅-투입 라우팅 Version
			this.ds_routingList.setColumn(nRow, "INPUTPROCESSDEFNAME",      rtn[2]);    // PROCESSDEFNAME          // 재작업 라우팅-투입 라우팅명
			this.ds_routingList.setColumn(nRow, "INPUTPROCESSPATHID",       rtn[3]);    // PROCESSPATHID           // 재작업 라우팅-투입 라우팅 상세 ID
			this.ds_routingList.setColumn(nRow, "INPUTUSERSEQUENCE",        rtn[4]);    // USERSEQUENCE            // 재작업 라우팅-순서
			this.ds_routingList.setColumn(nRow, "INPUTSEGMENTID",           rtn[5]);    // PROCESSSEGMENTID        // 재작업 라우팅-투입 공정 ID
			this.ds_routingList.setColumn(nRow, "INPUTSEGMENTVERSION",      rtn[6]);    // PROCESSSEGMENTVERSION   // 재작업 라우팅-투입 공정 Version
			this.ds_routingList.setColumn(nRow, "INPUTSEGMENTNAME",         rtn[7]);    // PROCESSSEGMENTNAME      // 재작업 라우팅-투입 공정명
			this.ds_routingList.setColumn(nRow, "INPUTAREAID",              rtn[8]);    // AREAID                  // 재작업 라우팅-투입 작업장 ID
			this.ds_routingList.setColumn(nRow, "INPUTRESOURCEID",          rtn[9]);    // RESOURCEID              // 재작업 라우팅-투입 Resource ID
			this.ds_routingList.setColumn(nRow, "INPUTRESOURCENAME",        rtn[10]);    // RESOURCENAME           // 재작업 라우팅-투입 Resource명
            
			this.ds_reworkLotDefectList.clearData();
		}

	    var rtn1 = this.qam_rtnValue[1];
		if (!this.nfn_isNull(rtn1))
		{
			this.ds_routingList.setColumn(nRow, "RETURNPROCESSDEFID",       rtn1[0]);    // PROCESSDEFID            // 재작업 후 공정-재작업 후 라우팅 ID
			this.ds_routingList.setColumn(nRow, "RETURNPROCESSDEFVERSION",  rtn1[1]);    // PROCESSDEFVERSION       // 재작업 후 공정-재작업 후 라우팅 Version
			this.ds_routingList.setColumn(nRow, "RETURNPROCESSPATHID",      rtn1[2]);    // PROCESSPATHID           // 재작업 후 공정-재작업 후 라우팅 상세 ID
			this.ds_routingList.setColumn(nRow, "RETURNUSERSEQUENCE",       rtn1[3]);    // USERSEQUENCE            // 재작업 후 공정-재작업 후 순서
			this.ds_routingList.setColumn(nRow, "RETURNSEGMENTID",          rtn1[4]);    // PROCESSSEGMENTID        // 재작업 후 공정-재작업 후 공정 ID
			this.ds_routingList.setColumn(nRow, "RETURNSEGMENTVERSION",     rtn1[5]);    // PROCESSSEGMENTVERSION   // 재작업 후 공정-재작업 후 공정 Version
			this.ds_routingList.setColumn(nRow, "RETURNSEGMENTNAME",        rtn1[6]);    // PROCESSSEGMENTNAME      // 재작업 후 공정-재작업 후 공정명
			this.ds_routingList.setColumn(nRow, "RETURNAREAID",             rtn1[7]);    // AREAID                  // 재작업 후 공정-재작업 후 작업장 ID
			this.ds_routingList.setColumn(nRow, "RETURNRESOURCEID",         rtn1[8]);    // RESOURCEID              // 재작업 후 공정-재작업 후 Resource ID
			this.ds_routingList.setColumn(nRow, "RETURNRESOURCENAME",       rtn1[9]);    // RESOURCENAME            // 재작업 후 공정-재작업 후 작업장명
		    
			this.ds_reworkLotDefectList.clearData();
		}
		
	    var rtn3 = this.qam_rtnValue[2];
		if (!this.nfn_isNull(rtn3))
		{
		   for(var i=0; i<rtn3.length; i++)
		   {
			 var nRow = this.ds_reworkLotDefectList.addRow();
			 for(var j=0; j<rtn3[i].length; j++)
			 {				
				this.ds_reworkLotDefectList.setColumn(i, j, rtn3[i][j]);
			 }
		   }
		}

		return;
	}
	else if (sPopupId == "REWORKROUTING") //
	{
        return;
    }
	
    var rtn = this.fv_rtnValue;
    if(this.nfn_isNull(rtn)) return;
	
    if (sPopupId == "SRCH_AREA228")    /*조회조건-작업장*/
    {
        this.tab_search.Tab1.form.edt_area_id.set_value(rtn[0]);
		this.tab_search.Tab1.form.edt_area.set_value(rtn[1]);
    }
	else if (sPopupId == "SRCH_PRODUCTDEF218")    /*조회조건-품목*/
    {
        this.tab_search.Tab1.form.edt_productDef_id.set_value(rtn[0]);
		this.tab_search.Tab1.form.edt_productDef.set_value(rtn[1]);
    }
};

/**************************************************************************
 * 7. 기타 함수(화면 로컬 정의)
 **************************************************************************/
/*
 * 기능 : 최초 호출되는 초기화 함수
 */
this.fn_formInit = function ()
{
	this.fn_setSearchDate("today"); //조회기간 셋팅
	this.tab_search.Tab1.form.cbo_plantId.set_value(this.qam_plantId);
	this.tab_search.Tab1.form.cbo_period.set_value("today"); //금일	
};

/*
 * 기능 : 조회조건 초기화
 */
this.fn_searchClear = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fn_formInit();	
};

/*
 * 이벤트 : 조회조건- 조회기간 직접 변경시
 */
this.fn_preiodChang = function(obj:nexacro.Calendar,e:nexacro.ChangeEventInfo)
{
	if (!this.nfn_isNull(this.tab_search.Tab1.form.cbo_period.value))
	{
		this.tab_search.Tab1.form.cbo_period.set_text("사용자정의");
	}	
};

/*
 * 기능 : 조회기간의 기간타입이 변경될 경우 날짜 셋팅
 */
this.fn_setSearchDate = function (pChangValue)
{	
	if (this.nfn_isNull(pChangValue)) return false;

	var sDate = this.nfn_getCurrentSystemTime(0, 0, pChangValue);
	var arrDate = sDate.split(",");
	var sDateFrom = arrDate[1];
	var sDateTo = arrDate[2];
	var sTime = "0830";

	this.tab_search.Tab1.form.div_dateFrom.form.calStart.set_value(sDateFrom+sTime);
	this.tab_search.Tab1.form.div_dateTo.form.calStart.set_value(sDateTo+sTime);	
};

/*
 * 기능 : 취소사유를 양품인계로 변경시 공정체크
 */
this.fn_searchProductRouting = function(pDataset, pJobFlag)
{
    //조회조건 Setting
	this.fn_setSearchRouting(pDataset, pJobFlag);
	
	this.ds_productRoutingList.clearData();	
    var sSvcID        = "selectProductRoutingPreviousProcessPathsList";
    var sController   = "/qam01900/selectProductRoutingPreviousProcessPathsList.do";
    var sInDatasets   = "INPUT=ds_searchRouting";
    var sOutDatasets  = "ds_productRoutingList=output";
    var sArgs         = "";
    this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs, "", false, false,"");
	
	if (pJobFlag == "C")
	{
		if (this.ds_productRoutingList.rowcount == 0)
		{	
			this.gfn_Message("LastProcesssegmentIsNotTakeoverGoods", null, "info", "ok"); //해당공정이 마지막 공정이므로 양품인계가 불가능합니다.
			return false;
		}		
	}
	else if (pJobFlag == "S")
	{
		if (this.ds_productRoutingList.rowcount == 0) return false;	
	}
	
	return true;
};

/*
 * 기능 : 취소사유를 양품인계로 변경시 공정체크
 */
this.fn_setSearchRouting = function (pDataset, pJobFlag)
{
	this.ds_searchRouting.clearData();
	var nRow = this.ds_searchRouting.addRow();
	var currRow = pDataset.rowposition;
	
	this.ds_searchRouting.setColumn(nRow, "LANGUAGETYPE",      this.qam_lang);
	this.ds_searchRouting.setColumn(nRow, "CANCELCODE",        "TakeoverGoods"); //양품인계
	this.ds_searchRouting.setColumn(nRow, "LOTID",             pDataset.getColumn(currRow, "PARENTLOTID"));		
	this.ds_searchRouting.setColumn(nRow, "PROCESSDEFID",      pDataset.getColumn(currRow, "PARENTPROCESSDEFID"));	
	this.ds_searchRouting.setColumn(nRow, "PROCESSDEFVERSION", pDataset.getColumn(currRow, "PARENTPROCESSDEFVERSION"));
	this.ds_searchRouting.setColumn(nRow, "PROCESSSEGMENTID",  pDataset.getColumn(currRow, "PROCESSSEGMENTID"));
	this.ds_searchRouting.setColumn(nRow, "JOBFLAG",           pJobFlag);
	this.ds_searchRouting.setColumn(nRow, "VERSION",           "10002");
};

/*
 * 해당 Lot의 취소수량을 받아와 완불처리 됬는지 판별(Y - 완불처리, N - 완불처리아님)
 */
this.fn_searchIsAllQtyDefectLot = function(pLotNo, pCancelQty)
{	
	this.ds_resultInfo.clearData();	
    var sSvcID        = "selectIsAllQtyDefectLot";
    var sController   = "/qam01900/selectIsAllQtyDefectLot.do";
    var sInDatasets   = "";
    var sOutDatasets  = "ds_resultInfo=output";
    var sArgs         = "";
		sArgs        += this.gfn_setParam("LOTID",      pLotNo);		
        sArgs        += this.gfn_setParam("DEFECTQTY",  pCancelQty);	

	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs, "", "", false, "");
	
	var result = this.ds_resultInfo.getColumn(0, "COUNT") == 1 ? "Y" : "N";
	return result;
};


/*
 * 기능 : 해당 Lot의 불량 총수량
 */
this.fn_searchTotalLotDefect = function(pLotNo)
{	
	this.ds_resultInfo.clearData();	
    var sSvcID        = "selectTotalLotDefectInfo";
    var sController   = "/qam01900/selectTotalLotDefectInfo.do";
    var sInDatasets   = "";
    var sOutDatasets  = "ds_resultInfo=output";
    var sArgs         = "";
		sArgs        += this.gfn_setParam("LOTID",      pLotNo);		
    this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs, "", false, false, "");
	
	this.totalDefectQty = this.ds_resultInfo.getColumn(0, "COUNT");
};

/*
 *
 */
this.ds_lotDefectList_cancolumnchange = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if (e.columnid == "CHK")
	{
		if (e.newvalue == "1")
		{
			var currLotId;
			var currProductDef;			
			var nRow = this.ds_lotDefectList.findRow("CHK", "1");
			
			if (nRow > -1)
			{
				chkLotId = this.ds_lotDefectList.getColumn(nRow, "LOTID");
				chkProductDef = this.ds_lotDefectList.getColumn(nRow, "PRODUCTDEFID") + this.ds_lotDefectList.getColumn(nRow, "PRODUCTDEFVERSION");	
				currLotId = this.ds_lotDefectList.getColumn(e.row, "LOTID");
				currProductDef = this.ds_lotDefectList.getColumn(e.row, "PRODUCTDEFID") + this.ds_lotDefectList.getColumn(e.row, "PRODUCTDEFVERSION");
				
				if (chkLotId != currLotId)
				{
					this.gfn_Message("MixSelectLotID", "", "warning", "ok"); // 다른 Lot ID는 선택할 수 없습니다.
					return false;		
				}
				
				if (chkProductDef != currProductDef)
				{
					this.gfn_Message("MixSelectLotID", "", "warning", "ok"); // 다른 Lot ID는 선택할 수 없습니다.
					return false;		
				}			
			}
		}//if e.newvalue
	}// if e.columnid
};

/*
 * 기능 : 취소 PCS 수량이 변할때마다 Total PCS 수량과 취소 PNL 수량을 계산한다.
 */
this.ds_lotDefectCountList_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	obj.set_enableevent(false);
	
	// 취소 PCS수량 입력할때
	if (e.columnid == "CANCELPCSQTY")
	{
		var totalCancelPcs = 0; // 취소할 총 불량PCS(전체)
		var totalCancelPnl = 0; // 취소할 총 불량PNL(전체)

		var cancelPcs   = nexacro.toNumber(e.newvalue); // 취소할 불량수량(개별)
		var panelPerQty = nexacro.toNumber(obj.getColumn(e.row, "PANELPERQTY")); // PNL당 PCS수량(개별)
		var cancelPnl   = panelPerQty == 0 ? 0 : Math.ceil(cancelPcs / panelPerQty); // 취소 PNL 수량(개별)

		obj.setColumn(e.row, "CANCELPNLQTY", cancelPnl);
  
		// 모든 Row에 대한 취소 PCS수량의 합을 구한다.
		totalCancelPcs = obj.getSum("CANCELPCSQTY");
		totalCancelPnl = obj.getSum("CANCELPNLQTY");

		// 취소할 불량수량이 총 불량수량보다 많다면 Exception
		if (cancelPcs > nexacro.toNumber(obj.getColumn(e.row, "DEFECTPCSQTY")))
		{
			this.gfn_Message("CancelGreatThenDefect", "", "warning", "ok"); // 취소할 수량이 불량수량보다 많습니다.
	
			obj.setColumn(e.row, "CANCELPCSQTY", 0);
			obj.setColumn(e.row, "CANCELPNLQTY", 0);
            obj.set_enableevent(true);
			
			// 모든 Row에 대한 취소 PCS수량과 PNL수량의 합을 다시 구한다.
			totalCancelPcs = 0;
			totalCancelPnl = 0;

			totalCancelPcs = obj.getSum("CANCELPCSQTY");
			totalCancelPnl = obj.getSum("CANCELPNLQTY");
			
			this.div_lotInfo.msk_pcs.set_value(totalCancelPcs);// 취소할 총 불량 PCS
			this.div_lotInfo.msk_pnl.set_value(totalCancelPnl); // 취소할 총 불량 PNL
			return false;
		}

		this.div_lotInfo.msk_pcs.set_value(totalCancelPcs);// 취소할 총 불량 PCS
		this.div_lotInfo.msk_pnl.set_value(totalCancelPnl); // 취소할 총 불량 PNL
	}
	// 취소 PNL 수량 입력할때
	else if (e.columnid == "CANCELPNLQTY")
	{

		var totalCancelPcs = 0; // 취소할 총 불량PCS(전체)
		var totalCancelPnl = 0; // 취소할 총 불량PNL(전체)

		var cancelPnl = nexacro.toNumber(e.newvalue); // 취소할 불량수량(개별)
		var panelPerQty = nexacro.toNumber(obj.getColumn(e.row, "PANELPERQTY")); // PNL당 PCS수량(개별)
		var cancelPcs = 0;

		// 취소할 불량수량이 총 불량수량보다 많다면 Exception
		if (nexacro.toNumber(obj.getColumn(e.row, "CANCELPNLQTY")) > nexacro.toNumber(obj.getColumn(e.row, "DEFECTPNLQTY")))
		{
			this.gfn_Message("CancelGreatThenDefect", "", "warning", "ok"); // 취소할 수량이 불량수량보다 많습니다.

			obj.setColumn(e.row, "CANCELPCSQTY", 0);
			obj.setColumn(e.row, "CANCELPNLQTY", 0);
			obj.set_enableevent(true);

			// 모든 Row에 대한 취소 PCS수량과 PNL수량의 합을 다시 구한다.
			totalCancelPcs = 0;
			totalCancelPnl = 0;

			// 모든 Row에 대한 취소 PCS수량과 PNL수량의 합을 구한다.
			totalCancelPcs = obj.getSum("CANCELPCSQTY");
			totalCancelPnl = obj.getSum("CANCELPNLQTY");

			this.div_lotInfo.msk_pcs.set_value(totalCancelPcs);// 취소할 총 불량 PCS
			this.div_lotInfo.msk_pnl.set_value(totalCancelPnl); // 취소할 총 불량 PNL
			return false;
		}
        
		var defectPcsQty = obj.getColumn(e.row, "DEFECTPCSQTY");

		if (panelPerQty * cancelPnl > nexacro.toNumber(defectPcsQty))
		{
			obj.setColumn(e.row, nexacro.toNumber(defectPcsQty));
		}
		else
		{
			cancelPcs = cancelPnl * panelPerQty; // 취소 PCS 수량(개별)
			obj.setColumn(e.row, "CANCELPCSQTY", cancelPcs);
		}

		// 모든 Row에 대한 취소 PCS수량과 PNL수량의 합을 구한다.
		totalCancelPcs = obj.getSum("CANCELPCSQTY");
		totalCancelPnl = obj.getSum("CANCELPNLQTY");
		
		this.div_lotInfo.msk_pcs.set_value(totalCancelPcs);// 취소할 총 불량 PCS
		this.div_lotInfo.msk_pnl.set_value(totalCancelPnl); // 취소할 총 불량 PNL
	} //if e.columnid
	
	if (e.columnid == "CANCELPCSQTY" || e.columnid == "CANCELPNLQTY")
	{
		var lotId = obj.getColumn(e.row, "LOTID");
		var pcsCnt = this.div_lotInfo.msk_pcs.value;		

		// 해당 Lot 완불처리 Check		
		if (this.fn_searchIsAllQtyDefectLot(lotId, pcsCnt) == "Y")
		{
			// 완불처리된 Lot의 전량취소이므로 원래 Lot에 원복처리됩니다.
			this.gfn_Message("AllDefectLotAllCancelisOriginalLotRestore", "", "warning", "ok");
            this.ds_routingList.set_enableevent(false);
			this.ds_routingList.setColumn(0, "MERGECHECK", 1);
			this.ds_routingList.setColumn(0, "CANCELCODE", "Retest");
			this.ds_routingList.setColumn(0, "INPUTPROCESSDEFID", "");
			this.ds_routingList.setColumn(0, "INPUTPROCESSDEFVERSION", "");
			this.ds_routingList.setColumn(0, "INPUTPROCESSDEFNAME", "");
			this.ds_routingList.setColumn(0, "INPUTPROCESSPATHID", "");
			this.ds_routingList.setColumn(0, "INPUTUSERSEQUENCE", "");
			this.ds_routingList.setColumn(0, "INPUTSEGMENTID", "");
			this.ds_routingList.setColumn(0, "INPUTSEGMENTVERSION", "");
			this.ds_routingList.setColumn(0, "INPUTSEGMENTNAME", "");
			this.ds_routingList.setColumn(0, "INPUTAREAID", "");
			this.ds_routingList.setColumn(0, "INPUTRESOURCEID", "");
			this.ds_routingList.setColumn(0, "INPUTRESOURCENAME", "");
			this.ds_routingList.setColumn(0, "RETURNPROCESSDEFID", "");
			this.ds_routingList.setColumn(0, "RETURNPROCESSDEFVERSION", "");
			this.ds_routingList.setColumn(0, "RETURNPROCESSPATHID", "");
			this.ds_routingList.setColumn(0, "RETURNUSERSEQUENCE", "");
			this.ds_routingList.setColumn(0, "RETURNSEGMENTID", "");
			this.ds_routingList.setColumn(0, "RETURNSEGMENTVERSION", "");
			this.ds_routingList.setColumn(0, "RETURNSEGMENTNAME", "");
			this.ds_routingList.setColumn(0, "RETURNAREAID", "");
			this.ds_routingList.setColumn(0, "RETURNRESOURCEID", "");
			this.ds_routingList.setColumn(0, "RETURNRESOURCENAME", "");
			this.ds_routingList.set_enableevent(true);
			this.ds_reworkLotDefectList.clearData();
		}
		else
		{
			this.ds_routingList.set_enableevent(false);
			this.ds_routingList.setColumn(0, "MERGECHECK", 0);
			this.ds_routingList.set_enableevent(true);
		}
	} //if (e.columnid == "CANCELPCSQTY" || e.columnid == "CANCELPNLQTY")
	
	obj.set_enableevent(true);
};


/*
 * 기능 : 취소사유가 양품인계인 경우는 Lot의 공정진행상태가 작업완료일때만 가능하다.
 */
this.ds_routingList_cancolumnchange = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if (e.columnid == "MERGECHECK")
	{
		//Original Lot Merge가 가능이면 활성화 불가능이면 비활성화
		if (obj.getColumn(e.row, "ISORIGINALLOTMERGECODE") == "N") return false;
	}	
    else if (e.columnid != "MERGECHECK" && obj.getColumn(e.row, "MERGECHECK") ==  1)
	{
	    // Original Lot Merge를 할 경우 Row 비활성화
		this.gfn_Message("OriginalLotMergeNotSelect", "", "warning", "ok");
		return false;
	}
	else if (e.columnid == "CANCELCODE")
	{
		//취소사유가 불량취소시 라우팅정보 초기화하지 않음
		if (e.newvalue != "Retest")
		{
			obj.set_enableevent(false);
			obj.setColumn(0, "INPUTPROCESSDEFNAME", "");
			obj.setColumn(0, "INPUTUSERSEQUENCE", "");
			obj.setColumn(0, "INPUTSEGMENTNAME", "");
			obj.setColumn(0, "INPUTRESOURCENAME", "");
			obj.setColumn(0, "RETURNUSERSEQUENCE", "");
			obj.setColumn(0, "RETURNSEGMENTNAME", "");
			obj.setColumn(0, "RETURNRESOURCENAME", "");	
			obj.set_enableevent(true);
		}
		
		//취소사유가 양품인계인 경우는 Lot의 공정진행상태가 작업완료일때만 가능하다.
		if (e.newvalue == "TakeoverGoods") //양품인계
		{
		    var processState = obj.getColumn(0, "PROCESSSTATE");

            if (processState != "WaitForSend") //인수대기
			{
				this.gfn_Message("ProcessstateIsWaitForSendPossibleTakeoverGoods", null, "warning", "ok"); //LOT의 공정진행상태가 작업완료일때만 양품인계가 가능합니다.
				return false;
			}
			//불량난 해당 공정이 마지막 공정이라면 양품인계가 불가능하다.
			else
			{		
				if (!this.fn_searchProductRouting(this.ds_routingList, "C"))
				{
					obj.set_enableevent(false);
					obj.setColumn(e.row, "CANCELCODE", "");
					obj.set_enableevent(true);
					return false;
				}
			}
		} // if e.newvalue	
	}
    else if (e.columnid == "INPUTPROCESSDEFNAME")
	{
		//라우팅명 초기화시 관련정보 초기화
		if (this.nfn_isNull(e.newvalue))
		{
			obj.set_enableevent(false);
			obj.setColumn(e.row, "INPUTUSERSEQUENCE", "");
			obj.setColumn(e.row, "INPUTSEGMENTNAME", "");
			obj.setColumn(e.row, "INPUTRESOURCENAME", "");
			obj.setColumn(e.row, "RETURNUSERSEQUENCE", "");
			obj.setColumn(e.row, "RETURNSEGMENTNAME", "");
			obj.setColumn(e.row, "RETURNAREAID", "");
			obj.setColumn(e.row, "RETURNRESOURCENAME", "");
			obj.set_enableevent(true);
		}		
	} //if e.columnid
	
	return true;
};

/*
 * 기능 : 체크된 불량코드를 가져와 LOT, PCS, PNL 수량을 계산한다.
 */
this.fn_setCalcCount = function ()
{
	if (this.ds_lotDefectCountList.rowcount == 0)
	{
		//div_lotInfo 데이터 초기화
		this.fn_setInitialDivLotInfo();
	}
	else
	{
		var pcsCnt = this.ds_lotDefectCountList.getSum("CANCELPCSQTY");
		var pnlCnt = this.ds_lotDefectCountList.getSum("CANCELPNLQTY");
		var itemId = this.ds_lotDefectCountList.getColumn(0, "PRODUCTDEFID");
		var itemNm = this.ds_lotDefectCountList.getColumn(0, "PRODUCTDEFNAME");
		var lotId  = this.ds_lotDefectCountList.getColumn(0, "PARENTLOTID");
		var defectLotId = this.ds_lotDefectCountList.getColumn(0, "LOTID");
		
		this.div_lotInfo.edt_itemId.set_value(itemId);
		this.div_lotInfo.edt_itemName.set_value(itemNm);		
		this.div_lotInfo.edt_lotId.set_value(lotId);
		this.div_lotInfo.edt_defectLotId.set_value(defectLotId);
		this.div_lotInfo.msk_pcs.set_value(pcsCnt);
		this.div_lotInfo.msk_pnl.set_value(pnlCnt);
	}
};

/*
 *
 */
this.fn_setInitialControl = function ()
{
	this.ds_lotDefectCountList.clearData();
	this.ds_routingList.clearData();
	
	//div_lotInfo 데이터 초기화
	this.fn_setInitialDivLotInfo();	
};

/*
 * 기능 : div_lotInfo 데이터 초기화
 */
this.fn_setInitialDivLotInfo = function ()
{
	this.div_lotInfo.edt_lotId.set_value("");
	this.div_lotInfo.edt_itemId.set_value("");
	this.div_lotInfo.edt_itemName.set_value("");
	this.div_lotInfo.edt_defectLotId.set_value("");
	this.div_lotInfo.msk_pcs.set_value("");
	this.div_lotInfo.msk_pnl.set_value("");
};

/**************************************************************************
 * 8. 이벤트
 ***************************************************************************/
/*
 * 이벤트 : 조회조건 아이콘 버튼 클릭시
 */
this.fn_popup_click = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if (obj.name == "btn_area")
	{
		this.fn_openPop("SRCH_AREA228","P00228"); //작업장
	}
	else if (obj.name == "btn_productDef")
	{
		this.fn_openPop("SRCH_PRODUCTDEF218","P00218"); //품목
	}
};

/*
 * 이벤트 : 조회조건 이름 삭제시 id 초기화
 */
this.fn_popup_canchange = function(obj:nexacro.Edit,e:nexacro.ChangeEventInfo)
{
	if (obj.name == "edt_area")
	{
		this.nfn_isNull(e.postvalue) == false ? "": this.tab_search.Tab1.form.edt_area_id.set_value("");
	}
	else if (obj.name == "edt_productDef")
	{
		this.nfn_isNull(e.postvalue) == false ? "": this.tab_search.Tab1.form.edt_productDef_id.set_value("");
	}
};

/*
 * 이벤트 : 조회조건- 조회기간 타입 변경시
 */
this.tab_search_Tab1_cbo_period_canitemchange = function(obj:nexacro.Combo,e:nexacro.ItemChangeEventInfo)
{
	this.fn_setSearchDate(e.postvalue);
};

/*
 * 이벤트 : 
 */
this.btn_suttleDown_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var sourceCnt = this.ds_lotDefectList.getCaseCount("CHK == '1'");	
	if (sourceCnt == 0) return false;
	
	if (this.ds_routingList.rowcount > 0)
	{		
		var sourceRow         = this.ds_lotDefectList.findRow("CHK", "1");
		var sourceLotId       = this.ds_lotDefectList.getColumn(sourceRow, "LOTID");	
		var sourceParentLotId = this.ds_lotDefectList.getColumn(sourceRow, "PARENTLOTID");
		var targetLotId       = this.ds_lotDefectCountList.getColumn(0, "LOTID");
		var sourceProduct     = this.ds_lotDefectList.getColumnInfo(sourceRow, "PRODUCTDEFID") + this.ds_lotDefectList.getColumnInfo(sourceRow, "PRODUCTDEFVERSION");
		var targetProduct     = this.ds_lotDefectCountList.getColumnInfo(0, "PRODUCTDEFID") + this.ds_lotDefectCountList.getColumnInfo(0, "PRODUCTDEFVERSION");
		
		if (sourceLotId != targetLotId)
		{
			this.ds_lotDefectList.setColumn(this.ds_lotDefectList.rowposition, "CHK", 0);
			this.gfn_Message("MixSelectLotID", "", "warning", "ok"); // 다른 Lot ID는 선택할 수 없습니다.
			return false;
		}
		
		if (sourceProduct != targetProduct)
		{
			this.ds_lotDefectList.setColumn(this.ds_lotDefectList.rowposition, "CHK", 0);
			this.gfn_Message("MixSelectProduct", "", "warning", "ok"); // 다른 품목은 선택할 수 없습니다.
			return false;
		}
	} //if this.ds_routingList
	
	for(var i=this.ds_lotDefectList.rowcount-1 ; i>= 0 ; i--)
	{
		if(this.ds_lotDefectList.getColumn(i,"CHK") == "1")
		{
			var nRow = this.ds_lotDefectCountList.addRow();				
			this.ds_lotDefectCountList.copyRow(nRow, this.ds_lotDefectList, i);	
			this.ds_lotDefectCountList.setColumn(nRow, "CHK", 0);
			if (this.ds_routingList.rowcount == 0)
			{
				var routingRow = this.ds_routingList.addRow();
				this.ds_routingList.copyRow(routingRow, this.ds_lotDefectList, i);
				this.ds_routingList.setColumn(routingRow, "CHK", 0);

				if (this.ds_lotDefectList.getColumn(i, "ISORIGINALLOTMERGECODE") == "Y")
				{
					this.ds_routingList.setColumn(routingRow, "ISORIGINALLOTMERGE",  this.nfn_getDictionarynameUpper("POSSIBLE")); // 가능
				}
				else
				{
				    this.ds_routingList.setColumn(routingRow, "ISORIGINALLOTMERGE",  this.nfn_getDictionarynameUpper("IMPOSSIBLE")); // 불가능
				}

			}
			this.ds_lotDefectList.deleteRow(i);
		} //if CHK
	}//for

	//체크된 불량코드를 가져와 LOT, PCS, PNL 수량을 계산한다.
	this.fn_setCalcCount();    
};

/*
 * 이벤트 : 
 */
this.btn_suttleUp_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	for(var i=this.ds_lotDefectCountList.rowcount-1 ; i>= 0 ; i--)	
	{
		if(this.ds_lotDefectCountList.getColumn(i,"CHK")== "1")
		{
			var nRow = this.ds_lotDefectList.addRow();
			this.ds_lotDefectList.copyRow(nRow, this.ds_lotDefectCountList, i);
			this.ds_lotDefectList.setColumn(nRow, "CHK", "0");
			this.ds_lotDefectCountList.deleteRow(i);
		}
	}
	
	if (this.ds_lotDefectCountList.rowcount == 0)
	{
		if (this.ds_routingList.rowcount == 0) return;
		
		this.ds_routingList.deleteRow(0);
	}
	
	//체크된 불량코드를 가져와 LOT, PCS, PNL 수량을 계산한다.
	this.fn_setCalcCount(); 
};

/*
 * 이벤트 : 내역조회 Row 더블클릭시 어떤 라우팅을 태웠는지 확인할 수 있는 팝업
 */
this.fn_gridOncelldblclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	var objDataset = obj.getBindDataset();
    var popupId = "REWORKROUTING";
   	var oArg = {};
	    oArg.cancelReason             = objDataset.getColumn(e.row, "CANCELREASON");
        oArg.repairLotNo              = objDataset.getColumn(e.row, "REPAIRLOTNO");
        oArg.cancelRoutingType        = objDataset.getColumn(e.row, "CANCELROUTINGTYPE");
        oArg.resourceName             = objDataset.getColumn(e.row, "RESOURCENAME");
        oArg.returnResourceName       = objDataset.getColumn(e.row, "RETURNRESOURCENAME");
        oArg.inputSegmentId           = objDataset.getColumn(e.row, "INPUTSEGMENTID");
        oArg.inputUserSequence        = objDataset.getColumn(e.row, "INPUTUSERSEQUENCE");
        oArg.returnProcessSgementId   = objDataset.getColumn(e.row, "RETURNPROCESSSEGMENTID");
		oArg.returnUserSequence       = objDataset.getColumn(e.row, "RETURNUSERSEQUENCE");
		oArg.lotId                    = objDataset.getColumn(e.row, "LOTID");
        oArg.txnHistKey               = objDataset.getColumn(e.row, "TXNHISTKEY");
		oArg.requestNo                = objDataset.getColumn(e.row, "REQUESTNO");		

	this.gfn_openPopup(popupId,"qam::QAM01900P2.xfdl",oArg,"width=1000,height=581");
};

/*
 * 이벤트 : Cell 에 표시된 확장버튼에서 눌렸던 마우스 왼쪽버튼을 떼었을 때 발생하는 이벤트입니다.
 */
this.fn_grid_onexpandup = function(obj:nexacro.Grid,e:nexacro.GridMouseEventInfo)
{
    //라우팅	
	if (e.cell == obj.getBindCellIndex("body", "INPUTPROCESSDEFNAME"))
	{	
		var objDataset = obj.getBindDataset();
		
		// 취소사유가 선택되지 않았다면 라우팅 선택팝업 비활성화
		if (this.nfn_isNull(objDataset.getColumn(e.row, "CANCELCODE")))
		{
			this.gfn_Message("CancelReasonSelectAfterRouting", "", "warning", "ok");
			return false;			
		}	
		var popupId = "ROUTINGNAME";
        var oArg = {};
	    oArg.parentLotId             = objDataset.getColumn(e.row, "PARENTLOTID");
		oArg.lotId                   = objDataset.getColumn(e.row, "LOTID");
        oArg.cancelCode              = objDataset.getColumn(e.row, "CANCELCODE");
        oArg.parentProcessDefId      = objDataset.getColumn(e.row, "PARENTPROCESSDEFID");
        oArg.parentProcessDefVersion = objDataset.getColumn(e.row, "PARENTPROCESSDEFVERSION");
        oArg.processSegmentId        = objDataset.getColumn(e.row, "PROCESSSEGMENTID");
        oArg.productDefId            = objDataset.getColumn(e.row, "PRODUCTDEFID");
        oArg.productDefVersion       = objDataset.getColumn(e.row, "PRODUCTDEFVERSION");
        oArg.areaId                  = objDataset.getColumn(e.row, "AREAID");
		this.gfn_openPopup(popupId,"qam::QAM01900P1.xfdl",oArg,"width=1000,height=550");
	}
	else if (e.cell == 4)
	{
		this.ds_routingList.setColumn(e.row, "INPUTPROCESSDEFNAME", "");
	}
};]]></Script>
  </Form>
</FDL>
