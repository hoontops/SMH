<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="QAM00300P1" width="992" height="626" titletext="검사원 등록/수정" onload="fn_init">
    <Layouts>
      <Layout height="626" width="992">
        <Static id="Static02" taborder="0" text="h20" width="50" top="0" visible="false" height="20" left="66" cssclass="guideTip"/>
        <Static id="Static02_01_00" taborder="1" text="w&#13;&#10;20" width="20" top="82" visible="false" height="84" left="0" cssclass="guideTip"/>
        <Static id="Static02_01_00_00" taborder="2" text="w&#13;&#10;20" width="20" top="100" visible="false" height="84" cssclass="guideTip" right="0"/>
        <Static id="Static02_00" taborder="3" text="h20" width="50" visible="false" height="20" cssclass="guideTip" bottom="0" right="97"/>
        <Static id="Static02_02" taborder="4" text="h10" width="700" visible="false" height="10" cssclass="guideTip" right="0" bottom="48"/>
        <Div id="div_basicInfo" taborder="5" left="20" top="20" height="187" cssclass="div_WF_detail_line" text="" right="20">
          <Layouts>
            <Layout>
              <Static id="sta_site" taborder="1" text="Site" left="0" top="0" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english"/>
              <Combo id="cbo_site" taborder="0" left="145" top="5" width="160" height="20" enable="false" codecolumn="C,SiteType,,Y,N"/>
              <Static id="sta_area" taborder="2" text="작업장" left="0" top="31" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="WORKAREA"/>
              <Static id="sta_inspectionclassid" taborder="3" text="자격구분" left="0" top="62" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="CAPACITYTYPE"/>
              <Static id="sta_prevcareer" taborder="4" text="이전경력" left="0" top="93" width="140" height="31" cssclass="sta_WF_detailLabel" wordWrap="english" tooltiptext="PREVCAREER"/>
              <Static id="sta_score" taborder="5" text="점수" left="0" top="124" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="SCORE"/>
              <Static id="sta_evaluationtype" taborder="6" text="평가구분" left="0" top="155" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="EVALUATIONTYPE"/>
              <Static id="sta_inspector" taborder="7" text="검사자명" left="310" top="0" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="INSPECTORNAME"/>
              <Static id="sta_certdate" taborder="8" text="인증 평가일" left="310" top="31" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="CERTDATE"/>
              <Static id="sta_enterdate" taborder="9" text="입사일자" left="310" top="62" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="ENTERDATE"/>
              <Static id="sta_career" taborder="10" text="자회사경력" left="310" top="93" width="140" height="31" cssclass="sta_WF_detailLabel" wordWrap="english" tooltiptext="COMPANYCAREER"/>
              <Static id="sta_grade" taborder="11" text="등급" left="310" top="124" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="GRADE"/>
              <Static id="sta_inspectorno" taborder="12" text="검사원번호" left="310" top="155" width="140" height="31" cssclass="sta_WF_detailLabel" wordWrap="english" tooltiptext="INSPECTORNUMBER"/>
              <Static id="sta_empno" taborder="13" text="사원번호" left="640" top="0" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="EMPLOYEENUMBER"/>
              <Static id="sta_nextcertdate" taborder="14" text="차기 인증평가일" left="640" top="31" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="NEXTCERTDATE"/>
              <Static id="sta_retiredate" taborder="15" text="퇴사일자" left="640" top="62" width="140" height="31" cssclass="sta_WF_detailLabel" wordWrap="english" tooltiptext="RETIREDATE"/>
              <Static id="sta_totalcareer" taborder="16" text="총경력" left="640" top="93" width="140" height="31" cssclass="sta_WF_detailLabel" wordWrap="english" tooltiptext="TOTALCAREER"/>
              <Static id="sta_iscertfinish" taborder="17" text="인증평가 완료여부" left="640" top="124" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="ISCERTFINISH"/>
              <Static id="sta_validstate" taborder="18" text="유효상태" left="640" top="155" width="140" height="31" cssclass="sta_WF_detailLabel_P" wordWrap="english" tooltiptext="VALIDSTATE"/>
              <Edit id="edt_inspector_id" taborder="19" left="785" top="5" width="160" height="20" readonly="true" enable="false"/>
              <Edit id="edt_areaname" taborder="20" left="145" top="36" width="160" height="20" readonly="true" enable="false"/>
              <Combo id="cmb_inspectionclassid" taborder="21" left="145" top="67" width="160" height="20"/>
              <Spin id="spn_prevcareeryear" taborder="22" left="145" top="98" width="50" height="20"/>
              <Static id="unit01" taborder="23" text="년" left="195" top="98" width="20" height="20" cssclass="sta_WF_unit" fittocontents="width" tooltiptext="YEAR"/>
              <Spin id="spn_prevcareermonth" taborder="24" left="215" top="98" width="50" height="20" max="12" min="0" value=""/>
              <Static id="unit02" taborder="25" text="개월" left="265" top="98" width="32" height="20" cssclass="sta_WF_unit" fittocontents="width" tooltiptext="MONTH"/>
              <MaskEdit id="edt_score" taborder="26" left="145" top="129" width="160" height="20" format="#0.0"/>
              <Combo id="cbo_evaluationtype" taborder="27" left="145" top="160" width="160" height="20" codecolumn="C,EvaluationType,,Y,Y"/>
              <Edit id="edt_inspector" taborder="28" left="455" top="5" height="20" width="158" onkeydown="qamfn_callOpenPopEditEvent"/>
              <Button id="btn_inspector" taborder="29" width="22" height="20" cssclass="btn_WF_finder" top="5" left="edt_inspector:0" onclick="qamfn_callOpenPopButtonEvent"/>
              <Calendar id="cal_certdate" taborder="30" left="455" top="36" width="180" height="20" dateformat="yyyy-MM-dd"/>
              <Calendar id="cal_enterdate" taborder="31" left="455" top="67" width="180" height="20" dateformat="yyyy-MM-dd"/>
              <Edit id="edt_career" taborder="32" left="455" top="98" width="180" height="20" readonly="true" enable="false"/>
              <Edit id="edt_grade" taborder="33" left="455" top="129" width="180" height="20" readonly="true" enable="false"/>
              <Edit id="edt_inspectorno" taborder="34" left="455" top="160" width="180" height="20" enable="false"/>
              <Calendar id="cal_nextcertdate" taborder="35" left="785" top="36" width="160" height="20" dateformat="yyyy-MM-dd"/>
              <Calendar id="cal_retiredate" taborder="36" left="785" top="67" width="160" height="20" dateformat="yyyy-MM-dd"/>
              <Edit id="edt_totalcareer" taborder="37" left="785" top="98" width="160" height="20" readonly="true" enable="false"/>
              <Combo id="cbo_iscertfinish" taborder="38" left="785" top="129" width="160" height="20" value="" index="-1" codecolumn="C,YesNo,,Y,Y"/>
              <Combo id="cbo_validstate" taborder="39" left="785" top="160" width="160" height="20" value="" index="-1" codecolumn="C,ValidState,,Y,Y"/>
              <Edit id="edt_area_id" taborder="40" left="10" top="39" height="20" text="작업장ID (HIDDEN)" value="작업장ID (HIDDEN)" width="59" visible="false"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="sta_subTitle" taborder="6" text="인증평가 이력" left="20" top="207" height="34" cssclass="sta_WF_subTitle" fittocontents="width" width="99" tooltiptext="CERTIFICATIONHISTORY"/>
        <Grid id="grd_qamQcinspectorhistory" taborder="7" left="20" top="241" height="327" autoenter="select" right="20" binddataset="ds_qamQcinspectorhistory">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="40"/>
                <Column size="150"/>
                <Column size="200"/>
                <Column size="120"/>
                <Column size="80"/>
                <Column size="120"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="No"/>
                <Cell col="1" text="변경일시" tooltiptext="CHANGEDATE"/>
                <Cell col="2" text="자격구분" tooltiptext="CAPACITYTYPE"/>
                <Cell col="3" text="인증평가일" tooltiptext="CERTDATE"/>
                <Cell col="4" text="점수" tooltiptext="SCORE"/>
                <Cell col="5" text="인증평가완료여부" tooltiptext="ISCERTFINISH"/>
              </Band>
              <Band id="body">
                <Cell text="expr:currow+1"/>
                <Cell col="1" text="bind:TXNTIME"/>
                <Cell col="2" text="bind:INSPECTIONCLASSNAME"/>
                <Cell col="3" text="bind:CERTDATE"/>
                <Cell col="4" text="bind:SCORE" maskeditformat="#0.0" displaytype="mask"/>
                <Cell col="5" text="bind:ISCERTFINISH"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btnSave" taborder="8" text="저장" width="70" height="28" cssclass="btn_pop_yes" bottom="20" tooltiptext="SAVE" onclick="fn_save" right="95"/>
        <Button id="btn_close" taborder="9" text="닫기" width="70" height="28" cssclass="btn_pop_no" right="20" bottom="20" onclick="btn_close_onclick" tooltiptext="CLOSE"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_qamQcinspector" oncolumnchanged="ds_qamQcinspector_oncolumnchanged">
        <ColumnInfo>
          <Column id="INSPECTORID" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="INSPECTORNAME" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="INSPECTIONCLASSID" type="STRING" size="256"/>
          <Column id="CERTDATE" type="STRING" size="256"/>
          <Column id="NEXTCERTDATE" type="STRING" size="256"/>
          <Column id="ENTERDATE" type="STRING" size="256"/>
          <Column id="RETIREDATE" type="STRING" size="256"/>
          <Column id="PREVCAREERYEAR" type="INT" size="256"/>
          <Column id="PREVCAREERMONTH" type="STRING" size="256"/>
          <Column id="SCORE" type="BIGDECIMAL" size="256"/>
          <Column id="GRADE" type="STRING" size="256"/>
          <Column id="ISCERTFINISH" type="STRING" size="256"/>
          <Column id="EVALUATIONTYPE" type="STRING" size="256"/>
          <Column id="INSPECTORNO" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="CREATOR" type="STRING" size="256"/>
          <Column id="CREATEDTIME" type="STRING" size="256"/>
          <Column id="MODIFIER" type="STRING" size="256"/>
          <Column id="MODIFIEDTIME" type="STRING" size="256"/>
          <Column id="LASTTXNHISTKEY" type="STRING" size="256"/>
          <Column id="LASTTXNID" type="STRING" size="256"/>
          <Column id="LASTTXNUSER" type="STRING" size="256"/>
          <Column id="LASTTXNTIME" type="STRING" size="256"/>
          <Column id="LASTTXNCOMMENT" type="STRING" size="256"/>
          <Column id="VALIDSTATE" type="STRING" size="256"/>
          <Column id="AREANAME" type="STRING" size="256"/>
          <Column id="COMPANYCAREER" type="STRING" size="256"/>
          <Column id="CAREER" type="STRING" size="256"/>
          <Column id="PLANTCODEID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_qamQcinspectorhistory" useclientlayout="true">
        <ColumnInfo>
          <Column id="INSPECTORID" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="EMPNO" type="STRING" size="256"/>
          <Column id="INSPECTORNAME" type="STRING" size="256"/>
          <Column id="AREAID" type="STRING" size="256"/>
          <Column id="INSPECTIONCLASSID" type="STRING" size="256"/>
          <Column id="CERTDATE" type="STRING" size="256"/>
          <Column id="NEXTCERTDATE" type="STRING" size="256"/>
          <Column id="ENTERDATE" type="STRING" size="256"/>
          <Column id="RETIREDATE" type="STRING" size="256"/>
          <Column id="PREVCAREERYEAR" type="STRING" size="256"/>
          <Column id="PREVCAREERMONTH" type="STRING" size="256"/>
          <Column id="SCORE" type="BIGDECIMAL" size="256"/>
          <Column id="GRADE" type="STRING" size="256"/>
          <Column id="ISCERTFINISH" type="STRING" size="256"/>
          <Column id="EVALUATIONTYPE" type="STRING" size="256"/>
          <Column id="INSPECTORNO" type="STRING" size="256"/>
          <Column id="DESCRIPTION" type="STRING" size="256"/>
          <Column id="CREATOR" type="STRING" size="256"/>
          <Column id="CREATEDTIME" type="STRING" size="256"/>
          <Column id="MODIFIER" type="STRING" size="256"/>
          <Column id="MODIFIEDTIME" type="STRING" size="256"/>
          <Column id="LASTTXNHISTKEY" type="STRING" size="256"/>
          <Column id="LASTTXNID" type="STRING" size="256"/>
          <Column id="LASTTXNUSER" type="STRING" size="256"/>
          <Column id="LASTTXNTIME" type="STRING" size="256"/>
          <Column id="LASTTXNCOMMENT" type="STRING" size="256"/>
          <Column id="VALIDSTATE" type="STRING" size="256"/>
          <Column id="TXNTIME" type="STRING" size="256"/>
          <Column id="INSPECTIONCLASSNAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_search">
        <ColumnInfo>
          <Column id="PLANTID" type="STRING" size="256"/>
          <Column id="INSPECTIONCLASSID" type="STRING" size="256"/>
          <Column id="INSPECTORID" type="STRING" size="256"/>
          <Column id="ENTERPRISEID" type="STRING" size="256"/>
          <Column id="SCORE" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_output" useclientlayout="true">
        <ColumnInfo>
          <Column id="GRADE" type="STRING" size="256"/>
          <Column id="INSPECTORID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.1"><![CDATA[/***************************************************************************************
 * 시스템명 	: IFC MES시스템
 * 업무명 		: 검사원 등록.수정
 * 파일명 		: QAM00300P1.xfdl
 * 작성자 		: 권혜영
 * 작성일 		: 2021.04.26
 *
 * 설  명		: 품질관리 > 검사원/AUDIT > 검사원관리 > 검사원 등록/수정
 *---------------------------------------------------------------------------------------
 * 변경일		변경자		변경내역
 *---------------------------------------------------------------------------------------
 * 2021.04.26	권혜영   	최초작성
 *---------------------------------------------------------------------------------------
 ****************************************************************************************/

/**************************************************************************
 * 1. 필수 include
 ***************************************************************************/
include "lib::lib_bas.xjs";	//기준관리 공통 라이브러리 include
include "lib::lib_qam.xjs";	//품질관리 공통 라이브러리 include
/**************************************************************************
 * 2. FORM 변수 선언 영역
 ***************************************************************************/
this.qamSearchComp = this.div_basicInfo.form;
this.fv_isNew = true;
this.fv_existEmpno = false;
/**************************************************************************
 * 3. FORM LOAD
 ***************************************************************************/
this.fn_init = function (obj:Form, e:nexacro.LoadEventInfo)
{
	this.nfn_formInit(obj);
	this.fn_initCombo();
	this.fn_formInit();
};

/**************************************************************************
 * 4. 공통버튼영역 (함수 삭제금지!!!!)
 ***************************************************************************/
/*
 * 기능 : 검색
 */
this.fn_search = function (obj:Button, e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 검색 초기화
 */
this.fn_searchClear = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
};

/*
 * 기능 : 신규
 */
this.fn_add = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{	
};

/*
 * 기능 : 저장
 */
this.fn_save = function (obj:Button, e:nexacro.ClickEventInfo)
{
	if (!this.gfn_dsIsUpdated(this.ds_qamQcinspector) ) 
	{
		this.gfn_Message("NoSaveData", null, "warning", "ok");//this.gfn_Message("IMCMM0033", null, "warning", "ok");
		return;
	}
	
	var objDs = this.ds_qamQcinspector, strColumn = "INSPECTORNAME|EMPNO|AREANAME|CERTDATE|NEXTCERTDATE|INSPECTIONCLASSID:CAPACITYTYPE|ENTERDATE|SCORE|GRADE|ISCERTFINISH|EVALUATIONTYPE|VALIDSTATE";
	var validation = this.qamfn_checkEmptyField(objDs, strColumn);
	if(!validation.rtn) {
		
		this.qamfn_setEditFocus(this.div_basicInfo, objDs, validation.column);
		this.gfn_Message("NoSelectedMsg", validation.msgTxt, "warning", "ok"); //선택된 {0}(이)가 없습니다. 먼저 선택하세요.
		return;
	}
	
	validation = this.fn_checkValidation();
	if(!validation.rtn) {
		this.gfn_Message(validation.msg, null, "warning", "ok");
		return;
	}
// 	if(this.fv_isNew) {
// 		this.fn_searchExistInspector();
// 		if(!this.fv_existEmpno) {
// 			return;
// 		}
// 	}
	
	// -------------------------
	// 저장
	// ':U' 는 갱신된 내용만을 입력 데이터세트로 보내며, ':A' 는 모든 정보를 보냅니다.
	// ':N' 은 현재 Delete를 제외한 데이터를 Normal 상태로 보냅니다. 지정하지 않는 데이터세트는 Normal로 동작합니다
	// -------------------------
	var sSvcID 			= "saveQamQcinspector";
	var sController 	= "/qam00300/saveQamQcinspector.do";
	var sInDatasets 	= "INPUT=ds_qamQcinspector:U";
	var sOutDatasets 	= "";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

/*
 * 기능 : 삭제
 */
this.fn_delete = function (obj:Button, e:nexacro.ClickEventInfo)
{
};

/**************************************************************************
 * 5. TRANSACTION, CALLBACK 영역
 ***************************************************************************/
this.fn_callBack = function (trId, errCD, errMsg)
{
	if (errCD < 0) 
	{
		this.gfn_Message("ProcessingError", trId + errMsg, "error", "ok");		
	}
	else 
	{
		if (trId == "saveQamQcinspector") 
		{
			this.gfn_Message("SuccessSave", null, "info", "ok");
			this.opener.fn_search();
			this.close();
		} else if (trId == "selectQamQcinspectorList") 
		{ 
			this.qamfn_calCareer(this.ds_qamQcinspector);
 		} else if (trId == "selectCapacityTypeList") 
		{
		
		} else if (trId == "selectInspectionScore") 
		{
			var grade = "None";
			if(this.ds_output.rowcount > 0) {
				grade = this.ds_output.getColumn(0, "GRADE") || grade;
			}
			this.ds_qamQcinspector.setColumn(0, "GRADE", grade);
			
		} else if (trId == "selectExistInspector") 
		{
			if(this.ds_output.rowcount > 0) {
				this.gfn_Message("ExistInspector", null, "info", "ok");
				this.fv_existEmpno = false;
			}
		}
	}
};


/**************************************************************************
 * 6. 팝업 호출/콜백
 **************************************************************************/
this.fn_openPopup = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var oArg = {};
	this.gfn_openPopup("SEARCH_INSPECTOR","qam::QAM00300P1.xfdl",oArg,"");
};

/**************************************************************************
 * 7. 기타 함수(화면 로컬 정의) 
 **************************************************************************/
/*
 * 최초 호출되는 초기화 함수
 */
this.fn_formInit = function ()
{ 
	this.ds_CSiteType.filter("LOOKUP_CODE == '"+this.gf_getSiteType()+"'");

	if(!this.nfn_isNull(this.parent.ds_qamQcinspector) && !this.nfn_isNull(this.parent.nRow)) {
		this.fv_isNew = false;
		this.ds_qamQcinspector.set_updatecontrol(false);
		this.ds_qamQcinspector.clearData();
		this.ds_qamQcinspector.addRow();
		this.ds_qamQcinspector.copyRow(0, this.parent.ds_qamQcinspector, this.parent.nRow);
		
		this.qamfn_calCareer(this.ds_qamQcinspector);
		this.ds_qamQcinspector.set_updatecontrol(true);
		
		this.fn_searchHistory();
	} else {
		var dsObj = this.ds_qamQcinspector;
		var row = dsObj.addRow();
		
		dsObj.setColumn(row,"ENTERPRISEID", this.gf_getEnterpriseId());//ENTERPRISEID	
		dsObj.setColumn(row,"PLANTID", this.gf_getSiteType());//PLANTID
		dsObj.setColumn(row,"PLANTCODEID", this.ds_CSiteType.getColumn(this.ds_CSiteType.rowposition, "ATTRIBUTE2"));//PLANTCODEID
		
		dsObj.setColumn(row,"VALIDSTATE", "Valid");			//유효여부
		dsObj.setColumn(row,"ISCERTFINISH", "Y");			//인증평가 완료여부
		
		this.div_basicInfo.form.edt_inspectorno.set_enable(true);
		
		this.fn_setNextCertDate();
	}
};

/*
 * 검색 콤보 조회
 */
this.fn_initCombo = function ()
{
	this.qamfn_setCustomQueryCmb(this.div_basicInfo.form.cmb_inspectionclassid // Object
								, "selectGetCapacityTypeList,SEL,Y,A" // OPTION
								, ""
								, "fn_callBack");	  // 추가 파라미터
};

/*
 * 기능 : 검색
 */
this.fn_searchHistory = function (obj:Button, e:nexacro.ClickEventInfo)
{
	this.ds_qamQcinspectorhistory.clearData();
	this.ds_search.clearData();
	this.ds_search.addRow();
	this.ds_search.setColumn(0, "INSPECTORID", this.ds_qamQcinspector.getColumn(0, "INSPECTORID"));

	var sSvcID 			= "selectQamQcinspectorhistoryList";
	var sController 	= "/qam00300/selectQamQcinspectorhistoryList.do";
	var sInDatasets 	= "INPUT=ds_search";
	var sOutDatasets 	= "ds_qamQcinspectorhistory=output";
	var sArgs 			= "";
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};


/*
 * 기능 : 유효성 검증
 */
this.fn_checkValidation = function() 
{
	var validation = {rtn: true, msg: ""};
	var objDs = this.ds_qamQcinspector;
	
	var certDate = objDs.getColumn(0, "CERTDATE");
	var enterDate = objDs.getColumn(0, "ENTERDATE");
	var retireDate = objDs.getColumn(0, "RETIREDATE");
	var grade = objDs.getColumn(0, "GRADE");
	
	// 등급
	if (grade == "None"){
		validation.rtn = false;
		validation.msg = "NoRegistGrade"; //NoRegistGrade
		return validation;
	}
	// 퇴사일자도 입력됬다면 포함해서 날짜 유효성 평가
	else if(!this.nfn_isNull(retireDate)) {
		/*if (enterDate > certDate || enterDate > retireDate || retireDate > certDate) {*/
		if (enterDate > certDate || enterDate > retireDate) {
			validation.rtn = false;
			validation.msg = "CheckDate"; //날짜를 확인해주세요.
			return validation;
		}
	} 
	// 입사일자만 입력됬다면 퇴사일자 빼고 날짜 유효성 평가
	else {
		if (enterDate > certDate) {
			validation.rtn = false;
			validation.msg = "CheckDate"; //날짜를 확인해주세요.
			return validation;
		}
	}
	
	return validation;
};

/*
 * 기능 : 차기 인증평가일을 인증평가일 + 1년으로 설정
 */
this.fn_setNextCertDate = function ()
{
	var objDs = this.ds_qamQcinspector;
	
	objDs.setColumn(0, "CERTDATE", this.gfn_today());
	var nextCertDate = this.gfn_addYear(objDs.getColumn(0, "CERTDATE"), 1);
	
	objDs.setColumn(0, "NEXTCERTDATE", nextCertDate);
	objDs.setColumn(0, "RETIREDATE", "");
	
};

/*
 * 기능 : 검사원 관리의 점수에 따른 등급조회 (AS-IS : GetInspectionScore)
 */
this.fn_searchInspectionScore = function (inspectionclassid, score)
{
	this.ds_output.clearData();
	this.ds_search.clearData();
	this.ds_search.addRow();
	
	this.ds_search.setColumn(0, "ENTERPRISEID", this.gf_getEnterpriseId());//ENTERPRISEID	
	this.ds_search.setColumn(0, "PLANTID", this.gf_getSiteType());//PLANTID
	this.ds_search.setColumn(0, "INSPECTIONCLASSID", inspectionclassid);
	this.ds_search.setColumn(0, "SCORE", score);
	
	var sSvcID 			= "selectInspectionScore";
	var sController 	= "/qam00300/selectInspectionScore.do";
	var sInDatasets 	= "INPUT=ds_search";
	var sOutDatasets 	= "ds_output=output";
	var sArgs 			= "";
	
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs);
};

/*
 * 기능 : 검사원 등록 시 이미 등록된 검사원명, 사원번호인지 조회 (AS-IS : GetExistInspector)
 */
this.fn_searchExistInspector = function ()
{
	this.ds_output.clearData();
	this.ds_search.clearData();
	this.ds_search.addRow();
	
	this.ds_search.setColumn(0, "ENTERPRISEID", this.gf_getEnterpriseId());//ENTERPRISEID	
	this.ds_search.setColumn(0, "PLANTID", this.gf_getSiteType());//PLANTID
	this.ds_search.setColumn(0, "EMPNO", this.ds_qamQcinspector.getColumn(0, "EMPNO"));
	this.ds_search.setColumn(0, "INSPECTORNAME", this.ds_qamQcinspector.getColumn(0, "INSPECTORNAME"));
	
	var sSvcID 			= "selectExistInspector";
	var sController 	= "/qam00300/selectExistInspector.do";
	var sInDatasets 	= "INPUT=ds_search";
	var sOutDatasets 	= "ds_output=output";
	var sArgs 			= "";
	
	this.gfn_transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgs, null, true, false);
};

/**************************************************************************
 * 8. 이벤트
 ***************************************************************************/


this.btn_close_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.close();
};

this.ds_qamQcinspector_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid == "INSPECTORNAME" && this.nfn_isNull(e.newvalue)) {
		obj.setColumn(e.row, "AREAID", "");
		obj.setColumn(e.row, "AREANAME", "");
	}
	if(e.columnid == "PREVCAREERYEAR") {
		this.qamfn_calCareer(this.ds_qamQcinspector, e.newvalue, obj.getColumn(e.row, "PREVCAREERMONTH"));
	}
	if(e.columnid == "PREVCAREERMONTH") {
		this.qamfn_calCareer(this.ds_qamQcinspector, obj.getColumn(e.row, "PREVCAREERYEAR"), e.newvalue);
	}
	if(e.columnid == "INSPECTIONCLASSID") {
		this.fn_searchInspectionScore(e.newvalue, obj.getColumn(e.row, "SCORE"));
	}
	if(e.columnid == "SCORE") {
		this.fn_searchInspectionScore(obj.getColumn(e.row, "INSPECTIONCLASSID"), e.newvalue);
	}
	this.qamfn_calCareer(this.ds_qamQcinspector);
};

]]></Script>
    <Bind>
      <BindItem id="item0" compid="div_basicInfo.form.cbo_site" propid="value" datasetid="ds_qamQcinspector" columnid="PLANTID"/>
      <BindItem id="item1" compid="div_basicInfo.form.edt_inspector" propid="value" datasetid="ds_qamQcinspector" columnid="INSPECTORNAME"/>
      <BindItem id="item2" compid="div_basicInfo.form.edt_inspector_id" propid="value" datasetid="ds_qamQcinspector" columnid="EMPNO"/>
      <BindItem id="item3" compid="div_basicInfo.form.edt_areaname" propid="value" datasetid="ds_qamQcinspector" columnid="AREANAME"/>
      <BindItem id="item4" compid="div_basicInfo.form.cal_certdate" propid="value" datasetid="ds_qamQcinspector" columnid="CERTDATE"/>
      <BindItem id="item5" compid="div_basicInfo.form.cal_nextcertdate" propid="value" datasetid="ds_qamQcinspector" columnid="NEXTCERTDATE"/>
      <BindItem id="item6" compid="div_basicInfo.form.cmb_inspectionclassid" propid="value" datasetid="ds_qamQcinspector" columnid="INSPECTIONCLASSID"/>
      <BindItem id="item7" compid="div_basicInfo.form.cal_enterdate" propid="value" datasetid="ds_qamQcinspector" columnid="ENTERDATE"/>
      <BindItem id="item8" compid="div_basicInfo.form.cal_retiredate" propid="value" datasetid="ds_qamQcinspector" columnid="RETIREDATE"/>
      <BindItem id="item9" compid="div_basicInfo.form.spn_prevcareeryear" propid="value" datasetid="ds_qamQcinspector" columnid="PREVCAREERYEAR"/>
      <BindItem id="item10" compid="div_basicInfo.form.spn_prevcareermonth" propid="value" datasetid="ds_qamQcinspector" columnid="PREVCAREERMONTH"/>
      <BindItem id="item11" compid="div_basicInfo.form.edt_career" propid="value" datasetid="ds_qamQcinspector" columnid="COMPANYCAREER"/>
      <BindItem id="item12" compid="div_basicInfo.form.edt_totalcareer" propid="value" datasetid="ds_qamQcinspector" columnid="CAREER"/>
      <BindItem id="item13" compid="div_basicInfo.form.edt_score" propid="value" datasetid="ds_qamQcinspector" columnid="SCORE"/>
      <BindItem id="item14" compid="div_basicInfo.form.edt_grade" propid="value" datasetid="ds_qamQcinspector" columnid="GRADE"/>
      <BindItem id="item15" compid="div_basicInfo.form.cbo_iscertfinish" propid="value" datasetid="ds_qamQcinspector" columnid="ISCERTFINISH"/>
      <BindItem id="item16" compid="div_basicInfo.form.cbo_evaluationtype" propid="value" datasetid="ds_qamQcinspector" columnid="EVALUATIONTYPE"/>
      <BindItem id="item17" compid="div_basicInfo.form.edt_inspectorno" propid="value" datasetid="ds_qamQcinspector" columnid="INSPECTORNO"/>
      <BindItem id="item18" compid="div_basicInfo.form.cbo_validstate" propid="value" datasetid="ds_qamQcinspector" columnid="VALIDSTATE"/>
      <BindItem id="item19" compid="div_basicInfo.form.edt_area_id" propid="value" datasetid="ds_qamQcinspector" columnid="AREAID"/>
    </Bind>
  </Form>
</FDL>
